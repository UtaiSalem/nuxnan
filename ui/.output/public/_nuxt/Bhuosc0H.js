import{_ as q,c as i,a as t,e as a,$ as f,aa as v,ab as L,F as M,k as Z,t as d,d as _,b as O,w as A,a1 as G,y as H,n as J,r as u,o as l,T as y,a7 as F,j as K,ai as R}from"./Brb_7992.js";import{a as k}from"./Dnk_-Q5K.js";const W={name:"ZoneManagement",setup(){const g=u({data:[],current_page:1,last_page:1,from:0,to:0,total:0}),e=u(!1),C=u(""),s=u(""),p=u(!1),c=u(null),o=u(!1),m=u({}),h=u({zone_name:"",description:"",color:"#3B82F6",is_active:!0,display_order:0}),V=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#84CC16"],j=J(()=>{const n=[],r=g.value.current_page,b=g.value.last_page,z=2;for(let w=Math.max(2,r-z);w<=Math.min(b-1,r+z);w++)n.push(w);return r-z>2&&n.unshift("..."),r+z<b-1&&n.push("..."),n.unshift(1),b>1&&n.push(b),n.filter((w,Q,I)=>I.indexOf(w)===Q)});let D=null;const S=()=>{clearTimeout(D),D=setTimeout(()=>{x(1)},500)},x=async(n=1)=>{e.value=!0;try{const r={page:n,per_page:10};C.value&&(r.search=C.value),s.value!==""&&(r.is_active=s.value);const b=await k.get("/home-visit/admin/zones",{params:r});g.value=b.data.zones}catch(r){console.error("Error loading zones:",r),alert("เกิดข้อผิดพลาดในการโหลดข้อมูล")}finally{e.value=!1}},E=()=>{c.value=null,h.value={zone_name:"",description:"",color:"#3B82F6",is_active:!0,display_order:0},m.value={},p.value=!0},U=n=>{c.value=n,h.value={zone_name:n.zone_name,description:n.description||"",color:n.color||"#3B82F6",is_active:n.is_active,display_order:n.display_order||0},m.value={},p.value=!0},B=()=>{p.value=!1,c.value=null,m.value={}},T=async()=>{o.value=!0,m.value={};try{c.value?(await k.put(`/home-visit/admin/zones/${c.value.id}`,h.value),alert("อัพเดทโซนเรียบร้อยแล้ว")):(await k.post("/home-visit/admin/zones",h.value),alert("เพิ่มโซนเรียบร้อยแล้ว")),B(),x(g.value.current_page)}catch(n){console.error("Error saving zone:",n),n.response&&n.response.data.errors?m.value=n.response.data.errors:alert("เกิดข้อผิดพลาดในการบันทึกข้อมูล")}finally{o.value=!1}},N=async n=>{try{const r=await k.put(`/home-visit/admin/zones/${n.id}/toggle-status`);alert(r.data.message),x(g.value.current_page)}catch(r){console.error("Error toggling zone status:",r),alert("เกิดข้อผิดพลาดในการเปลี่ยนสถานะ")}},P=async n=>{if(n.home_visits_count>0){alert("ไม่สามารถลบโซนที่มีการเยี่ยมบ้านอยู่ได้ กรุณาย้ายหรือลบการเยี่ยมบ้านก่อน");return}if(confirm(`คุณแน่ใจหรือไม่ที่จะลบโซน "${n.zone_name}"?`))try{await k.delete(`/home-visit/admin/zones/${n.id}`),alert("ลบโซนเรียบร้อยแล้ว"),x(g.value.current_page)}catch(r){console.error("Error deleting zone:",r),alert(r.response?.data?.message||"เกิดข้อผิดพลาดในการลบโซน")}};return H(()=>{x()}),{zones:g,loading:e,searchQuery:C,statusFilter:s,showModal:p,editingZone:c,saving:o,errors:m,formData:h,presetColors:V,visiblePages:j,debouncedSearch:S,loadZones:x,openCreateModal:E,editZone:U,closeModal:B,saveZone:T,toggleZoneStatus:N,deleteZone:P}}},X={class:"space-y-6"},Y={class:"flex justify-between items-center"},$={class:"bg-white shadow rounded-lg p-4"},ee={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},te={class:"md:col-span-2"},se={class:"relative"},oe={key:0,class:"text-center py-12"},ne={key:1,class:"space-y-4"},re={class:"p-6"},ie={class:"flex items-start justify-between"},le={class:"flex items-start space-x-4 flex-1"},ae={class:"flex-1 min-w-0"},de={class:"flex items-center space-x-3"},me={class:"text-lg font-semibold text-gray-900"},ue={key:0,class:"mt-2 text-sm text-gray-600"},ge={class:"mt-3 flex items-center text-sm text-gray-500"},fe={class:"flex items-center space-x-2 ml-4"},ce=["onClick"],xe=["onClick"],be=["onClick","disabled"],ve={key:2,class:"bg-white shadow rounded-lg p-12 text-center"},ye={key:3,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6 rounded-lg shadow"},pe={class:"flex-1 flex justify-between sm:hidden"},he=["disabled"],we=["disabled"],_e={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},ke={class:"text-sm text-gray-700"},Ce={class:"font-medium"},ze={class:"font-medium"},Me={class:"font-medium"},Ze={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px","aria-label":"Pagination"},De=["disabled"],Be=["onClick"],Fe=["disabled"],Ve={key:0,class:"fixed z-50 inset-0 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},je={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Se={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},Ee={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4"},Ue={class:"sm:flex sm:items-start"},Te={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1"},Ne={class:"text-lg leading-6 font-medium text-gray-900",id:"modal-title"},Pe={class:"mt-4 space-y-4"},Qe={key:0,class:"mt-1 text-sm text-red-600"},Ie={class:"mt-1 flex items-center space-x-3"},qe={class:"mt-2 flex space-x-2"},Le=["onClick"],Oe={class:"flex items-center"},Ae={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Ge=["disabled"],He={key:0,class:"fas fa-spinner fa-spin mr-2"},Je=["disabled"];function Ke(g,e,C,s,p,c){return l(),i("div",X,[t("div",Y,[e[20]||(e[20]=t("div",null,[t("h2",{class:"text-2xl font-bold text-gray-900"},"จัดการโซนการเยี่ยมบ้าน"),t("p",{class:"mt-1 text-sm text-gray-600"}," จัดการโซนพื้นที่สำหรับการเยี่ยมบ้านนักเรียน ")],-1)),t("button",{onClick:e[0]||(e[0]=(...o)=>s.openCreateModal&&s.openCreateModal(...o)),class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...e[19]||(e[19]=[t("i",{class:"fas fa-plus mr-2"},null,-1),a(" เพิ่มโซนใหม่ ",-1)])])]),t("div",$,[t("div",ee,[t("div",te,[e[22]||(e[22]=t("label",{for:"search",class:"sr-only"},"ค้นหาโซน",-1)),t("div",se,[e[21]||(e[21]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("i",{class:"fas fa-search text-gray-400"})],-1)),f(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>s.searchQuery=o),type:"text",id:"search",class:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"ค้นหาจากชื่อโซน หรือรหัสโซน...",onInput:e[2]||(e[2]=(...o)=>s.debouncedSearch&&s.debouncedSearch(...o))},null,544),[[v,s.searchQuery]])])]),t("div",null,[e[24]||(e[24]=t("label",{for:"status-filter",class:"sr-only"},"กรองตามสถานะ",-1)),f(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>s.statusFilter=o),id:"status-filter",class:"block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",onChange:e[4]||(e[4]=(...o)=>s.loadZones&&s.loadZones(...o))},[...e[23]||(e[23]=[t("option",{value:""},"ทั้งหมด",-1),t("option",{value:"1"},"เปิดใช้งาน",-1),t("option",{value:"0"},"ปิดใช้งาน",-1)])],544),[[L,s.statusFilter]])])])]),s.loading?(l(),i("div",oe,[...e[25]||(e[25]=[t("i",{class:"fas fa-spinner fa-spin text-4xl text-indigo-500"},null,-1),t("p",{class:"mt-2 text-gray-600"},"กำลังโหลดข้อมูล...",-1)])])):s.zones.data&&s.zones.data.length>0?(l(),i("div",ne,[(l(!0),i(M,null,Z(s.zones.data,o=>(l(),i("div",{key:o.id,class:y(["bg-white shadow rounded-lg overflow-hidden hover:shadow-md transition-shadow duration-200",{"opacity-60":!o.is_active}])},[t("div",re,[t("div",ie,[t("div",le,[t("div",{class:"w-16 h-16 rounded-lg flex-shrink-0",style:F({backgroundColor:o.color||"#6B7280"})},null,4),t("div",ae,[t("div",de,[t("h3",me,d(o.zone_name),1),t("span",{class:y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",o.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},d(o.is_active?"เปิดใช้งาน":"ปิดใช้งาน"),3)]),o.description?(l(),i("p",ue,d(o.description),1)):_("",!0),t("div",ge,[e[28]||(e[28]=t("i",{class:"fas fa-home mr-2"},null,-1)),t("span",null,[e[26]||(e[26]=a("จำนวนการเยี่ยมบ้าน: ",-1)),t("strong",null,d(o.home_visits_count||0),1),e[27]||(e[27]=a(" ครั้ง",-1))])])])]),t("div",fe,[t("button",{onClick:m=>s.toggleZoneStatus(o),class:y(["inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",o.is_active?"hover:bg-yellow-50":"hover:bg-green-50"])},[t("i",{class:y([o.is_active?"fas fa-toggle-on text-green-600":"fas fa-toggle-off text-gray-400","mr-2"])},null,2),a(" "+d(o.is_active?"ปิดใช้งาน":"เปิดใช้งาน"),1)],10,ce),t("button",{onClick:m=>s.editZone(o),class:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},[...e[29]||(e[29]=[t("i",{class:"fas fa-edit mr-2"},null,-1),a(" แก้ไข ",-1)])],8,xe),t("button",{onClick:m=>s.deleteZone(o),class:y(["inline-flex items-center px-3 py-2 border border-red-300 shadow-sm text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",{"opacity-50 cursor-not-allowed":o.home_visits_count>0}]),disabled:o.home_visits_count>0},[...e[30]||(e[30]=[t("i",{class:"fas fa-trash mr-2"},null,-1),a(" ลบ ",-1)])],10,be)])])])],2))),128))])):(l(),i("div",ve,[e[32]||(e[32]=t("i",{class:"fas fa-map-marked-alt text-6xl text-gray-300 mb-4"},null,-1)),e[33]||(e[33]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"ยังไม่มีโซน",-1)),e[34]||(e[34]=t("p",{class:"text-gray-500 mb-6"},"เริ่มต้นสร้างโซนการเยี่ยมบ้านเพื่อจัดการพื้นที่",-1)),t("button",{onClick:e[5]||(e[5]=(...o)=>s.openCreateModal&&s.openCreateModal(...o)),class:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700"},[...e[31]||(e[31]=[t("i",{class:"fas fa-plus mr-2"},null,-1),a(" เพิ่มโซนแรก ",-1)])])])),s.zones.data&&s.zones.data.length>0?(l(),i("div",ye,[t("div",pe,[t("button",{onClick:e[6]||(e[6]=o=>s.loadZones(s.zones.current_page-1)),disabled:s.zones.current_page===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," ก่อนหน้า ",8,he),t("button",{onClick:e[7]||(e[7]=o=>s.loadZones(s.zones.current_page+1)),disabled:s.zones.current_page===s.zones.last_page,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"}," ถัดไป ",8,we)]),t("div",_e,[t("div",null,[t("p",ke,[e[35]||(e[35]=a(" แสดง ",-1)),t("span",Ce,d(s.zones.from),1),e[36]||(e[36]=a(" ถึง ",-1)),t("span",ze,d(s.zones.to),1),e[37]||(e[37]=a(" จาก ",-1)),t("span",Me,d(s.zones.total),1),e[38]||(e[38]=a(" รายการ ",-1))])]),t("div",null,[t("nav",Ze,[t("button",{onClick:e[8]||(e[8]=o=>s.loadZones(s.zones.current_page-1)),disabled:s.zones.current_page===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},[...e[39]||(e[39]=[t("i",{class:"fas fa-chevron-left"},null,-1)])],8,De),(l(!0),i(M,null,Z(s.visiblePages,o=>(l(),i("button",{key:o,onClick:m=>s.loadZones(o),class:y([o===s.zones.current_page?"z-10 bg-indigo-50 border-indigo-500 text-indigo-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},d(o),11,Be))),128)),t("button",{onClick:e[9]||(e[9]=o=>s.loadZones(s.zones.current_page+1)),disabled:s.zones.current_page===s.zones.last_page,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"},[...e[40]||(e[40]=[t("i",{class:"fas fa-chevron-right"},null,-1)])],8,Fe)])])])])):_("",!0),O(G,{name:"modal"},{default:A(()=>[s.showModal?(l(),i("div",Ve,[t("div",je,[t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:e[10]||(e[10]=(...o)=>s.closeModal&&s.closeModal(...o))}),e[48]||(e[48]=t("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),t("div",Se,[t("form",{onSubmit:e[18]||(e[18]=K((...o)=>s.saveZone&&s.saveZone(...o),["prevent"]))},[t("div",Ee,[t("div",Ue,[e[47]||(e[47]=t("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100 sm:mx-0 sm:h-10 sm:w-10"},[t("i",{class:"fas fa-map-marked-alt text-indigo-600"})],-1)),t("div",Te,[t("h3",Ne,d(s.editingZone?"แก้ไขโซน":"เพิ่มโซนใหม่"),1),t("div",Pe,[t("div",null,[e[41]||(e[41]=t("label",{for:"zone_name",class:"block text-sm font-medium text-gray-700"},[a(" ชื่อโซน "),t("span",{class:"text-red-500"},"*")],-1)),f(t("input",{"onUpdate:modelValue":e[11]||(e[11]=o=>s.formData.zone_name=o),type:"text",id:"zone_name",required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"เช่น โซนเหนือ, โซนกลาง"},null,512),[[v,s.formData.zone_name]]),s.errors.zone_name?(l(),i("p",Qe,d(s.errors.zone_name[0]),1)):_("",!0)]),t("div",null,[e[42]||(e[42]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," รายละเอียด ",-1)),f(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=o=>s.formData.description=o),id:"description",rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"คำอธิบายเกี่ยวกับโซนนี้"},null,512),[[v,s.formData.description]])]),t("div",null,[e[43]||(e[43]=t("label",{for:"color",class:"block text-sm font-medium text-gray-700"}," สีประจำโซน ",-1)),t("div",Ie,[f(t("input",{"onUpdate:modelValue":e[13]||(e[13]=o=>s.formData.color=o),type:"color",id:"color",class:"h-10 w-20 border-gray-300 rounded-md cursor-pointer"},null,512),[[v,s.formData.color]]),f(t("input",{"onUpdate:modelValue":e[14]||(e[14]=o=>s.formData.color=o),type:"text",class:"flex-1 border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"#3B82F6"},null,512),[[v,s.formData.color]])]),t("div",qe,[(l(!0),i(M,null,Z(s.presetColors,o=>(l(),i("button",{key:o,type:"button",onClick:m=>s.formData.color=o,class:"w-8 h-8 rounded-full border-2 border-gray-300 hover:border-gray-400",style:F({backgroundColor:o})},null,12,Le))),128))])]),t("div",null,[e[44]||(e[44]=t("label",{for:"display_order",class:"block text-sm font-medium text-gray-700"}," ลำดับการแสดง ",-1)),f(t("input",{"onUpdate:modelValue":e[15]||(e[15]=o=>s.formData.display_order=o),type:"number",id:"display_order",min:"0",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"0"},null,512),[[v,s.formData.display_order,void 0,{number:!0}]]),e[45]||(e[45]=t("p",{class:"mt-1 text-xs text-gray-500"},"ตัวเลขน้อยแสดงก่อน",-1))]),t("div",Oe,[f(t("input",{"onUpdate:modelValue":e[16]||(e[16]=o=>s.formData.is_active=o),type:"checkbox",id:"is_active",class:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"},null,512),[[R,s.formData.is_active]]),e[46]||(e[46]=t("label",{for:"is_active",class:"ml-2 block text-sm text-gray-900"}," เปิดใช้งาน ",-1))])])])])]),t("div",Ae,[t("button",{type:"submit",disabled:s.saving,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50"},[s.saving?(l(),i("i",He)):_("",!0),a(" "+d(s.saving?"กำลังบันทึก...":"บันทึก"),1)],8,Ge),t("button",{type:"button",onClick:e[17]||(e[17]=(...o)=>s.closeModal&&s.closeModal(...o)),disabled:s.saving,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"}," ยกเลิก ",8,Je)])],32)])])])):_("",!0)]),_:1})])}const Xe=q(W,[["render",Ke],["__scopeId","data-v-23a55ad0"]]);export{Xe as default};
