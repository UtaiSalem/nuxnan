import{q as J,n as k,c,o as i,a as e,d as x,b as a,u as s,I as u,e as A,t as f,T,j as M,w as F,a9 as te,r as q,V as se,a3 as X,g as Y,a1 as H,a4 as re,$ as I,aa as O,F as R,k as G,f as ae,ai as Z,K as W,ay as oe,z as le,W as ie,U as ee,aE as ne}from"./CHs-R6Sv.js";import{_ as de,a as ue}from"./C4w5myq4.js";import{S}from"./BQxta0Da.js";import{C as ce}from"./DEyJstjP.js";const ge={class:"group relative bg-white dark:bg-gray-800 rounded-3xl shadow-xl hover:shadow-2xl hover:shadow-indigo-500/20 transition-all duration-300 overflow-hidden mb-8 border border-gray-100 dark:border-gray-700 isolate"},pe={class:"relative h-48 overflow-hidden"},fe={class:"absolute inset-0 flex items-center justify-center"},xe={class:"relative z-10 p-6 text-center transform transition-transform duration-500 group-hover:-translate-y-2"},me={class:"w-16 h-16 mx-auto bg-white/20 backdrop-blur-md rounded-2xl flex items-center justify-center mb-3 shadow-inner ring-1 ring-white/30"},be={class:"absolute top-4 left-4 z-20 flex flex-wrap gap-2"},ve={class:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-black/30 backdrop-blur-md text-white ring-1 ring-white/20 shadow-sm"},ye={key:0,class:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold bg-blue-500/20 backdrop-blur-md text-blue-50 ring-1 ring-blue-400/30 shadow-sm"},he={class:"absolute top-4 right-4 z-20"},we={key:0,class:"absolute bottom-4 right-4 z-20 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-300 translate-y-2 group-hover:translate-y-0"},ke={class:"p-6 md:p-8 relative z-10"},_e={class:"flex justify-between items-start mb-6"},ze={class:"flex-1 pr-4"},qe={class:"text-2xl md:text-3xl font-extrabold text-gray-800 dark:text-white leading-tight mb-2 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors"},$e={key:0,class:"text-gray-500 dark:text-gray-400 text-sm line-clamp-2 leading-relaxed"},Ce={class:"flex flex-col items-center justify-center w-16 h-16 rounded-2xl bg-amber-50 dark:bg-amber-900/10 border border-amber-100 dark:border-amber-700/30 text-amber-600 dark:text-amber-500 shadow-sm flex-shrink-0"},De={class:"text-xl font-black"},Ve={class:"grid grid-cols-2 gap-4 mb-6"},je={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700"},Ae={class:"w-10 h-10 rounded-lg bg-white dark:bg-gray-800 flex items-center justify-center text-indigo-500 shadow-sm"},Be={class:"font-bold text-gray-700 dark:text-gray-200"},Te={class:"flex items-center gap-3 p-3 rounded-xl bg-gray-50 dark:bg-gray-700/30 border border-gray-100 dark:border-gray-700"},Me={class:"w-10 h-10 rounded-lg bg-white dark:bg-gray-800 flex items-center justify-center text-emerald-500 shadow-sm"},Se={class:"font-bold text-gray-700 dark:text-gray-200"},Ee={key:0,class:"flex flex-wrap gap-y-2 gap-x-6 text-sm text-gray-500 dark:text-gray-400 mb-6 px-1"},Ie={key:0,class:"flex items-center gap-1.5"},Fe={key:1,class:"flex items-center gap-1.5"},Ue={key:1,class:"mb-6"},Le={class:"p-4 flex items-center justify-between relative z-10"},Pe={class:"flex items-center gap-4"},Ne={class:"relative"},Qe={class:"text-right"},He={class:"text-sm font-medium text-gray-500"},Re={class:"flex items-center gap-3"},We={key:1,class:"flex-[2] py-3 px-6 rounded-xl font-bold bg-gray-100 text-gray-400 flex items-center justify-center gap-2 cursor-not-allowed"},Ke=J({__name:"QuizPost",props:{quiz:{},isAdmin:{type:Boolean,default:!1},courseId:{},quizIndex:{default:1}},emits:["edit","delete","start","view","duplicate"],setup(p,{emit:h}){const l=p,_=h,$=k(()=>l.quiz.is_active||l.quiz.status===1?{text:"เผยแพร่แล้ว",color:"bg-emerald-500/90 text-white shadow-emerald-500/30",icon:"fluent:checkmark-circle-24-filled"}:{text:"ฉบับร่าง",color:"bg-gray-500/90 text-white",icon:"fluent:draft-24-regular"}),b=k(()=>l.quiz.questions_count||l.quiz.questions?.length||0),w=k(()=>l.quiz.total_score||0),r=k(()=>l.quiz.time_limit||0),v=k(()=>l.quiz.passing_score||50),j=k(()=>{const z=new Date;return!(l.quiz.start_date&&new Date(l.quiz.start_date)>z||l.quiz.end_date&&new Date(l.quiz.end_date)<z)}),C=z=>z?new Date(z).toLocaleDateString("th-TH",{day:"numeric",month:"short",year:"2-digit",hour:"2-digit",minute:"2-digit"}):"-",m=k(()=>l.quiz.current_result&&l.quiz.current_result.completed_at),U=k(()=>m.value?l.quiz.current_result?.score||0:null),D=k(()=>m.value?parseFloat(l.quiz.current_result?.percentage||0).toFixed(1):null),y=k(()=>l.quiz.current_result?.status==="Pass"||l.quiz.current_result?.status==="passed"||l.quiz.current_result?.status===3),V=k(()=>{if(!y.value)return!1;const z=parseFloat(l.quiz.current_result?.percentage||0),n=l.quiz.passing_score||50;return z<n+10}),L=()=>_("edit",l.quiz),P=()=>_("delete",l.quiz.id),N=()=>_("start",l.quiz),Q=()=>_("view",l.quiz),E=()=>_("duplicate",l.quiz);return(z,n)=>(i(),c("article",ge,[n[10]||(n[10]=e("div",{class:"absolute -top-24 -right-24 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl group-hover:bg-purple-500/20 transition-all duration-500"},null,-1)),n[11]||(n[11]=e("div",{class:"absolute -bottom-24 -left-24 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl group-hover:bg-blue-500/20 transition-all duration-500"},null,-1)),e("div",pe,[n[1]||(n[1]=e("div",{class:"absolute inset-0 bg-gradient-to-br from-indigo-600 via-purple-600 to-blue-600 transition-transform duration-700 group-hover:scale-105"},null,-1)),n[2]||(n[2]=e("div",{class:"absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"},null,-1)),e("div",fe,[e("div",xe,[e("div",me,[a(s(u),{icon:"healthicons:i-exam-qualification-outline",class:"w-9 h-9 text-white drop-shadow-md"})]),n[0]||(n[0]=e("h3",{class:"text-white font-bold text-lg opacity-90 tracking-wide uppercase"},"แบบทดสอบ",-1))])]),e("div",be,[e("span",ve,[a(s(u),{icon:"fluent:number-symbol-24-filled",class:"w-3.5 h-3.5"}),A(" ชุดที่ "+f(p.quizIndex),1)]),r.value?(i(),c("span",ye,[a(s(u),{icon:"fluent:timer-24-filled",class:"w-3.5 h-3.5"}),A(" "+f(r.value)+" นาที ",1)])):x("",!0)]),e("div",he,[e("span",{class:T([$.value.color,"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold shadow-lg backdrop-blur-md ring-1 ring-white/20"])},[a(s(u),{icon:$.value.icon,class:"w-3.5 h-3.5"},null,8,["icon"]),A(" "+f($.value.text),1)],2)]),p.isAdmin?(i(),c("div",we,[e("button",{onClick:M(E,["stop"]),class:"p-2.5 bg-white text-gray-700 rounded-xl hover:bg-purple-50 hover:text-purple-600 transition-colors shadow-lg",title:"คัดลอก"},[a(s(u),{icon:"fluent:copy-24-filled",class:"w-5 h-5"})]),e("button",{onClick:M(L,["stop"]),class:"p-2.5 bg-white text-gray-700 rounded-xl hover:bg-gray-50 hover:text-blue-600 transition-colors shadow-lg",title:"แก้ไข"},[a(s(u),{icon:"fluent:edit-24-filled",class:"w-5 h-5"})]),e("button",{onClick:M(P,["stop"]),class:"p-2.5 bg-white text-gray-700 rounded-xl hover:bg-red-50 hover:text-red-600 transition-colors shadow-lg",title:"ลบ"},[a(s(u),{icon:"fluent:delete-24-filled",class:"w-5 h-5"})])])):x("",!0)]),e("div",ke,[e("div",_e,[e("div",ze,[e("h2",qe,f(p.quiz.title||p.quiz.name),1),p.quiz.description?(i(),c("p",$e,f(p.quiz.description),1)):x("",!0)]),e("div",Ce,[e("span",De,f(w.value),1),n[3]||(n[3]=e("span",{class:"text-[10px] font-bold uppercase tracking-wide"},"คะแนน",-1))])]),e("div",Ve,[e("div",je,[e("div",Ae,[a(s(u),{icon:"fluent:document-text-24-filled",class:"w-5 h-5"})]),e("div",null,[n[4]||(n[4]=e("p",{class:"text-xs text-gray-400 font-medium uppercase"},"จำนวนข้อ",-1)),e("p",Be,f(b.value)+" ข้อ",1)])]),e("div",Te,[e("div",Me,[a(s(u),{icon:"fluent:target-arrow-24-filled",class:"w-5 h-5"})]),e("div",null,[n[5]||(n[5]=e("p",{class:"text-xs text-gray-400 font-medium uppercase"},"เกณฑ์ผ่าน",-1)),e("p",Se,f(v.value)+"%",1)])])]),p.quiz.start_date||p.quiz.end_date?(i(),c("div",Ee,[p.quiz.start_date?(i(),c("div",Ie,[a(s(u),{icon:"fluent:calendar-ltr-24-regular",class:"w-4 h-4 text-gray-400"}),e("span",null,"เริ่ม: "+f(C(p.quiz.start_date)),1)])):x("",!0),p.quiz.end_date?(i(),c("div",Fe,[a(s(u),{icon:"fluent:calendar-end-24-regular",class:"w-4 h-4 text-gray-400"}),e("span",null,"สิ้นสุด: "+f(C(p.quiz.end_date)),1)])):x("",!0)])):x("",!0),n[9]||(n[9]=e("div",{class:"h-px w-full bg-gradient-to-r from-transparent via-gray-200 dark:via-gray-700 to-transparent mb-6"},null,-1)),m.value&&!p.isAdmin?(i(),c("div",Ue,[e("div",{class:T(["relative overflow-hidden rounded-2xl border transition-all duration-300",y.value?V.value?"bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200 dark:from-orange-900/20 dark:to-amber-900/20 dark:border-orange-800":"bg-gradient-to-r from-emerald-50 to-teal-50 border-emerald-200 dark:from-emerald-900/20 dark:to-teal-900/20 dark:border-emerald-800":"bg-gradient-to-r from-red-50 to-orange-50 border-red-200 dark:from-red-900/20 dark:to-orange-900/20 dark:border-red-800"])},[e("div",Le,[e("div",Pe,[e("div",Ne,[a(de,{percentage:parseFloat(D.value),color:y.value?V.value?"text-orange-500":"text-emerald-500":"text-red-500",size:52,strokeWidth:4,class:"bg-white rounded-full shadow-sm"},{default:F(()=>[a(s(u),{icon:y.value?"fluent:trophy-24-filled":"fluent:dismiss-circle-24-filled",class:T(["w-5 h-5",y.value?V.value?"text-orange-500":"text-emerald-500":"text-red-500"])},null,8,["icon","class"])]),_:1},8,["percentage","color"])]),e("div",null,[e("p",{class:T(["text-xs font-bold uppercase opacity-70",y.value?V.value?"text-orange-800 dark:text-orange-300":"text-emerald-800 dark:text-emerald-300":"text-red-800 dark:text-red-300"])},"ผลการทดสอบ",2),e("p",{class:T(["text-lg font-black tracking-tight",y.value?V.value?"text-orange-700 dark:text-orange-400":"text-emerald-700 dark:text-emerald-400":"text-red-700 dark:text-red-400"])},f(y.value?V.value?"ผ่านแบบเฉียดฉิว":"ผ่านการทดสอบ":"ไม่ผ่านเกณฑ์"),3)])]),e("div",Qe,[e("div",{class:T(["text-2xl font-black tabular-nums",y.value?"text-emerald-600":"text-red-600"])},[A(f(U.value),1),e("span",He,"/"+f(w.value),1)],2)])]),e("div",{class:T(["absolute -right-6 -bottom-6 w-24 h-24 rounded-full opacity-50 blur-2xl",y.value?"bg-emerald-400":"bg-red-400"])},null,2)],2)])):x("",!0),e("div",Re,[e("button",{onClick:Q,class:"flex-1 py-3 px-4 rounded-xl font-bold text-gray-600 dark:text-gray-300 bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors flex items-center justify-center gap-2"},[a(s(u),{icon:"fluent:eye-24-filled",class:"w-5 h-5"}),n[6]||(n[6]=A(" รายละเอียด ",-1))]),!p.isAdmin||p.isAdmin&&p.quiz.questions_count>0?(i(),c("button",{key:0,onClick:N,class:T(["flex-[2] py-3 px-6 rounded-xl font-bold text-white shadow-lg hover:shadow-indigo-500/30 transform hover:-translate-y-0.5 transition-all flex items-center justify-center gap-2 relative overflow-hidden group/btn",p.isAdmin?"bg-gray-900 dark:bg-gray-700":m.value?"bg-gradient-to-r from-blue-600 to-cyan-600":"bg-gradient-to-r from-indigo-600 to-purple-600"])},[n[7]||(n[7]=e("div",{class:"absolute inset-0 bg-white/20 translate-y-full group-hover/btn:translate-y-0 transition-transform duration-300"},null,-1)),a(s(u),{icon:m.value?"fluent:arrow-rotate-clockwise-24-filled":"fluent:play-circle-24-filled",class:"w-6 h-6"},null,8,["icon"]),e("span",null,f(p.isAdmin?"ทดสอบ (Admin)":m.value?"ทำแบบทดสอบอีกครั้ง":"เริ่มทำแบบทดสอบ"),1)],2)):x("",!0),!p.isAdmin&&!j.value?(i(),c("div",We,[a(s(u),{icon:"fluent:lock-closed-24-filled"}),n[8]||(n[8]=e("span",null,"ยังไม่เปิด",-1))])):x("",!0)])])]))}}),Oe={class:"flex items-center justify-between p-5 border-b border-gray-200 dark:border-gray-700"},Ye={class:"flex items-center gap-3"},Ge={class:"w-10 h-10 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center"},Je=["disabled"],Xe={class:"p-5 space-y-5 max-h-[calc(100vh-240px)] overflow-y-auto"},Ze={class:"relative"},et={class:"relative"},tt={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-xl overflow-hidden"},st={class:"px-4 py-2 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/30 dark:to-indigo-900/30 border-b border-gray-100 dark:border-gray-700"},rt={class:"text-xs font-semibold text-purple-700 dark:text-purple-300 flex items-center gap-1.5"},at={class:"max-h-48 overflow-y-auto"},ot=["onMousedown"],lt={class:"w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0"},it={class:"flex-1 min-w-0"},nt={class:"font-medium text-gray-900 dark:text-white truncate text-sm"},dt={class:"flex items-center gap-2 text-xs text-gray-500"},ut={key:0,class:"text-purple-600 dark:text-purple-400 truncate"},ct={class:"flex items-center gap-1"},gt=["onMousedown"],pt=["onMousedown"],ft={class:"grid grid-cols-2 gap-4"},xt={class:"relative"},mt={class:"grid grid-cols-2 gap-4"},bt={class:"flex flex-wrap gap-4"},vt={class:"flex items-center gap-2 cursor-pointer"},yt={class:"flex items-center gap-2 cursor-pointer"},ht={key:0,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3"},wt={class:"list-disc list-inside text-sm text-red-600 dark:text-red-400"},kt={class:"flex justify-end gap-3 p-5 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50 rounded-b-2xl"},_t=["disabled"],zt=["disabled"],qt={key:0,class:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50"},$t={class:"bg-white dark:bg-gray-800 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-2xl"},Ct=J({__name:"QuizCreateModal",props:{courseId:{},show:{type:Boolean}},emits:["close","created"],setup(p,{emit:h}){const l=p,_=h,$=te(),b=q(!1),w=q([]),r=se({title:"",description:"",start_date:new Date,end_date:new Date(Date.now()+3600*1e3),time_limit:60,passing_score:50,is_active:!0,shuffle_questions:!1}),v=q([]),j=q(!1),C=q(!1),m=q(!1),U=k(()=>C.value&&v.value.length>0);let D=null;X(()=>r.title,o=>{D&&clearTimeout(D),o&&o.length>=2?D=setTimeout(y,300):v.value=[]});const y=async()=>{if(!(!r.title||r.title.length<2)){j.value=!0;try{const o=await $.get(`/api/quizzes/search?q=${encodeURIComponent(r.title)}`);Array.isArray(o)?v.value=o:o.quizzes?v.value=o.quizzes:o.data?v.value=Array.isArray(o.data)?o.data:[]:v.value=[]}catch(o){console.error("Error searching quizzes:",o),v.value=[]}finally{j.value=!1}}},V=()=>{C.value=!0,r.title&&r.title.length>=2&&v.value.length===0&&y()},L=()=>{setTimeout(()=>{C.value=!1},300)},P=o=>{r.title=o.title||"",r.description=o.description||"",r.time_limit=o.time_limit||60,r.passing_score=o.passing_score||50,r.shuffle_questions=!!o.shuffle_questions,r.is_active=!!o.is_active,C.value=!1,S.fire({icon:"info",title:"นำค่ามาใช้แล้ว",text:"ข้อมูลถูกนำมาใส่ในฟอร์มแล้ว",timer:2e3,showConfirmButton:!1})},N=o=>{v.value=v.value.filter((t,d)=>d!==o)},Q=async o=>{const t=await S.fire({title:"คัดลอกแบบทดสอบ",html:`
      <p class="mb-4">คุณต้องการคัดลอก "${o.title}" มาใช้ในคอร์สนี้หรือไม่?</p>
      <input id="swal-new-title" class="swal2-input" placeholder="ชื่อแบบทดสอบใหม่" value="${o.title} (สำเนา)">
    `,icon:"question",showCancelButton:!0,confirmButtonText:"คัดลอก",cancelButtonText:"ยกเลิก",confirmButtonColor:"#8b5cf6",preConfirm:()=>{const d=document.getElementById("swal-new-title");return d.value.trim()?d.value.trim():(S.showValidationMessage("กรุณาระบุชื่อแบบทดสอบ"),!1)}});if(t.isConfirmed&&t.value){m.value=!0;try{const d=await $.post(`/api/quizzes/${o.id}/duplicate`,{course_id:Number(l.courseId),title:t.value});(d.success||d.quiz)&&(await S.fire({icon:"success",title:"คัดลอกสำเร็จ!",text:"แบบทดสอบถูกคัดลอกมายังคอร์สนี้แล้ว",timer:2e3,showConfirmButton:!1}),_("created",d.quiz),_("close"),W(`/courses/${l.courseId}/quizzes/${d.quiz.id}/edit`))}catch(d){console.error("Error duplicating quiz:",d),S.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:d?.data?.message||"ไม่สามารถคัดลอกแบบทดสอบได้"})}finally{m.value=!1}}},E=k(()=>r.title.trim()!==""&&r.time_limit>0&&r.passing_score>=0&&r.passing_score<=100&&(!r.start_date||!r.end_date||new Date(r.end_date)>new Date(r.start_date))),z=async()=>{if(!(!E.value||b.value)){b.value=!0,w.value=[];try{const o={title:r.title,description:r.description,time_limit:r.time_limit,passing_score:r.passing_score,is_active:r.is_active,shuffle_questions:r.shuffle_questions,start_date:r.start_date,end_date:r.end_date},t=await $.post(`/api/courses/${l.courseId}/quizzes`,o);(t.success||t.quiz)&&(S.fire({icon:"success",title:"สร้างแบบทดสอบสำเร็จ",timer:1500,showConfirmButton:!1}),_("created",t.quiz||t.data),_("close"),t.quiz?.id&&W(`/courses/${l.courseId}/quizzes/${t.quiz.id}/edit`))}catch(o){console.error(o),o.data?.errors?w.value=Object.values(o.data.errors).flat():w.value=["เกิดข้อผิดพลาดในการสร้างแบบทดสอบ"],S.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:w.value[0]})}finally{b.value=!1}}};X(()=>l.show,o=>{o||(r.title="",r.description="",r.time_limit=60,r.passing_score=50,r.is_active=!0,r.shuffle_questions=!1,r.start_date=new Date,r.end_date=new Date(Date.now()+3600*1e3),w.value=[],v.value=[])});const n=()=>{!b.value&&!m.value&&_("close")};return(o,t)=>{const d=ae("VueDatePicker");return i(),Y(re,{to:"body"},[a(H,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:F(()=>[p.show?(i(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto py-8 bg-black/50 backdrop-blur-sm",onClick:M(n,["self"])},[a(H,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 scale-95","enter-to-class":"opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100 scale-100","leave-to-class":"opacity-0 scale-95"},{default:F(()=>[p.show?(i(),c("div",{key:0,class:"relative w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-2xl mx-4",onClick:t[8]||(t[8]=M(()=>{},["stop"]))},[e("div",Oe,[e("div",Ye,[e("div",Ge,[a(s(u),{icon:"fluent:quiz-new-24-filled",class:"w-5 h-5 text-white"})]),t[9]||(t[9]=e("div",null,[e("h2",{class:"text-lg font-bold text-gray-900 dark:text-white"},"สร้างแบบทดสอบใหม่"),e("p",{class:"text-sm text-gray-500"},"กรอกข้อมูลเพื่อสร้างแบบทดสอบ")],-1))]),e("button",{onClick:n,disabled:s(b)||s(m),class:"p-2 rounded-lg text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"},[a(s(u),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"})],8,Je)]),e("div",Xe,[e("div",Ze,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[A(" ชื่อแบบทดสอบ "),e("span",{class:"text-red-500"},"*")],-1)),e("div",et,[I(e("input",{"onUpdate:modelValue":t[0]||(t[0]=g=>s(r).title=g),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-shadow",placeholder:"เช่น แบบทดสอบบทที่ 1",onFocus:V,onBlur:L},null,544),[[O,s(r).title]]),s(j)?(i(),Y(s(u),{key:0,icon:"svg-spinners:ring-resize",class:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-500"})):x("",!0)]),a(H,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:F(()=>[s(U)?(i(),c("div",tt,[e("div",st,[e("p",rt,[a(s(u),{icon:"fluent:copy-24-regular",class:"w-3.5 h-3.5"}),t[10]||(t[10]=A(" แบบทดสอบที่คุณเคยสร้าง ",-1))])]),e("div",at,[(i(!0),c(R,null,G(s(v),(g,B)=>(i(),c("div",{key:g.id,class:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("button",{type:"button",onMousedown:M(K=>P(g),["prevent"]),class:"flex items-center gap-3 flex-1 text-left"},[e("div",lt,[a(s(u),{icon:"fluent:quiz-new-24-filled",class:"w-4 h-4 text-white"})]),e("div",it,[e("p",nt,f(g.title),1),e("div",dt,[e("span",null,f(g.questions_count||0)+" ข้อ",1),g.course?(i(),c("span",ut,f(g.course.name),1)):x("",!0)])])],40,ot),e("div",ct,[e("button",{type:"button",onMousedown:M(K=>Q(g),["prevent"]),class:"p-1.5 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg",title:"คัดลอกพร้อมคำถาม"},[a(s(u),{icon:"fluent:copy-24-regular",class:"w-4 h-4"})],40,gt),e("button",{type:"button",onMousedown:M(K=>N(B),["prevent"]),class:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg"},[a(s(u),{icon:"fluent:dismiss-16-regular",class:"w-4 h-4"})],40,pt)])]))),128))])])):x("",!0)]),_:1})]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," คำอธิบาย ",-1)),I(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=g=>s(r).description=g),rows:"2",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"รายละเอียดหรือคำชี้แจง..."},null,512),[[O,s(r).description]])]),e("div",ft,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[A(" เวลา (นาที) "),e("span",{class:"text-red-500"},"*")],-1)),I(e("input",{"onUpdate:modelValue":t[2]||(t[2]=g=>s(r).time_limit=g),type:"number",min:"1",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[O,s(r).time_limit,void 0,{number:!0}]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[A(" เกณฑ์ผ่าน (%) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",xt,[I(e("input",{"onUpdate:modelValue":t[3]||(t[3]=g=>s(r).passing_score=g),type:"number",min:"0",max:"100",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-8"},null,512),[[O,s(r).passing_score,void 0,{number:!0}]]),t[14]||(t[14]=e("span",{class:"absolute right-3 top-2.5 text-gray-500"},"%",-1))])])]),e("div",mt,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," เริ่มทำได้ตั้งแต่ ",-1)),a(d,{modelValue:s(r).start_date,"onUpdate:modelValue":t[4]||(t[4]=g=>s(r).start_date=g),format:"dd/MM/yyyy HH:mm","auto-apply":"",teleport:!0},null,8,["modelValue"])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," สิ้นสุดเมื่อ ",-1)),a(d,{modelValue:s(r).end_date,"onUpdate:modelValue":t[5]||(t[5]=g=>s(r).end_date=g),format:"dd/MM/yyyy HH:mm","auto-apply":"",teleport:!0},null,8,["modelValue"])])]),e("div",bt,[e("label",vt,[I(e("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=g=>s(r).shuffle_questions=g),class:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500"},null,512),[[Z,s(r).shuffle_questions]]),t[18]||(t[18]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"สลับข้อคำถาม",-1))]),e("label",yt,[I(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=g=>s(r).is_active=g),class:"w-4 h-4 text-green-600 rounded focus:ring-green-500"},null,512),[[Z,s(r).is_active]]),t[19]||(t[19]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"เปิดใช้งาน",-1))])]),s(w).length?(i(),c("div",ht,[e("ul",wt,[(i(!0),c(R,null,G(s(w),(g,B)=>(i(),c("li",{key:B},f(g),1))),128))])])):x("",!0)]),e("div",kt,[e("button",{onClick:n,class:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",disabled:s(b)||s(m)}," ยกเลิก ",8,_t),e("button",{onClick:z,class:"px-6 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",disabled:!s(E)||s(b)||s(m)},[s(b)?(i(),Y(s(u),{key:0,icon:"svg-spinners:ring-resize",class:"w-5 h-5"})):x("",!0),e("span",null,f(s(b)?"กำลังบันทึก...":"สร้างแบบทดสอบ"),1)],8,zt)])])):x("",!0)]),_:1}),a(H,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:F(()=>[s(m)?(i(),c("div",qt,[e("div",$t,[a(s(u),{icon:"svg-spinners:ring-resize",class:"w-14 h-14 text-purple-600"}),t[20]||(t[20]=e("div",{class:"text-center"},[e("p",{class:"text-lg font-bold text-gray-900 dark:text-white"},"กำลังคัดลอกแบบทดสอบ..."),e("p",{class:"text-sm text-gray-500 mt-1"},"รวมถึงคำถามและรูปภาพทั้งหมด")],-1))])])):x("",!0)]),_:1})])):x("",!0)]),_:1})])}}}),Dt={key:1,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center max-w-md mx-auto"},Vt={class:"text-red-600 dark:text-red-400 mb-4"},jt={key:0,class:"bg-gradient-to-r from-purple-600 via-indigo-600 to-blue-600 dark:from-purple-800 dark:via-indigo-800 dark:to-blue-800 rounded-2xl p-6 shadow-xl mb-6"},At={class:"flex items-center justify-between"},Bt={class:"flex items-center gap-4"},Tt={class:"w-14 h-14 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center shadow-lg"},Mt={class:"text-white/80 text-sm"},St={key:1,class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-12 text-center"},Et={class:"text-gray-600 dark:text-gray-400"},Pt=J({__name:"index",setup(p){const h=ee("course"),l=ee("isCourseAdmin"),_=oe(),$=te(),b=q([]),w=q(!0),r=q(null),v=q(!1),j=q(!1),C=q(null),m=q(!1),U=k(()=>/\/quizzes\/?$/.test(_.path)),D=async()=>{if(h?.value?.id){w.value=!0,r.value=null;try{const t=await $.get(`/api/courses/${h.value.id}/quizzes`);b.value=t.quizzes||t.data||t||[]}catch(t){console.error("Error fetching quizzes:",t),r.value=t.message||"ไม่สามารถโหลดแบบทดสอบได้"}finally{w.value=!1}}},y=()=>{m.value=!0},V=t=>{t&&b.value.unshift(t)},L=t=>{W(`/courses/${h?.value?.id}/quizzes/${t.id}/edit`)},P=async t=>{if(confirm("ยืนยันการลบแบบทดสอบนี้หรือไม่?"))try{await $.delete(`/api/courses/${h?.value?.id}/quizzes/${t}`),await D()}catch(d){console.error("Error deleting quiz:",d),alert("ไม่สามารถลบแบบทดสอบได้")}},N=t=>{W(`/courses/${h?.value?.id}/quizzes/${t.id}/attempt`)},Q=t=>{W(`/courses/${h?.value?.id}/quizzes/${t.id}`)},E=t=>{C.value=t,j.value=!0},z=async t=>{t&&t.course_id===h?.value?.id&&await D()},n=()=>{window.scrollTo({top:0,behavior:"smooth"})},o=()=>{v.value=window.scrollY>300};return le(()=>{D(),window.addEventListener("scroll",o)}),ie(()=>{window.removeEventListener("scroll",o)}),(t,d)=>{const g=ne;return i(),c("div",null,[a(g),s(U)?(i(),c(R,{key:0},[s(w)?(i(),Y(ce,{key:0})):s(r)?(i(),c("div",Dt,[a(s(u),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),d[2]||(d[2]=e("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"เกิดข้อผิดพลาด",-1)),e("p",Vt,f(s(r)),1),e("button",{onClick:D,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," ลองใหม่ ")])):(i(),c(R,{key:2},[s(l)?(i(),c("div",jt,[e("div",At,[e("div",Bt,[e("div",Tt,[a(s(u),{icon:"healthicons:i-exam-qualification-outline",class:"w-7 h-7 text-white"})]),e("div",null,[d[3]||(d[3]=e("h2",{class:"text-2xl font-bold text-white mb-1"},"แบบทดสอบทั้งหมด",-1)),e("p",Mt,f(s(b).length)+" ชุด",1)])]),e("button",{onClick:y,class:"flex items-center gap-2 px-5 py-3 bg-white text-purple-600 rounded-xl hover:bg-purple-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105 font-bold"},[a(s(u),{icon:"fluent:add-circle-24-filled",class:"w-5 h-5"}),d[4]||(d[4]=e("span",null,"เพิ่มแบบทดสอบ",-1))])])])):x("",!0),s(b).length?x("",!0):(i(),c("div",St,[a(s(u),{icon:"healthicons:i-exam-qualification-outline",class:"w-24 h-24 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),d[5]||(d[5]=e("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white mb-2"}," ยังไม่มีแบบทดสอบในรายวิชานี้ ",-1)),e("p",Et,f(s(l)?"เริ่มสร้างแบบทดสอบแรกของคุณ":"อาจารย์กำลังเตรียมแบบทดสอบอยู่"),1)])),(i(!0),c(R,null,G(s(b),(B,K)=>(i(),c("div",{key:B.id},[a(Ke,{quiz:B,"is-admin":s(l),"course-id":s(h)?.id,"quiz-index":K+1,onEdit:L,onDelete:P,onStart:N,onView:Q,onDuplicate:E},null,8,["quiz","is-admin","course-id","quiz-index"])]))),128))],64))],64)):x("",!0),a(H,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 translate-y-10","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-300","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-10"},{default:F(()=>[s(v)?(i(),c("button",{key:0,onClick:n,class:"fixed bottom-8 right-8 z-[999] p-3 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-full shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-xl hover:-translate-y-1 transition-all",title:"เลื่อนขึ้นด้านบน"},[a(s(u),{icon:"fluent:arrow-up-24-filled",class:"w-6 h-6"})])):x("",!0)]),_:1}),a(ue,{show:s(j),quiz:s(C),"current-course-id":s(h)?.id,onClose:d[0]||(d[0]=B=>j.value=!1),onDuplicated:z},null,8,["show","quiz","current-course-id"]),a(Ct,{show:s(m),"course-id":s(h)?.id,onClose:d[1]||(d[1]=B=>m.value=!1),onCreated:V},null,8,["show","course-id"])])}}});export{Pt as default};
