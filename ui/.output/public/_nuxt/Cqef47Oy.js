import{_ as ge,a9 as ve,o as l,g as Y,b as d,w as ie,c as a,j as de,a as e,u as o,I as c,t as y,F as q,k as W,T as le,$ as X,aj as ue,aa as ae,d as k,a0 as $e,ab as Ce,a1 as ce,a4 as Ae,r as u,n as Q,q as fe,l as Ge,a3 as Ie,e as te,y as He,W as Qe,aP as We,h as Je}from"./Brb_7992.js";import{u as pe}from"./ddpOXc7a.js";import{u as he}from"./CaSR6SuD.js";import{u as De}from"./dw-ZgbPA.js";import{_ as Xe}from"./BP2gnDQ3.js";import{P as Ye,S as Ze}from"./BxjnrTC5.js";import{I as et}from"./D1e3wYap.js";import"./BQxta0Da.js";const tt={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},st={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},lt={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},at={class:"flex items-center gap-2"},rt={class:"p-4 max-h-[70vh] overflow-y-auto"},it={class:"flex items-center gap-3 mb-4"},ot=["src"],nt={class:"flex-1"},dt={class:"font-medium text-gray-800 dark:text-white"},ut={class:"flex items-center gap-1 text-xs text-gray-500"},ct={class:"flex border-b border-gray-200 dark:border-vikinger-dark-50/30 mb-4"},gt=["onClick"],vt={class:"rounded-lg mb-4 min-h-[120px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},pt=["onKeydown","disabled"],kt={key:0,class:"mb-4"},ft={class:"flex flex-wrap gap-2"},ht=["src"],bt=["onClick"],xt={class:"text-xs text-gray-500 mt-1"},yt={key:1,class:"mb-4 space-y-2"},mt={class:"flex items-center gap-3"},_t={class:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},wt={class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[200px]"},$t={class:"text-xs text-gray-500"},Ct=["onClick"],At={class:"mb-4"},It={class:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-700/30"},Dt={class:"flex items-center justify-between mb-3"},jt={class:"flex items-center gap-2"},Lt={class:"space-y-3 mb-4"},Bt={class:"w-7 h-7 rounded-full bg-vikinger-purple text-white flex items-center justify-center text-xs font-bold flex-shrink-0"},Mt=["onUpdate:modelValue","placeholder"],St=["onClick"],Pt={class:"mt-3 pt-3 border-t border-amber-200 dark:border-amber-700/30"},Tt={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400"},Ft={class:"grid grid-cols-2 gap-4 mt-6"},Ut={class:"relative flex items-center"},Et={class:"absolute left-3 text-vikinger-cyan"},Ot={class:"relative flex items-center"},Rt={class:"absolute left-3 text-vikinger-orange"},Vt={class:"mt-4 p-4 bg-vikinger-cyan/5 dark:bg-vikinger-cyan/10 border border-vikinger-cyan/20 rounded-xl"},zt={class:"flex items-start gap-3"},Nt={class:"text-sm dark:text-gray-200 w-full"},Kt={class:"space-y-1.5"},qt={class:"flex justify-between items-center text-gray-600 dark:text-gray-400"},Gt={class:"font-semibold"},Ht={class:"flex justify-between items-center pt-2 border-t border-vikinger-cyan/20 font-bold text-gray-800 dark:text-white mt-1"},Qt={class:"mt-3 flex items-center gap-2 text-xs text-green-600 dark:text-green-400 font-medium"},Wt={key:0,class:"text-xs text-red-500 font-bold mt-2"},Jt={key:0,class:"flex flex-wrap gap-2 border-t border-gray-200 dark:border-vikinger-dark-50/30 pt-4"},Xt=["disabled"],Yt=["disabled"],Zt={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30"},es=["disabled"],ts={__name:"CourseCreatePostModal",props:{show:{type:Boolean,default:!1},courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["close","post-created"],setup(D,{emit:Z}){const i=D,G=Z,{user:M}=pe(),S=ve(),f=he(),$=u(""),w=u(!1),P=u([]),L=u([]),T=u(null),U=u(null),A=u("status"),O=[{id:"status",label:"สถานะ",icon:"fluent:edit-24-regular"},{id:"poll",label:"โพล",icon:"fluent:poll-24-regular"}],F=u(""),I=u(["",""]),E=u(24),V=u(12e3),H=u(100),ee=u("course"),R=Q(()=>typeof window>"u"?[]:P.value.map(p=>({file:p,url:URL.createObjectURL(p)}))),N=()=>{G("close")},h=async()=>{if(!(!$.value.trim()&&P.value.length===0&&A.value!=="poll")&&!w.value){if(A.value==="poll"){if(!F.value.trim()){f.warning("กรุณาใส่คำถามสำหรับโพล");return}if(I.value.filter(n=>n.trim()).length<2){f.warning("กรุณาใส่ตัวเลือกอย่างน้อย 2 ตัวเลือก");return}}w.value=!0;try{const p=new FormData;p.append("content",$.value),p.append("privacy",ee.value),i.groupId&&p.append("group_id",i.groupId),P.value.forEach((C,m)=>{p.append(`images[${m}]`,C)}),L.value.forEach((C,m)=>{p.append(`attachments[${m}]`,C)}),A.value==="poll"&&F.value.trim()&&(p.append("poll_question",F.value),I.value.filter(m=>m.trim()).forEach((m,se)=>{p.append(`poll_options[${se}]`,m)}),p.append("poll_duration",E.value),p.append("poll_points_pool",V.value),p.append("poll_max_votes",H.value));const n=await S.post(`/api/courses/${i.courseId}/posts`,p);if(n.success||n.data){const C=n.data||n.post;G("post-created",C),x(),f.toast("สร้างโพสต์สำเร็จ!","success")}else f.error(n.message||"ไม่สามารถสร้างโพสต์ได้")}catch(p){console.error("Error creating post:",p);let n="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";p?.data?.message&&(n=p.data.message),f.error(n)}finally{w.value=!1}}},x=()=>{$.value="",P.value=[],L.value=[],A.value="status",F.value="",I.value=["",""],E.value=24,V.value=12e3,H.value=100,N()},j=p=>{const n=Array.from(p.target.files);P.value=[...P.value,...n].slice(0,10),p.target.value=""},b=p=>{P.value.splice(p,1)},g=()=>{T.value?.click()},B=p=>{const n=Array.from(p.target.files);L.value=[...L.value,...n].slice(0,5),p.target.value=""},z=p=>{L.value.splice(p,1)},K=()=>{U.value?.click()},J=()=>{I.value.length<10&&I.value.push("")},oe=p=>{I.value.length>2&&I.value.splice(p,1)},re=p=>{if(p===0)return"0 Bytes";const n=1024,C=["Bytes","KB","MB","GB"],m=Math.floor(Math.log(p)/Math.log(n));return parseFloat((p/Math.pow(n,m)).toFixed(2))+" "+C[m]};return(p,n)=>(l(),Y(Ae,{to:"body"},[d(ce,{name:"modal"},{default:ie(()=>[D.show?(l(),a("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(N,["self"])},[e("div",tt,[e("div",st,[e("div",lt,[e("div",at,[d(o(c),{icon:"fluent:book-24-regular",class:"w-5 h-5 text-blue-500"}),n[5]||(n[5]=e("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"โพสต์ในรายวิชา",-1))]),e("button",{onClick:N,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),e("div",rt,[e("input",{type:"file",ref_key:"imageInput",ref:T,class:"hidden",accept:"image/*",multiple:"",onChange:j},null,544),e("input",{type:"file",ref_key:"fileInput",ref:U,class:"hidden",multiple:"",onChange:B},null,544),e("div",it,[e("img",{src:o(M)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,ot),e("div",nt,[e("div",dt,y(o(M)?.name),1),e("div",ut,[d(o(c),{icon:"fluent:people-community-24-regular",class:"w-3 h-3"}),n[6]||(n[6]=e("span",null,"โพสต์ในรายวิชา",-1))])])]),e("div",ct,[(l(),a(q,null,W(O,C=>e("button",{key:C.id,onClick:m=>A.value=C.id,class:le(["flex-1 pb-3 text-sm font-medium flex items-center justify-center gap-2 border-b-2 transition-colors relative",A.value===C.id?"text-blue-600 border-blue-600 dark:text-blue-400 dark:border-blue-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])},[d(o(c),{icon:C.icon,class:"w-5 h-5"},null,8,["icon"]),e("span",null,y(C.label),1)],10,gt)),64))]),X(e("div",null,[e("div",vt,[X(e("textarea",{"onUpdate:modelValue":n[0]||(n[0]=C=>$.value=C),placeholder:"แชร์ความรู้หรือถามคำถามในรายวิชานี้...",rows:"4",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(h,["ctrl"]),["enter"]),disabled:w.value},null,40,pt),[[ae,$.value]])]),R.value.length>0?(l(),a("div",kt,[e("div",ft,[(l(!0),a(q,null,W(R.value,(C,m)=>(l(),a("div",{key:m,class:"relative group"},[e("img",{src:C.url,class:"w-24 h-24 object-cover rounded-lg border border-gray-200 dark:border-vikinger-dark-50/30"},null,8,ht),e("button",{onClick:se=>b(m),class:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-sm md:opacity-0 md:group-hover:opacity-100 transition-opacity"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,bt)]))),128)),R.value.length<10?(l(),a("button",{key:0,onClick:g,class:"w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center hover:border-vikinger-purple hover:bg-vikinger-purple/5 transition-all"},[d(o(c),{icon:"fluent:add-24-regular",class:"w-8 h-8 text-gray-400"})])):k("",!0)]),e("p",xt,y(R.value.length)+"/10 รูป",1)])):k("",!0),L.value.length>0?(l(),a("div",yt,[(l(!0),a(q,null,W(L.value,(C,m)=>(l(),a("div",{key:m,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-vikinger-dark-200 rounded-lg"},[e("div",mt,[e("div",_t,[d(o(c),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"})]),e("div",null,[e("p",wt,y(C.name),1),e("p",$t,y(re(C.size)),1)])]),e("button",{onClick:se=>z(m),class:"p-1 hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 rounded-full"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4 text-gray-400 hover:text-red-500"})],8,Ct)]))),128))])):k("",!0)],512),[[$e,A.value==="status"]]),X(e("div",At,[e("div",It,[e("div",Dt,[e("div",jt,[d(o(c),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-600"}),n[7]||(n[7]=e("span",{class:"font-medium text-amber-700 dark:text-amber-300"},"รายละเอียดโพล",-1))])]),X(e("input",{"onUpdate:modelValue":n[1]||(n[1]=C=>F.value=C),type:"text",placeholder:"คำถามโพล...",class:"w-full px-3 py-2 mb-3 rounded-lg border border-amber-200 dark:border-amber-700/50 bg-white dark:bg-vikinger-dark-200 text-gray-800 dark:text-white"},null,512),[[ae,F.value]]),e("div",Lt,[(l(!0),a(q,null,W(I.value,(C,m)=>(l(),a("div",{key:m,class:"flex items-center gap-3 p-3 bg-white dark:bg-vikinger-dark-100 rounded-xl border border-gray-200 dark:border-vikinger-dark-50/30"},[e("div",Bt,y(m+1),1),X(e("input",{"onUpdate:modelValue":se=>I.value[m]=se,type:"text",placeholder:`ตัวเลือกที่ ${m+1}`,class:"flex-1 bg-transparent border-none outline-none text-gray-800 dark:text-white text-sm"},null,8,Mt),[[ae,I.value[m]]]),I.value.length>2?(l(),a("button",{key:0,onClick:se=>oe(m),class:"p-1 text-gray-400 hover:text-red-500 transition-colors"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"})],8,St)):k("",!0)]))),128))]),I.value.length<10?(l(),a("button",{key:0,onClick:J,class:"w-full h-11 border-2 border-dashed border-gray-200 dark:border-vikinger-dark-50/20 rounded-xl flex items-center justify-center gap-2 text-sm text-gray-500 hover:border-vikinger-cyan hover:text-vikinger-cyan transition-all mb-4"},[d(o(c),{icon:"fluent:add-24-regular",class:"w-5 h-5"}),n[8]||(n[8]=e("span",null,"เพิ่มตัวเลือก (สูงสุด 10 ตัวเลือก)",-1))])):k("",!0),e("div",Pt,[e("label",Tt,[d(o(c),{icon:"fluent:clock-24-regular",class:"w-4 h-4"}),n[10]||(n[10]=e("span",null,"ระยะเวลาโพล:",-1)),X(e("select",{"onUpdate:modelValue":n[2]||(n[2]=C=>E.value=C),class:"px-2 py-1 rounded border border-gray-200 dark:border-vikinger-dark-50/30 bg-white dark:bg-vikinger-dark-100 text-sm"},[...n[9]||(n[9]=[e("option",{value:1},"1 ชั่วโมง",-1),e("option",{value:6},"6 ชั่วโมง",-1),e("option",{value:12},"12 ชั่วโมง",-1),e("option",{value:24},"1 วัน",-1),e("option",{value:72},"3 วัน",-1),e("option",{value:168},"1 สัปดาห์",-1)])],512),[[Ce,E.value]])])])]),e("div",Ft,[e("div",null,[n[11]||(n[11]=e("label",{class:"block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider"}," แต้มรางวัลรวม ",-1)),e("div",Ut,[e("div",Et,[d(o(c),{icon:"mdi:piggy-bank",class:"w-4 h-4"})]),X(e("input",{"onUpdate:modelValue":n[3]||(n[3]=C=>V.value=C),type:"number",min:"0",step:"100",class:"w-full pl-9 pr-3 py-2.5 bg-gray-50 dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/10 rounded-xl text-sm focus:ring-1 focus:ring-vikinger-cyan outline-none",placeholder:"0"},null,512),[[ae,V.value,void 0,{number:!0}]])])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider"}," จำนวนคนโหวตสูงสุด ",-1)),e("div",Ot,[e("div",Rt,[d(o(c),{icon:"mdi:account-group",class:"w-4 h-4"})]),X(e("input",{"onUpdate:modelValue":n[4]||(n[4]=C=>H.value=C),type:"number",min:"1",class:"w-full pl-9 pr-3 py-2.5 bg-gray-50 dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/10 rounded-xl text-sm focus:ring-1 focus:ring-vikinger-cyan outline-none",placeholder:"100"},null,512),[[ae,H.value,void 0,{number:!0}]])])])]),e("div",Vt,[e("div",zt,[d(o(c),{icon:"fluent:info-24-regular",class:"w-6 h-6 text-vikinger-cyan flex-shrink-0 mt-0.5"}),e("div",Nt,[n[17]||(n[17]=e("p",{class:"font-bold text-vikinger-cyan mb-2"},"สรุปแต้มที่ต้องใช้:",-1)),e("ul",Kt,[n[15]||(n[15]=e("li",{class:"flex justify-between items-center text-gray-600 dark:text-gray-400"},[e("span",null,"ค่าธรรมเนียมสร้างโพล"),e("span",{class:"font-semibold"},"180 แต้ม")],-1)),e("li",qt,[n[13]||(n[13]=e("span",null,"แต้มรางวัลสำหรับคนโหวต",-1)),e("span",Gt,y(V.value)+" แต้ม",1)]),e("li",Ht,[n[14]||(n[14]=e("span",null,"รวมทั้งหมด",-1)),e("span",null,y(180+V.value)+" แต้ม",1)])]),e("div",Qt,[d(o(c),{icon:"fluent:gift-24-regular",class:"w-4 h-4"}),n[16]||(n[16]=e("span",null,"ผู้ร่วมโหวตจะได้รับแต้มรางวัลโดยอัตโนมัติ!",-1))]),o(M)&&o(M).pp<180+V.value?(l(),a("p",Wt," ! คุณมีแต้มไม่เพียงพอ (ปัจจุบัน "+y(o(M).pp)+" แต้ม) ",1)):k("",!0)])])])],512),[[$e,A.value==="poll"]]),A.value==="status"?(l(),a("div",Jt,[e("button",{onClick:g,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all",disabled:w.value},[d(o(c),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),n[18]||(n[18]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"รูปภาพ",-1))],8,Xt),e("button",{onClick:K,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all",disabled:w.value},[d(o(c),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),n[19]||(n[19]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"ไฟล์แนบ",-1))],8,Yt)])):k("",!0)]),e("div",Zt,[e("button",{onClick:h,disabled:w.value||A.value==="status"&&!$.value.trim()&&R.value.length===0||A.value==="poll"&&!F.value.trim(),class:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[w.value?(l(),Y(o(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):k("",!0),e("span",null,y(w.value?"กำลังโพสต์...":"โพสต์"),1)],8,es)])])])])):k("",!0)]),_:1})]))}},ss=ge(ts,[["__scopeId","data-v-240cdcfa"]]),ls={class:"bg-white dark:bg-vikinger-dark-100 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-vikinger-dark-50/20"},as={class:"flex items-center gap-3 mb-3"},rs=["src"],is={class:"flex items-center justify-around pt-2 border-t border-gray-100 dark:border-vikinger-dark-50/20"},os={__name:"CourseCreatePostBox",props:{courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["post-created"],setup(D,{emit:Z}){const i=Z,{user:G}=pe(),{getAvatarUrl:M}=De(),S=u(!1),f=Q(()=>M(G.value)),$=()=>{S.value=!0},w=()=>{S.value=!1},P=L=>{i("post-created",L),w()};return(L,T)=>(l(),a("div",ls,[e("div",as,[e("img",{src:f.value,alt:"Avatar",class:"w-10 h-10 rounded-full object-cover ring-2 ring-vikinger-purple/20"},null,8,rs),e("button",{onClick:$,class:"flex-1 text-left px-4 py-2.5 bg-gray-100 dark:bg-vikinger-dark-200/50 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-vikinger-dark-200 transition-colors text-sm"}," โพสต์อะไรในรายวิชานี้... ")]),e("div",is,[e("button",{onClick:$,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(c),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),T[0]||(T[0]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"รูปภาพ",-1))]),e("button",{onClick:$,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(c),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),T[1]||(T[1]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"ไฟล์แนบ",-1))]),e("button",{onClick:$,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(c),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-500"}),T[2]||(T[2]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"โพล",-1))])]),d(ss,{show:S.value,"course-id":D.courseId,"group-id":D.groupId,onClose:w,onPostCreated:P},null,8,["show","course-id","group-id"])]))}},ns={class:"bg-white dark:bg-vikinger-dark-200 rounded-xl shadow-sm overflow-hidden"},ds={class:"p-4 flex items-start gap-3"},us=["src","alt"],cs={class:"flex-1 min-w-0"},gs={class:"flex items-center gap-2"},vs={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},ps={class:"text-sm text-gray-500 dark:text-gray-400"},ks={key:0,class:"text-gray-400"},fs={key:0,class:"relative"},hs={key:0,class:"absolute right-0 top-full mt-1 w-36 bg-white dark:bg-vikinger-dark-300 rounded-lg shadow-lg border border-gray-200 dark:border-vikinger-dark-50/30 py-1 z-10"},bs={class:"px-4 pb-3"},xs={key:0,class:"prose dark:prose-invert prose-sm max-w-none whitespace-pre-wrap"},ys={key:0,class:"relative"},ms=["src","alt"],_s=["onClick"],ws=["src","alt"],$s={key:0,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},Cs={class:"text-2xl font-bold text-white"},As={key:1,class:"px-4 py-2"},Is={class:"space-y-2"},Ds=["href"],js={class:"flex-1 text-sm text-gray-700 dark:text-gray-300 truncate"},Ls={class:"text-xs text-gray-400"},Bs={key:2,class:"px-4 mb-3"},Ms={class:"px-4 py-2 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},Ss={class:"flex items-center gap-3"},Ps={key:0,class:"flex items-center gap-1"},Ts={class:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center"},Fs={key:1,class:"flex items-center gap-1"},Us={class:"w-5 h-5 rounded-full bg-gray-400 flex items-center justify-center"},Es={class:"flex items-center gap-4"},Os={key:1},Rs={class:"px-4 py-2 border-t border-gray-100 dark:border-vikinger-dark-50/30 flex items-center"},Vs=["disabled"],zs=["disabled"],Ns={key:0,class:"border-t border-gray-100 dark:border-vikinger-dark-50/30"},Ks={class:"p-4 flex gap-3"},qs=["src","alt"],Gs={class:"flex-1 flex gap-2"},Hs=["disabled"],Qs=["disabled"],Ws={key:1},Js={key:0,class:"px-4 pb-4 space-y-4"},Xs={class:"flex gap-2"},Ys=["src","alt"],Zs={class:"flex-1"},el={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},tl={class:"flex items-center gap-2"},sl={class:"font-medium text-sm text-gray-900 dark:text-white"},ll={key:0,class:"px-1.5 py-0.5 text-xs rounded bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},al={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},rl={class:"flex items-center gap-4 mt-1 ml-2 text-xs text-gray-500"},il=["onClick"],ol=["onClick"],nl=["onClick"],dl=["onClick"],ul={key:0,class:"mt-2 flex gap-2"},cl=["src","alt"],gl={class:"flex-1 flex gap-2"},vl=["placeholder","disabled"],pl=["disabled"],kl={key:1},fl=["onClick"],hl={key:2,class:"mt-2 ml-8"},bl={key:3,class:"mt-2 ml-8 space-y-3"},xl=["src","alt"],yl={class:"flex-1"},ml={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},_l={class:"font-medium text-xs text-gray-900 dark:text-white"},wl={class:"text-xs text-gray-700 dark:text-gray-300"},$l={class:"flex items-center gap-3 mt-1 ml-2 text-xs text-gray-500"},Cl=["onClick"],Al=["onClick"],Il=["disabled"],Dl={key:1,class:"px-4 pb-4 text-center text-sm text-gray-500 dark:text-gray-400"},jl=fe({__name:"CourseFeedPost",props:{post:{},courseId:{},currentUserId:{},isCourseAdmin:{type:Boolean,default:!1}},emits:["edit","delete","post-updated"],setup(D,{emit:Z}){const i=D,G=Z,M=Ge(),S=ve(),f=he(),{getAvatarUrl:$}=De(),w=Q(()=>M.user),P=u(!1),L=u(!0),T=u(!1),U=u(null),A=u(i.post?.isLikedByAuth||i.post?.is_liked||!1),O=u(i.post?.isDislikedByAuth||i.post?.is_disliked||!1),F=u(i.post?.likes||i.post?.likes_count||0),I=u(i.post?.dislikes||i.post?.dislikes_count||0),E=u(i.post?.comments_count||0),V=u(i.post?.shares||i.post?.shares_count||0),H=u(!1),ee=u(!1),R=u(!1),N=u(""),h=u(i.post?.post_comments||i.post?.comments||[]),x=u(!1),j=u(1),b=u(!0),g=u(null),B=u(""),z=u(!1),K=u({}),J=u({}),oe=u({}),re=Q(()=>{const t=w.value;return i.post.user?.id===i.currentUserId||t&&i.post.user?.id===t.id}),p=Q(()=>i.post.author||i.post.user||{}),n=Q(()=>$(p.value)),C=Q(()=>$(w.value)),m=Q(()=>i.post.imagesResources?.length?i.post.imagesResources:i.post.images?.length?i.post.images:i.post.media?.length?i.post.media:[]),se=Q(()=>i.post.attachments||[]),be=Q(()=>i.post.poll||null),ke=t=>{if(!t)return"";if(typeof t=="string"&&(t.includes("ที่แล้ว")||t.includes("เมื่อสักครู่")))return t;const r=new Date(t),s=new Date().getTime()-r.getTime(),v=Math.floor(s/6e4),ne=Math.floor(s/36e5),we=Math.floor(s/864e5);return v<1?"เมื่อสักครู่":v<60?`${v} นาทีที่แล้ว`:ne<24?`${ne} ชั่วโมงที่แล้ว`:we<7?`${we} วันที่แล้ว`:r.toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},je=Q(()=>i.post.diff_humans_created_at||ke(i.post.created_at));Ie(()=>i.post,t=>{t&&(A.value=t.isLikedByAuth||t.is_liked||!1,O.value=t.isDislikedByAuth||t.is_disliked||!1,F.value=t.likes||t.likes_count||0,I.value=t.dislikes||t.dislikes_count||0,E.value=t.comments_count||0,V.value=t.shares||t.shares_count||0,h.value=t.post_comments||t.comments||[])},{immediate:!0});const Le=async()=>{if(H.value||!i.post?.id)return;if(re.value){f.warning("คุณไม่สามารถกดถูกใจโพสต์ของตัวเองได้");return}H.value=!0;const t=A.value;A.value=!t,F.value+=t?-1:1,!t&&O.value&&(O.value=!1,I.value--);try{const r=await S.call(`/api/courses/${i.courseId}/posts/${i.post.id}/like`,{method:"POST"});r.success||(A.value=t,F.value+=t?1:-1,f.error(r.message||"ไม่สามารถกดถูกใจได้"))}catch(r){A.value=t,F.value+=t?1:-1,console.error("Failed to like:",r)}finally{H.value=!1}},Be=async()=>{if(ee.value||!i.post?.id)return;if(re.value){f.warning("คุณไม่สามารถกดไม่ถูกใจโพสต์ของตัวเองได้");return}ee.value=!0;const t=O.value;O.value=!t,I.value+=t?-1:1,!t&&A.value&&(A.value=!1,F.value--);try{const r=await S.call(`/api/courses/${i.courseId}/posts/${i.post.id}/dislike`,{method:"POST"});r.success||(O.value=t,I.value+=t?1:-1,f.error(r.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(r){O.value=t,I.value+=t?1:-1,console.error("Failed to dislike:",r)}finally{ee.value=!1}},xe=async()=>{if(!(!N.value.trim()||R.value)){R.value=!0;try{const t=await S.call(`/api/courses/${i.courseId}/posts/${i.post.id}/comments`,{method:"POST",body:{content:N.value}});t.success&&t.comment?(h.value.unshift(t.comment),E.value++,N.value=""):f.error(t.message||"ไม่สามารถเพิ่มความคิดเห็นได้")}catch(t){console.error("Failed to add comment:",t),f.error("เกิดข้อผิดพลาดในการเพิ่มความคิดเห็น")}finally{R.value=!1}}},Me=async()=>{if(!(x.value||!b.value)){x.value=!0;try{const t=j.value+1,r=await S.get(`/api/courses/${i.courseId}/posts/${i.post.id}/comments?page=${t}`);if(r.comments?.length){const _=new Set(h.value.map(v=>v.id)),s=r.comments.filter(v=>!_.has(v.id));h.value.push(...s),j.value=t}r.pagination?b.value=r.pagination.has_more:r.comments?.length||(b.value=!1)}catch(t){console.error("Failed to load comments:",t)}finally{x.value=!1}}},Se=async t=>{const r=t.user||t.author;if(w.value?.id===r?.id){f.warning("คุณไม่สามารถกดถูกใจคอมเมนต์ของตัวเองได้");return}if(t.isLiking)return;t.isLiking=!0;const _=t.isLikedByAuth||t.is_liked||!1;t.isLikedByAuth=!_,t.is_liked=!_,t.likes=(t.likes||0)+(_?-1:1),!_&&(t.isDislikedByAuth||t.is_disliked)&&(t.isDislikedByAuth=!1,t.is_disliked=!1,t.dislikes=(t.dislikes||0)-1);try{const s=await S.call(`/api/courses/posts/comments/${t.id}/like`,{method:"POST"});s.success||(t.isLikedByAuth=_,t.is_liked=_,t.likes=(t.likes||0)+(_?1:-1),f.error(s.message||"ไม่สามารถกดถูกใจได้"))}catch(s){t.isLikedByAuth=_,t.is_liked=_,t.likes=(t.likes||0)+(_?1:-1),console.error("Failed to like comment:",s)}finally{t.isLiking=!1}},Pe=async t=>{const r=t.user||t.author;if(w.value?.id===r?.id){f.warning("คุณไม่สามารถกดไม่ถูกใจคอมเมนต์ของตัวเองได้");return}if(t.isDisliking)return;t.isDisliking=!0;const _=t.isDislikedByAuth||t.is_disliked||!1;t.isDislikedByAuth=!_,t.is_disliked=!_,t.dislikes=(t.dislikes||0)+(_?-1:1),!_&&(t.isLikedByAuth||t.is_liked)&&(t.isLikedByAuth=!1,t.is_liked=!1,t.likes=(t.likes||0)-1);try{const s=await S.call(`/api/courses/posts/comments/${t.id}/dislike`,{method:"POST"});s.success||(t.isDislikedByAuth=_,t.is_disliked=_,t.dislikes=(t.dislikes||0)+(_?1:-1),f.error(s.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(s){t.isDislikedByAuth=_,t.is_disliked=_,t.dislikes=(t.dislikes||0)+(_?1:-1),console.error("Failed to dislike comment:",s)}finally{t.isDisliking=!1}},Te=t=>{g.value=t,B.value=""},ye=()=>{g.value=null,B.value=""},me=async()=>{if(!(!B.value.trim()||!g.value||z.value)){z.value=!0;try{const t=await S.call(`/api/courses/posts/comments/${g.value.id}/replies`,{method:"POST",body:{content:B.value}});t.success&&t.reply?(J.value[g.value.id]||(J.value[g.value.id]=[]),J.value[g.value.id].unshift(t.reply),g.value.replies_count!==void 0&&g.value.replies_count++,K.value[g.value.id]=!0,ye()):f.error(t.message||"ไม่สามารถตอบกลับได้")}catch(t){console.error("Failed to submit reply:",t),f.error("เกิดข้อผิดพลาดในการตอบกลับ")}finally{z.value=!1}}},Fe=async t=>{if(!oe.value[t]){oe.value[t]=!0;try{const r=await S.get(`/api/courses/posts/comments/${t}/replies`);r.replies&&(J.value[t]=r.replies,K.value[t]=!0)}catch(r){console.error("Failed to load replies:",r)}finally{oe.value[t]=!1}}},Ue=t=>{K.value[t]?K.value[t]=!1:J.value[t]?K.value[t]=!0:Fe(t)},Ee=async(t,r)=>{const _=t.user||t.author;if(w.value?.id===_?.id){f.warning("คุณไม่สามารถกดถูกใจการตอบกลับของตัวเองได้");return}if(t.isLiking)return;t.isLiking=!0;const s=t.isLikedByAuth||t.is_liked||!1;t.isLikedByAuth=!s,t.is_liked=!s,t.likes=(t.likes||0)+(s?-1:1);try{(await S.call(`/api/courses/posts/comments/replies/${t.id}/like`,{method:"POST"})).success||(t.isLikedByAuth=s,t.is_liked=s,t.likes=(t.likes||0)+(s?1:-1))}catch(v){t.isLikedByAuth=s,t.is_liked=s,t.likes=(t.likes||0)+(s?1:-1),console.error("Failed to like reply:",v)}finally{t.isLiking=!1}},Oe=async(t,r)=>{const _=t.user||t.author;if(w.value?.id===_?.id){f.warning("คุณไม่สามารถกดไม่ถูกใจการตอบกลับของตัวเองได้");return}if(t.isDisliking)return;t.isDisliking=!0;const s=t.isDislikedByAuth||t.is_disliked||!1;t.isDislikedByAuth=!s,t.is_disliked=!s,t.dislikes=(t.dislikes||0)+(s?-1:1);try{(await S.call(`/api/courses/posts/comments/replies/${t.id}/dislike`,{method:"POST"})).success||(t.isDislikedByAuth=s,t.is_disliked=s,t.dislikes=(t.dislikes||0)+(s?1:-1))}catch(v){t.isDislikedByAuth=s,t.is_disliked=s,t.dislikes=(t.dislikes||0)+(s?1:-1),console.error("Failed to dislike reply:",v)}finally{t.isDisliking=!1}},Re=async()=>{if(await f.confirm("คุณต้องการลบโพสต์นี้หรือไม่?","ลบโพสต์"))try{const r=await S.call(`/api/courses/${i.courseId}/posts/${i.post.id}`,{method:"DELETE"});r.success?(G("delete",i.post.id),f.toast("ลบโพสต์สำเร็จ","success")):f.error(r.message||"ไม่สามารถลบโพสต์ได้")}catch(r){console.error("Failed to delete post:",r),f.error("เกิดข้อผิดพลาดในการลบโพสต์")}},Ve=async t=>{if(await f.confirm("คุณต้องการลบความคิดเห็นนี้หรือไม่?","ลบความคิดเห็น"))try{const _=await S.call(`/api/courses/posts/comments/${t.id}`,{method:"DELETE"});_.success?(h.value=h.value.filter(s=>s.id!==t.id),E.value--,f.toast("ลบความคิดเห็นสำเร็จ","success")):f.error(_.message||"ไม่สามารถลบความคิดเห็นได้")}catch(_){console.error("Failed to delete comment:",_),f.error("เกิดข้อผิดพลาดในการลบความคิดเห็น")}},ze=()=>{T.value=!0},Ne=()=>{V.value++,T.value=!1},_e=t=>{U.value=t},Ke=t=>{i.post.poll&&Object.assign(i.post.poll,t),G("post-updated",i.post)},qe=()=>{G("delete",i.post.id)};return(t,r)=>{const _=Xe;return l(),a("div",ns,[e("div",ds,[d(_,{to:`/profile/${p.value.username}`},{default:ie(()=>[e("img",{src:n.value,alt:p.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,us)]),_:1},8,["to"]),e("div",cs,[e("div",gs,[d(_,{to:`/profile/${p.value.username}`,class:"font-medium text-gray-900 dark:text-white hover:underline"},{default:ie(()=>[te(y(p.value.name),1)]),_:1},8,["to"]),p.value.role==="teacher"||p.value.role==="admin"?(l(),a("span",vs," ผู้สอน ")):k("",!0)]),e("p",ps,[te(y(je.value)+" ",1),D.post.is_edited?(l(),a("span",ks," · แก้ไขแล้ว")):k("",!0)])]),re.value||D.isCourseAdmin?(l(),a("div",fs,[e("button",{onClick:r[0]||(r[0]=s=>P.value=!P.value),class:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 text-gray-400"},[d(o(c),{icon:"fluent:more-horizontal-24-regular",class:"w-5 h-5"})]),d(ce,{name:"fade"},{default:ie(()=>[P.value?(l(),a("div",hs,[re.value||D.isCourseAdmin?(l(),a("button",{key:0,onClick:r[1]||(r[1]=s=>{G("edit",D.post),P.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 flex items-center gap-2"},[d(o(c),{icon:"fluent:edit-24-regular",class:"w-4 h-4"}),r[10]||(r[10]=te(" แก้ไข ",-1))])):k("",!0),e("button",{onClick:r[2]||(r[2]=s=>{Re(),P.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2"},[d(o(c),{icon:"fluent:delete-24-regular",class:"w-4 h-4"}),r[11]||(r[11]=te(" ลบ ",-1))])])):k("",!0)]),_:1})])):k("",!0)]),e("div",bs,[D.post.content?(l(),a("div",xs,y(D.post.content),1)):k("",!0)]),m.value.length>0?(l(),a("div",ys,[m.value.length===1?(l(),a("img",{key:0,src:m.value[0].url||m.value[0],alt:m.value[0].alt||"Post image",class:"w-full max-h-96 object-cover cursor-pointer",onClick:r[3]||(r[3]=s=>_e(0))},null,8,ms)):(l(),a("div",{key:1,class:le(["grid gap-1",[m.value.length===2?"grid-cols-2":"",m.value.length===3?"grid-cols-3":"",m.value.length>=4?"grid-cols-2":""]])},[(l(!0),a(q,null,W(m.value.slice(0,4),(s,v)=>(l(),a("div",{key:v,class:"relative aspect-square cursor-pointer",onClick:ne=>_e(v)},[e("img",{src:s.url||s,alt:s.alt||`Image ${v+1}`,class:"w-full h-full object-cover"},null,8,ws),v===3&&m.value.length>4?(l(),a("div",$s,[e("span",Cs,"+"+y(m.value.length-4),1)])):k("",!0)],8,_s))),128))],2))])):k("",!0),se.value.length>0?(l(),a("div",As,[e("div",Is,[(l(!0),a(q,null,W(se.value,s=>(l(),a("a",{key:s.id,href:s.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-vikinger-dark-100 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-50 transition-colors"},[d(o(c),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"}),e("span",js,y(s.name||s.filename),1),e("span",Ls,y(s.size),1)],8,Ds))),128))])])):k("",!0),be.value?(l(),a("div",Bs,[d(Ye,{poll:be.value,"show-actions":re.value,"is-nested":!0,onUpdate:Ke,onDelete:qe},null,8,["poll","show-actions"])])):k("",!0),e("div",Ms,[e("div",Ss,[F.value>0?(l(),a("div",Ps,[e("div",Ts,[d(o(c),{icon:"fluent:thumb-like-24-filled",class:"w-3 h-3 text-white"})]),e("span",null,y(F.value),1)])):k("",!0),I.value>0?(l(),a("div",Fs,[e("div",Us,[d(o(c),{icon:"fluent:thumb-dislike-24-filled",class:"w-3 h-3 text-white"})]),e("span",null,y(I.value),1)])):k("",!0)]),e("div",Es,[E.value>0?(l(),a("button",{key:0,onClick:r[4]||(r[4]=s=>L.value=!L.value),class:"hover:underline"},y(E.value)+" ความคิดเห็น ",1)):k("",!0),V.value>0?(l(),a("span",Os,y(V.value)+" แชร์",1)):k("",!0)])]),e("div",Rs,[e("button",{onClick:Le,disabled:H.value,class:le(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",A.value?"text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(c),{icon:A.value?"fluent:thumb-like-24-filled":"fluent:thumb-like-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[12]||(r[12]=e("span",null,"ถูกใจ",-1))],10,Vs),e("button",{onClick:Be,disabled:ee.value,class:le(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",O.value?"text-gray-700 dark:text-gray-200":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(c),{icon:O.value?"fluent:thumb-dislike-24-filled":"fluent:thumb-dislike-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[13]||(r[13]=e("span",null,"ไม่ถูกใจ",-1))],10,zs),e("button",{onClick:r[5]||(r[5]=s=>L.value=!L.value),class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(o(c),{icon:"fluent:chat-24-regular",class:"w-5 h-5"}),r[14]||(r[14]=e("span",null,"ความคิดเห็น",-1))]),e("button",{onClick:ze,class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(o(c),{icon:"fluent:share-24-regular",class:"w-5 h-5"}),r[15]||(r[15]=e("span",null,"แชร์",-1))])]),d(ce,{name:"slide"},{default:ie(()=>[L.value?(l(),a("div",Ns,[e("div",Ks,[e("img",{src:C.value,alt:w.value?.name,class:"w-8 h-8 rounded-full"},null,8,qs),e("div",Gs,[X(e("input",{"onUpdate:modelValue":r[6]||(r[6]=s=>N.value=s),type:"text",placeholder:"เขียนความคิดเห็น...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(xe,["enter"]),disabled:R.value},null,40,Hs),[[ae,N.value]]),e("button",{onClick:xe,disabled:!N.value.trim()||R.value,class:"px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[R.value?(l(),Y(o(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin"})):(l(),a("span",Ws,"ส่ง"))],8,Qs)])]),h.value.length>0?(l(),a("div",Js,[(l(!0),a(q,null,W(h.value,s=>(l(),a("div",{key:s.id,class:"space-y-2"},[e("div",Xs,[e("img",{src:o($)(s.user||s.author),alt:(s.user||s.author)?.name,class:"w-8 h-8 rounded-full"},null,8,Ys),e("div",Zs,[e("div",el,[e("div",tl,[e("p",sl,y((s.user||s.author)?.name),1),(s.user||s.author)?.role==="teacher"?(l(),a("span",ll," ผู้สอน ")):k("",!0)]),e("p",al,y(s.content),1)]),e("div",rl,[e("button",{onClick:v=>Se(s),class:le(["hover:text-blue-600",s.isLikedByAuth||s.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+y(s.likes>0?` (${s.likes})`:""),11,il),e("button",{onClick:v=>Pe(s),class:le(["hover:text-gray-700",s.isDislikedByAuth||s.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+y(s.dislikes>0?` (${s.dislikes})`:""),11,ol),e("button",{onClick:v=>Te(s),class:"hover:text-blue-600"}," ตอบกลับ ",8,nl),e("span",null,y(ke(s.created_at)),1),w.value?.id===(s.user||s.author)?.id||D.isCourseAdmin?(l(),a("button",{key:0,onClick:v=>Ve(s),class:"hover:text-red-600"}," ลบ ",8,dl)):k("",!0)]),g.value?.id===s.id?(l(),a("div",ul,[e("img",{src:C.value,alt:w.value?.name,class:"w-6 h-6 rounded-full"},null,8,cl),e("div",gl,[X(e("input",{"onUpdate:modelValue":r[7]||(r[7]=v=>B.value=v),type:"text",placeholder:`ตอบกลับ ${(s.user||s.author)?.name}...`,class:"flex-1 px-3 py-1.5 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(me,["enter"]),disabled:z.value},null,40,vl),[[ae,B.value]]),e("button",{onClick:me,disabled:!B.value.trim()||z.value,class:"px-3 py-1.5 bg-blue-600 text-white rounded-full text-xs font-medium hover:bg-blue-700 disabled:opacity-50"},[z.value?(l(),Y(o(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-3 h-3 animate-spin"})):(l(),a("span",kl,"ส่ง"))],8,pl),e("button",{onClick:ye,class:"px-3 py-1.5 text-gray-500 hover:text-gray-700 text-xs"}," ยกเลิก ")])])):k("",!0),s.replies_count>0||J.value[s.id]?.length>0?(l(),a("button",{key:1,onClick:v=>Ue(s.id),class:"mt-2 ml-2 flex items-center gap-1 text-xs text-blue-600 hover:underline"},[d(o(c),{icon:K.value[s.id]?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-4 h-4"},null,8,["icon"]),te(" "+y(K.value[s.id]?"ซ่อน":"ดู")+" "+y(s.replies_count||J.value[s.id]?.length||0)+" การตอบกลับ ",1)],8,fl)):k("",!0),oe.value[s.id]?(l(),a("div",hl,[d(o(c),{icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin text-gray-400"})])):k("",!0),K.value[s.id]&&J.value[s.id]?.length?(l(),a("div",bl,[(l(!0),a(q,null,W(J.value[s.id],v=>(l(),a("div",{key:v.id,class:"flex gap-2"},[e("img",{src:o($)(v.user||v.author),alt:(v.user||v.author)?.name,class:"w-6 h-6 rounded-full"},null,8,xl),e("div",yl,[e("div",ml,[e("p",_l,y((v.user||v.author)?.name),1),e("p",wl,y(v.content),1)]),e("div",$l,[e("button",{onClick:ne=>Ee(v,s.id),class:le(["hover:text-blue-600",v.isLikedByAuth||v.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+y(v.likes>0?` (${v.likes})`:""),11,Cl),e("button",{onClick:ne=>Oe(v,s.id),class:le(["hover:text-gray-700",v.isDislikedByAuth||v.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+y(v.dislikes>0?` (${v.dislikes})`:""),11,Al),e("span",null,y(ke(v.created_at)),1)])])]))),128))])):k("",!0)])])]))),128)),b.value&&E.value>h.value.length?(l(),a("button",{key:0,onClick:Me,disabled:x.value,class:"w-full py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"},[x.value?(l(),Y(o(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin inline mr-2"})):k("",!0),te(" ดูความคิดเห็นเพิ่มเติม ("+y(E.value-h.value.length)+") ",1)],8,Il)):k("",!0)])):(l(),a("div",Dl," ยังไม่มีความคิดเห็น เป็นคนแรกที่แสดงความคิดเห็น! "))])):k("",!0)]),_:1}),T.value?(l(),Y(Ze,{key:3,show:T.value,"shareable-type":"CoursePost","shareable-id":D.post.id,post:D.post,onClose:r[8]||(r[8]=s=>T.value=!1),onShared:Ne},null,8,["show","shareable-id","post"])):k("",!0),U.value!==null?(l(),Y(et,{key:4,images:m.value,"initial-index":U.value,onClose:r[9]||(r[9]=s=>U.value=null)},null,8,["images","initial-index"])):k("",!0)])}}}),Ll=ge(jl,[["__scopeId","data-v-321bdb15"]]),Bl={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},Ml={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},Sl={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},Pl={class:"flex items-center gap-2"},Tl={class:"p-4 max-h-[70vh] overflow-y-auto"},Fl={class:"flex items-center gap-3 mb-4"},Ul=["src"],El={class:"flex-1"},Ol={class:"font-medium text-gray-800 dark:text-white"},Rl={class:"flex items-center gap-2"},Vl=["value"],zl={class:"rounded-lg mb-4 min-h-[150px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},Nl=["onKeydown","disabled"],Kl={key:0,class:"mb-4"},ql={class:"flex flex-wrap gap-2"},Gl=["src"],Hl=["onClick"],Ql={key:1,class:"mb-4"},Wl={class:"flex flex-wrap gap-2"},Jl=["src"],Xl=["onClick"],Yl={class:"text-xs text-gray-500 mt-1"},Zl={key:2,class:"mb-4"},ea=["disabled"],ta={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30 flex gap-3"},sa=["disabled"],la=fe({__name:"CourseEditPostModal",props:{show:{type:Boolean},post:{},courseId:{}},emits:["close","post-updated"],setup(D,{emit:Z}){const i=D,G=Z,{user:M}=pe(),S=ve(),f=he(),$=u(i.post?.content||""),w=u(!1),P=u(i.post?.privacy_settings||3),L=u([]),T=u(null),U=u([]);Ie(()=>i.post,h=>{h&&($.value=h.content||"",P.value=h.privacy_settings||3,L.value=[],U.value=[])},{immediate:!0});const A=Q(()=>i.post?(i.post.images||i.post.media||i.post.imagesResources||[]).filter(x=>!U.value.includes(x.id)):[]),O=Q(()=>typeof window>"u"?[]:L.value.map(h=>({file:h,url:URL.createObjectURL(h)}))),F=Q(()=>A.value.length+O.value.length),I=()=>{G("close")},E=h=>{const x=h.target;if(!x.files)return;const j=Array.from(x.files),b=10-F.value;if(j.length>b){f.warning(`สามารถเพิ่ม ได้อีก ${b} รูปเท่านั้น (สูงสุด 10 รูป)`);return}L.value=[...L.value,...j],x.value=""},V=h=>{L.value.splice(h,1)},H=h=>{U.value.includes(h)||U.value.push(h)},ee=()=>{T.value?.click()},R=[{value:1,label:"สาธารณะ",icon:"fluent:globe-24-regular"},{value:2,label:"เฉพาะสมาชิกคอร์ส",icon:"fluent:people-24-regular"},{value:3,label:"เฉพาะครูและผู้ดูแล",icon:"fluent:lock-closed-24-regular"}],N=async()=>{if(!$.value.trim()){f.warning("กรุณาใส่เนื้อหาโพสต์");return}if(!w.value){w.value=!0;try{const h=new FormData;h.append("content",$.value),h.append("privacy_settings",P.value.toString()),L.value.forEach((j,b)=>{h.append(`images[${b}]`,j)}),U.value.forEach((j,b)=>{h.append(`remove_images[${b}]`,j.toString())});const x=await S.post(`/api/courses/${i.courseId}/posts/${i.post.id}?_method=PUT`,h);if(x.success||x.data){const j=x.data||x.post||{...i.post,content:$.value,privacy_settings:P.value,is_edited:!0};G("post-updated",j),f.toast("แก้ไขโพสต์สำเร็จ!","success")}else f.error(x.message||"ไม่สามารถแก้ไขโพสต์ได้")}catch(h){console.error("Error updating post:",h);let x="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";h?.data?.message&&(x=h.data.message),f.error(x)}finally{w.value=!1}}};return(h,x)=>(l(),Y(Ae,{to:"body"},[d(ce,{name:"modal"},{default:ie(()=>[D.show?(l(),a("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(I,["self"])},[e("div",Bl,[e("div",Ml,[e("div",Sl,[e("div",Pl,[d(o(c),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-blue-500"}),x[2]||(x[2]=e("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"แก้ไขโพสต์",-1))]),e("button",{onClick:I,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),e("div",Tl,[e("input",{type:"file",ref_key:"imageInput",ref:T,class:"hidden",accept:"image/*",multiple:"",onChange:E},null,544),e("div",Fl,[e("img",{src:D.post.user?.avatar||D.post.author?.avatar||o(M)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,Ul),e("div",El,[e("div",Ol,y(D.post.user?.name||D.post.author?.name||o(M)?.name),1),e("div",Rl,[d(o(c),{icon:"fluent:book-24-regular",class:"w-3 h-3 text-gray-500"}),x[3]||(x[3]=e("span",{class:"text-xs text-gray-500"},"โพสต์ในรายวิชา",-1)),X(e("select",{"onUpdate:modelValue":x[0]||(x[0]=j=>P.value=j),class:"text-xs px-2 py-0.5 rounded border border-gray-200 dark:border-vikinger-dark-50/30 bg-white dark:bg-vikinger-dark-100"},[(l(),a(q,null,W(R,j=>e("option",{key:j.value,value:j.value},y(j.label),9,Vl)),64))],512),[[Ce,P.value]])])])]),e("div",zl,[X(e("textarea",{"onUpdate:modelValue":x[1]||(x[1]=j=>$.value=j),placeholder:"แก้ไขเนื้อหาโพสต์...",rows:"6",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(N,["ctrl"]),["enter"]),disabled:w.value},null,40,Nl),[[ae,$.value]])]),A.value.length>0?(l(),a("div",Kl,[x[4]||(x[4]=e("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400 mb-2"},"รูปภาพปัจจุบัน",-1)),e("div",ql,[(l(!0),a(q,null,W(A.value,(j,b)=>(l(),a("div",{key:j.id||b,class:"relative group"},[e("img",{src:j.url||j,class:"w-24 h-24 object-cover rounded-lg border border-gray-200 dark:border-vikinger-dark-50/30"},null,8,Gl),e("button",{onClick:g=>H(j.id),class:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-sm md:opacity-0 md:group-hover:opacity-100 transition-opacity"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,Hl)]))),128))])])):k("",!0),O.value.length>0?(l(),a("div",Ql,[x[5]||(x[5]=e("p",{class:"text-sm font-medium text-green-600 dark:text-green-400 mb-2"},"รูปภาพใหม่",-1)),e("div",Wl,[(l(!0),a(q,null,W(O.value,(j,b)=>(l(),a("div",{key:b,class:"relative group"},[e("img",{src:j.url,class:"w-24 h-24 object-cover rounded-lg border-2 border-green-400 dark:border-green-500"},null,8,Jl),e("button",{onClick:g=>V(b),class:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-sm md:opacity-0 md:group-hover:opacity-100 transition-opacity"},[d(o(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,Xl)]))),128)),F.value<10?(l(),a("button",{key:0,onClick:ee,class:"w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center hover:border-vikinger-purple hover:bg-vikinger-purple/5 transition-all"},[d(o(c),{icon:"fluent:add-24-regular",class:"w-8 h-8 text-gray-400"})])):k("",!0)]),e("p",Yl,y(F.value)+"/10 รูป",1)])):k("",!0),O.value.length===0?(l(),a("div",Zl,[e("button",{onClick:ee,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all",disabled:F.value>=10},[d(o(c),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),x[6]||(x[6]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"เพิ่มรูปภาพ",-1))],8,ea)])):k("",!0)]),e("div",ta,[e("button",{onClick:I,class:"flex-1 py-3 px-4 bg-gray-100 dark:bg-vikinger-dark-200 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 transition-all"}," ยกเลิก "),e("button",{onClick:N,disabled:w.value||!$.value.trim(),class:"flex-1 py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[w.value?(l(),Y(o(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):k("",!0),e("span",null,y(w.value?"กำลังบันทึก...":"บันทึก"),1)],8,sa)])])])])):k("",!0)]),_:1})]))}}),aa=ge(la,[["__scopeId","data-v-8ad136ba"]]),ra={class:"space-y-4"},ia={class:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide"},oa=["onClick"],na={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-6 text-center"},da={class:"text-red-600 dark:text-red-400 mb-4"},ua={key:1,class:"space-y-4"},ca={class:"flex justify-center"},ga={key:1,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-8 text-center"},va={key:0,class:"flex items-center gap-2 px-6 py-3 bg-white dark:bg-vikinger-dark-200 text-blue-600 rounded-full shadow-sm"},pa={key:1,class:"h-4 w-full"},ka={key:3,class:"text-center py-6 text-gray-500 dark:text-gray-400"},fa=fe({__name:"CourseFeedsList",props:{courseId:{},isCourseAdmin:{type:Boolean,default:!1},groupId:{},initialTab:{default:"all"}},setup(D){const Z=D,i=ve(),{user:G}=pe(),M=u([]),S=u(!0),f=u(!1),$=u(!0),w=u(1),P=u(10),L=u(null),T=u(!1),U=u(null),A=u(Z.initialTab),O=[{id:"all",label:"ทั้งหมด",icon:"fluent:feed-24-regular"},{id:"discussions",label:"พูดคุย",icon:"fluent:chat-multiple-24-regular"},{id:"questions",label:"คำถาม",icon:"fluent:question-circle-24-regular"},{id:"materials",label:"เอกสาร",icon:"fluent:document-24-regular"},{id:"announcements",label:"ประกาศ",icon:"fluent:megaphone-24-regular"}],F=u(null);let I=null;const E=async(b=!1)=>{b&&(w.value=1,$.value=!0,L.value=null),S.value=b,f.value=!b;try{const g={page:w.value,per_page:P.value,group_id:Z.groupId};A.value!=="all"&&(g.type=A.value);const B=await i.get(`/api/courses/${Z.courseId}/posts`,{params:g}),z=B.data?.data||B.data||B.posts||[],K=B.pagination||B.meta||{};if(b)M.value=Array.isArray(z)?z:[];else{const J=Array.isArray(z)?z:[];M.value=[...M.value,...J]}K.has_more!==void 0?$.value=K.has_more:K.last_page!==void 0?$.value=w.value<K.last_page:$.value=Array.isArray(z)&&z.length===P.value}catch(g){console.error("Error fetching posts:",g),L.value="ไม่สามารถโหลดโพสต์ได้",b||(L.value=null)}finally{S.value=!1,f.value=!1}},V=async()=>{f.value||!$.value||(w.value++,await E(!1))},H=async()=>{await E(!0)},ee=b=>{b&&M.value.unshift(b)},R=b=>{const g=M.value.findIndex(B=>B.id===b.id);g!==-1&&(M.value[g]={...M.value[g],...b}),T.value=!1,U.value=null},N=b=>{M.value=M.value.filter(g=>g.id!==b)},h=b=>{U.value={...b},T.value=!0},x=b=>{A.value!==b&&(A.value=b,E(!0))},j=()=>{I&&I.disconnect(),I=new IntersectionObserver(b=>{b[0].isIntersecting&&$.value&&!f.value&&!S.value&&V()},{root:null,rootMargin:"200px",threshold:.1}),F.value&&I.observe(F.value)};return He(()=>{E(!0),j()}),Qe(()=>{I&&I.disconnect()}),(b,g)=>(l(),a("div",ra,[d(os,{"course-id":D.courseId,"group-id":D.groupId,onPostCreated:ee},null,8,["course-id","group-id"]),e("div",ia,[(l(),a(q,null,W(O,B=>e("button",{key:B.id,onClick:z=>x(B.id),class:le(["flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all duration-300",A.value===B.id?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg":"bg-white dark:bg-vikinger-dark-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(c),{icon:B.icon,class:"w-4 h-4"},null,8,["icon"]),te(" "+y(B.label),1)],10,oa)),64))]),L.value&&!S.value?(l(),a("div",na,[d(o(c),{icon:"fluent:error-circle-24-regular",class:"w-12 h-12 mx-auto mb-3 text-red-500"}),e("p",da,y(L.value),1),e("button",{onClick:H,class:"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},[d(o(c),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4 inline mr-2"}),g[1]||(g[1]=te(" ลองใหม่อีกครั้ง ",-1))])])):S.value?(l(),a("div",ua,[(l(),a(q,null,W(3,B=>e("div",{key:B,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-6 animate-pulse"},[...g[2]||(g[2]=[Je('<div class="flex items-center gap-4 mb-4" data-v-0f6913ec><div class="w-10 h-10 bg-gray-200 dark:bg-vikinger-dark-100 rounded-full" data-v-0f6913ec></div><div class="flex-1 space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/4" data-v-0f6913ec></div><div class="h-3 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/6" data-v-0f6913ec></div></div></div><div class="space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-full" data-v-0f6913ec></div><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-3/4" data-v-0f6913ec></div></div>',2)])])),64))])):(l(),a(q,{key:2},[e("div",ca,[e("button",{onClick:H,class:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full transition-colors"},[d(o(c),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4"}),g[3]||(g[3]=te(" รีเฟรชฟีด ",-1))])]),M.value.length>0?(l(),Y(We,{key:0,tag:"div",name:"feed",class:"space-y-4"},{default:ie(()=>[(l(!0),a(q,null,W(M.value,B=>(l(),Y(Ll,{key:B.id,post:B,"course-id":D.courseId,"current-user-id":o(G)?.id,"is-course-admin":D.isCourseAdmin,onEdit:h,onDelete:N,onPostUpdated:R},null,8,["post","course-id","current-user-id","is-course-admin"]))),128))]),_:1})):(l(),a("div",ga,[d(o(c),{icon:"fluent:chat-24-regular",class:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),g[4]||(g[4]=e("h3",{class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ยังไม่มีโพสต์ ",-1)),g[5]||(g[5]=e("p",{class:"text-gray-500 dark:text-gray-400"}," เป็นคนแรกที่โพสต์ในรายวิชานี้! ",-1))])),$.value&&M.value.length>0?(l(),a("div",{key:2,ref_key:"loadMoreTrigger",ref:F,class:"flex justify-center py-6"},[f.value?(l(),a("div",va,[d(o(c),{icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"}),g[6]||(g[6]=te(" กำลังโหลด... ",-1))])):(l(),a("div",pa))],512)):k("",!0),!$.value&&M.value.length>0?(l(),a("div",ka,[d(o(c),{icon:"fluent:checkmark-circle-24-regular",class:"w-8 h-8 mx-auto mb-2 text-green-500"}),g[7]||(g[7]=e("p",null,"คุณได้ดูโพสต์ทั้งหมดแล้ว!",-1))])):k("",!0)],64)),T.value&&U.value?(l(),Y(aa,{key:3,show:T.value,post:U.value,"course-id":D.courseId,onClose:g[0]||(g[0]=B=>{T.value=!1,U.value=null}),onPostUpdated:R},null,8,["show","post","course-id"])):k("",!0)]))}}),Ca=ge(fa,[["__scopeId","data-v-0f6913ec"]]);export{Ca as C};
