import{q as z,ay as M,a9 as F,r as d,z as q,c as a,a as t,d as k,b as c,e as $,u as n,F as A,k as B,$ as j,ab as D,aB as S,aa as K,aj as L,U as T,o as i,I as u,t as p}from"./CHs-R6Sv.js";import{S as f}from"./BQxta0Da.js";const E={class:"container mx-auto px-4 py-8 max-w-6xl"},Q={class:"flex justify-between items-center mb-6"},G={class:"text-2xl font-bold flex items-center gap-2"},H={key:0,class:"text-center py-10"},J={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},O={key:0,class:"absolute top-0 right-0 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},P={key:1,class:"absolute top-0 right-0 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},W=["src"],X={class:"flex-1 min-w-0"},Y={class:"font-semibold text-gray-900 dark:text-gray-100 truncate"},Z={class:"text-sm text-gray-500 truncate"},ee={class:"flex items-center gap-2 mt-2"},te=["onClick"],se={key:0,class:"col-span-full text-center py-10 text-gray-500"},oe={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4"},ne={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]"},ae={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center"},ie={class:"p-4 space-y-4"},le={class:"flex gap-2"},re={class:"flex-1 overflow-y-auto min-h-[200px] border rounded-lg p-2 bg-gray-50 dark:bg-gray-900/50"},de={key:0,class:"text-center py-4"},ce={key:1,class:"space-y-2"},ue={class:"flex items-center gap-3"},ge=["src"],me={class:"font-medium text-sm"},ve={class:"text-xs text-gray-500"},xe=["onClick"],pe={key:2,class:"text-center py-4 text-gray-500"},we=z({__name:"admin",setup(fe){const I=M(),g=F(),m=I.params.id;T("isCourseAdmin");const h=d([]),v=d(!0),x=d(!1),r=d(""),y=d([]),_=d(!1),b=d(3),w=async()=>{v.value=!0;try{const o=await g.get(`/api/courses/${m}/admins`);if(o.success){const e=o.admins.map(l=>({...l,status:1})),s=(o.invitations||[]).map(l=>({id:`invite-${l.id}`,user:l.invitee,role:l.role,status:2,is_invitation:!0,invitation_id:l.id}));h.value=[...e,...s]}}catch(o){console.error("Failed to fetch admins",o)}finally{v.value=!1}};q(()=>{w()});const C=async()=>{if(!(r.value.length<2)){_.value=!0;try{const o=await g.post(`/api/courses/${m}/admins/search`,{query:r.value});o.success&&(y.value=o.users)}catch(o){console.error("Search failed",o)}finally{_.value=!1}}},V=async o=>{try{v.value=!0,(await g.post(`/api/courses/${m}/admins/invite`,{user_id:o.id,role:b.value})).success&&(f.fire("สำเร็จ","ส่งคำเชิญเรียบร้อยแล้ว","success"),x.value=!1,r.value="",y.value=[],w())}catch(e){f.fire("ข้อผิดพลาด",e.response?.data?.message||"ไม่สามารถเชิญได้","error")}finally{v.value=!1}},N=async o=>{const e=o.is_invitation,s=e?"ยกเลิกคำเชิญ?":"ยืนยันการลบ?",l=e?`คุณต้องการยกเลิกคำเชิญ "${o.user?.name}"?`:`คุณต้องการลบ "${o.user?.name}" ออกจากผู้ดูแล?`;if((await f.fire({title:s,text:l,icon:"warning",showCancelButton:!0,confirmButtonText:e?"ยกเลิกคำเชิญ":"ลบเลย",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33"})).isConfirmed)try{e?await g.delete(`/api/courses/${m}/admins/invitations/${o.invitation_id}`):await g.delete(`/api/courses/${m}/admins/${o.id}`),f.fire(e?"ยกเลิกสำเร็จ":"ลบสำเร็จ","","success"),w()}catch{f.fire("ผิดพลาด","ไม่สามารถดำเนินการได้","error")}},R=T("course"),U=o=>R?.value?.user_id===o.user_id?"แอดมิน (Admin)":o.role===4?"ผู้ดูแล (Admin)":"ผู้ช่วยสอน (TA)";return(o,e)=>(i(),a("div",E,[t("div",Q,[t("div",null,[t("h1",G,[c(n(u),{icon:"eos-icons:admin-outlined",class:"text-blue-600"}),e[4]||(e[4]=$(" จัดการผู้ดูแลรายวิชา ",-1))]),e[5]||(e[5]=t("p",{class:"text-gray-500 text-sm mt-1"},"เพิ่มหรือลบผู้ดูแลและผู้ช่วยสอน",-1))]),t("button",{onClick:e[0]||(e[0]=s=>x.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow transition-all"},[c(n(u),{icon:"mdi:plus"}),e[6]||(e[6]=$(" เพิ่มผู้ดูแล ",-1))])]),n(v)&&!n(x)?(i(),a("div",H,[c(n(u),{icon:"svg-spinners:ring-resize",class:"w-10 h-10 mx-auto text-blue-500"})])):(i(),a("div",J,[(i(!0),a(A,null,B(n(h),s=>(i(),a("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center gap-4 relative overflow-hidden"},[s.status===2?(i(),a("div",O," รอการตอบรับ ")):(i(),a("div",P,p(U(s)),1)),t("img",{src:s.user?.avatar||"/images/default-avatar.png",class:"w-16 h-16 rounded-full object-cover border-2 border-gray-200"},null,8,W),t("div",X,[t("h3",Y,p(s.user?.name||"Unknown"),1),t("p",Z,p(s.user?.email),1),t("div",ee,[t("button",{onClick:l=>N(s),class:"text-red-500 hover:text-red-700 text-xs flex items-center gap-1 bg-red-50 px-2 py-1 rounded-md transition-colors"},[c(n(u),{icon:"mdi:trash-can-outline"}),e[7]||(e[7]=$(" ลบ/ยกเลิก ",-1))],8,te)])])]))),128)),n(h).length===0?(i(),a("div",se," ยังไม่มีผู้ดูแล ")):k("",!0)])),n(x)?(i(),a("div",oe,[t("div",ne,[t("div",ae,[e[8]||(e[8]=t("h3",{class:"font-bold text-lg"},"เชิญผู้ดูแล / TA",-1)),t("button",{onClick:e[1]||(e[1]=s=>x.value=!1),class:"text-gray-500 hover:text-gray-700"},[c(n(u),{icon:"mdi:close",class:"w-6 h-6"})])]),t("div",ie,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-1"},"ตำแหน่ง",-1)),j(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>S(b)?b.value=s:null),class:"w-full border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700"},[...e[9]||(e[9]=[t("option",{value:3},"ผู้ช่วยสอน (TA) - จัดการเนื้อหา/การบ้านได้",-1),t("option",{value:4},"ผู้ดูแลระบบ (Admin) - จัดการทุกอย่างได้",-1)])],512),[[D,n(b)]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-1"},"ค้นหาผู้ใช้งาน (ชื่อ, อีเมล, รหัสอ้างอิง)",-1)),t("div",le,[j(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>S(r)?r.value=s:null),onKeyup:L(C,["enter"]),type:"text",class:"flex-1 border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700",placeholder:"พิมพ์ชื่อเพื่อค้นหา..."},null,544),[[K,n(r)]]),t("button",{onClick:C,class:"bg-blue-600 text-white px-4 rounded-lg hover:bg-blue-700"},[c(n(u),{icon:"heroicons:magnifying-glass"})])])]),t("div",re,[n(_)?(i(),a("div",de,[c(n(u),{icon:"svg-spinners:ring-resize",class:"w-6 h-6 mx-auto text-blue-500"})])):n(y).length>0?(i(),a("div",ce,[(i(!0),a(A,null,B(n(y),s=>(i(),a("div",{key:s.id,class:"flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded shadow-sm hover:shadow-md transition-shadow"},[t("div",ue,[t("img",{src:s.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full"},null,8,ge),t("div",null,[t("p",me,p(s.name),1),t("p",ve,p(s.email),1)])]),t("button",{onClick:l=>V(s),class:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors"}," เชิญ ",8,xe)]))),128))])):n(r).length>1?(i(),a("div",pe," ไม่พบผู้ใช้งาน ")):k("",!0)])])])])):k("",!0)]))}});export{we as default};
