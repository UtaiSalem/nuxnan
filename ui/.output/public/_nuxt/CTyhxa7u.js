import{q as Y,a9 as Z,r as _,n as M,a3 as q,c as s,a as e,d as g,b as i,e as p,u as d,t as v,F as I,k as A,T as E,ae as oe,o as t,I as c,$ as ne,aa as ie,g as G,a7 as de,w as K,j as W,aP as ce,a1 as ue,_ as ge}from"./cTealXVQ.js";import{_ as ve}from"./D6ta9QHx.js";import{_ as X}from"./VPWt-suZ.js";import{u as ee}from"./CaSR6SuD.js";import{u as be}from"./CuhQWnJh.js";import{I as me}from"./B8TD85Ki.js";const xe={class:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6"},fe={class:"flex items-center justify-between mb-6"},he={class:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white"},ye={class:"px-2 py-0.5 text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full"},pe={key:0,class:"flex gap-2 mb-6 overflow-x-auto pb-2"},ke=["onClick"],_e={key:1,class:"space-y-6"},we={class:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl border border-green-200 dark:border-green-800"},$e={class:"flex items-start justify-between mb-4"},Ce={class:"text-lg font-bold text-gray-900 dark:text-white"},je={class:"flex items-center gap-3"},Ie={key:0,class:"flex items-center gap-1 bg-white dark:bg-gray-800 rounded-lg p-1 shadow-sm border border-gray-200 dark:border-gray-700"},Ae={key:0,class:"mb-4"},Se={class:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400"},Ue={class:"flex items-center gap-1.5"},Fe={key:0,class:"flex items-center gap-1.5"},Ve={key:1,class:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-3"},Le=["src","alt"],Ne={key:0,class:"space-y-4"},Te={class:"font-bold text-gray-900 dark:text-white flex items-center gap-2"},Be={key:0,class:"py-8 flex justify-center"},Ee={key:1,class:"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-xl border border-dashed border-gray-300 dark:border-gray-700"},Pe={key:2,class:"space-y-4"},Qe={class:"flex items-start gap-3 mb-3"},ze=["src"],Me={class:"flex-1 min-w-0"},De={class:"flex justify-between items-start"},Oe={class:"font-bold text-gray-900 dark:text-white flex items-center gap-2"},Ge={key:0,class:"px-2 py-0.5 text-[10px] bg-red-100 text-red-600 rounded-full border border-red-200"},Je={key:1,class:"px-2 py-0.5 text-[10px] bg-green-100 text-green-600 rounded-full border border-green-200"},He={class:"text-xs text-gray-500"},Re={key:0,class:"text-red-500 ml-1"},Ke={class:"text-right flex flex-col items-end gap-1"},We=["onClick"],Xe={class:"text-xs text-gray-500"},Ye={class:"mt-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-100 dark:border-gray-800"},Ze={key:0,class:"mt-2 text-xs text-blue-500 flex gap-1"},qe={class:"mt-2 pt-3 border-t border-gray-100 dark:border-gray-700"},et={class:"flex items-center gap-4"},tt=["onUpdate:modelValue","max"],st=["onClick","disabled"],rt=["onClick","disabled"],at={key:1,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800"},lt={class:"flex justify-between items-start mb-2"},ot={class:"font-semibold text-blue-800 dark:text-blue-300 flex items-center gap-2"},nt={class:"flex items-center gap-2"},it={key:0,class:"px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 rounded-lg flex items-center gap-1"},dt={key:1,class:"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400 rounded-lg flex items-center gap-1"},ct={class:"text-gray-700 dark:text-gray-300 mt-2"},ut={key:0,class:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2"},gt=["src"],vt={key:1,class:"mt-4 p-3 bg-amber-100 dark:bg-amber-900/30 rounded-lg"},bt={class:"flex items-center gap-2 text-amber-700 dark:text-amber-400 font-bold"},mt={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},xt={key:2,id:"answer-form",class:"p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-lg"},ft={class:"flex justify-between items-center mb-4"},ht={class:"font-semibold text-gray-900 dark:text-white flex items-center gap-2"},yt={class:"mt-4"},pt={class:"flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 dark:text-gray-400 hover:border-green-500 hover:text-green-500 cursor-pointer transition-colors"},kt={key:0,class:"mt-3 flex flex-wrap gap-2"},_t={class:"truncate max-w-32"},wt=["onClick"],$t={key:1,class:"mt-3"},Ct={class:"flex flex-wrap gap-2"},jt=["src"],It=["onClick"],At=["disabled"],St={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},$s=Y({__name:"LessonAssignmentSection",props:{assignments:{},lessonId:{},courseId:{},isCreator:{type:Boolean}},emits:["submit","close","edit","delete","view-submissions"],setup(k,{emit:J}){const y=k,V=J,P=Z(),C=ee(),{getAvatarUrl:Q}=be(),S=_(y.assignments[0]?.id||null),w=_(!1),f=_(""),h=_([]),N=_([]),D=_(!1),U=_([]),T=_([]),F=_(!1),O=o=>Q(o),u=M(()=>y.assignments.find(o=>o.id===S.value)||null),x=M(()=>u.value&&u.value.answers?.[0]||null),B=M(()=>u.value?x.value?.graded_score!==void 0&&x.value?.graded_score!==null?"graded":x.value?"submitted":"not_started":"not_started"),z=M(()=>{const o={not_started:{icon:"fluent:circle-24-regular",text:"ยังไม่ได้ทำ",color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-50 dark:bg-gray-800 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/30"},submitted:{icon:"fluent:checkmark-circle-24-filled",text:"ส่งแล้ว - รอตรวจ",color:"text-blue-700 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/30 ring-1 ring-inset ring-blue-700/10 dark:ring-blue-500/30"},graded:{icon:"fluent:trophy-24-filled",text:"ตรวจแล้ว",color:"text-amber-700 dark:text-amber-400",bgColor:"bg-amber-50 dark:bg-amber-900/30 ring-1 ring-inset ring-amber-600/20 dark:ring-amber-500/30"}};return o[B.value]||o.not_started}),b=async()=>{if(!(!u.value||!y.isCreator)){D.value=!0;try{const o=await P.get(`/api/assignments/${u.value.id}/answers`);N.value=(o.answers||[]).map(a=>({...a,points:a.points,originalPoints:a.points,isUpdating:!1}))}catch(o){console.error("Failed to fetch answers:",o)}finally{D.value=!1}}};q(S,()=>{y.isCreator&&b()},{immediate:!0});const m=async o=>{if(u.value)try{o.isUpdating=!0,await P.post(`/api/assignments/${u.value.id}/answers/${o.id}/set-points`,{points:o.points,feedback:o.feedback,course_id:y.courseId||u.value.course_id||u.value.lesson?.course_id}),o.status="graded",o.originalPoints=o.points,o.isUpdating=!1,C.toast("บันทึกคะแนนเรียบร้อย","success")}catch(a){console.error("Failed to grade:",a),C.toast("ไม่สามารถบันทึกคะแนนได้","error"),o.isUpdating=!1}},r=o=>{o.points=o.originalPoints},j=async o=>{const a=o.student?.name||o.member_name||"นักเรียน";if(!(!await C.confirm("ลบคำตอบ",`คุณแน่ใจหรือไม่ที่จะลบคำตอบของ ${a}? 
ข้อมูลคะแนนที่ได้จากงานนี้จะถูกลบไปด้วย`)||!u.value))try{await P.delete(`/api/assignments/${u.value.id}/answers/${o.id}`,{params:{course_id:y.courseId||u.value.course_id||u.value.lesson?.course_id}}),N.value=N.value.filter($=>$.id!==o.id),C.toast("ลบคำตอบเรียบร้อยแล้ว","success")}catch($){console.error("Failed to delete answer:",$),C.toast("ไม่สามารถลบคำตอบได้","error")}},n=o=>{S.value=o,f.value="",h.value=[],U.value=[],T.value=[],F.value=!1},L=o=>{const a=o.target;a.files&&(h.value=[...h.value,...Array.from(a.files)])},H=o=>{h.value.splice(o,1)},te=()=>{x.value&&(f.value=x.value.content||"",U.value=[...x.value.images||[]],T.value=[],h.value=[],F.value=!0,oe(()=>{const o=document.getElementById("answer-form");o&&o.scrollIntoView({behavior:"smooth"})}))},se=()=>{F.value=!1,f.value="",h.value=[],U.value=[],T.value=[]},re=o=>{const a=U.value.findIndex(l=>l.id===o);a!==-1&&(U.value.splice(a,1),T.value.push(o))},ae=async()=>{if(!(!u.value||!f.value.trim()&&h.value.length===0&&U.value.length===0)){w.value=!0;try{const o={content:f.value,files:h.value,deleted_images:T.value};V("submit",u.value.id,o),f.value="",h.value=[],U.value=[],T.value=[],F.value=!1}finally{w.value=!1}}},R=o=>o?new Date(o).toLocaleString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return(o,a)=>(t(),s("div",xe,[e("div",fe,[e("h3",he,[i(d(c),{icon:"fluent:clipboard-task-24-filled",class:"w-6 h-6 text-green-600"}),a[5]||(a[5]=p(" แบบฝึกหัดประจำบทเรียน ",-1)),e("span",ye,v(k.assignments.length)+" ข้อ ",1)]),e("button",{onClick:a[0]||(a[0]=l=>V("close")),class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[i(d(c),{icon:"fluent:chevron-up-24-regular",class:"w-5 h-5"})])]),k.assignments.length>1?(t(),s("div",pe,[(t(!0),s(I,null,A(k.assignments,(l,$)=>(t(),s("button",{key:l.id,onClick:le=>n(l.id),class:E(["flex-shrink-0 px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200",[S.value===l.id?"bg-green-500 text-white shadow-lg":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"]])}," ข้อที่ "+v($+1),11,ke))),128))])):g("",!0),u.value?(t(),s("div",_e,[e("div",we,[e("div",$e,[e("h4",Ce,v(u.value.title),1),e("div",je,[k.isCreator?(t(),s("div",Ie,[e("button",{onClick:a[1]||(a[1]=l=>V("edit",u.value)),class:"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-md transition-colors",title:"แก้ไข"},[i(d(c),{icon:"fluent:edit-16-regular",class:"w-4 h-4"})]),a[7]||(a[7]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700"},null,-1)),e("button",{onClick:a[2]||(a[2]=l=>V("delete",u.value)),class:"p-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-md transition-colors",title:"ลบ"},[i(d(c),{icon:"fluent:delete-16-regular",class:"w-4 h-4"})]),a[8]||(a[8]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700"},null,-1)),e("button",{onClick:a[3]||(a[3]=l=>V("view-submissions",u.value)),class:"flex items-center gap-1 px-2 py-1 text-xs font-bold text-amber-600 bg-amber-50 hover:bg-amber-100 dark:bg-amber-900/20 dark:text-amber-400 dark:hover:bg-amber-900/30 rounded-md transition-colors"},[i(d(c),{icon:"fluent:clipboard-task-list-20-regular",class:"w-4 h-4"}),a[6]||(a[6]=e("span",null,"ตรวจละเอียด",-1))])])):(t(),s("span",{key:1,class:E(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium",[z.value.bgColor,z.value.color]])},[i(d(c),{icon:z.value.icon,class:"w-4 h-4"},null,8,["icon"]),p(" "+v(z.value.text),1)],2))])]),u.value.description?(t(),s("div",Ae,[i(X,{"model-value":u.value.description,disabled:"",class:"!min-h-0"},null,8,["model-value"])])):g("",!0),e("div",Se,[e("div",Ue,[i(d(c),{icon:"fluent:star-24-regular",class:"w-4 h-4 text-amber-500"}),e("span",null,v(u.value.points||0)+" คะแนน",1)]),u.value.due_date?(t(),s("div",Fe,[i(d(c),{icon:"fluent:calendar-24-regular",class:"w-4 h-4 text-blue-500"}),e("span",null,"กำหนดส่ง: "+v(R(u.value.due_date)),1)])):g("",!0)]),u.value.images?.length?(t(),s("div",Ve,[(t(!0),s(I,null,A(u.value.images,l=>(t(),s("img",{key:l.id,src:l.full_url||l.image_url,alt:u.value.title,class:"w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity"},null,8,Le))),128))])):g("",!0)]),k.isCreator?(t(),s("div",Ne,[e("h4",Te,[i(d(c),{icon:"fluent:person-available-24-filled",class:"w-5 h-5 text-green-600"}),p(" ส่งงานแล้ว ("+v(N.value.length)+") ",1)]),D.value?(t(),s("div",Be,[i(d(c),{icon:"eos-icons:loading",class:"w-8 h-8 text-green-500"})])):N.value.length===0?(t(),s("div",Ee,[...a[9]||(a[9]=[e("p",{class:"text-gray-500"},"ยังไม่มีใครส่งงาน",-1)])])):(t(),s("div",Pe,[(t(!0),s(I,null,A(N.value,l=>(t(),s("div",{key:l.id,class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm"},[e("div",Qe,[e("img",{src:O(l.user),class:"w-10 h-10 rounded-full object-cover border border-gray-200 dark:border-gray-600"},null,8,ze),e("div",Me,[e("div",De,[e("div",null,[e("div",Oe,[p(v(l.user?.firstname)+" "+v(l.user?.lastname)+" ",1),l.points===null||l.points===void 0?(t(),s("span",Ge," รอตรวจ ")):(t(),s("span",Je," ตรวจแล้ว "))]),e("div",He,[p(" ส่งเมื่อ "+v(R(l.created_at))+" ",1),l.late_submission?(t(),s("span",Re,"(ส่งช้า)")):g("",!0)])]),e("div",Ke,[e("button",{onClick:$=>j(l),class:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"ลบคำตอบ"},[i(d(c),{icon:"fluent:delete-20-regular",class:"w-5 h-5"})],8,We),e("div",null,[e("span",{class:E(["text-2xl font-bold",l.points!==null?"text-green-600 dark:text-green-400":"text-gray-400"])},v(l.points??"-"),3),e("span",Xe,"/ "+v(u.value.points),1)])])]),e("div",Ye,[p(v(l.content)+" ",1),l.images?.length?(t(),s("div",Ze,[i(d(c),{icon:"fluent:image-24-regular",class:"w-4 h-4"}),p(" มีรูปภาพแนบ "+v(l.images.length)+" รูป ",1)])):g("",!0)])])]),e("div",qe,[e("div",et,[a[12]||(a[12]=e("span",{class:"text-xs font-medium text-gray-500"},"ให้คะแนน:",-1)),ne(e("input",{type:"range","onUpdate:modelValue":$=>l.points=$,min:0,max:u.value.points,step:"1",class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-green-500"},null,8,tt),[[ie,l.points,void 0,{number:!0}]]),e("button",{onClick:$=>m(l),disabled:l.isUpdating||l.points===l.originalPoints,class:"p-1 px-3 text-xs font-bold text-white bg-green-500 rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:"บันทึกคะแนน"},[l.isUpdating?(t(),G(d(c),{key:0,icon:"eos-icons:loading",class:"w-4 h-4 animate-spin"})):(t(),G(d(c),{key:1,icon:"fluent:save-24-regular",class:"w-4 h-4"})),a[10]||(a[10]=p(" บันทึก ",-1))],8,st),l.points!==l.originalPoints?(t(),s("button",{key:0,onClick:$=>r(l),disabled:l.isUpdating,class:"p-1 px-3 text-xs font-bold text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 flex items-center gap-1",title:"ยกเลิก"},[i(d(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"}),a[11]||(a[11]=p(" ยกเลิก ",-1))],8,rt)):g("",!0)])])]))),128))]))])):g("",!0),x.value&&!F.value&&!k.isCreator?(t(),s("div",at,[e("div",lt,[e("h5",ot,[i(d(c),{icon:"fluent:document-text-24-regular",class:"w-5 h-5"}),a[13]||(a[13]=p(" คำตอบของคุณ ",-1))]),e("div",nt,[x.value.graded_score===null||x.value.graded_score===void 0?(t(),s("span",it,[i(d(c),{icon:"fluent:clock-24-regular",class:"w-3.5 h-3.5"}),a[14]||(a[14]=p(" ส่งแล้ว - รอตรวจ ",-1))])):(t(),s("span",dt,[i(d(c),{icon:"fluent:checkmark-circle-24-filled",class:"w-3.5 h-3.5"}),a[15]||(a[15]=p(" ตรวจแล้ว ",-1))])),B.value!=="graded"?(t(),s("button",{key:2,onClick:te,class:"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1 ml-2"},[i(d(c),{icon:"fluent:edit-16-filled",class:"w-4 h-4"}),a[16]||(a[16]=p(" แก้ไข ",-1))])):g("",!0)])]),e("div",ct,[i(ve,{content:x.value.content},null,8,["content"])]),x.value.images?.length?(t(),s("div",ut,[(t(!0),s(I,null,A(x.value.images,l=>(t(),s("img",{key:l.id,src:l.full_url||l.image_url,class:"w-full h-24 object-cover rounded-lg border border-blue-100 dark:border-blue-800"},null,8,gt))),128))])):g("",!0),x.value.graded_score!==void 0&&x.value.graded_score!==null?(t(),s("div",vt,[e("div",bt,[i(d(c),{icon:"fluent:trophy-24-filled",class:"w-5 h-5"}),p(" คะแนนที่ได้: "+v(x.value.graded_score)+" / "+v(u.value.points||100),1)]),x.value.feedback?(t(),s("p",mt,v(x.value.feedback),1)):g("",!0)])):g("",!0)])):g("",!0),B.value!=="graded"&&!k.isCreator&&!x.value||F.value?(t(),s("div",xt,[e("div",ft,[e("h5",ht,[i(d(c),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-green-600"}),p(" "+v(F.value?"แก้ไขคำตอบ":"เขียนคำตอบ"),1)]),F.value?(t(),s("button",{key:0,onClick:se,class:"text-gray-500 hover:text-gray-700 text-sm font-medium"}," ยกเลิก ")):g("",!0)]),i(X,{modelValue:f.value,"onUpdate:modelValue":a[4]||(a[4]=l=>f.value=l),placeholder:"พิมพ์คำตอบของคุณที่นี่...",class:"min-h-[120px]"},null,8,["modelValue"]),e("div",yt,[e("label",pt,[i(d(c),{icon:"fluent:attach-24-regular",class:"w-5 h-5"}),a[17]||(a[17]=e("span",null,"แนบไฟล์ / รูปภาพ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,.pdf,.doc,.docx",class:"hidden",onChange:L},null,32)]),h.value.length?(t(),s("div",kt,[(t(!0),s(I,null,A(h.value,(l,$)=>(t(),s("div",{key:$,class:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm"},[i(d(c),{icon:"fluent:document-24-regular",class:"w-4 h-4"}),e("span",_t,v(l.name),1),e("button",{onClick:le=>H($),class:"text-red-500 hover:text-red-700"},[i(d(c),{icon:"fluent:dismiss-12-regular",class:"w-4 h-4"})],8,wt)]))),128))])):g("",!0),U.value.length>0?(t(),s("div",$t,[a[18]||(a[18]=e("p",{class:"text-xs text-gray-500 mb-2"},"รูปภาพเดิม:",-1)),e("div",Ct,[(t(!0),s(I,null,A(U.value,l=>(t(),s("div",{key:l.id,class:"relative group w-24 h-24 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},[e("img",{src:l.full_url||l.image_url,class:"w-full h-full object-cover"},null,8,jt),e("button",{onClick:$=>re(l.id),class:"absolute top-1 right-1 p-1 bg-red-500/90 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"ลบรูปภาพ"},[i(d(c),{icon:"fluent:delete-16-regular",class:"w-3 h-3"})],8,It)]))),128))])])):g("",!0)]),e("button",{onClick:ae,disabled:w.value||!f.value.trim()&&h.value.length===0,class:"mt-4 w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"},[i(d(c),{icon:w.value?"fluent:spinner-ios-20-regular":"fluent:send-24-filled",class:E(["w-5 h-5",w.value&&"animate-spin"])},null,8,["icon","class"]),p(" "+v(w.value?"กำลังบันทึก...":F.value?"บันทึกการแก้ไข":"ส่งคำตอบ"),1)],8,At)])):g("",!0)])):(t(),s("div",St,[i(d(c),{icon:"fluent:clipboard-task-24-regular",class:"w-12 h-12 mx-auto mb-2 opacity-50"}),a[19]||(a[19]=e("p",null,"ไม่มีแบบฝึกหัดในบทเรียนนี้",-1))]))]))}}),Ut={class:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6"},Ft={class:"flex flex-col gap-4 mb-6"},Vt={class:"flex items-center justify-between"},Lt={class:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white"},Nt={class:"px-2 py-0.5 text-sm font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded-full"},Tt={key:0,class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden"},Bt={key:1,class:"text-right text-sm text-gray-500 dark:text-gray-400"},Et={key:0,class:"space-y-8"},Pt={class:"flex items-start gap-5"},Qt={class:"flex-shrink-0 w-10 h-10 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg font-bold text-lg"},zt={class:"flex-1 w-full min-w-0"},Mt={class:"font-medium text-lg text-gray-900 dark:text-white mb-4 leading-relaxed whitespace-pre-wrap"},Dt={key:0,class:"flex gap-3 overflow-x-auto pb-4 scrollbar-hide"},Ot=["src","onClick"],Gt={class:"space-y-3 mt-2"},Jt=["onClick","disabled"],Ht={class:"flex-1"},Rt={class:"text-gray-900 dark:text-gray-200 text-base"},Kt={key:0,class:"mt-3"},Wt=["src","onClick"],Xt={class:"mt-6 flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50"},Yt={class:"flex-1 min-h-[40px] flex items-center"},Zt={key:0,class:"text-sm opacity-80 ml-1"},qt=["onClick","disabled"],es={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},ts={key:1,class:"space-y-4"},ss={key:0,class:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border-dashed border-2 border-gray-200 dark:border-gray-700"},rs={class:"w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mx-auto mb-4"},as={class:"flex items-start gap-4"},ls={class:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg font-bold"},os={class:"flex-1 min-w-0"},ns={class:"font-medium text-gray-900 dark:text-white mb-2"},is={key:0,class:"flex gap-2 overflow-x-auto pb-2"},ds=["src","onClick"],cs={class:"mt-3 space-y-1"},us=["src","onClick"],gs={key:1},vs={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},bs=["onClick"],ms=["onClick"],xs={class:"absolute top-4 right-4 text-xs font-medium text-gray-400"},fs=Y({__name:"LessonQuizSection",props:{questions:{},lessonId:{},isCreator:{type:Boolean}},emits:["update:questions","create","edit","delete"],setup(k,{emit:J}){const y=k,V=J,P=Z(),C=ee(),Q=M(()=>y.questions&&y.questions.length>0),S=_([]),w=_({}),f=_({}),h=_({});q(()=>y.questions,b=>{b&&(S.value=JSON.parse(JSON.stringify(b)))},{immediate:!0,deep:!0});const N=M(()=>{if(!y.questions||y.questions.length===0)return 0;const b=new Set(Object.keys(f.value).map(Number));y.questions&&y.questions.forEach(r=>{r.user_answer&&b.add(r.id)});const m=b.size;return Math.round(m/y.questions.length*100)}),D=(b,m)=>{f.value[b]?.is_correct||(w.value[b]=m)},U=b=>{for(let m=b.length-1;m>0;m--){const r=Math.floor(Math.random()*(m+1));[b[m],b[r]]=[b[r],b[m]]}return b},T=async b=>{const m=w.value[b.id];if(m){h.value[b.id]=!0;try{const j=await P.post(`/api/lessons/${y.lessonId}/questions/${b.id}/answer`,{answer_id:m});if(f.value[b.id]={is_correct:j.is_correct,points:j.points,message:j.message},j.is_correct)C.toast("ถูกต้อง! เก่งมาก","success");else{C.toast("ยังไม่ถูกต้อง ลองใหม่นะ","error");const n=S.value.findIndex(L=>L.id===b.id);n!==-1&&S.value[n].options&&setTimeout(()=>{S.value[n].options=U([...S.value[n].options]),w.value[b.id]=0},1e3)}}catch(r){console.error("Submit answer failed",r),C.error("ส่งคำตอบไม่สำเร็จ")}finally{h.value[b.id]=!1}}},F=async b=>{if(await C.confirm("ลบคำถาม","คุณแน่ใจหรือไม่ที่จะลบคำถามนี้?"))try{await P.delete(`/api/lessons/${y.lessonId}/questions/${b.id}`),C.toast("ลบคำถามเรียบร้อย","success");const r=y.questions.filter(j=>j.id!==b.id);V("update:questions",r)}catch(r){console.error("Failed to delete question:",r),C.error("ไม่สามารถลบคำถามได้")}},O=_(!1),u=_([]),x=_(0),B=(b,m)=>{u.value=b.map(r=>({...r,url:r.full_url||r.image_url})),x.value=m,O.value=!0},z=()=>{O.value=!1,u.value=[],x.value=0};return(b,m)=>(t(),s("div",Ut,[e("div",Ft,[e("div",Vt,[e("h3",Lt,[i(d(c),{icon:"fluent:quiz-new-24-filled",class:"w-6 h-6 text-orange-600"}),m[2]||(m[2]=p(" แบบทดสอบ ",-1)),e("span",Nt,v(k.questions.length)+" ข้อ ",1)]),k.isCreator?(t(),s("button",{key:0,onClick:m[0]||(m[0]=r=>V("create")),class:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm font-medium"},[i(d(c),{icon:"fluent:add-24-filled",class:"w-4 h-4"}),m[3]||(m[3]=p(" เพิ่มคำถาม ",-1))])):g("",!0)]),!k.isCreator&&Q.value?(t(),s("div",Tt,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-500 ease-out",style:de({width:`${N.value}%`})},null,4)])):g("",!0),!k.isCreator&&Q.value?(t(),s("div",Bt," ความคืบหน้า: "+v(N.value)+"% ",1)):g("",!0)]),!k.isCreator&&Q.value?(t(),s("div",Et,[(t(!0),s(I,null,A(S.value,(r,j)=>(t(),s("div",{key:r.id,class:"bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-md"},[e("div",Pt,[e("div",Qt,v(j+1),1),e("div",zt,[e("p",Mt,v(r.text),1),r.images?.length?(t(),s("div",Dt,[(t(!0),s(I,null,A(r.images,(n,L)=>(t(),s("img",{key:n.id,src:n.full_url||n.image_url,class:"h-40 w-auto rounded-xl object-cover border border-gray-200 dark:border-gray-700 cursor-pointer hover:opacity-95 transition-opacity shadow-sm",onClick:H=>B(r.images,L)},null,8,Ot))),128))])):g("",!0),e("div",Gt,[i(ce,{name:"list",tag:"div",class:"space-y-3"},{default:K(()=>[(t(!0),s(I,null,A(r.options,n=>(t(),s("button",{key:n.id,onClick:L=>D(r.id,n.id),disabled:h.value[r.id]||f.value[r.id]?.is_correct,class:E(["w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all text-left group relative overflow-hidden",[w.value[r.id]===n.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/10":"border-gray-200 dark:border-gray-700 hover:border-orange-200 dark:hover:border-orange-800 hover:bg-gray-50 dark:hover:bg-gray-800/50"]])},[e("div",{class:E(["w-6 h-6 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-colors",[w.value[r.id]===n.id?"border-orange-500 bg-orange-500 text-white":"border-gray-300 dark:border-gray-600 group-hover:border-orange-400"]])},[w.value[r.id]===n.id?(t(),G(d(c),{key:0,icon:"fluent:checkmark-16-filled",class:"w-4 h-4"})):g("",!0)],2),e("div",Ht,[e("span",Rt,v(n.text),1),n.images?.length?(t(),s("div",Kt,[e("img",{src:n.images[0].full_url||n.images[0].image_url,class:"h-32 w-auto rounded-lg object-cover cursor-pointer hover:opacity-95 shadow-sm border border-gray-200 dark:border-gray-700",onClick:W(L=>B(n.images,0),["stop"])},null,8,Wt)])):g("",!0)])],10,Jt))),128))]),_:2},1024)]),e("div",Xt,[e("div",Yt,[i(ue,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0"},{default:K(()=>[f.value[r.id]?(t(),s("div",{key:0,class:E(["flex items-center gap-3 font-medium px-4 py-2 rounded-lg",f.value[r.id].is_correct?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400"])},[i(d(c),{icon:f.value[r.id].is_correct?"fluent:checkmark-circle-24-filled":"fluent:dismiss-circle-24-filled",class:"w-6 h-6"},null,8,["icon"]),e("span",null,v(f.value[r.id].message),1),f.value[r.id].is_correct?(t(),s("span",Zt," (+"+v(f.value[r.id].points)+" คะแนน) ",1)):g("",!0)],2)):g("",!0)]),_:2},1024)]),f.value[r.id]?.is_correct?g("",!0):(t(),s("button",{key:0,onClick:n=>T(r),disabled:!w.value[r.id]||h.value[r.id],class:"px-8 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium rounded-full shadow-lg shadow-orange-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2 transform active:scale-95"},[h.value[r.id]?(t(),s("span",es)):g("",!0),e("span",null,v(h.value[r.id]?"กำลังส่ง...":"ตรวจคำตอบ"),1),h.value[r.id]?g("",!0):(t(),G(d(c),{key:1,icon:"fluent:send-24-filled",class:"w-5 h-5"}))],8,qt))])])])]))),128))])):g("",!0),k.isCreator?(t(),s("div",ts,[Q.value?g("",!0):(t(),s("div",ss,[e("div",rs,[i(d(c),{icon:"fluent:question-circle-24-regular",class:"w-8 h-8 text-orange-500"})]),m[4]||(m[4]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ยังไม่มีคำถาม",-1)),e("button",{onClick:m[1]||(m[1]=r=>V("create")),class:"mt-4 text-orange-600 hover:text-orange-700 font-medium"}," เพิ่มคำถามแรก ")])),(t(!0),s(I,null,A(k.questions,(r,j)=>(t(),s("div",{key:r.id,class:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm relative group"},[e("div",as,[e("div",ls,v(j+1),1),e("div",os,[e("p",ns,v(r.text),1),r.images?.length?(t(),s("div",is,[(t(!0),s(I,null,A(r.images,(n,L)=>(t(),s("img",{key:n.id,src:n.full_url||n.image_url,class:"h-16 w-auto rounded-lg object-cover border border-gray-200 dark:border-gray-700 cursor-pointer hover:opacity-90 transition-opacity",onClick:H=>B(r.images,L)},null,8,ds))),128))])):g("",!0),e("div",cs,[(t(!0),s(I,null,A(r.options,n=>(t(),s("div",{key:n.id,class:E(["flex items-center gap-2 text-sm",n.is_correct?"text-green-600 dark:text-green-400 font-medium":"text-gray-500 dark:text-gray-400"])},[i(d(c),{icon:n.is_correct?"fluent:checkmark-circle-24-filled":"fluent:circle-24-regular",class:"w-4 h-4 flex-shrink-0"},null,8,["icon"]),n.images?.length?(t(),s("img",{key:0,src:n.images[0].full_url||n.images[0].image_url,class:"h-10 w-auto rounded border border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:W(L=>B(n.images,0),["stop"])},null,8,us)):g("",!0),n.text?(t(),s("span",gs,v(n.text),1)):g("",!0)],2))),128))])]),e("div",vs,[e("button",{onClick:n=>V("edit",r),class:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg",title:"แก้ไข"},[i(d(c),{icon:"fluent:edit-20-regular",class:"w-5 h-5"})],8,bs),e("button",{onClick:n=>F(r),class:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:"ลบ"},[i(d(c),{icon:"fluent:delete-20-regular",class:"w-5 h-5"})],8,ms)])]),e("div",xs,v(r.points)+" คะแนน ",1)]))),128))])):g("",!0),i(me,{show:O.value,images:u.value,"initial-index":x.value,onClose:z},null,8,["show","images","initial-index"])]))}}),Cs=ge(fs,[["__scopeId","data-v-dd10a6ba"]]);export{Cs as Q,$s as _};
