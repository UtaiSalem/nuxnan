import{q as O,ay as G,a9 as J,v as W,r as y,V as X,n as U,a3 as Y,c as g,a as e,g as $,b as l,u as s,d as b,e as c,$ as x,aa as w,w as F,a1 as A,ai as I,F as j,k as N,t as v,a4 as Z,K as Q,f as ee,o as u,I as i,j as M}from"./CHs-R6Sv.js";import{S as f}from"./BQxta0Da.js";const te={class:"container mx-auto px-4 py-6 max-w-4xl"},re={class:"flex items-center gap-4 mb-6"},se={class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},ae={class:"p-6 space-y-6"},oe={class:"grid gap-6"},le={class:"relative"},ie={class:"relative"},ne={key:0,class:"absolute z-50 w-full mt-1 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-xl overflow-hidden"},de={class:"px-4 py-2 bg-gradient-to-r from-purple-50 to-indigo-50 dark:from-purple-900/30 dark:to-indigo-900/30 border-b border-gray-100 dark:border-gray-700"},ue={class:"text-xs font-semibold text-purple-700 dark:text-purple-300 flex items-center gap-1.5"},ce={class:"max-h-64 overflow-y-auto"},ge=["onMousedown"],pe={class:"w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0"},fe={class:"flex-1 min-w-0"},me={class:"font-medium text-gray-900 dark:text-white truncate"},ye={class:"flex items-center gap-3 text-xs text-gray-500 dark:text-gray-400 mt-0.5"},be={class:"flex items-center gap-1"},xe={class:"flex items-center gap-1"},ve={key:0,class:"text-purple-600 dark:text-purple-400 truncate"},he={class:"flex items-center gap-1 flex-shrink-0"},ke=["onMousedown"],we=["onMousedown"],_e={class:"px-4 py-2 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-100 dark:border-gray-700"},Ve={class:"text-xs text-gray-500 dark:text-gray-400"},ze={class:"grid md:grid-cols-2 gap-6"},Be={class:"space-y-4"},Ce={class:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},$e={class:"relative"},Me={class:"space-y-4"},Te={class:"font-medium text-gray-900 dark:text-white flex items-center gap-2"},qe={class:"flex flex-col sm:flex-row gap-6"},De={class:"flex items-center gap-3 cursor-pointer group"},Se={class:"relative flex items-center"},Ue={class:"flex items-center gap-3 cursor-pointer group"},Fe={class:"relative flex items-center"},Ae={key:0,class:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4"},Ie={class:"flex items-start gap-3"},je={class:"list-disc list-inside text-sm text-red-600 dark:text-red-400"},Ne={class:"px-6 py-4 bg-gray-50 dark:bg-gray-700/50 border-t border-gray-200 dark:border-gray-700 flex justify-end gap-3"},Qe=["disabled"],Ee=["disabled"],He={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"},Re={class:"bg-white dark:bg-gray-800 rounded-2xl p-8 flex flex-col items-center gap-4 shadow-2xl"},Pe={class:"relative"},Je=O({__name:"create",setup(Le){const h=G().params.id,_=J();W();const p=y(!1),m=y([]),r=X({title:"",description:"",start_date:new Date,end_date:new Date(Date.now()+3600*1e3),time_limit:60,passing_score:50,is_active:!0,shuffle_questions:!1}),d=y([]),V=y(!1),k=y(!1),z=y(!1),T=U(()=>k.value&&d.value.length>0);let B=null;Y(()=>r.title,a=>{B&&clearTimeout(B),a&&a.length>=2?B=setTimeout(q,300):d.value=[]});const q=async()=>{if(!(!r.title||r.title.length<2)){console.log("Searching quizzes for:",r.title),V.value=!0;try{const a=await _.get(`/api/quizzes/search?q=${encodeURIComponent(r.title)}`);console.log("API Response:",a),Array.isArray(a)?d.value=a:a.quizzes?d.value=a.quizzes:a.data?d.value=Array.isArray(a.data)?a.data:[]:d.value=[],console.log("Quiz suggestions loaded:",d.value.length,"items")}catch(a){console.error("Error searching quizzes:",a),d.value=[]}finally{V.value=!1}}},E=()=>{k.value=!0,r.title&&r.title.length>=2&&d.value.length===0&&q()},H=()=>{setTimeout(()=>{k.value=!1},300)},R=a=>{r.title=a.title||"",r.description=a.description||"",r.time_limit=a.time_limit||60,r.passing_score=a.passing_score||50,r.shuffle_questions=!!a.shuffle_questions,r.is_active=!!a.is_active,k.value=!1,f.fire({icon:"info",title:"นำค่ามาใช้แล้ว",text:"ข้อมูลถูกนำมาใส่ในฟอร์มแล้ว กรุณาแก้ไขและบันทึก",timer:2e3,showConfirmButton:!1})},P=a=>{d.value=d.value.filter((t,n)=>n!==a)},L=async a=>{const t=await f.fire({title:"คัดลอกแบบทดสอบ",html:`
      <p class="mb-4">คุณต้องการคัดลอก "${a.title}" มาใช้ในคอร์สนี้หรือไม่?</p>
      <input id="swal-new-title" class="swal2-input" placeholder="ชื่อแบบทดสอบใหม่" value="${a.title} (สำเนา)">
    `,icon:"question",showCancelButton:!0,confirmButtonText:"คัดลอก",cancelButtonText:"ยกเลิก",confirmButtonColor:"#8b5cf6",preConfirm:()=>{const n=document.getElementById("swal-new-title");return n.value.trim()?n.value.trim():(f.showValidationMessage("กรุณาระบุชื่อแบบทดสอบ"),!1)}});if(t.isConfirmed&&t.value){z.value=!0;try{const n=await _.post(`/api/quizzes/${a.id}/duplicate`,{course_id:Number(h),title:t.value});(n.success||n.quiz)&&(await f.fire({icon:"success",title:"คัดลอกสำเร็จ!",text:"แบบทดสอบถูกคัดลอกมายังคอร์สนี้แล้ว",timer:2e3,showConfirmButton:!1}),Q(`/courses/${h}/quizzes/${n.quiz.id}/edit`))}catch(n){console.error("Error duplicating quiz:",n),f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:n?.data?.message||"ไม่สามารถคัดลอกแบบทดสอบได้"})}finally{z.value=!1}}T.value=!1},D=U(()=>r.title.trim()!==""&&r.time_limit>0&&r.passing_score>=0&&r.passing_score<=100&&(!r.start_date||!r.end_date||new Date(r.end_date)>new Date(r.start_date))),K=async()=>{if(!(!D.value||p.value)){p.value=!0,m.value=[];try{const a={title:r.title,description:r.description,time_limit:r.time_limit,passing_score:r.passing_score,is_active:r.is_active,shuffle_questions:r.shuffle_questions,start_date:r.start_date,end_date:r.end_date};(await _.post(`/api/courses/${h}/quizzes`,a)).success&&(f.fire({icon:"success",title:"สร้างแบบทดสอบสำเร็จ",timer:1500,showConfirmButton:!1}),Q(`/courses/${h}/quizzes`))}catch(a){console.error(a),a.data?.errors?m.value=Object.values(a.data.errors).flat():m.value=["เกิดข้อผิดพลาดในการสร้างแบบทดสอบ"],f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:m.value[0]})}finally{p.value=!1}}};return(a,t)=>{const n=ee("VueDatePicker");return u(),g("div",te,[e("div",re,[e("button",{onClick:t[0]||(t[0]=o=>a.$router.back()),class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 transition-colors"},[l(s(i),{icon:"fluent:arrow-left-24-regular",class:"w-6 h-6"})]),t[10]||(t[10]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"สร้างแบบทดสอบใหม่"),e("p",{class:"text-sm text-gray-500"},"กรอกข้อมูลเพื่อสร้างแบบทดสอบสำหรับรายวิชานี้")],-1))]),e("div",se,[e("div",ae,[e("div",oe,[e("div",le,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[c(" ชื่อแบบทดสอบ "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ie,[x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s(r).title=o),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-shadow",placeholder:"เช่น แบบทดสอบบทที่ 1",onFocus:E,onBlur:H},null,544),[[w,s(r).title]]),s(V)?(u(),$(s(i),{key:0,icon:"svg-spinners:ring-resize",class:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-purple-500"})):b("",!0)]),l(A,{"enter-active-class":"transition ease-out duration-150","enter-from-class":"opacity-0 -translate-y-2","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-100","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 -translate-y-2"},{default:F(()=>[s(T)&&s(d).length>0?(u(),g("div",ne,[e("div",de,[e("p",ue,[l(s(i),{icon:"fluent:copy-24-regular",class:"w-3.5 h-3.5"}),t[11]||(t[11]=c(" แบบทดสอบที่คุณเคยสร้าง ",-1))])]),e("div",ce,[(u(!0),g(j,null,N(s(d),(o,C)=>(u(),g("div",{key:o.id,class:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("button",{type:"button",onMousedown:M(S=>R(o),["prevent"]),class:"flex items-center gap-3 flex-1 text-left"},[e("div",pe,[l(s(i),{icon:"fluent:quiz-new-24-filled",class:"w-5 h-5 text-white"})]),e("div",fe,[e("p",me,v(o.title),1),e("div",ye,[e("span",be,[l(s(i),{icon:"fluent:document-24-regular",class:"w-3.5 h-3.5"}),c(" "+v(o.questions_count||0)+" ข้อ ",1)]),e("span",xe,[l(s(i),{icon:"fluent:star-24-regular",class:"w-3.5 h-3.5"}),c(" "+v(o.total_score||0)+" คะแนน ",1)]),o.course?(u(),g("span",ve," จาก: "+v(o.course.name||o.course.title),1)):b("",!0)])])],40,ge),e("div",he,[e("button",{type:"button",onMousedown:M(S=>L(o),["prevent"]),class:"p-2 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded-lg transition-colors",title:"คัดลอกแบบทดสอบ (พร้อมคำถาม)"},[l(s(i),{icon:"fluent:copy-24-regular",class:"w-4 h-4"})],40,ke),e("button",{type:"button",onMousedown:M(S=>P(C),["prevent"]),class:"p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"ซ่อน"},[l(s(i),{icon:"fluent:dismiss-16-regular",class:"w-4 h-4"})],40,we)])]))),128))]),e("div",_e,[e("p",Ve,[l(s(i),{icon:"fluent:info-16-regular",class:"w-3.5 h-3.5 inline mr-1"}),t[12]||(t[12]=c(" คลิกชื่อเพื่อนำค่ามาใช้ หรือคลิก ",-1)),l(s(i),{icon:"fluent:copy-24-regular",class:"w-3 h-3 inline text-green-600"}),t[13]||(t[13]=c(" เพื่อคัดลอกพร้อมคำถาม ",-1))])])])):b("",!0)]),_:1})]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," คำอธิบาย ",-1)),x(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=o=>s(r).description=o),rows:"3",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-shadow",placeholder:"รายละเอียดย่อ หรือคำชี้แจง..."},null,512),[[w,s(r).description]])])]),t[27]||(t[27]=e("hr",{class:"border-gray-200 dark:border-gray-700"},null,-1)),e("div",ze,[e("div",Be,[e("h3",Ce,[l(s(i),{icon:"fluent:timer-24-regular",class:"w-5 h-5 text-gray-400"}),t[16]||(t[16]=c(" การตั้งค่าเวลาและคะแนน ",-1))]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[c(" เวลาในการทำข้อสอบ (นาที) "),e("span",{class:"text-red-500"},"*")],-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s(r).time_limit=o),type:"number",min:"1",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[w,s(r).time_limit,void 0,{number:!0}]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},[c(" เกณฑ์ผ่าน (%) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",$e,[x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s(r).passing_score=o),type:"number",min:"0",max:"100",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-8"},null,512),[[w,s(r).passing_score,void 0,{number:!0}]]),t[18]||(t[18]=e("span",{class:"absolute right-3 top-2.5 text-gray-500"},"%",-1))])])]),e("div",Me,[e("h3",Te,[l(s(i),{icon:"fluent:calendar-ltr-24-regular",class:"w-5 h-5 text-gray-400"}),t[20]||(t[20]=c(" กำหนดการ ",-1))]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," เริ่มทำได้ตั้งแต่ ",-1)),l(n,{modelValue:s(r).start_date,"onUpdate:modelValue":t[5]||(t[5]=o=>s(r).start_date=o),format:"dd/MM/yyyy HH:mm","auto-apply":"",teleport:!0,"input-class-name":"bg-white dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white"},null,8,["modelValue"])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"}," สิ้นสุดเมื่อ ",-1)),l(n,{modelValue:s(r).end_date,"onUpdate:modelValue":t[6]||(t[6]=o=>s(r).end_date=o),format:"dd/MM/yyyy HH:mm","auto-apply":"",teleport:!0},null,8,["modelValue"])])])]),t[28]||(t[28]=e("hr",{class:"border-gray-200 dark:border-gray-700"},null,-1)),e("div",qe,[e("label",De,[e("div",Se,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=o=>s(r).shuffle_questions=o),class:"peer sr-only"},null,512),[[I,s(r).shuffle_questions]]),t[23]||(t[23]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-purple-600"},null,-1))]),t[24]||(t[24]=e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-300 group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors"},"สลับข้อคำถาม",-1))]),e("label",Ue,[e("div",Fe,[x(e("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=o=>s(r).is_active=o),class:"peer sr-only"},null,512),[[I,s(r).is_active]]),t[25]||(t[25]=e("div",{class:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 dark:peer-focus:ring-purple-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"},null,-1))]),t[26]||(t[26]=e("span",{class:"text-sm font-medium text-gray-900 dark:text-gray-300 group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors"},"เปิดใช้งาน (เผยแพร่)",-1))])]),s(m).length?(u(),g("div",Ae,[e("div",Ie,[l(s(i),{icon:"fluent:error-circle-24-filled",class:"w-5 h-5 text-red-500 mt-0.5"}),e("ul",je,[(u(!0),g(j,null,N(s(m),(o,C)=>(u(),g("li",{key:C},v(o),1))),128))])])])):b("",!0)]),e("div",Ne,[e("button",{onClick:t[9]||(t[9]=o=>a.$router.back()),class:"px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",disabled:s(p)}," ยกเลิก ",8,Qe),e("button",{onClick:K,class:"px-6 py-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2",disabled:!s(D)||s(p)},[s(p)?(u(),$(s(i),{key:0,icon:"svg-spinners:ring-resize",class:"w-5 h-5"})):b("",!0),e("span",null,v(s(p)?"กำลังบันทึก...":"สร้างแบบทดสอบ"),1)],8,Ee)])]),(u(),$(Z,{to:"body"},[l(A,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0","enter-to-class":"opacity-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"opacity-100","leave-to-class":"opacity-0"},{default:F(()=>[s(z)?(u(),g("div",He,[e("div",Re,[e("div",Pe,[l(s(i),{icon:"svg-spinners:ring-resize",class:"w-14 h-14 text-purple-600"})]),t[29]||(t[29]=e("div",{class:"text-center"},[e("p",{class:"text-lg font-bold text-gray-900 dark:text-white"},"กำลังคัดลอกแบบทดสอบ..."),e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"รวมถึงคำถามและรูปภาพทั้งหมด")],-1))])])):b("",!0)]),_:1})]))])}}});export{Je as default};
