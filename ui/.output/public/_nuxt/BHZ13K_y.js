import{q as N,ay as S,a9 as V,r as L,am as M,n as Q,c as n,b as i,u as e,a as t,d as p,e as g,t as o,w as q,T as m,F as U,k as W,K as _,U as E,o as a,I as d,g as H}from"./CHs-R6Sv.js";import{S as h}from"./BQxta0Da.js";import{_ as $,a as K}from"./C4w5myq4.js";import{u as R}from"./Db4oljmS.js";import"./BGzz-v_u.js";const G={class:"container mx-auto px-4 py-6 max-w-4xl"},J={key:0,class:"flex justify-center p-12"},O={key:1},P={class:"flex items-center justify-between mb-6"},X={key:0,class:"flex items-center gap-2"},Y={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},Z={class:"bg-gradient-to-r from-purple-600 to-indigo-600 p-8 text-white"},tt={class:"flex items-start gap-4"},et={class:"w-16 h-16 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30"},st={class:"flex items-center gap-2 mb-2"},rt={class:"px-2 py-0.5 rounded-full text-xs font-medium bg-white/20 text-white border border-white/20"},ot={key:0,class:"flex items-center gap-1 text-xs bg-black/20 px-2 py-0.5 rounded-full"},at={class:"text-3xl font-bold mb-2"},nt={class:"text-purple-100 text-lg opacity-90"},lt={class:"grid md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700 border-b border-gray-200 dark:border-gray-700"},it={class:"p-6 text-center"},dt={class:"text-2xl font-bold text-gray-900 dark:text-white"},ct={class:"p-6 text-center"},ut={class:"text-2xl font-bold text-gray-900 dark:text-white"},gt={class:"p-6 text-center"},xt={class:"text-2xl font-bold text-gray-900 dark:text-white"},pt={class:"p-6 bg-gray-50 dark:bg-gray-700/30 border-b border-gray-200 dark:border-gray-700"},_t={class:"grid md:grid-cols-2 gap-4 text-sm"},bt={class:"flex items-center gap-3"},mt={class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"},ft={class:"font-medium text-gray-900 dark:text-white"},yt={class:"flex items-center gap-3"},ht={class:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400"},vt={class:"font-medium text-gray-900 dark:text-white"},kt={class:"p-8 text-center"},wt={key:0},zt={key:0,class:"bg-gray-100 dark:bg-gray-700/50 rounded-xl p-6 mb-6"},Ct={class:"flex justify-center gap-12 text-center py-4"},qt={class:"flex flex-col items-center"},$t={class:"flex flex-col items-center mt-1"},Ft={class:"text-xs text-gray-400 font-medium"},Bt={class:"flex flex-col items-center"},Tt={class:"mt-4 text-center"},jt={key:1,class:"mt-4 text-sm text-gray-500"},Dt={key:1},At={class:"bg-gray-50 dark:bg-gray-700/30 rounded-xl p-6"},It={class:"overflow-x-auto"},Nt={class:"w-full text-sm text-left"},St={class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white flex items-center gap-2"},Vt={class:"w-8 h-8 rounded-full bg-gray-200 overflow-hidden"},Lt=["src"],Mt={class:"px-6 py-4"},Qt={class:"px-6 py-4"},Ut={class:"px-6 py-4"},Wt={class:"px-6 py-4"},Et={key:1,class:"text-gray-500 italic"},Ht={key:0},Kt={class:"mt-4 flex justify-end gap-2"},Rt={key:2,class:"text-center py-12"},Zt=N({__name:"index",async setup(Gt){let b,v;const k=S(),u=k.params.id,x=k.params.quizId,w=V(),z=E("isCourseAdmin"),f=L(!1),F=()=>{f.value=!0},B=c=>{c&&c.course_id===Number(u)&&T()},{data:s,refresh:T,pending:j}=([b,v]=M(async()=>R(`course-quiz-${x}`,async()=>(await w.get(`/api/courses/${u}/quizzes/${x}`)).quiz)),b=await b,v(),b),D=()=>{_(`/courses/${u}/quizzes/${x}/attempt`)},C=()=>{_(`/courses/${u}/quizzes/${x}/edit`)},A=async()=>{if((await h.fire({title:"ยืนยันการลบ?",text:"คุณต้องการลบแบบทดสอบนี้ใช่หรือไม่ การกระทำนี้ไม่สามารถยกเลิกได้",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await w.delete(`/api/courses/${u}/quizzes/${x}`),await h.fire("ลบสำเร็จ!","แบบทดสอบถูกลบแล้ว","success"),_(`/courses/${u}/quizzes`)}catch{h.fire("เกิดข้อผิดพลาด","ไม่สามารถลบแบบทดสอบได้","error")}},y=c=>c?new Date(c).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",I=Q(()=>s.value?s.value.is_active?{text:"เผยแพร่แล้ว",class:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"}:{text:"ฉบับร่าง",class:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}:{});return(c,r)=>(a(),n("div",G,[e(j)?(a(),n("div",J,[i(e(d),{icon:"svg-spinners:3-dots-fade",class:"w-10 h-10 text-gray-400"})])):e(s)?(a(),n("div",O,[t("div",P,[t("button",{onClick:r[0]||(r[0]=l=>("navigateTo"in c?c.navigateTo:e(_))(`/courses/${e(u)}/quizzes`)),class:"flex items-center gap-2 text-gray-500 hover:text-gray-900 dark:hover:text-white transition-colors"},[i(e(d),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"}),r[3]||(r[3]=t("span",null,"กลับไปหน้ารวมแบบทดสอบ",-1))]),e(z)?(a(),n("div",X,[t("button",{onClick:F,class:"px-4 py-2 rounded-lg bg-purple-50 text-purple-600 hover:bg-purple-100 dark:bg-purple-900/20 dark:text-purple-400 dark:hover:bg-purple-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:copy-24-regular",class:"w-5 h-5"}),r[4]||(r[4]=g(" คัดลอก ",-1))]),t("button",{onClick:C,class:"px-4 py-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5"}),r[5]||(r[5]=g(" แก้ไข ",-1))]),t("button",{onClick:A,class:"px-4 py-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:delete-24-regular",class:"w-5 h-5"}),r[6]||(r[6]=g(" ลบ ",-1))])])):p("",!0)]),t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[i(e(d),{icon:"fluent:quiz-new-24-filled",class:"w-8 h-8 text-white"})]),t("div",null,[t("div",st,[t("span",rt,o(e(I).text),1),e(s).time_limit?(a(),n("span",ot,[i(e(d),{icon:"fluent:timer-24-filled",class:"w-3 h-3"}),g(" "+o(e(s).time_limit)+" นาที ",1)])):p("",!0)]),t("h1",at,o(e(s).title),1),t("p",nt,o(e(s).description||"ไม่มีคำอธิบาย"),1)])])]),t("div",lt,[t("div",it,[r[7]||(r[7]=t("div",{class:"text-sm text-gray-500 mb-1"},"จำนวนข้อ",-1)),t("div",dt,o(e(s).questions?.length||0),1)]),t("div",ct,[r[8]||(r[8]=t("div",{class:"text-sm text-gray-500 mb-1"},"คะแนนเต็ม",-1)),t("div",ut,o(e(s).total_score||0),1)]),t("div",gt,[r[9]||(r[9]=t("div",{class:"text-sm text-gray-500 mb-1"},"เกณฑ์ผ่าน",-1)),t("div",xt,o(e(s).passing_score)+"% ",1)])]),t("div",pt,[t("div",_t,[t("div",bt,[t("div",mt,[i(e(d),{icon:"fluent:calendar-ltr-24-regular",class:"w-5 h-5"})]),t("div",null,[r[10]||(r[10]=t("p",{class:"text-gray-500"},"เริ่มทำได้ตั้งแต่",-1)),t("p",ft,o(y(e(s).start_date)),1)])]),t("div",yt,[t("div",ht,[i(e(d),{icon:"fluent:calendar-end-24-regular",class:"w-5 h-5"})]),t("div",null,[r[11]||(r[11]=t("p",{class:"text-gray-500"},"สิ้นสุดเมื่อ",-1)),t("p",vt,o(y(e(s).end_date)),1)])])])]),t("div",kt,[e(z)?(a(),n("div",Dt,[t("div",At,[r[17]||(r[17]=t("h3",{class:"text-lg font-semibold mb-4"},"ผลการสอบของนักเรียน",-1)),t("div",It,[t("table",Nt,[r[16]||(r[16]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-400"},[t("tr",null,[t("th",{class:"px-6 py-3 rounded-l-lg"},"นักเรียน"),t("th",{class:"px-6 py-3"},"วันที่สอบ"),t("th",{class:"px-6 py-3"},"คะแนน"),t("th",{class:"px-6 py-3"},"เปอร์เซ็นต์"),t("th",{class:"px-6 py-3 rounded-r-lg"},"สถานะ")])],-1)),t("tbody",null,[(a(!0),n(U,null,W(e(s).student_results,l=>(a(),n("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700"},[t("td",St,[t("div",Vt,[l.user?.avatar?(a(),n("img",{key:0,src:l.user.avatar,class:"w-full h-full object-cover"},null,8,Lt)):(a(),H(e(d),{key:1,icon:"fluent:person-24-filled",class:"w-full h-full p-1 text-gray-400"}))]),g(" "+o(l.user?.name||"Unknown"),1)]),t("td",Mt,o(l.completed_at?y(l.completed_at):l.started_at?"กำลังทำข้อสอบ":"-"),1),t("td",Qt,o(l.score)+" / "+o(e(s).total_score),1),t("td",Ut,o(parseFloat(l.percentage).toFixed(1))+"% ",1),t("td",Wt,[l.completed_at?(a(),n("span",{key:0,class:m(["px-2 py-1 rounded text-xs font-bold",l.status===3?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},o(l.status===3?"ผ่าน":"ไม่ผ่าน"),3)):(a(),n("span",Et,"..."))])]))),128)),!e(s).student_results||e(s).student_results.length===0?(a(),n("tr",Ht,[...r[15]||(r[15]=[t("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"}," ยังไม่มีใครทำแบบทดสอบนี้นะ ",-1)])])):p("",!0)])])])]),t("div",Kt,[t("button",{onClick:C,class:"px-4 py-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5"}),r[18]||(r[18]=g(" แก้ไขแบบทดสอบ ",-1))])])])):(a(),n("div",wt,[e(s).current_result&&e(s).current_result.completed_at?(a(),n("div",zt,[r[14]||(r[14]=t("h3",{class:"text-lg font-semibold mb-4 text-center"},"ผลการทดสอบของคุณ",-1)),t("div",Ct,[t("div",qt,[i($,{percentage:e(s).current_result.score/e(s).total_score*100,color:e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-500":"text-green-600":"text-red-500",trackColor:"text-gray-100 dark:text-gray-700",size:100,strokeWidth:8},{default:q(()=>[t("div",$t,[t("span",{class:m(["text-2xl font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-600":"text-green-600":"text-red-600"])},o(e(s).current_result.score),3),t("span",Ft,"/ "+o(e(s).total_score),1)])]),_:1},8,["percentage","color"]),r[12]||(r[12]=t("div",{class:"text-sm font-bold mt-3 text-gray-500"},"คะแนน",-1))]),t("div",Bt,[i($,{percentage:parseFloat(e(s).current_result.percentage),color:e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-500":"text-green-600":"text-red-500",trackColor:"text-gray-100 dark:text-gray-700",size:100,strokeWidth:8},{default:q(()=>[t("span",{class:m(["text-xl font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-600":"text-green-600":"text-red-600"])},o(parseFloat(e(s).current_result.percentage).toFixed(0))+"% ",3)]),_:1},8,["percentage","color"]),r[13]||(r[13]=t("div",{class:"text-sm font-bold mt-3 text-gray-500"},"เปอร์เซ็นต์",-1))])]),t("div",Tt,[t("span",{class:m(["px-3 py-1 rounded-full text-sm font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},o(e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"ผ่านเฉียดฉิว":"ผ่านฉลุย":"ไม่ผ่าน"),3)])])):p("",!0),t("button",{onClick:D,class:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:scale-105 transition-all duration-300 shadow-purple-200 dark:shadow-none"},[i(e(d),{icon:"fluent:play-circle-24-filled",class:"w-8 h-8"}),g(" "+o(e(s).current_result&&e(s).current_result.completed_at?"ทำแบบทดสอบอีกครั้ง":"เริ่มทำแบบทดสอบ"),1)]),!e(s).current_result||!e(s).current_result.completed_at?(a(),n("p",jt," เมื่อกดปุ่มเริ่มทำ เวลาจะนับถอยหลังทันที ")):p("",!0)]))])])])):(a(),n("div",Rt,[i(e(d),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r[19]||(r[19]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"ไม่พบข้อมูลแบบทดสอบ",-1)),t("button",{onClick:r[1]||(r[1]=l=>("navigateTo"in c?c.navigateTo:e(_))(`/courses/${e(u)}/quizzes`)),class:"mt-4 text-purple-600 hover:underline"}," กลับไปหน้ารวม ")])),i(K,{show:e(f),quiz:e(s),"current-course-id":e(u),onClose:r[2]||(r[2]=l=>f.value=!1),onDuplicated:B},null,8,["show","quiz","current-course-id"])]))}});export{Zt as default};
