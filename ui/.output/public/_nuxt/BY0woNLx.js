import{_ as le}from"./D5md19eB.js";import{q,r as b,n as T,c as o,a as e,d as h,T as L,F as U,k as W,u as t,t as c,o as a,b as l,I as n,a9 as Z,e as M,$ as se,aa as re,aF as X,g as A,j as de,a4 as ce,p as Y,z as ue,a3 as N,a7 as ge,aE as ve,w as ye,U as O}from"./DvtEeXFW.js";import{_ as be}from"./0NabHjdI.js";import{S as ae}from"./BQxta0Da.js";import"./Cpj98o6Y.js";const me={class:"flex items-center gap-1"},xe=["disabled","onClick","onMouseenter"],P=q({__name:"CourseRatingStars",props:{rating:{},size:{default:"md"},interactive:{type:Boolean,default:!1},showValue:{type:Boolean,default:!1},reviewsCount:{default:0}},emits:["rate"],setup(d,{emit:C}){const m=d,R=C,v=b(0),y=T(()=>{switch(m.size){case"sm":return"w-4 h-4";case"lg":return"w-7 h-7";default:return"w-5 h-5"}}),u=T(()=>{switch(m.size){case"sm":return"text-xs";case"lg":return"text-lg";default:return"text-sm"}}),r=T(()=>m.interactive&&v.value>0?v.value:m.rating),S=w=>{const D=r.value;return w<=Math.floor(D)?"full":w===Math.ceil(D)&&D%1>=.5?"half":"empty"},_=w=>{switch(w){case"full":return"fluent:star-24-filled";case"half":return"fluent:star-half-24-regular";default:return"fluent:star-24-regular"}},j=w=>{m.interactive&&R("rate",w)},f=w=>{m.interactive&&(v.value=w)},p=()=>{m.interactive&&(v.value=0)};return(w,D)=>(a(),o("div",me,[e("div",{class:L(["flex items-center",{"cursor-pointer":d.interactive}]),onMouseleave:p},[(a(),o(U,null,W(5,g=>e("button",{key:g,type:"button",disabled:!d.interactive,class:L(["p-0.5 transition-transform",{"hover:scale-110":d.interactive,"cursor-default":!d.interactive}]),onClick:k=>j(g),onMouseenter:k=>f(g)},[l(t(n),{icon:_(S(g)),class:L([t(y),S(g)==="empty"?"text-gray-300 dark:text-gray-600":"text-yellow-400"])},null,8,["icon","class"])],42,xe)),64))],34),d.showValue?(a(),o("span",{key:0,class:L([t(u),"font-semibold text-gray-700 dark:text-gray-300 ml-1"])},c(d.rating>0?d.rating.toFixed(1):"-"),3)):h("",!0),d.reviewsCount>0?(a(),o("span",{key:1,class:L([t(u),"text-gray-500 dark:text-gray-400"])}," ("+c(d.reviewsCount)+") ",3)):h("",!0)]))}}),fe={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6"},pe={class:"text-lg font-semibold text-gray-900 dark:text-white mb-4"},he={class:"mb-4"},_e={class:"flex items-center gap-2"},we={key:0,class:"text-lg font-semibold text-gray-700 dark:text-gray-300 ml-2"},ke={class:"mb-4"},$e={class:"mb-4"},Ce={class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Re={key:0,class:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg"},je={class:"text-sm text-red-600 dark:text-red-400"},Me={class:"flex items-center justify-end gap-3"},Se=["disabled"],De=["disabled"],ze=q({__name:"CourseReviewForm",props:{courseId:{},existingReview:{default:null}},emits:["submitted","cancel"],setup(d,{emit:C}){const m=d,R=C,v=Z(),y=b(m.existingReview?.rating||0),u=b(m.existingReview?.title||""),r=b(m.existingReview?.content||""),S=b(!1),_=b(""),j=T(()=>!!m.existingReview),f=T(()=>y.value>=1&&y.value<=5),p=g=>{y.value=g},w=async()=>{if(f.value){S.value=!0,_.value="";try{const g=await v.post(`/api/courses/${m.courseId}/reviews`,{rating:y.value,title:u.value||null,content:r.value||null});g.success?R("submitted",g.review):_.value=g.message||"ไม่สามารถบันทึกรีวิวได้"}catch(g){_.value=g.data?.message||"เกิดข้อผิดพลาด กรุณาลองใหม่"}finally{S.value=!1}}},D=()=>{R("cancel")};return(g,k)=>(a(),o("div",fe,[e("h4",pe,c(t(j)?"แก้ไขรีวิว":"เขียนรีวิว"),1),e("div",he,[k[2]||(k[2]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[M(" ให้คะแนน "),e("span",{class:"text-red-500"},"*")],-1)),e("div",_e,[l(P,{rating:t(y),size:"lg",interactive:!0,onRate:p},null,8,["rating"]),t(y)>0?(a(),o("span",we,c(t(y))+"/5 ",1)):h("",!0)])]),e("div",ke,[k[3]||(k[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," หัวข้อรีวิว (ไม่บังคับ) ",-1)),se(e("input",{"onUpdate:modelValue":k[0]||(k[0]=B=>X(u)?u.value=B:null),type:"text",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"สรุปความคิดเห็นของคุณ...",maxlength:"255"},null,512),[[re,t(u)]])]),e("div",$e,[k[4]||(k[4]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," รายละเอียด (ไม่บังคับ) ",-1)),se(e("textarea",{"onUpdate:modelValue":k[1]||(k[1]=B=>X(r)?r.value=B:null),rows:"4",class:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",placeholder:"แชร์ประสบการณ์การเรียนของคุณ...",maxlength:"2000"},null,512),[[re,t(r)]]),e("p",Ce,c(t(r).length)+"/2000 ",1)]),t(_)?(a(),o("div",Re,[e("p",je,c(t(_)),1)])):h("",!0),e("div",Me,[e("button",{type:"button",onClick:D,disabled:t(S),class:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50"}," ยกเลิก ",8,Se),e("button",{type:"button",onClick:w,disabled:!t(f)||t(S),class:"px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[t(S)?(a(),A(t(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-4 h-4"})):(a(),A(t(n),{key:1,icon:"fluent:send-24-regular",class:"w-4 h-4"})),M(" "+c(t(j)?"อัปเดตรีวิว":"ส่งรีวิว"),1)],8,De)])]))}}),Fe={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5"},Ae={class:"flex items-start justify-between mb-3"},Ie={class:"flex items-center gap-3"},Te=["src","alt"],Ee={class:"font-medium text-gray-900 dark:text-white"},Be={class:"text-xs text-gray-500 dark:text-gray-400"},Le={key:0,class:"flex items-center gap-1"},Ve={class:"mb-3"},Ne={key:0,class:"font-semibold text-gray-900 dark:text-white mb-2"},Ue={key:1,class:"text-gray-600 dark:text-gray-400 text-sm leading-relaxed"},He={class:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-sm w-full shadow-xl"},We={class:"text-center mb-4"},qe={class:"flex gap-3"},Oe=["disabled"],Ge=["disabled"],Je=q({__name:"CourseReviewCard",props:{review:{}},emits:["edit","delete"],setup(d,{emit:C}){const m=d,R=C,v=b(!1),y=b(!1),u=f=>f?f.startsWith("http")?f:`${Y().public.apiBase}/storage/${f}`:"/images/default-avatar.png",r=()=>{R("edit",m.review)},S=()=>{y.value=!0},_=()=>{y.value=!1},j=async()=>{v.value=!0,R("delete",m.review.id)};return(f,p)=>(a(),o("div",Fe,[e("div",Ae,[e("div",Ie,[e("img",{src:u(d.review.user?.avatar),alt:d.review.user?.name,class:"w-10 h-10 rounded-full object-cover border-2 border-gray-200 dark:border-gray-600"},null,8,Te),e("div",null,[e("p",Ee,c(d.review.user?.name||"ผู้ใช้งาน"),1),e("p",Be,c(d.review.created_at_formatted),1)])]),d.review.is_own?(a(),o("div",Le,[e("button",{onClick:r,class:"p-2 text-gray-500 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"แก้ไข"},[l(t(n),{icon:"fluent:edit-24-regular",class:"w-4 h-4"})]),e("button",{onClick:S,class:"p-2 text-gray-500 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"ลบ"},[l(t(n),{icon:"fluent:delete-24-regular",class:"w-4 h-4"})])])):h("",!0)]),e("div",Ve,[l(P,{rating:d.review.rating,size:"sm"},null,8,["rating"])]),d.review.title?(a(),o("h4",Ne,c(d.review.title),1)):h("",!0),d.review.content?(a(),o("p",Ue,c(d.review.content),1)):h("",!0),(a(),A(ce,{to:"body"},[t(y)?(a(),o("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:de(_,["self"])},[e("div",He,[e("div",We,[l(t(n),{icon:"fluent:warning-24-regular",class:"w-12 h-12 text-yellow-500 mx-auto mb-3"}),p[0]||(p[0]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," ยืนยันการลบรีวิว? ",-1)),p[1]||(p[1]=e("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-2"}," การดำเนินการนี้ไม่สามารถยกเลิกได้ ",-1))]),e("div",qe,[e("button",{onClick:_,disabled:t(v),class:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50"}," ยกเลิก ",8,Oe),e("button",{onClick:j,disabled:t(v),class:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50 flex items-center justify-center gap-2"},[t(v)?(a(),A(t(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-4 h-4"})):h("",!0),p[2]||(p[2]=M(" ลบรีวิว ",-1))],8,Ge)])])])):h("",!0)]))]))}}),Ke={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6"},Qe={class:"text-lg font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2"},Xe={key:0,class:"flex items-center justify-center py-12"},Ye={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"},Ze={class:"text-center md:text-left"},Pe={class:"flex items-center justify-center md:justify-start gap-3 mb-2"},et={class:"text-5xl font-bold text-gray-900 dark:text-white"},tt={class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},st={class:"space-y-2"},rt={class:"text-sm text-gray-600 dark:text-gray-400 w-3"},at={class:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},it={class:"text-xs text-gray-500 dark:text-gray-400 w-8 text-right"},ot={key:0,class:"mb-6"},nt={key:1,class:"mb-6"},lt={key:2,class:"mb-6 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl text-center"},dt={class:"text-sm text-gray-600 dark:text-gray-400"},ct={key:3,class:"space-y-4"},ut={key:0,class:"text-center pt-4"},gt=["disabled"],vt={key:4,class:"text-center py-8"},yt={key:0,class:"text-sm text-gray-400 dark:text-gray-500 mt-1"},bt=q({__name:"CourseReviewsSection",props:{courseId:{},isMember:{type:Boolean}},setup(d){const C=d,m=Z(),R=b([]),v=b({average_rating:0,total_reviews:0,distribution:{1:0,2:0,3:0,4:0,5:0}}),y=b({current_page:1,last_page:1,per_page:10,total:0}),u=b(null),r=b(!1),S=b(!0),_=b(!1),j=b(!1),f=b(null),p=async(x=1,$=!1)=>{x===1?S.value=!0:_.value=!0;try{const F=await m.get(`/api/courses/${C.courseId}/reviews`,{params:{page:x,per_page:10}});F.success&&($?R.value=[...R.value,...F.reviews||[]]:R.value=F.reviews||[],v.value=F.summary||v.value,y.value=F.pagination||y.value)}catch(F){console.error("Failed to fetch reviews:",F)}finally{S.value=!1,_.value=!1}},w=async()=>{if(C.isMember)try{const x=await m.get(`/api/courses/${C.courseId}/reviews/my-review`);x.success&&(u.value=x.review||null,r.value=x.can_review||!1)}catch(x){console.error("Failed to fetch my review:",x)}},D=async x=>{try{(await m.delete(`/api/courses/${C.courseId}/reviews/${x}`)).success&&(R.value=R.value.filter(F=>F.id!==x),u.value?.id===x&&(u.value=null),p(1))}catch($){console.error("Failed to delete review:",$)}},g=x=>{u.value=x,j.value=!1,f.value=null,p(1)},k=x=>{f.value=x,j.value=!0},B=()=>{j.value=!1,f.value=null},G=()=>{y.value.current_page<y.value.last_page&&p(y.value.current_page+1,!0)},J=x=>v.value.total_reviews===0?0:(v.value.distribution[x]||0)/v.value.total_reviews*100;return ue(()=>{p(),w()}),N(()=>C.courseId,()=>{p(),w()}),(x,$)=>{const F=ze,K=Je;return a(),o("div",Ke,[e("h3",Qe,[l(t(n),{icon:"fluent:star-24-regular",class:"w-5 h-5 text-yellow-500"}),$[1]||($[1]=M(" รีวิวและคะแนน ",-1))]),t(S)?(a(),o("div",Xe,[l(t(n),{icon:"svg-spinners:ring-resize",class:"w-8 h-8 text-blue-500"})])):(a(),o(U,{key:1},[e("div",Ye,[e("div",Ze,[e("div",Pe,[e("span",et,c(t(v).average_rating>0?t(v).average_rating.toFixed(1):"-"),1),e("div",null,[l(P,{rating:t(v).average_rating,size:"md"},null,8,["rating"]),e("p",tt,c(t(v).total_reviews)+" รีวิว ",1)])])]),e("div",st,[(a(),o(U,null,W([5,4,3,2,1],I=>e("div",{key:I,class:"flex items-center gap-2"},[e("span",rt,c(I),1),l(t(n),{icon:"fluent:star-24-filled",class:"w-4 h-4 text-yellow-400"}),e("div",at,[e("div",{class:"h-full bg-yellow-400 rounded-full transition-all duration-300",style:ge({width:`${J(I)}%`})},null,4)]),e("span",it,c(t(v).distribution[I]||0),1)])),64))])]),d.isMember&&t(r)&&!t(u)?(a(),o("div",ot,[t(j)?(a(),A(F,{key:1,"course-id":d.courseId,"existing-review":t(f),onSubmitted:g,onCancel:B},null,8,["course-id","existing-review"])):(a(),o("button",{key:0,onClick:$[0]||($[0]=I=>j.value=!0),class:"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-600 dark:text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-colors flex items-center justify-center gap-2"},[l(t(n),{icon:"fluent:edit-24-regular",class:"w-5 h-5"}),$[2]||($[2]=M(" เขียนรีวิว ",-1))]))])):d.isMember&&t(u)&&t(j)?(a(),o("div",nt,[l(F,{"course-id":d.courseId,"existing-review":{id:t(u).id,rating:t(u).rating,title:t(u).title,content:t(u).content},onSubmitted:g,onCancel:B},null,8,["course-id","existing-review"])])):d.isMember?h("",!0):(a(),o("div",lt,[e("p",dt,[l(t(n),{icon:"fluent:info-24-regular",class:"w-4 h-4 inline mr-1"}),$[3]||($[3]=M(" สมัครเรียนเพื่อเขียนรีวิว ",-1))])])),t(R).length>0?(a(),o("div",ct,[(a(!0),o(U,null,W(t(R),I=>(a(),A(K,{key:I.id,review:I,onEdit:k,onDelete:D},null,8,["review"]))),128)),t(y).current_page<t(y).last_page?(a(),o("div",ut,[e("button",{onClick:G,disabled:t(_),class:"px-6 py-2 text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors flex items-center gap-2 mx-auto"},[t(_)?(a(),A(t(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-4 h-4"})):h("",!0),$[4]||($[4]=e("span",null,"โหลดเพิ่มเติม",-1))],8,gt)])):h("",!0)])):(a(),o("div",vt,[l(t(n),{icon:"fluent:chat-empty-24-regular",class:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-3"}),$[5]||($[5]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ยังไม่มีรีวิว",-1)),d.isMember&&t(r)?(a(),o("p",yt," เป็นคนแรกที่รีวิวรายวิชานี้! ")):h("",!0)]))],64))])}}}),mt={key:0,class:"space-y-6"},xt={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ft={class:"lg:col-span-2 space-y-6"},pt={key:0,class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-xl p-6 relative overflow-hidden"},ht={class:"absolute top-0 right-0 p-4 opacity-10"},_t={class:"relative z-10"},wt={class:"flex items-center gap-3 mb-2"},kt={class:"p-2 bg-blue-100 dark:bg-blue-800 rounded-full"},$t={class:"text-blue-700 dark:text-blue-300"},Ct={class:"font-semibold underline"},Rt={class:"text-gray-600 dark:text-gray-400 mt-2 mb-4 max-w-xl"},jt={class:"flex gap-3"},Mt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6"},St={class:"flex items-center justify-between mb-4"},Dt={class:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2"},zt={key:0,class:"text-gray-600 dark:text-gray-400 leading-relaxed prose dark:prose-invert max-w-none"},Ft=["innerHTML"],At={key:1,class:"text-gray-400 italic"},It={key:1,class:"space-y-4"},Tt={class:"flex items-center justify-end gap-3"},Et=["disabled"],Bt=["disabled"],Lt={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6"},Vt={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Nt={class:"flex items-center gap-4"},Ut=["src","alt"],Ht={class:"flex-1"},Wt={class:"font-semibold text-gray-900 dark:text-white text-lg"},qt={class:"text-gray-500 dark:text-gray-400 text-sm"},Ot={class:"px-4 py-2 border border-blue-500 text-blue-500 rounded-lg font-medium hover:bg-blue-500 hover:text-white transition-colors"},Gt={key:1,class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6"},Jt={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Kt={class:"space-y-2"},Qt=["onClick"],Xt={class:"font-medium text-gray-900 dark:text-white"},Yt={class:"flex items-center gap-3 text-gray-500 text-sm"},Zt={key:0,class:"divide-y divide-gray-200 dark:divide-gray-600"},Pt={class:"flex items-center gap-3"},es={class:"text-gray-700 dark:text-gray-300 text-sm"},ts={class:"text-gray-500 text-sm"},ss={class:"space-y-6"},rs={class:"bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-6 sticky top-24"},as={class:"relative aspect-video bg-gray-200 dark:bg-gray-700 rounded-lg overflow-hidden mb-4"},is=["src","alt"],os={class:"absolute inset-0 flex items-center justify-center bg-black/30"},ns={class:"w-14 h-14 bg-blue-500 rounded-full flex items-center justify-center hover:bg-blue-600 transition-colors shadow-lg"},ls={key:0,class:"text-center mb-4"},ds={class:"text-3xl font-bold text-gray-900 dark:text-white"},cs={class:"space-y-3 mb-6"},us=["disabled"],gs=["disabled"],vs={class:"space-y-3 text-sm"},ys={class:"flex items-center justify-between text-gray-600 dark:text-gray-400"},bs={class:"flex items-center gap-2"},ms={class:"font-medium text-gray-900 dark:text-white"},xs={class:"flex items-center justify-between text-gray-600 dark:text-gray-400"},fs={class:"flex items-center gap-2"},ps={class:"font-medium text-gray-900 dark:text-white"},hs={key:0,class:"flex items-center justify-between text-gray-600 dark:text-gray-400"},_s={class:"flex items-center gap-2"},ws={class:"font-medium text-gray-900 dark:text-white"},ks={class:"flex items-center justify-between text-gray-600 dark:text-gray-400"},$s={class:"flex items-center gap-2"},Cs={class:"font-medium text-gray-900 dark:text-white"},Rs={class:"flex items-center justify-between text-gray-600 dark:text-gray-400"},js={class:"flex items-center gap-2"},Ms={class:"font-medium text-gray-900 dark:text-white"},Ss={class:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700"},Ds={class:"space-y-2 text-sm text-gray-600 dark:text-gray-400"},zs={class:"flex items-center gap-2"},Fs={class:"flex items-center gap-2"},As={class:"flex items-center gap-2"},Vs=q({__name:"index",props:{course:{},academy:{},isCourseAdmin:{type:Boolean}},setup(d){const C=d,m=O("course"),R=O("academy"),v=O("isCourseAdmin"),y=O("refreshCourse"),u=ve();N([()=>C.course,m],([i,s])=>{const z=i||s;z&&u.setCourse(z)},{immediate:!0}),N([()=>C.academy,R],([i,s])=>{const z=i||s;z&&u.setAcademy(z)},{immediate:!0}),N([()=>C.isCourseAdmin,v],([i,s])=>{const z=i||s||!1;u.setIsCourseAdmin(z)},{immediate:!0});const r=T(()=>C.course||m?.value||u.currentCourse);T(()=>C.academy||R?.value||u.academy);const S=T(()=>C.isCourseAdmin||v?.value||u.isCourseAdmin),_=Z(),j=b(!1),f=b(!1),p=b(!1),w=b([0]),D=b(!1),g=b(""),k=b(!1);N(()=>r.value?.description,i=>{i&&!D.value&&(g.value=i)},{immediate:!0});const B=()=>{g.value=r.value?.description||"",D.value=!0},G=()=>{g.value=r.value?.description||"",D.value=!1},J=async()=>{if(r.value){k.value=!0;try{(await _.put(`/api/courses/${r.value.id}`,{description:g.value})).success&&(D.value=!1,u.updateCourse({description:g.value}),y&&y())}catch(i){alert(i.data?.msg||"ไม่สามารถบันทึกได้")}finally{k.value=!1}}},x=T(()=>r.value?.lessons?.length?r.value.lessons.map((i,s)=>({id:i.id,title:`${s+1}. ${i.name}`,videos:i.topics_count||0,items:i.topics?.map(z=>({id:z.id,title:z.name,duration:z.duration||"15min",type:z.is_preview?"video":"locked"}))||[]})):[]),$=i=>{const s=w.value.indexOf(i);s>-1?w.value.splice(s,1):w.value.push(i)},F=async()=>{if(r.value){j.value=!0;try{const i=await _.post(`/api/courses/${r.value.id}/members`);i.success&&(r.value.isMember=!0,r.value.member_status=i.memberStatus,u.updateCourse({isMember:!0,member_status:i.memberStatus}))}catch(i){alert(i.data?.msg||"ไม่สามารถสมัครเรียนได้")}finally{j.value=!1}}},K=async()=>{if(!(!r.value||p.value)){p.value=!0;try{const i=await _.post(`/api/courses/${r.value.id}/favorite`);i.success&&(f.value=i.is_favorited??!f.value)}catch(i){console.error("Failed to toggle favorite:",i)}finally{p.value=!1}}};N(()=>r.value?.is_favorited,i=>{i!==void 0&&(f.value=i)},{immediate:!0});const I=i=>i?i.startsWith("http")?i:`${Y().public.apiBase}/storage/images/courses/covers/${i}`:`${Y().public.apiBase}/storage/images/courses/covers/default_cover.jpg`,ee=i=>i?new Date(i).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric"}):"-",ie=i=>new Intl.NumberFormat("th-TH",{minimumFractionDigits:0,maximumFractionDigits:0}).format(i||0),H=T(()=>r.value?.pending_invitation),te=async i=>{if(H.value)try{const s=i?"accept":"decline";(await _.post(`/api/courses/${r.value.id}/admins/invitations/${H.value.id}/${s}`)).success&&(i?window.location.reload():(r.value&&(r.value.pending_invitation=null),u.updateCourse({pending_invitation:null}),ae.fire("ปฏิเสธคำเชิญแล้ว","","success")))}catch(s){ae.fire("ข้อผิดพลาด",s.response?.data?.message||"ทำรายการไม่สำเร็จ","error")}};return(i,s)=>{const z=le,oe=bt,ne=be;return t(r)?(a(),o("div",mt,[e("div",xt,[e("div",ft,[t(H)?(a(),o("div",pt,[e("div",ht,[l(t(n),{icon:"fluent:mail-read-24-filled",class:"w-24 h-24 text-blue-600"})]),e("div",_t,[e("div",wt,[e("div",kt,[l(t(n),{icon:"fluent:person-key-20-filled",class:"w-6 h-6 text-blue-600 dark:text-blue-300"})]),e("div",null,[s[4]||(s[4]=e("h3",{class:"font-bold text-lg text-gray-900 dark:text-white"},"คำเชิญเป็นผู้ดูแลรายวิชา",-1)),e("p",$t,[s[3]||(s[3]=M(" คุณได้รับคำเชิญให้เข้าร่วมเป็น ",-1)),e("span",Ct,c(t(H).role===4?"ผู้ดูแลระบบ (Admin)":"ผู้ช่วยสอน (TA)"),1)])])]),e("p",Rt,[M(" ผู้เชิญ: "+c(t(H).inviter_id)+" (ตรวจสอบโดยระบบ) ",1),s[5]||(s[5]=e("br",null,null,-1)),s[6]||(s[6]=M(" เมื่อคุณตอบรับ คุณจะได้รับสิทธิ์ในการจัดการรายวิชานี้ตามบทบาทที่ได้รับมอบหมายทันที ",-1))]),e("div",jt,[e("button",{onClick:s[0]||(s[0]=E=>te(!0)),class:"px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all shadow-md hover:shadow-lg transform hover:-translate-y-0.5"}," ตอบรับคำเชิญ "),e("button",{onClick:s[1]||(s[1]=E=>te(!1)),class:"px-6 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 font-medium rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"}," ปฏิเสธ ")])])])):h("",!0),e("div",Mt,[e("div",St,[e("h3",Dt,[l(t(n),{icon:"fluent:text-description-24-regular",class:"w-5 h-5 text-blue-500"}),s[7]||(s[7]=M(" รายละเอียดรายวิชา ",-1))]),t(S)&&!t(D)?(a(),o("button",{key:0,onClick:B,class:"flex items-center gap-1 px-3 py-1.5 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors"},[l(t(n),{icon:"fluent:edit-24-regular",class:"w-4 h-4"}),s[8]||(s[8]=M(" แก้ไข ",-1))])):h("",!0)]),t(D)?(a(),o("div",It,[l(z,{modelValue:t(g),"onUpdate:modelValue":s[2]||(s[2]=E=>X(g)?g.value=E:null),placeholder:"เขียนรายละเอียดรายวิชาที่นี่...","min-height":"250px"},null,8,["modelValue"]),e("div",Tt,[e("button",{onClick:G,disabled:t(k),class:"px-4 py-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors disabled:opacity-50"}," ยกเลิก ",8,Et),e("button",{onClick:J,disabled:t(k),class:"flex items-center gap-2 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50"},[t(k)?(a(),A(t(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-4 h-4"})):(a(),A(t(n),{key:1,icon:"fluent:save-24-regular",class:"w-4 h-4"})),s[9]||(s[9]=M(" บันทึก ",-1))],8,Bt)])])):(a(),o("div",zt,[t(r).description?(a(),o("div",{key:0,innerHTML:t(r).description},null,8,Ft)):(a(),o("p",At,"ไม่มีรายละเอียด"))]))]),e("div",Lt,[e("h3",Vt,[l(t(n),{icon:"fluent:person-24-regular",class:"w-5 h-5 text-blue-500"}),s[10]||(s[10]=M(" ผู้สอน ",-1))]),e("div",Nt,[e("img",{src:t(r).user?.avatar||"/images/default-avatar.png",alt:t(r).user?.name,class:"w-16 h-16 rounded-full object-cover border-2 border-gray-200 dark:border-gray-700"},null,8,Ut),e("div",Ht,[e("p",Wt,c(t(r).user?.name||"ผู้สอน"),1),e("p",qt,c(t(r).user?.bio||"ไม่มีข้อมูล"),1)]),e("button",Ot,[l(t(n),{icon:"fluent:person-add-24-regular",class:"w-5 h-5"})])])]),t(x).length>0?(a(),o("div",Gt,[e("h3",Jt,[l(t(n),{icon:"fluent:book-24-regular",class:"w-5 h-5 text-blue-500"}),s[11]||(s[11]=M(" เนื้อหาบทเรียน ",-1))]),e("div",Kt,[(a(!0),o(U,null,W(t(x),(E,Q)=>(a(),o("div",{key:E.id,class:"border border-gray-200 dark:border-gray-600 rounded-lg overflow-hidden"},[e("button",{onClick:V=>$(Q),class:"w-full px-4 py-3 bg-gray-50 dark:bg-gray-700/50 flex items-center justify-between hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[e("span",Xt,c(E.title),1),e("div",Yt,[e("span",null,c(E.videos)+" หัวข้อ",1),l(t(n),{icon:t(w).includes(Q)?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-5 h-5"},null,8,["icon"])])],8,Qt),t(w).includes(Q)&&E.items.length>0?(a(),o("div",Zt,[(a(!0),o(U,null,W(E.items,V=>(a(),o("div",{key:V.id,class:"px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors"},[e("div",Pt,[l(t(n),{icon:V.type==="locked"?"fluent:lock-closed-24-regular":"fluent:play-circle-24-regular",class:L(["w-5 h-5",V.type==="locked"?"text-gray-400":"text-blue-500"])},null,8,["icon","class"]),e("span",es,c(V.title),1)]),e("span",ts,c(V.duration),1)]))),128))])):h("",!0)]))),128))])])):h("",!0),t(r)?(a(),A(oe,{key:2,"course-id":t(r).id,"is-member":t(r).isMember},null,8,["course-id","is-member"])):h("",!0)]),e("div",ss,[e("div",rs,[e("div",as,[e("img",{src:I(t(r).cover),alt:t(r).name,class:"w-full h-full object-cover"},null,8,is),e("div",os,[e("button",ns,[l(t(n),{icon:"fluent:play-24-filled",class:"w-7 h-7 text-white ml-1"})])])]),t(r).price?(a(),o("div",ls,[e("span",ds," ฿"+c(ie(t(r).price)),1)])):h("",!0),e("div",cs,[t(r).isMember?(a(),A(ne,{key:1,to:`/courses/${t(r).id}/lessons`,class:"w-full py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition-colors flex items-center justify-center gap-2"},{default:ye(()=>[l(t(n),{icon:"fluent:play-24-filled",class:"w-5 h-5"}),s[12]||(s[12]=M(" เข้าเรียน ",-1))]),_:1},8,["to"])):(a(),o("button",{key:0,onClick:F,disabled:t(j),class:"w-full py-3 bg-green-500 text-white rounded-lg font-bold hover:bg-green-600 transition-colors flex items-center justify-center gap-2 disabled:opacity-50"},[l(t(n),{icon:"fluent:add-24-regular",class:"w-5 h-5"}),M(" "+c(t(j)?"กำลังสมัคร...":"สมัครเรียน"),1)],8,us)),e("button",{onClick:K,disabled:t(p),class:L(["w-full py-3 rounded-lg font-medium flex items-center justify-center gap-2 transition-colors disabled:opacity-50",t(f)?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},[t(p)?(a(),A(t(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-5 h-5"})):(a(),A(t(n),{key:1,icon:t(f)?"fluent:heart-24-filled":"fluent:heart-24-regular",class:"w-5 h-5"},null,8,["icon"])),M(" "+c(t(f)?"เพิ่มในรายการโปรดแล้ว":"เพิ่มในรายการโปรด"),1)],10,gs)]),e("div",vs,[e("div",ys,[e("div",bs,[l(t(n),{icon:"fluent:people-24-regular",class:"w-5 h-5"}),s[13]||(s[13]=e("span",null,"ผู้เรียน",-1))]),e("span",ms,c(t(r).enrolled_students||0)+" คน",1)]),e("div",xs,[e("div",fs,[l(t(n),{icon:"fluent:book-24-regular",class:"w-5 h-5"}),s[14]||(s[14]=e("span",null,"บทเรียน",-1))]),e("span",ps,c(t(r).lessons_count||t(x).length)+" บท",1)]),t(r).duration?(a(),o("div",hs,[e("div",_s,[l(t(n),{icon:"fluent:clock-24-regular",class:"w-5 h-5"}),s[15]||(s[15]=e("span",null,"ระยะเวลา",-1))]),e("span",ws,c(t(r).duration),1)])):h("",!0),e("div",ks,[e("div",$s,[l(t(n),{icon:"fluent:calendar-24-regular",class:"w-5 h-5"}),s[16]||(s[16]=e("span",null,"เริ่มเรียน",-1))]),e("span",Cs,c(ee(t(r).start_date)),1)]),e("div",Rs,[e("div",js,[l(t(n),{icon:"fluent:calendar-checkmark-24-regular",class:"w-5 h-5"}),s[17]||(s[17]=e("span",null,"สิ้นสุด",-1))]),e("span",Ms,c(ee(t(r).end_date)),1)])]),e("div",Ss,[s[21]||(s[21]=e("h4",{class:"font-medium text-gray-900 dark:text-white mb-3"},"สิ่งที่จะได้รับ",-1)),e("ul",Ds,[e("li",zs,[l(t(n),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5 text-green-500"}),s[18]||(s[18]=e("span",null,"เข้าถึงเนื้อหาได้ตลอดชีพ",-1))]),e("li",Fs,[l(t(n),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5 text-green-500"}),s[19]||(s[19]=e("span",null,"ใบประกาศนียบัตร",-1))]),e("li",As,[l(t(n),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5 text-green-500"}),s[20]||(s[20]=e("span",null,"รองรับทุกอุปกรณ์",-1))])])])])])])])):h("",!0)}}});export{Vs as default};
