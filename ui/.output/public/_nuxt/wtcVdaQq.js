import{q,p as $,a9 as T,r as S,n as p,c as i,o as d,T as u,a as o,t as n,d as r,e as B,_ as D}from"./DvtEeXFW.js";import{u as z}from"./BvQ5DSdH.js";const E={class:"coupon-header"},A={class:"type-badge"},N={class:"icon"},V={class:"type-label"},F={class:"coupon-body"},R={class:"body-main"},H={key:0,class:"qr-section"},I=["src"],L={class:"details-col"},M={class:"amount-section"},O={class:"amount"},P={class:"unit"},Q={class:"code-section"},U={class:"code-container"},W={class:"coupon-code"},Y=["title"],j={class:"btn-text-full"},G={class:"btn-text-short"},J={class:"dates-compact"},K={key:0,class:"date-item"},X={key:1,class:"date-item no-expiry"},Z={key:0,class:"description-section"},oo={class:"description"},to={class:"coupon-footer"},eo=["disabled"],so=q({__name:"CouponCard",props:{coupon:{}},emits:["cancelled","printed"],setup(s,{emit:v}){const e=s,m=v,y=$().public.apiBase,b=T(),l=z(),a=S(!1),f=p(()=>({"status-active":e.coupon.status==="active","status-redeemed":e.coupon.status==="redeemed","status-expired":e.coupon.status==="expired","status-cancelled":e.coupon.status==="cancelled"})),x=p(()=>e.coupon.status==="active"&&!e.coupon.is_expired),_=p(()=>e.coupon.coupon_type==="wallet"?e.coupon.amount.toFixed(2):Math.floor(e.coupon.amount).toString()),h=p(()=>e.coupon.qr_code_path?`${y}/storage/${e.coupon.qr_code_path}`:"");function g(t){return new Date(t).toLocaleDateString("th-TH",{day:"2-digit",month:"short",year:"2-digit"})}async function C(){try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(e.coupon.coupon_code);else{const t=document.createElement("textarea");t.value=e.coupon.coupon_code,t.style.position="fixed",t.style.left="-9999px",t.style.top="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")}catch{throw new Error("Fallback copy failed")}document.body.removeChild(t)}a.value=!0,l.success("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß"),setTimeout(()=>{a.value=!1},2e3)}catch(t){l.error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ"),console.error("Clipboard error:",t)}}function w(){if(!e.coupon.qr_code_path)return;const t=window.open("","_blank");t&&(t.document.write(`
      <!DOCTYPE html>
      <html>
      <head>
        <title>‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á ${e.coupon.coupon_code}</title>
        <style>
          body { font-family: 'Sarabun', sans-serif; padding: 20px; text-align: center; }
          .coupon { border: 3px solid #6366f1; border-radius: 16px; padding: 30px; max-width: 400px; margin: 0 auto; }
          .qr-code { width: 200px; height: 200px; margin: 20px auto; }
          .code { font-size: 24px; font-weight: bold; letter-spacing: 2px; margin: 20px 0; }
          .amount { font-size: 36px; font-weight: bold; color: #6366f1; margin: 20px 0; }
          .type { font-size: 18px; color: #666; margin-bottom: 10px; }
        </style>
      </head>
      <body>
        <div class="coupon">
          <div class="type">${e.coupon.type_label}</div>
          <div class="amount">${_.value} ${e.coupon.coupon_type==="points"?"‡πÅ‡∏ï‡πâ‡∏°":"‡∏ö‡∏≤‡∏ó"}</div>
          <img src="${h.value}" class="qr-code" />
          <div class="code">${e.coupon.coupon_code}</div>
        </div>
      </body>
      </html>
    `),t.document.close(),t.print(),m("printed",e.coupon))}async function k(){if(confirm("‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ô‡∏µ‡πâ?"))try{const t=await b.post(`/api/coupons/${e.coupon.id}/cancel`,{});t.success?(l.success("‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"),m("cancelled",e.coupon)):l.error(t.message||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÑ‡∏î‡πâ")}catch(t){l.error(t.message||"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î")}}return(t,c)=>(d(),i("div",{class:u(["coupon-card",f.value])},[o("div",E,[o("div",A,[o("span",N,n(s.coupon.coupon_type==="points"?"üéØ":"üí∞"),1),o("span",V,n(s.coupon.type_label),1)]),o("span",{class:u(["status-badge",s.coupon.status])},n(s.coupon.status_label),3)]),o("div",F,[o("div",R,[s.coupon.qr_code_path?(d(),i("div",H,[o("img",{src:h.value,alt:"QR Code",class:"qr-image"},null,8,I)])):r("",!0),o("div",L,[o("div",M,[o("span",O,n(_.value),1),o("span",P,n(s.coupon.coupon_type==="points"?"‡πÅ‡∏ï‡πâ‡∏°":"‡∏ö‡∏≤‡∏ó"),1)]),o("div",Q,[o("div",U,[o("code",W,n(s.coupon.coupon_code),1),o("button",{onClick:C,class:u(["copy-btn",{copied:a.value}]),title:a.value?"‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß":"‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™"},[o("span",j,n(a.value?"‚úì ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à":"‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å"),1),o("span",G,n(a.value?"‚úì":"‡∏Ñ‡∏±‡∏î"),1)],10,Y)])]),o("div",J,[s.coupon.expires_at?(d(),i("span",K,[c[0]||(c[0]=o("span",{class:"date-label"},"‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏:",-1)),B(" "+n(g(s.coupon.expires_at)),1)])):(d(),i("span",X,"‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏"))])])]),s.coupon.description?(d(),i("div",Z,[o("p",oo,n(s.coupon.description),1)])):r("",!0)]),o("div",to,[o("button",{onClick:w,class:"action-btn print-btn",disabled:!s.coupon.qr_code_path},[...c[1]||(c[1]=[o("span",{class:"btn-icon"},"üñ®Ô∏è",-1),o("span",null,"‡∏û‡∏¥‡∏°‡∏û‡πå",-1)])],8,eo),x.value?(d(),i("button",{key:0,onClick:k,class:"action-btn cancel-btn"},[...c[2]||(c[2]=[o("span",{class:"btn-icon"},"‚ùå",-1),o("span",null,"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",-1)])])):r("",!0)])],2))}}),io=D(so,[["__scopeId","data-v-4de5cec3"]]);export{io as C};
