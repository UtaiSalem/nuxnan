import{l as w,p as b,r as h,n as $}from"./CHs-R6Sv.js";const A=()=>{const n=w(),s=b().public.apiBase,r=h(!1),a=h(null),g=$(()=>n.user),m=async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/login`,{method:"POST",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data;throw new Error(e.message||"Failed to record login")}catch(e){throw a.value=e.message||"Failed to record login",console.error("Record login error:",e),e}finally{r.value=!1}},f=async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/streak`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data;throw new Error(e.message||"Failed to get streak info")}catch(e){throw a.value=e.message||"Failed to get streak info",console.error("Get streak info error:",e),e}finally{r.value=!1}},v=async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/achievements`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data.achievements;throw new Error(e.message||"Failed to get achievements")}catch(e){throw a.value=e.message||"Failed to get achievements",console.error("Get achievements error:",e),e}finally{r.value=!1}},p=async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/achievements/available`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data.achievements;throw new Error(e.message||"Failed to get available achievements")}catch(e){throw a.value=e.message||"Failed to get available achievements",console.error("Get available achievements error:",e),e}finally{r.value=!1}},y=async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/achievements/stats`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data;throw new Error(e.message||"Failed to get achievement stats")}catch(e){throw a.value=e.message||"Failed to get achievement stats",console.error("Get achievement stats error:",e),e}finally{r.value=!1}},l=async(e={})=>{try{r.value=!0,a.value=null;const t=new URLSearchParams;e.limit&&t.append("limit",e.limit.toString()),e.page&&t.append("page",e.page.toString());const o=await $fetch(`${s}/api/gamification/leaderboard/points?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(o.success)return o.data;throw new Error(o.message||"Failed to get points leaderboard")}catch(t){throw a.value=t.message||"Failed to get points leaderboard",console.error("Get points leaderboard error:",t),t}finally{r.value=!1}},c=async(e={})=>{try{r.value=!0,a.value=null;const t=new URLSearchParams;e.limit&&t.append("limit",e.limit.toString()),e.page&&t.append("page",e.page.toString());const o=await $fetch(`${s}/api/gamification/leaderboard/streak?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(o.success)return o.data;throw new Error(o.message||"Failed to get streak leaderboard")}catch(t){throw a.value=t.message||"Failed to get streak leaderboard",console.error("Get streak leaderboard error:",t),t}finally{r.value=!1}},u=async(e={})=>{try{r.value=!0,a.value=null;const t=new URLSearchParams;e.limit&&t.append("limit",e.limit.toString()),e.page&&t.append("page",e.page.toString());const o=await $fetch(`${s}/api/gamification/leaderboard/achievements?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(o.success)return o.data;throw new Error(o.message||"Failed to get achievement leaderboard")}catch(t){throw a.value=t.message||"Failed to get achievement leaderboard",console.error("Get achievement leaderboard error:",t),t}finally{r.value=!1}},d=async(e={})=>{try{r.value=!0,a.value=null;const t=new URLSearchParams;e.limit&&t.append("limit",e.limit.toString()),e.page&&t.append("page",e.page.toString());const o=await $fetch(`${s}/api/gamification/leaderboard/level?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(o.success)return o.data;throw new Error(o.message||"Failed to get level leaderboard")}catch(t){throw a.value=t.message||"Failed to get level leaderboard",console.error("Get level leaderboard error:",t),t}finally{r.value=!1}};return{user:g,isLoading:r,error:a,recordLogin:m,getStreakInfo:f,getAchievements:v,getAvailableAchievements:p,getAchievementStats:y,getPointsLeaderboard:l,getStreakLeaderboard:c,getAchievementLeaderboard:u,getLevelLeaderboard:d,getLeaderboard:async(e={})=>{const t=e.type||"points",{limit:o,page:i}=e;switch(t){case"streak":return c({limit:o,page:i});case"achievements":return u({limit:o,page:i});case"level":return d({limit:o,page:i});default:return l({limit:o,page:i})}},getUserLevel:async()=>{try{r.value=!0,a.value=null;const e=n.user;return e?{level:e.level||1,current_xp:e.current_xp||0,xp_for_next_level:e.xp_for_next_level||100,progress_percentage:e.level_progress||0}:null}catch(e){throw a.value=e.message||"Failed to get user level",console.error("Get user level error:",e),e}finally{r.value=!1}},getLeaderboardSummary:async()=>{try{r.value=!0,a.value=null;const e=await $fetch(`${s}/api/gamification/leaderboard/summary`,{method:"GET",headers:{Authorization:`Bearer ${n.token}`}});if(e.success)return e.data;throw new Error(e.message||"Failed to get leaderboard summary")}catch(e){throw a.value=e.message||"Failed to get leaderboard summary",console.error("Get leaderboard summary error:",e),e}finally{r.value=!1}},showStreakNotification:e=>{typeof Swal<"u"&&Swal.fire({icon:e.bonus_milestone_reached?"success":"info",title:e.bonus_milestone_reached?"üî• Streak Bonus!":"üî• Streak Updated",html:`
          <div style="text-align: center;">
            <p style="font-size: 48px; margin: 0;">${e.streak_icon}</p>
            <h3 style="margin: 10px 0;">Streak: ${e.current_streak} ‡∏ß‡∏±‡∏ô</h3>
            <p style="margin: 0;">${e.streak_level} Level</p>
            ${e.bonus_points_earned>0?`<p style="margin: 10px 0; font-weight: bold; color: #10b981;">+${e.bonus_points_earned} ‡πÅ‡∏ï‡πâ‡∏°</p>`:""}
            ${e.next_milestone?`<p style="margin: 10px 0; color: #6b7280;">Bonus ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡∏ó‡∏µ‡πà ${e.next_milestone} ‡∏ß‡∏±‡∏ô (${e.days_until_next_bonus} ‡∏ß‡∏±‡∏ô)</p>`:""}
          </div>
        `,confirmButtonText:"‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö",confirmButtonColor:"#10b981"})},showAchievementNotification:e=>{typeof Swal<"u"&&Swal.fire({icon:"success",title:"üèÜ ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",html:`
          <div style="text-align: center;">
            <img src="${e.icon||"/icons/achievement.png"}" style="width: 64px; height: 64px; margin-bottom: 10px;">
            <h3 style="margin: 0 0 10px 0;">${e.name}</h3>
            <p style="margin: 0 0 10px 0; color: #666;">${e.description||""}</p>
            ${e.points_reward?`<p style="margin: 0; font-weight: bold; color: #10b981;">+${e.points_reward} ‡πÅ‡∏ï‡πâ‡∏°</p>`:""}
          </div>
        `,confirmButtonText:"‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö",confirmButtonColor:"#10b981"})}}};export{A as u};
