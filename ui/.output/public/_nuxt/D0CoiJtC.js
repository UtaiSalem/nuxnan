import{l as E,p as X,r as m,q as Y,i as Z,z as tt,c as i,a as t,d as f,g as V,b as c,e as H,u as y,w as _,F as I,k as M,j as q,$ as W,aa as B,T as A,a4 as O,o as n,I as b,t as d}from"./cTealXVQ.js";import{_ as $}from"./Bznm997H.js";const et=()=>{const k=E(),v=X().public.apiBase,x=m(!1),P=m(null),D=async()=>{try{x.value=!0;const s=await $fetch(`${v}/api/admin/wallet/stats`,{headers:{Authorization:`Bearer ${k.token}`}});return s.success?s.data:null}catch(s){return console.error("Failed to get stats:",s),null}finally{x.value=!1}},T=async(s={})=>{try{x.value=!0;const l=new URLSearchParams(s).toString(),r=await $fetch(`${v}/api/admin/wallet/withdrawals/pending?${l}`,{headers:{Authorization:`Bearer ${k.token}`}});return r.success?r.data:null}catch(l){return console.error("Failed to get pending withdrawals:",l),null}finally{x.value=!1}},z=async(s,l="")=>{try{x.value=!0;const r=await $fetch(`${v}/api/admin/wallet/withdrawals/${s}/approve`,{method:"POST",headers:{Authorization:`Bearer ${k.token}`},body:{admin_notes:l}});return r.success?r.data:null}catch(r){throw console.error("Failed to approve withdrawal:",r),r}finally{x.value=!1}},h=async(s,l)=>{try{x.value=!0;const r=await $fetch(`${v}/api/admin/wallet/withdrawals/${s}/reject`,{method:"POST",headers:{Authorization:`Bearer ${k.token}`},body:{reason:l}});return r.success?r.data:null}catch(r){throw console.error("Failed to reject withdrawal:",r),r}finally{x.value=!1}},g=async(s,l)=>{try{x.value=!0;const r=await $fetch(`${v}/api/admin/wallet/users/${s}/adjust`,{method:"POST",headers:{Authorization:`Bearer ${k.token}`},body:l});return r.success?r.data:null}catch(r){throw console.error("Failed to adjust wallet:",r),r}finally{x.value=!1}},j=async(s,l={})=>{try{x.value=!0;const r=new URLSearchParams(l).toString(),S=await $fetch(`${v}/api/admin/wallet/users/${s}/transactions?${r}`,{headers:{Authorization:`Bearer ${k.token}`}});return S.success?S.data:null}catch(r){return console.error("Failed to get user transactions:",r),null}finally{x.value=!1}},U=async(s={})=>{try{x.value=!0;const l=new URLSearchParams(s).toString(),r=await $fetch(`${v}/api/admin/wallet/analytics?${l}`,{headers:{Authorization:`Bearer ${k.token}`}});return r.success?r.data:null}catch(l){return console.error("Failed to get analytics:",l),null}finally{x.value=!1}},C=s=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),u=s=>`${s.toFixed(2)}%`,w=s=>s*.13;return{isLoading:x,error:P,getStats:D,getPendingWithdrawals:T,approveWithdrawal:z,rejectWithdrawal:h,adjustWallet:g,getUserTransactions:j,getAnalytics:U,formatMoney:C,formatPercentage:u,calculateFee:w,calculateNetAmount:s=>{const l=w(s);return s-l}}},at={class:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4 sm:px-6 lg:px-8"},st={class:"max-w-7xl mx-auto"},rt={class:"flex items-center justify-between mb-8"},lt={class:"flex gap-3"},ot={key:0,class:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8"},nt={class:"flex items-center gap-4"},dt={class:"w-14 h-14 bg-emerald-100 dark:bg-emerald-900/30 rounded-xl flex items-center justify-center"},it={class:"text-2xl font-bold text-gray-900 dark:text-white"},ut={class:"flex items-center gap-4"},ct={class:"w-14 h-14 bg-yellow-100 dark:bg-yellow-900/30 rounded-xl flex items-center justify-center"},xt={class:"text-2xl font-bold text-gray-900 dark:text-white"},gt={class:"flex items-center gap-4"},yt={class:"w-14 h-14 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center"},mt={class:"text-2xl font-bold text-gray-900 dark:text-white"},pt={class:"flex items-center gap-4"},bt={class:"w-14 h-14 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center"},vt={class:"text-2xl font-bold text-gray-900 dark:text-white"},ft={class:"flex gap-2 mb-6 overflow-x-auto pb-2"},kt=["onClick"],ht={key:0,class:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center"},wt={key:1,class:"py-12 text-center"},_t={key:2},$t={key:0,class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},jt={class:"p-2"},Ct={class:"space-y-4"},Ft={class:"flex items-center justify-between"},At={class:"font-bold text-green-500"},St={class:"flex items-center justify-between"},Wt={class:"font-bold text-red-500"},Bt={class:"flex items-center justify-between"},Pt={class:"font-bold text-blue-500"},Dt={class:"flex items-center justify-between"},Tt={class:"font-bold text-purple-500"},zt={class:"p-2"},Ut={class:"flex items-center justify-between mb-4"},It={key:0,class:"space-y-3"},Mt=["src"],Lt={class:"flex-grow"},Nt={class:"font-medium text-gray-900 dark:text-white"},Rt={class:"text-xs text-gray-500"},Vt={class:"font-bold text-red-500"},Ht={key:1,class:"text-center py-4 text-gray-500"},qt={key:1},Ot={class:"overflow-x-auto"},Et={class:"w-full"},Gt={class:"py-3 px-4"},Jt={class:"flex items-center gap-3"},Kt=["src"],Qt={class:"font-medium text-gray-900 dark:text-white"},Xt={class:"text-xs text-gray-500"},Yt={class:"py-3 px-4"},Zt={class:"font-bold text-red-500"},te={class:"text-xs text-gray-500"},ee={class:"py-3 px-4"},ae={class:"text-gray-900 dark:text-white"},se={class:"text-xs text-gray-500"},re={class:"py-3 px-4 text-gray-600 dark:text-gray-400 text-sm"},le={class:"py-3 px-4 text-center"},oe={class:"py-3 px-4 text-right"},ne={key:0,class:"flex gap-2 justify-end"},de=["onClick"],ie=["onClick"],ue={key:0,class:"text-center py-8 text-gray-500"},ce={key:2},xe={class:"p-4 text-center text-gray-500 dark:text-gray-400"},ge={class:"space-y-4"},ye={class:"flex gap-2"},me={class:"flex gap-3 mt-6"},pe={class:"flex gap-3 mt-6"},fe=Y({__name:"Wallet",setup(k){Z({title:"จัดการ Wallet - Admin"}),E();const{getStats:L,getPendingWithdrawals:v,approveWithdrawal:x,rejectWithdrawal:P,adjustWallet:D,getAnalytics:T,isLoading:z}=et(),h=m("overview"),g=m(null),j=m([]),U=m(null),C=m(!1),u=m({user_id:"",amount:0,type:"add",reason:""}),w=m(!1),F=m(null),s=m(""),l=async()=>{try{const[o,e,a]=await Promise.all([L(),v(),T()]);o&&(g.value=o),e&&(j.value=e.withdrawals||e),a&&(U.value=a)}catch(o){console.error("Failed to load admin wallet data:",o)}},r=async o=>{if(confirm("ต้องการอนุมัติการถอนเงินนี้หรือไม่?"))try{await x(o),await l()}catch(e){console.error("Failed to approve withdrawal:",e)}},S=o=>{F.value=o,s.value="",w.value=!0},G=async()=>{if(F.value)try{await P(F.value,s.value),w.value=!1,F.value=null,await l()}catch(o){console.error("Failed to reject withdrawal:",o)}},J=async()=>{try{await D(parseInt(u.value.user_id),{amount:u.value.amount,type:u.value.type,reason:u.value.reason}),C.value=!1,u.value={user_id:"",amount:0,type:"add",reason:""},await l()}catch(o){console.error("Failed to adjust wallet:",o)}},p=o=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(o),N=o=>new Date(o).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),K=o=>({pending:"รอดำเนินการ",approved:"อนุมัติแล้ว",rejected:"ปฏิเสธ",completed:"เสร็จสิ้น",cancelled:"ยกเลิก"})[o]||o,Q=o=>({pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",approved:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",rejected:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",completed:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",cancelled:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"})[o]||"bg-gray-100 text-gray-800";return tt(l),(o,e)=>(n(),i("div",at,[t("div",st,[t("div",rt,[e[16]||(e[16]=t("div",null,[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"จัดการ Wallet"),t("p",{class:"text-gray-600 dark:text-gray-400"},"Admin Wallet Management")],-1)),t("div",lt,[t("button",{class:"px-4 py-2 bg-primary-500 text-white rounded-xl hover:bg-primary-600 transition-colors flex items-center gap-2",onClick:e[0]||(e[0]=a=>C.value=!0)},[c(y(b),{icon:"mdi:wallet-plus",class:"w-5 h-5"}),e[15]||(e[15]=H(" ปรับยอดผู้ใช้ ",-1))])])]),g.value?(n(),i("div",ot,[c($,null,{default:_(()=>[t("div",nt,[t("div",dt,[c(y(b),{icon:"mdi:wallet",class:"w-7 h-7 text-emerald-500"})]),t("div",null,[t("p",it,d(p(g.value.total_wallet||0)),1),e[17]||(e[17]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"ยอดเงินทั้งหมด",-1))])])]),_:1}),c($,null,{default:_(()=>[t("div",ut,[t("div",ct,[c(y(b),{icon:"mdi:clock-outline",class:"w-7 h-7 text-yellow-500"})]),t("div",null,[t("p",xt,d(g.value.pending_withdrawals||0),1),e[18]||(e[18]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"รอดำเนินการ",-1))])])]),_:1}),c($,null,{default:_(()=>[t("div",gt,[t("div",yt,[c(y(b),{icon:"mdi:check-circle",class:"w-7 h-7 text-green-500"})]),t("div",null,[t("p",mt,d(p(g.value.completed_withdrawals||0)),1),e[19]||(e[19]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"ถอนสำเร็จ",-1))])])]),_:1}),c($,null,{default:_(()=>[t("div",pt,[t("div",bt,[c(y(b),{icon:"mdi:plus-circle",class:"w-7 h-7 text-blue-500"})]),t("div",null,[t("p",vt,d(p(g.value.total_deposits||0)),1),e[20]||(e[20]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"เงินฝากทั้งหมด",-1))])])]),_:1})])):f("",!0),t("div",ft,[(n(!0),i(I,null,M([{key:"overview",label:"ภาพรวม",icon:"mdi:view-dashboard"},{key:"withdrawals",label:"คำขอถอนเงิน",icon:"mdi:bank-transfer-out",badge:g.value?.pending_withdrawals},{key:"analytics",label:"วิเคราะห์",icon:"mdi:chart-bar"}],a=>(n(),i("button",{key:a.key,class:A(["px-4 py-2 rounded-xl text-sm font-medium transition-all whitespace-nowrap flex items-center gap-2 relative",h.value===a.key?"bg-primary-500 text-white shadow":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700"]),onClick:R=>h.value=a.key},[c(y(b),{icon:a.icon,class:"w-4 h-4"},null,8,["icon"]),H(" "+d(a.label)+" ",1),a.badge&&a.badge>0?(n(),i("span",ht,d(a.badge),1)):f("",!0)],10,kt))),128))]),y(z)?(n(),i("div",wt,[c(y(b),{icon:"mdi:loading",class:"w-12 h-12 text-primary-500 animate-spin mx-auto"})])):(n(),i("div",_t,[h.value==="overview"?(n(),i("div",$t,[c($,null,{default:_(()=>[t("div",jt,[e[25]||(e[25]=t("h3",{class:"text-lg font-bold text-gray-900 dark:text-white mb-4"},"สถิติธุรกรรม",-1)),t("div",Ct,[t("div",Ft,[e[21]||(e[21]=t("span",{class:"text-gray-600 dark:text-gray-400"},"เงินฝากทั้งหมด",-1)),t("span",At,d(p(g.value?.total_deposits||0)),1)]),t("div",St,[e[22]||(e[22]=t("span",{class:"text-gray-600 dark:text-gray-400"},"ถอนเงินทั้งหมด",-1)),t("span",Wt,d(p(g.value?.total_withdrawals||0)),1)]),t("div",Bt,[e[23]||(e[23]=t("span",{class:"text-gray-600 dark:text-gray-400"},"โอนเงินทั้งหมด",-1)),t("span",Pt,d(p(g.value?.total_transfers||0)),1)]),t("div",Dt,[e[24]||(e[24]=t("span",{class:"text-gray-600 dark:text-gray-400"},"แปลงจากแต้ม",-1)),t("span",Tt,d(p(g.value?.total_conversions||0)),1)])])])]),_:1}),c($,null,{default:_(()=>[t("div",zt,[t("div",Ut,[e[26]||(e[26]=t("h3",{class:"text-lg font-bold text-gray-900 dark:text-white"},"รอดำเนินการ",-1)),t("button",{class:"text-primary-500 text-sm hover:underline",onClick:e[1]||(e[1]=a=>h.value="withdrawals")}," ดูทั้งหมด ")]),j.value.length>0?(n(),i("div",It,[(n(!0),i(I,null,M(j.value.slice(0,3),a=>(n(),i("div",{key:a.id,class:"flex items-center gap-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl"},[t("img",{src:a.user?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,Mt),t("div",Lt,[t("p",Nt,d(a.user?.name),1),t("p",Rt,d(N(a.created_at)),1)]),t("p",Vt,d(p(a.amount)),1)]))),128))])):(n(),i("div",Ht,[c(y(b),{icon:"mdi:check-all",class:"w-8 h-8 mx-auto mb-2 text-green-500"}),e[27]||(e[27]=t("p",null,"ไม่มีคำขอรอดำเนินการ",-1))]))])]),_:1})])):f("",!0),h.value==="withdrawals"?(n(),i("div",qt,[c($,null,{default:_(()=>[t("div",Ot,[t("table",Et,[e[28]||(e[28]=t("thead",null,[t("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"ผู้ใช้"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"จำนวน"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"ธนาคาร"),t("th",{class:"text-left py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"วันที่"),t("th",{class:"text-center py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"สถานะ"),t("th",{class:"text-right py-3 px-4 text-sm font-medium text-gray-500 dark:text-gray-400"},"จัดการ")])],-1)),t("tbody",null,[(n(!0),i(I,null,M(j.value,a=>(n(),i("tr",{key:a.id,class:"border-b border-gray-100 dark:border-gray-700"},[t("td",Gt,[t("div",Jt,[t("img",{src:a.user?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,Kt),t("div",null,[t("p",Qt,d(a.user?.name),1),t("p",Xt,"ID: "+d(a.user_id),1)])])]),t("td",Yt,[t("p",Zt,d(p(a.amount)),1),t("p",te,"ค่าธรรมเนียม: "+d(p(a.fee||0)),1)]),t("td",ee,[t("p",ae,d(a.bank_account?.bank_name),1),t("p",se,d(a.bank_account?.account_number),1)]),t("td",re,d(N(a.created_at)),1),t("td",le,[t("span",{class:A(["px-2 py-1 rounded-full text-xs font-medium",Q(a.status)])},d(K(a.status)),3)]),t("td",oe,[a.status==="pending"?(n(),i("div",ne,[t("button",{class:"px-3 py-1 bg-green-500 text-white rounded-lg text-sm hover:bg-green-600",onClick:R=>r(a.id)}," อนุมัติ ",8,de),t("button",{class:"px-3 py-1 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600",onClick:R=>S(a.id)}," ปฏิเสธ ",8,ie)])):f("",!0)])]))),128))])]),j.value.length===0?(n(),i("div",ue,[c(y(b),{icon:"mdi:inbox-outline",class:"w-12 h-12 mx-auto mb-3"}),e[29]||(e[29]=t("p",null,"ไม่มีคำขอถอนเงิน",-1))])):f("",!0)])]),_:1})])):f("",!0),h.value==="analytics"?(n(),i("div",ce,[c($,null,{default:_(()=>[t("div",xe,[c(y(b),{icon:"mdi:chart-bar",class:"w-16 h-16 mx-auto mb-4"}),e[30]||(e[30]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-2"},"กราฟวิเคราะห์",-1)),e[31]||(e[31]=t("p",null,"กำลังพัฒนา - จะแสดงกราฟแนวโน้มธุรกรรมและการวิเคราะห์ข้อมูล Wallet",-1))])]),_:1})])):f("",!0)])),(n(),V(O,{to:"body"},[C.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[10]||(e[10]=a=>C.value=!1)},[t("div",{class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-md w-full p-6",onClick:e[9]||(e[9]=q(()=>{},["stop"]))},[e[36]||(e[36]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white mb-6"},"ปรับยอดเงินผู้ใช้",-1)),t("div",ge,[t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"User ID",-1)),W(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>u.value.user_id=a),type:"text",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"ระบุ User ID"},null,512),[[B,u.value.user_id]])]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"ประเภท",-1)),t("div",ye,[t("button",{class:A(["flex-1 py-2 rounded-xl font-medium transition-colors",u.value.type==="add"?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"]),onClick:e[3]||(e[3]=a=>u.value.type="add")}," เพิ่ม ",2),t("button",{class:A(["flex-1 py-2 rounded-xl font-medium transition-colors",u.value.type==="deduct"?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"]),onClick:e[4]||(e[4]=a=>u.value.type="deduct")}," หัก ",2),t("button",{class:A(["flex-1 py-2 rounded-xl font-medium transition-colors",u.value.type==="set"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"]),onClick:e[5]||(e[5]=a=>u.value.type="set")}," ตั้งค่า ",2)])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"จำนวน (บาท)",-1)),W(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.amount=a),type:"number",min:"0",step:"0.01",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl"},null,512),[[B,u.value.amount,void 0,{number:!0}]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"เหตุผล",-1)),W(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.reason=a),type:"text",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"ระบุเหตุผล"},null,512),[[B,u.value.reason]])])]),t("div",me,[t("button",{class:"flex-1 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl",onClick:e[8]||(e[8]=a=>C.value=!1)}," ยกเลิก "),t("button",{class:"flex-1 py-2 bg-primary-500 text-white rounded-xl",onClick:J}," บันทึก ")])])])):f("",!0)])),(n(),V(O,{to:"body"},[w.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:e[14]||(e[14]=a=>w.value=!1)},[t("div",{class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-md w-full p-6",onClick:e[13]||(e[13]=q(()=>{},["stop"]))},[e[38]||(e[38]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white mb-6"},"ปฏิเสธคำขอถอนเงิน",-1)),t("div",null,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"เหตุผลในการปฏิเสธ",-1)),W(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=a=>s.value=a),rows:"3",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"ระบุเหตุผล"},null,512),[[B,s.value]])]),t("div",pe,[t("button",{class:"flex-1 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl",onClick:e[12]||(e[12]=a=>w.value=!1)}," ยกเลิก "),t("button",{class:"flex-1 py-2 bg-red-500 text-white rounded-xl",onClick:G}," ปฏิเสธ ")])])])):f("",!0)]))])]))}});export{fe as default};
