import{_ as kt}from"./DROJGjoa.js";import{q as se,r as w,n as q,z as oe,W as ke,g as z,a4 as wt,a as e,T as V,c as i,d as C,b as u,u as r,t as p,F as Y,e as H,o as l,I as d,_ as we,$ as Z,k as K,a0 as pe,a9 as _e,a3 as de,w as J,a1 as et,aa as W,f as _t,E as tt,ap as xe,U as Ie,X as Te,ai as $t,l as Ct,aj as Ge,j as Ke,ae as Xe,a7 as At}from"./CHs-R6Sv.js";import{_ as st}from"./oluhtfaa.js";import{_ as St,Q as Lt}from"./Bit1x6KH.js";import{u as $e}from"./CaSR6SuD.js";import{u as lt}from"./B34yIM1Q.js";import{o as nt,s as Ft,S as ie,i as jt,t as Tt,u as De,a as ne,c as Dt,A as ot,l as Et,T as Bt,N as It,b as We,G as qt,V as Ut,Y as Vt}from"./xF3ZEHm6.js";const Mt={key:0,class:"text-white text-lg font-semibold mb-4 truncate pr-12 md:pr-0"},zt={class:"relative rounded-2xl overflow-hidden shadow-2xl ring-1 ring-white/20 bg-black aspect-video"},Ot={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-900"},Rt={class:"text-center"},Pt={class:"w-20 h-20 mx-auto mb-4 bg-gray-800 rounded-full flex items-center justify-center animate-pulse"},Nt=["src"],Ht={key:1,class:"w-full h-full flex items-center justify-center bg-gray-900"},Zt={class:"text-center"},Yt=se({__name:"VideoModal",props:{youtubeUrl:{},vimeoUrl:{},videoSrc:{},title:{}},emits:["close"],setup(t,{emit:$}){const s=t,L=$,F=w(!1),b=w(!0),c=w(!1),a=D=>{if(!D)return null;if(/^[a-zA-Z0-9_-]{11}$/.test(D))return D;const B=[/(?:youtube\.com\/watch\?v=|youtube\.com\/watch\?.+&v=)([a-zA-Z0-9_-]{11})/,/youtu\.be\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/];for(const m of B){const g=D.match(m);if(g&&g[1])return g[1]}return null},A=q(()=>s.youtubeUrl?a(s.youtubeUrl):null),y=q(()=>{if(!A.value)return null;const D=new URLSearchParams({autoplay:"1",rel:"0",modestbranding:"1",playsinline:"1"});return`https://www.youtube-nocookie.com/embed/${A.value}?${D.toString()}`}),T=()=>{b.value=!0,F.value=!1,setTimeout(()=>{L("close")},300)},E=D=>{D.key==="Escape"&&T()},U=D=>{D.target.classList.contains("modal-backdrop")&&T()},N=()=>{c.value=!0};return oe(()=>{document.addEventListener("keydown",E),document.body.style.overflow="hidden",requestAnimationFrame(()=>{F.value=!0,setTimeout(()=>{b.value=!1},300)})}),ke(()=>{document.removeEventListener("keydown",E),document.body.style.overflow=""}),(D,B)=>(l(),z(wt,{to:"body"},[e("div",{class:V(["modal-backdrop fixed inset-0 z-[9999] flex items-center justify-center p-4 md:p-8 transition-all duration-300",[F.value?"bg-black/80 backdrop-blur-md":"bg-black/0 backdrop-blur-0"]]),onClick:U},[e("div",{class:V(["relative w-full max-w-5xl transition-all duration-300 transform",[F.value?"opacity-100 scale-100":"opacity-0 scale-95"]])},[e("button",{onClick:T,class:"absolute -top-12 right-0 md:-right-12 md:top-0 p-3 text-white/80 hover:text-white hover:bg-white/10 rounded-full transition-all duration-200 z-10 group",title:"ปิด (Esc)"},[u(r(d),{icon:"fluent:dismiss-24-filled",class:"w-8 h-8 transform group-hover:rotate-90 transition-transform duration-200"})]),t.title?(l(),i("h3",Mt,p(t.title),1)):C("",!0),e("div",zt,[y.value?(l(),i(Y,{key:0},[c.value?C("",!0):(l(),i("div",Ot,[e("div",Rt,[e("div",Pt,[u(r(d),{icon:"fluent:play-24-filled",class:"w-10 h-10 text-gray-600"})]),B[0]||(B[0]=e("span",{class:"text-gray-500"},"กำลังโหลดวิดีโอ...",-1))])])),e("iframe",{src:y.value,class:"absolute inset-0 w-full h-full",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:"",onLoad:N},null,40,Nt)],64)):(l(),i("div",Ht,[e("div",Zt,[u(r(d),{icon:"fluent:video-off-24-filled",class:"w-16 h-16 text-gray-600 mx-auto mb-4"}),B[1]||(B[1]=e("span",{class:"text-gray-500"},"ไม่พบวิดีโอ",-1))])]))]),B[2]||(B[2]=e("p",{class:"text-white/50 text-center text-sm mt-4 hidden md:block"},[H(" กด "),e("kbd",{class:"px-2 py-1 bg-white/10 rounded text-white/70"},"Esc"),H(" หรือคลิกด้านนอกเพื่อปิด ")],-1))],2)],2)]))}}),Qt=we(Yt,[["__scopeId","data-v-b7d88a0f"]]),Gt={class:"flex items-center gap-3 flex-1"},Kt={class:"border-t border-gray-200 dark:border-gray-700"},Xt={class:"p-4 space-y-4"},Wt={key:0,class:"prose prose-sm dark:prose-invert max-w-none"},Jt={key:1,class:"grid grid-cols-2 gap-2"},es=["src","alt"],ts={key:2,class:"pt-4 border-t border-gray-200 dark:border-gray-700"},ss={class:"flex items-center gap-2 mb-3"},ls={class:"space-y-2"},ns={class:"text-sm font-medium text-gray-900 dark:text-white"},os={key:3,class:"pt-4 border-t border-gray-200 dark:border-gray-700"},rs={class:"flex items-center gap-2 mb-3"},as={class:"text-sm text-gray-600 dark:text-gray-400"},is=se({__name:"TopicAccordion",props:{topic:{},isCompleted:{type:Boolean,default:!1}},emits:["toggleComplete"],setup(t,{emit:$}){const s=t,L=$,F=w(!1),b=()=>{F.value=!F.value},c=a=>{a.stopPropagation(),L("toggleComplete",s.topic.id)};return(a,A)=>(l(),i("div",{class:V(["border rounded-xl overflow-hidden transition-all duration-300",[t.isCompleted?"border-green-300 dark:border-green-700 bg-green-50 dark:bg-green-900/10":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"]])},[e("button",{onClick:b,class:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[e("div",Gt,[e("div",{onClick:c,class:V(["flex-shrink-0 w-6 h-6 rounded-md border-2 flex items-center justify-center cursor-pointer transition-all",[t.isCompleted?"bg-green-500 border-green-500":"border-gray-300 dark:border-gray-600 hover:border-green-500"]])},[t.isCompleted?(l(),z(r(d),{key:0,icon:"fluent:checkmark-24-filled",class:"w-4 h-4 text-white"})):C("",!0)],2),u(r(d),{icon:"fluent:document-text-24-regular",class:V(["w-5 h-5 flex-shrink-0",t.isCompleted?"text-green-600 dark:text-green-400":"text-gray-600 dark:text-gray-400"])},null,8,["class"]),e("h4",{class:V(["text-left font-medium transition-colors",[t.isCompleted?"text-green-900 dark:text-green-100 line-through":"text-gray-900 dark:text-white"]])},p(t.topic.title),3)]),u(r(d),{icon:F.value?"fluent:chevron-up-24-filled":"fluent:chevron-down-24-filled",class:"w-5 h-5 text-gray-500 dark:text-gray-400 flex-shrink-0 ml-2"},null,8,["icon"])]),Z(e("div",Kt,[e("div",Xt,[t.topic.content?(l(),i("div",Wt,[u(st,{content:t.topic.content},null,8,["content"])])):C("",!0),t.topic.images&&t.topic.images.length>0?(l(),i("div",Jt,[(l(!0),i(Y,null,K(t.topic.images,y=>(l(),i("img",{key:y.id,src:y.full_url,alt:t.topic.title,class:"rounded-lg object-cover w-full h-48 border border-gray-200 dark:border-gray-700 hover:scale-105 transition-transform cursor-pointer"},null,8,es))),128))])):C("",!0),t.topic.assignments&&t.topic.assignments.length>0?(l(),i("div",ts,[e("div",ss,[u(r(d),{icon:"fluent:clipboard-task-24-filled",class:"w-5 h-5 text-green-600 dark:text-green-400"}),A[0]||(A[0]=e("h5",{class:"font-semibold text-gray-900 dark:text-white"},"แบบฝึกหัดในหัวข้อนี้",-1))]),e("div",ls,[(l(!0),i(Y,null,K(t.topic.assignments,y=>(l(),i("div",{key:y.id,class:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800"},[e("p",ns,p(y.title),1)]))),128))])])):C("",!0),t.topic.questions&&t.topic.questions.length>0?(l(),i("div",os,[e("div",rs,[u(r(d),{icon:"fluent:quiz-new-24-filled",class:"w-5 h-5 text-orange-600 dark:text-orange-400"}),A[1]||(A[1]=e("h5",{class:"font-semibold text-gray-900 dark:text-white"},"คำถามในหัวข้อนี้",-1))]),e("p",as," มี "+p(t.topic.questions.length)+" คำถาม ",1)])):C("",!0)])],512),[[pe,F.value]])],2))}}),ds={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},us={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto"},cs={class:"p-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center sticky top-0 bg-white dark:bg-gray-800 z-10"},gs={class:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},fs={class:"p-6 space-y-6"},vs={class:"grid grid-cols-2 gap-4"},ms={class:"relative"},ps={class:"relative"},hs={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4"},bs=["src"],ys=["onClick"],xs=["src"],ks=["onClick"],ws={class:"aspect-video flex flex-col items-center justify-center border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer hover:border-green-500 hover:text-green-500 transition-colors bg-gray-50 dark:bg-gray-700/50"},_s={class:"p-6 border-t border-gray-100 dark:border-gray-700 flex justify-end gap-3 bg-gray-50 dark:bg-gray-800/50 rounded-b-2xl"},$s=["disabled"],Cs={key:1},As=se({__name:"AssignmentFormModal",props:{show:{type:Boolean},lessonId:{},assignment:{}},emits:["close","submit"],setup(t,{emit:$}){const s=t,L=$,F=_e(),b=$e(),c=w({title:"",description:"",points:10,start_date:"",due_date:"",images:[],existingImages:[]}),a=w(!1),A=w([]),y=()=>{const m=new Date,g=m.getFullYear(),_=String(m.getMonth()+1).padStart(2,"0"),h=String(m.getDate()).padStart(2,"0"),v=String(m.getHours()).padStart(2,"0"),x=String(m.getMinutes()).padStart(2,"0");return`${g}-${_}-${h}T${v}:${x}`},T=()=>{const m=new Date;m.setDate(m.getDate()+1);const g=m.getFullYear(),_=String(m.getMonth()+1).padStart(2,"0"),h=String(m.getDate()).padStart(2,"0"),v=String(m.getHours()).padStart(2,"0"),x=String(m.getMinutes()).padStart(2,"0");return`${g}-${_}-${h}T${v}:${x}`},E=()=>{c.value={title:"",description:"",points:10,start_date:y(),due_date:T(),images:[],existingImages:[]},A.value=[]};de(()=>s.assignment,m=>{m?c.value={title:m.title,description:m.description||"",points:m.points||10,start_date:m.start_date?new Date(m.start_date):"",due_date:m.due_date?new Date(m.due_date):"",images:[],existingImages:m.images||[]}:E()},{immediate:!0});const U=m=>{const g=m.target;if(g.files){const _=Array.from(g.files);c.value.images=[...c.value.images,..._],_.forEach(h=>{const v=new FileReader;v.onload=x=>{x.target?.result&&A.value.push(x.target.result)},v.readAsDataURL(h)})}},N=m=>{c.value.images.splice(m,1),A.value.splice(m,1)},D=m=>{c.value.existingImages=c.value.existingImages.filter(g=>g.id!==m)},B=async()=>{if(!c.value.title){b.toast("กรุณาระบุหัวข้อแบบฝึกหัด","warning");return}a.value=!0;try{const m=new FormData;m.append("title",c.value.title),c.value.description&&m.append("description",c.value.description),m.append("points",c.value.points.toString()),c.value.start_date&&m.append("start_date",new Date(c.value.start_date).toISOString()),c.value.due_date&&m.append("due_date",new Date(c.value.due_date).toISOString()),c.value.images.forEach(_=>{m.append("images[]",_)});let g;s.assignment?(m.append("_method","PUT"),g=await F.post(`/api/lessons/${s.lessonId}/assignments/${s.assignment.id}`,m)):g=await F.post(`/api/lessons/${s.lessonId}/assignments`,m),g.assignment&&(L("submit",g.assignment),b.toast(s.assignment?"แก้ไขแบบฝึกหัดสำเร็จ":"สร้างแบบฝึกหัดสำเร็จ","success"),L("close"))}catch(m){console.error("Failed to save assignment:",m),b.error(m?.data?.message||"ไม่สามารถบันทึกข้อมูลได้")}finally{a.value=!1}};return de(()=>s.show,m=>{m&&!s.assignment&&E()}),(m,g)=>{const _=_t("VueDatePicker");return l(),z(et,{name:"fade"},{default:J(()=>[t.show?(l(),i("div",ds,[e("div",us,[e("div",cs,[e("h3",gs,[u(r(d),{icon:"fluent:clipboard-task-edit-24-filled",class:"text-green-600"}),H(" "+p(t.assignment?"แก้ไขแบบฝึกหัด":"สร้างแบบฝึกหัดใหม่"),1)]),e("button",{onClick:g[0]||(g[0]=h=>L("close")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors"},[u(r(d),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),e("div",fs,[e("div",null,[g[7]||(g[7]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[H(" หัวข้อแบบฝึกหัด "),e("span",{class:"text-red-500"},"*")],-1)),Z(e("input",{"onUpdate:modelValue":g[1]||(g[1]=h=>c.value.title=h),type:"text",class:"w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all",placeholder:"Ex. แบบฝึกหัดทบทวนบทที่ 1"},null,512),[[W,c.value.title]])]),e("div",null,[g[8]||(g[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," คำอธิบาย / โจทย์ ",-1)),Z(e("textarea",{"onUpdate:modelValue":g[2]||(g[2]=h=>c.value.description=h),rows:"4",class:"w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all resize-none",placeholder:"ระบุรายละเอียดของงาน..."},null,512),[[W,c.value.description]])]),e("div",vs,[e("div",null,[g[9]||(g[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," วันที่เริ่มต้น (Start Date) ",-1)),e("div",ms,[u(_,{modelValue:c.value.start_date,"onUpdate:modelValue":g[3]||(g[3]=h=>c.value.start_date=h),"auto-apply":"","enable-time-picker":!0,dark:!0},null,8,["modelValue"])])]),e("div",null,[g[10]||(g[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," กำหนดส่ง (Due Date) ",-1)),u(_,{modelValue:c.value.due_date,"onUpdate:modelValue":g[4]||(g[4]=h=>c.value.due_date=h),"auto-apply":"","enable-time-picker":!0,dark:!0},null,8,["modelValue"])])]),e("div",null,[g[11]||(g[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," คะแนนเต็ม ",-1)),e("div",ps,[Z(e("input",{"onUpdate:modelValue":g[5]||(g[5]=h=>c.value.points=h),type:"number",min:"0",class:"w-full px-4 py-2 pl-10 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500 focus:border-transparent outline-none transition-all"},null,512),[[W,c.value.points]]),u(r(d),{icon:"fluent:star-24-regular",class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400"})])]),e("div",null,[g[13]||(g[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," รูปภาพประกอบ ",-1)),e("div",hs,[(l(!0),i(Y,null,K(c.value.existingImages,h=>(l(),i("div",{key:h.id,class:"relative group aspect-video bg-gray-100 rounded-lg overflow-hidden"},[e("img",{src:h.full_url||h.image_url,class:"w-full h-full object-cover"},null,8,bs),e("button",{onClick:v=>D(h.id),class:"absolute top-1 right-1 p-1bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity"},[u(r(d),{icon:"fluent:delete-16-filled",class:"w-4 h-4"})],8,ys)]))),128)),(l(!0),i(Y,null,K(A.value,(h,v)=>(l(),i("div",{key:v,class:"relative group aspect-video bg-gray-100 rounded-lg overflow-hidden"},[e("img",{src:h,class:"w-full h-full object-cover"},null,8,xs),e("button",{onClick:x=>N(v),class:"absolute top-1 right-1 p-1 bg-red-500 text-white rounded-full shadow-sm hover:bg-red-600 transition-colors"},[u(r(d),{icon:"fluent:dismiss-12-regular",class:"w-3 h-3"})],8,ks)]))),128)),e("label",ws,[u(r(d),{icon:"fluent:image-add-24-regular",class:"w-8 h-8 mb-2"}),g[12]||(g[12]=e("span",{class:"text-xs"},"เพิ่มรูปภาพ",-1)),e("input",{type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:U},null,32)])])])]),e("div",_s,[e("button",{onClick:g[6]||(g[6]=h=>L("close")),class:"px-5 py-2.5 text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-200 dark:hover:bg-gray-700 rounded-xl transition-colors"}," ยกเลิก "),e("button",{onClick:B,disabled:a.value,class:"px-5 py-2.5 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-medium rounded-xl shadow-lg shadow-green-500/30 hover:shadow-green-500/40 hover:from-green-600 hover:to-emerald-700 active:scale-[0.98] transition-all flex items-center gap-2"},[a.value?(l(),z(r(d),{key:0,icon:"eos-icons:loading",class:"w-5 h-5"})):(l(),i("span",Cs,p(t.assignment?"บันทึกการแก้ไข":"สร้างแบบฝึกหัด"),1))],8,$s)])])])):C("",!0)]),_:1})}}}),Ss=we(As,[["__scopeId","data-v-391bb215"]]),Ls={key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"},Fs={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-5xl h-[80vh] flex overflow-hidden"},js={class:"w-1/3 border-r border-gray-200 dark:border-gray-700 flex flex-col bg-gray-50 dark:bg-gray-800/50"},Ts={class:"p-4 border-b border-gray-200 dark:border-gray-700"},Ds={class:"font-bold text-gray-900 dark:text-white flex items-center justify-between"},Es={class:"flex-1 overflow-y-auto p-2 space-y-2"},Bs={key:0,class:"flex justify-center py-8"},Is=["onClick"],qs=["src"],Us={class:"flex-1 min-w-0"},Vs={class:"font-medium text-gray-900 dark:text-white truncate"},Ms={class:"text-xs text-gray-500 flex justify-between"},zs={key:0,class:"font-bold text-amber-600 dark:text-amber-400"},Os={key:1,class:"text-center py-8 text-gray-500"},Rs={class:"flex-1 flex flex-col w-2/3"},Ps={class:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800"},Ns={class:"font-bold text-lg text-gray-900 dark:text-white"},Hs={class:"flex-1 overflow-y-auto p-6 bg-gray-50 dark:bg-gray-900"},Zs={key:0,class:"space-y-6"},Ys={class:"bg-white dark:bg-gray-800 rounded-xl p-6 shadow-sm border border-gray-100 dark:border-gray-700"},Qs={class:"flex items-center gap-3 mb-4"},Gs=["src"],Ks={class:"font-bold text-gray-900 dark:text-white"},Xs={class:"text-xs text-gray-500"},Ws={class:"prose prose-sm dark:prose-invert max-w-none whitespace-pre-wrap"},Js={key:0,class:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-3"},el=["href"],tl=["src"],sl={key:1,class:"h-full flex flex-col items-center justify-center text-gray-500"},ll={key:0,class:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-10"},nl={class:"flex items-center gap-4 max-w-2xl mx-auto"},ol={class:"flex-1"},rl={class:"block text-xs font-medium text-gray-500 mb-1"},al={class:"relative"},il=["max"],dl=["max"],ul={class:"mt-4"},cl=["disabled"],gl={key:1},fl=se({__name:"AssignmentGradingModal",props:{show:{type:Boolean},assignment:{},lessonId:{}},emits:["close","graded"],setup(t,{emit:$}){const s=t,L=$,F=_e(),b=$e(),{getAvatarUrl:c}=lt(),a=w([]),A=w(!1),y=w(null),T=w(""),E=w(""),U=w(!1);de(()=>s.show,async g=>{if(g&&s.assignment){A.value=!0,y.value=null,E.value="";try{const _=await F.get(`/api/assignments/${s.assignment.id}/answers`);a.value=_.answers||[]}catch(_){console.error("Failed to fetch answers:",_),b.toast("ไม่สามารถโหลดคำตอบได้","error")}finally{A.value=!1}}});const N=g=>{y.value=g,T.value=g.points||0,E.value=g.feedback||""},D=async()=>{if(!y.value)return;const g=parseInt(T.value.toString());if(isNaN(g)||g<0){b.toast("กรุณาระบุคะแนนที่ถูกต้อง","warning");return}if(g>(s.assignment.points||100)){b.toast(`คะแนนต้องไม่เกิน ${s.assignment.points||100}`,"warning");return}U.value=!0;try{(await F.post(`/api/assignments/${s.assignment.id}/answers/${y.value.id}/set-points`,{points:g,feedback:E.value,course_id:s.assignment.course_id||s.assignment.lesson?.course_id})).success&&(b.toast("บันทึกคะแนนเรียบร้อย","success"),y.value.points=g,y.value.feedback=E.value,y.value.status="graded",L("graded",y.value))}catch(_){console.error("Failed to grade:",_),b.error(_?.data?.message||"ไม่สามารถบันทึกคะแนนได้")}finally{U.value=!1}},B=g=>c(g),m=g=>g?new Date(g).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return(g,_)=>(l(),z(et,{name:"fade"},{default:J(()=>[t.show?(l(),i("div",Ls,[e("div",Fs,[e("div",js,[e("div",Ts,[e("h3",Ds,[e("span",null,"ส่งงานแล้ว ("+p(a.value.length)+")",1),e("button",{onClick:_[0]||(_[0]=h=>L("close")),class:"md:hidden text-gray-500"},[u(r(d),{icon:"fluent:dismiss-24-regular"})])])]),e("div",Es,[A.value?(l(),i("div",Bs,[u(r(d),{icon:"eos-icons:loading",class:"w-6 h-6 text-green-500"})])):C("",!0),(l(!0),i(Y,null,K(a.value,h=>(l(),i("button",{key:h.id,onClick:v=>N(h),class:V(["w-full p-3 rounded-lg flex items-center gap-3 transition-colors text-left",y.value?.id===h.id?"bg-white dark:bg-gray-700 shadow-sm ring-1 ring-green-500":"hover:bg-gray-100 dark:hover:bg-gray-700"])},[e("img",{src:B(h.user),class:"w-10 h-10 rounded-full object-cover border border-gray-200 dark:border-gray-600"},null,8,qs),e("div",Us,[e("div",Vs,p(h.user?.firstname)+" "+p(h.user?.lastname),1),e("div",Ms,[e("span",null,p(m(h.created_at)),1),h.points!==null?(l(),i("span",zs,p(h.points)+" / "+p(t.assignment.points),1)):C("",!0)])])],10,Is))),128)),!A.value&&a.value.length===0?(l(),i("div",Os,[..._[5]||(_[5]=[e("p",null,"ยังไม่มีใครส่งงาน",-1)])])):C("",!0)])]),e("div",Rs,[e("div",Ps,[e("h3",Ns,p(t.assignment?.title),1),e("button",{onClick:_[1]||(_[1]=h=>L("close")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"},[u(r(d),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"})])]),e("div",Hs,[y.value?(l(),i("div",Zs,[e("div",Ys,[e("div",Qs,[e("img",{src:B(y.value.user),class:"w-10 h-10 rounded-full"},null,8,Gs),e("div",null,[e("h4",Ks,p(y.value.user?.firstname)+" "+p(y.value.user?.lastname),1),e("p",Xs,"ส่งเมื่อ "+p(m(y.value.created_at)),1)])]),e("div",Ws,p(y.value.content),1),y.value.images?.length?(l(),i("div",Js,[(l(!0),i(Y,null,K(y.value.images,h=>(l(),i("a",{key:h.id,href:h.full_url||h.image_url,target:"_blank",class:"block rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700 hover:opacity-90"},[e("img",{src:h.full_url||h.image_url,class:"w-full h-32 object-cover"},null,8,tl)],8,el))),128))])):C("",!0)])])):(l(),i("div",sl,[u(r(d),{icon:"fluent:person-board-24-regular",class:"w-16 h-16 opacity-30 mb-4"}),_[6]||(_[6]=e("p",null,"เลือกนักเรียนจากรายการด้านซ้ายเพื่อตรวจงาน",-1))]))]),y.value?(l(),i("div",ll,[e("div",nl,[e("div",ol,[e("label",rl,"คะแนน (เต็ม "+p(t.assignment.points)+")",1),e("div",al,[Z(e("input",{"onUpdate:modelValue":_[2]||(_[2]=h=>T.value=h),type:"number",min:"0",max:t.assignment.points,class:"w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500 outline-none",placeholder:"ใส่คะแนน"},null,8,il),[[W,T.value]]),u(r(d),{icon:"fluent:star-24-regular",class:"absolute right-3 top-2.5 w-5 h-5 text-gray-400"})]),Z(e("input",{type:"range","onUpdate:modelValue":_[3]||(_[3]=h=>T.value=h),min:"0",max:t.assignment.points,step:"1",class:"w-full mt-3 accent-green-500 cursor-grab active:cursor-grabbing h-2 bg-gray-200 rounded-lg appearance-none dark:bg-gray-700"},null,8,dl),[[W,T.value,void 0,{number:!0}]]),e("div",ul,[_[7]||(_[7]=e("label",{class:"block text-xs font-medium text-gray-500 mb-1"},"ข้อเสนอแนะ (Feedback)",-1)),Z(e("textarea",{"onUpdate:modelValue":_[4]||(_[4]=h=>E.value=h),rows:"2",class:"w-full px-4 py-2 rounded-xl border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-green-500 outline-none resize-none",placeholder:"เขียนข้อแนะนำเพิ่มเติม..."},null,512),[[W,E.value]])])]),e("button",{onClick:D,disabled:U.value,class:"mt-5 px-6 py-2.5 bg-gradient-to-r from-amber-500 to-orange-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl active:scale-95 transition-all text-sm flex items-center gap-2"},[U.value?(l(),z(r(d),{key:0,icon:"eos-icons:loading",class:"w-5 h-5"})):(l(),i("span",gl,"บันทึกคะแนน"))],8,cl)])])):C("",!0)])])])):C("",!0)]),_:1}))}}),vl=we(fl,[["__scopeId","data-v-60d73bb0"]]);function ml(t){let $={called:!1};return(...s)=>{if(!$.called)return $.called=!0,t(...s)}}function je(t,...$){t&&$.length>0&&t.classList.add(...$)}function ye(t,...$){t&&$.length>0&&t.classList.remove(...$)}var Ee=(t=>(t.Finished="finished",t.Cancelled="cancelled",t))(Ee||{});function pl(t,$){let s=nt();if(!t)return s.dispose;let{transitionDuration:L,transitionDelay:F}=getComputedStyle(t),[b,c]=[L,F].map(a=>{let[A=0]=a.split(",").filter(Boolean).map(y=>y.includes("ms")?parseFloat(y):parseFloat(y)*1e3).sort((y,T)=>T-y);return A});return b!==0?s.setTimeout(()=>$("finished"),b+c):$("finished"),s.add(()=>$("cancelled")),s.dispose}function Je(t,$,s,L,F,b){let c=nt(),a=b!==void 0?ml(b):()=>{};return ye(t,...F),je(t,...$,...s),c.nextFrame(()=>{ye(t,...s),je(t,...L),c.add(pl(t,A=>(ye(t,...L,...$),je(t,...F),a(A))))}),c.add(()=>ye(t,...$,...s,...L,...F)),c.add(()=>a("cancelled")),c.dispose}function ae(t=""){return t.split(/\s+/).filter($=>$.length>1)}let qe=Symbol("TransitionContext");var hl=(t=>(t.Visible="visible",t.Hidden="hidden",t))(hl||{});function bl(){return Ie(qe,null)!==null}function yl(){let t=Ie(qe,null);if(t===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return t}function xl(){let t=Ie(Ue,null);if(t===null)throw new Error("A <TransitionChild /> is used but it is missing a parent <TransitionRoot />.");return t}let Ue=Symbol("NestingContext");function Ce(t){return"children"in t?Ce(t.children):t.value.filter(({state:$})=>$==="visible").length>0}function rt(t){let $=w([]),s=w(!1);oe(()=>s.value=!0),ke(()=>s.value=!1);function L(b,c=ie.Hidden){let a=$.value.findIndex(({id:A})=>A===b);a!==-1&&(De(c,{[ie.Unmount](){$.value.splice(a,1)},[ie.Hidden](){$.value[a].state="hidden"}}),!Ce($)&&s.value&&t?.())}function F(b){let c=$.value.find(({id:a})=>a===b);return c?c.state!=="visible"&&(c.state="visible"):$.value.push({id:b,state:"visible"}),()=>L(b,ie.Unmount)}return{children:$,register:F,unregister:L}}let at=It.RenderStrategy,Be=se({props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(t,{emit:$,attrs:s,slots:L,expose:F}){let b=w(0);function c(){b.value|=ne.Opening,$("beforeEnter")}function a(){b.value&=~ne.Opening,$("afterEnter")}function A(){b.value|=ne.Closing,$("beforeLeave")}function y(){b.value&=~ne.Closing,$("afterLeave")}if(!bl()&&Ft())return()=>tt(it,{...t,onBeforeEnter:c,onAfterEnter:a,onBeforeLeave:A,onAfterLeave:y},L);let T=w(null),E=q(()=>t.unmount?ie.Unmount:ie.Hidden);F({el:T,$el:T});let{show:U,appear:N}=yl(),{register:D,unregister:B}=xl(),m=w(U.value?"visible":"hidden"),g={value:!0},_=jt(),h={value:!1},v=rt(()=>{!h.value&&m.value!=="hidden"&&(m.value="hidden",B(_),y())});oe(()=>{let X=D(_);ke(X)}),xe(()=>{if(E.value===ie.Hidden&&_){if(U.value&&m.value!=="visible"){m.value="visible";return}De(m.value,{hidden:()=>B(_),visible:()=>D(_)})}});let x=ae(t.enter),k=ae(t.enterFrom),I=ae(t.enterTo),R=ae(t.entered),re=ae(t.leave),le=ae(t.leaveFrom),ge=ae(t.leaveTo);oe(()=>{xe(()=>{if(m.value==="visible"){let X=We(T);if(X instanceof Comment&&X.data==="")throw new Error("Did you forget to passthrough the `ref` to the actual DOM node?")}})});function fe(X){let O=g.value&&!N.value,j=We(T);!j||!(j instanceof HTMLElement)||O||(h.value=!0,U.value&&c(),U.value||A(),X(U.value?Je(j,x,k,I,R,Q=>{h.value=!1,Q===Ee.Finished&&a()}):Je(j,re,le,ge,R,Q=>{h.value=!1,Q===Ee.Finished&&(Ce(v)||(m.value="hidden",B(_),y()))})))}return oe(()=>{de([U],(X,O,j)=>{fe(j),g.value=!1},{immediate:!0})}),Te(Ue,v),Tt(q(()=>De(m.value,{visible:ne.Open,hidden:ne.Closed})|b.value)),()=>{let{appear:X,show:O,enter:j,enterFrom:Q,enterTo:P,entered:ve,leave:Ve,leaveFrom:Me,leaveTo:ze,...he}=t,Ae={ref:T},Se={...he,...N.value&&U.value&&Dt.isServer?{class:V([s.class,he.class,...x,...k])}:{}};return ot({theirProps:Se,ourProps:Ae,slot:{},slots:L,attrs:s,features:at,visible:m.value==="visible",name:"TransitionChild"})}}}),kl=Be,it=se({inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},show:{type:[Boolean],default:null},unmount:{type:[Boolean],default:!0},appear:{type:[Boolean],default:!1},enter:{type:[String],default:""},enterFrom:{type:[String],default:""},enterTo:{type:[String],default:""},entered:{type:[String],default:""},leave:{type:[String],default:""},leaveFrom:{type:[String],default:""},leaveTo:{type:[String],default:""}},emits:{beforeEnter:()=>!0,afterEnter:()=>!0,beforeLeave:()=>!0,afterLeave:()=>!0},setup(t,{emit:$,attrs:s,slots:L}){let F=Et(),b=q(()=>t.show===null&&F!==null?(F.value&ne.Open)===ne.Open:t.show);xe(()=>{if(![!0,!1].includes(b.value))throw new Error('A <Transition /> is used but it is missing a `:show="true | false"` prop.')});let c=w(b.value?"visible":"hidden"),a=rt(()=>{c.value="hidden"}),A=w(!0),y={show:b,appear:q(()=>t.appear||!A.value)};return oe(()=>{xe(()=>{A.value=!1,b.value?c.value="visible":Ce(a)||(c.value="hidden")})}),Te(Ue,a),Te(qe,y),()=>{let T=Bt(t,["show","appear","unmount","onBeforeEnter","onBeforeLeave","onAfterEnter","onAfterLeave"]),E={unmount:t.unmount};return ot({ourProps:{...E,as:"template"},theirProps:{},slot:{},slots:{...L,default:()=>[tt(kl,{onBeforeEnter:()=>$("beforeEnter"),onAfterEnter:()=>$("afterEnter"),onBeforeLeave:()=>$("beforeLeave"),onAfterLeave:()=>$("afterLeave"),...s,...E,...T},L.default)]},attrs:{},features:at,visible:c.value==="visible",name:"Transition"})}}});const wl={class:"fixed inset-0 overflow-y-auto"},_l={class:"flex min-h-full items-center justify-center p-4 text-center"},$l={class:"space-y-4 max-h-[70vh] overflow-y-auto pr-2"},Cl={key:0,class:"grid grid-cols-4 gap-2 mb-2"},Al=["src"],Sl=["onClick"],Ll={key:1,class:"grid grid-cols-4 gap-2 mb-2"},Fl=["src"],jl=["onClick"],Tl={class:"cursor-pointer inline-flex items-center gap-2 px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-lg text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"},Dl={class:"space-y-3"},El=["onClick"],Bl=["onUpdate:modelValue"],Il={class:"flex-1"},ql={key:0,class:"relative mb-2 w-max group"},Ul=["src"],Vl=["onClick"],Ml={class:"flex gap-2"},zl=["onUpdate:modelValue","placeholder"],Ol={class:"flex-shrink-0 cursor-pointer flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-500 dark:text-gray-400",title:"เพิ่มรูปภาพ"},Rl=["onChange"],Pl=["onClick"],Nl={class:"mt-6 flex justify-end gap-3 pt-4 border-t border-gray-100 dark:border-gray-700"},Hl=["disabled"],Zl=["disabled"],Yl=se({__name:"QuestionFormModal",props:{show:{type:Boolean},lessonId:{},question:{}},emits:["close","submit"],setup(t,{emit:$}){const s=t,L=$,F=_e(),b=$e(),c=w(!1),a=w({text:"",points:1,images:[],options:[{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null}],deleted_images:[]}),A=w([]),y=w([]),T=()=>{s.question?(a.value.text=s.question.text||"",a.value.points=s.question.points||1,a.value.images=[],a.value.deleted_images=[],A.value=[...s.question.images||[]],s.question.options&&s.question.options.length>0?a.value.options=s.question.options.map(v=>({id:v.id,text:v.text,is_correct:!!v.is_correct,image:v.images&&v.images.length>0?v.images[0].full_url||v.images[0].image_url:null,imageFile:null})):a.value.options=[{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null}]):E()};de(()=>s.question,T,{immediate:!0}),de(()=>s.show,v=>{v&&T()});function E(){a.value={text:"",points:1,images:[],options:[{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null},{text:"",is_correct:!1,id:null,image:null,imageFile:null}],deleted_images:[]},A.value=[],y.value=[]}const U=v=>{const x=v.target;if(x.files){const k=Array.from(x.files);a.value.images=[...a.value.images,...k],k.forEach(I=>{y.value.push(URL.createObjectURL(I))})}},N=v=>{URL.revokeObjectURL(y.value[v]),y.value.splice(v,1),a.value.images.splice(v,1)},D=v=>{const x=A.value.findIndex(k=>k.id===v);x!==-1&&(A.value.splice(x,1),a.value.deleted_images.push(v))},B=()=>{a.value.options.push({text:"",is_correct:!1,id:null,image:null,imageFile:null})},m=v=>{a.value.options.splice(v,1)},g=(v,x)=>{const k=v.target;if(k.files&&k.files[0]){const I=k.files[0];a.value.options[x].imageFile=I,a.value.options[x].image=URL.createObjectURL(I)}},_=v=>{a.value.options[v].imageFile&&URL.revokeObjectURL(a.value.options[v].image),a.value.options[v].image=null,a.value.options[v].imageFile=null},h=async()=>{if(!a.value.text){b.error("กรุณาระบุคำถาม");return}if(!a.value.options.some(v=>v.is_correct)){b.error("กรุณาเลือกคำตอบที่ถูกต้องอย่างน้อย 1 ข้อ");return}if(a.value.options.some(v=>!v.text?.trim()&&!v.image)){b.error("กรุณากรอกตัวเลือกให้ครบถ้วน (ต้องมีข้อความหรือรูปภาพ)");return}c.value=!0;try{const v=new FormData;v.append("text",a.value.text),v.append("points",a.value.points.toString()),a.value.options.forEach((k,I)=>{k.id&&v.append(`options[${I}][id]`,k.id.toString()),v.append(`options[${I}][text]`,k.text||""),v.append(`options[${I}][is_correct]`,k.is_correct?"true":"false"),k.imageFile&&v.append(`options[${I}][image]`,k.imageFile)}),a.value.images.forEach(k=>{v.append("images[]",k)}),a.value.deleted_images.forEach(k=>{v.append("deleted_images[]",k.toString())});let x;s.question?(v.append("_method","PUT"),x=(await F.post(`/api/lessons/${s.lessonId}/questions/${s.question.id}`,v)).question):x=(await F.post(`/api/lessons/${s.lessonId}/questions`,v)).question,L("submit",x),L("close"),b.toast("บันทึกคำถามเรียบร้อย","success")}catch(v){console.error("Failed to save question:",v),b.error(v?.data?.message||"ไม่สามารถบันทึกคำถามได้")}finally{c.value=!1}};return(v,x)=>(l(),z(r(it),{appear:"",show:t.show,as:"template"},{default:J(()=>[u(r(Vt),{as:"div",onClose:x[4]||(x[4]=k=>L("close")),class:"relative z-50"},{default:J(()=>[u(r(Be),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:J(()=>[...x[5]||(x[5]=[e("div",{class:"fixed inset-0 bg-black/25 backdrop-blur-sm"},null,-1)])]),_:1}),e("div",wl,[e("div",_l,[u(r(Be),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:J(()=>[u(r(qt),{class:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white dark:bg-gray-800 p-6 text-left align-middle shadow-xl transition-all"},{default:J(()=>[u(r(Ut),{as:"h3",class:"text-lg font-bold leading-6 text-gray-900 dark:text-white mb-4 flex items-center justify-between"},{default:J(()=>[e("span",null,p(t.question?"แก้ไขคำถาม":"เพิ่มคำถามใหม่"),1),e("button",{onClick:x[0]||(x[0]=k=>L("close")),class:"text-gray-400 hover:text-gray-500"},[u(r(d),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6"})])]),_:1}),e("div",$l,[e("div",null,[x[6]||(x[6]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"คำถาม",-1)),Z(e("textarea",{"onUpdate:modelValue":x[1]||(x[1]=k=>a.value.text=k),rows:"3",class:"w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-orange-500 focus:border-orange-500",placeholder:"ระบุคำถาม..."},null,512),[[W,a.value.text]])]),e("div",null,[x[8]||(x[8]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"รูปภาพประกอบ (ถ้ามี)",-1)),A.value.length>0?(l(),i("div",Cl,[(l(!0),i(Y,null,K(A.value,k=>(l(),i("div",{key:k.id,class:"relative group"},[e("img",{src:k.full_url||k.image_url,class:"h-16 w-full object-cover rounded-lg border dark:border-gray-600"},null,8,Al),e("button",{onClick:I=>D(k.id),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity"},[u(r(d),{icon:"fluent:dismiss-12-regular",class:"w-3 h-3"})],8,Sl)]))),128))])):C("",!0),y.value.length>0?(l(),i("div",Ll,[(l(!0),i(Y,null,K(y.value,(k,I)=>(l(),i("div",{key:I,class:"relative group"},[e("img",{src:k,class:"h-16 w-full object-cover rounded-lg border dark:border-gray-600"},null,8,Fl),e("button",{onClick:R=>N(I),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity"},[u(r(d),{icon:"fluent:dismiss-12-regular",class:"w-3 h-3"})],8,jl)]))),128))])):C("",!0),e("label",Tl,[u(r(d),{icon:"fluent:image-add-24-regular",class:"w-5 h-5"}),x[7]||(x[7]=H(" เพิ่มรูปภาพ ",-1)),e("input",{type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:U},null,32)])]),x[12]||(x[12]=e("hr",{class:"border-gray-200 dark:border-gray-700 my-4"},null,-1)),e("div",null,[x[10]||(x[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"ตัวเลือกคำตอบ",-1)),e("div",Dl,[(l(!0),i(Y,null,K(a.value.options,(k,I)=>(l(),i("div",{key:I,class:"flex items-center gap-3"},[e("div",{class:"flex-shrink-0 pt-1 cursor-pointer",onClick:R=>k.is_correct=!k.is_correct,title:"เลือกข้อที่ถูกต้อง (เลือกได้มากกว่า 1 ข้อ)"},[e("div",{class:V(["w-6 h-6 rounded border-2 flex items-center justify-center transition-colors duration-200",k.is_correct?"bg-green-500 border-green-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-green-400"])},[k.is_correct?(l(),z(r(d),{key:0,icon:"fluent:checkmark-16-filled",class:"w-4 h-4"})):C("",!0)],2),Z(e("input",{type:"checkbox","onUpdate:modelValue":R=>k.is_correct=R,class:"hidden"},null,8,Bl),[[$t,k.is_correct]])],8,El),e("div",Il,[k.image?(l(),i("div",ql,[e("img",{src:k.image,class:"h-16 w-auto object-contain rounded border bg-gray-50 dark:bg-gray-900"},null,8,Ul),e("button",{onClick:R=>_(I),class:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-0.5 opacity-0 group-hover:opacity-100 transition-opacity"},[u(r(d),{icon:"fluent:dismiss-12-regular",class:"w-3 h-3"})],8,Vl)])):C("",!0),e("div",Ml,[Z(e("input",{type:"text","onUpdate:modelValue":R=>k.text=R,class:V(["w-full rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-orange-500 focus:border-orange-500 text-sm",{"border-green-500 ring-1 ring-green-500":k.is_correct}]),placeholder:`ตัวเลือกที่ ${I+1}`},null,10,zl),[[W,k.text]]),e("label",Ol,[u(r(d),{icon:"fluent:image-20-regular",class:"w-5 h-5"}),e("input",{type:"file",accept:"image/*",class:"hidden",onChange:R=>g(R,I)},null,40,Rl)])])]),a.value.options.length>2?(l(),i("button",{key:0,onClick:R=>m(I),class:"text-gray-400 hover:text-red-500 p-1"},[u(r(d),{icon:"fluent:delete-20-regular",class:"w-5 h-5"})],8,Pl)):C("",!0)]))),128))]),e("button",{onClick:B,class:"mt-3 text-sm text-blue-600 hover:text-blue-700 flex items-center gap-1 font-medium"},[u(r(d),{icon:"fluent:add-circle-20-filled",class:"w-5 h-5"}),x[9]||(x[9]=H(" เพิ่มตัวเลือก ",-1))])]),x[13]||(x[13]=e("hr",{class:"border-gray-200 dark:border-gray-700 my-4"},null,-1)),e("div",null,[x[11]||(x[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"คะแนน",-1)),Z(e("input",{type:"number","onUpdate:modelValue":x[2]||(x[2]=k=>a.value.points=k),class:"w-32 rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:ring-orange-500 focus:border-orange-500",min:"1"},null,512),[[W,a.value.points]])])]),e("div",Nl,[e("button",{type:"button",class:"inline-flex justify-center rounded-lg border border-transparent bg-gray-100 dark:bg-gray-700 px-4 py-2 text-sm font-medium text-gray-900 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-600 focus:outline-none",onClick:x[3]||(x[3]=k=>L("close")),disabled:c.value}," ยกเลิก ",8,Hl),e("button",{type:"button",class:"inline-flex justify-center rounded-lg border border-transparent bg-orange-600 px-4 py-2 text-sm font-medium text-white hover:bg-orange-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-orange-500 focus-visible:ring-offset-2 flex items-center gap-2",onClick:h,disabled:c.value},[c.value?(l(),z(r(d),{key:0,icon:"eos-icons:loading",class:"w-4 h-4 animate-spin"})):C("",!0),x[14]||(x[14]=e("span",null,"บันทึก",-1))],8,Zl)])]),_:1})]),_:1})])])]),_:1})]),_:1},8,["show"]))}}),Ql={class:"border-t border-gray-200 dark:border-gray-700 pt-4"},Gl={class:"flex items-center gap-1 mb-4 bg-gray-100 dark:bg-gray-700/50 p-1 rounded-xl"},Kl=["onClick"],Xl={class:"min-h-[120px]"},Wl={class:"space-y-4"},Jl={class:"flex items-center justify-between py-3 border-b border-gray-200 dark:border-gray-700 text-sm text-gray-500 dark:text-gray-400"},en={class:"flex items-center gap-4"},tn={key:0,class:"flex items-center gap-1.5 hover:text-vikinger-purple cursor-pointer transition-colors"},sn={class:"font-medium"},ln={key:1,class:"flex items-center gap-1.5 hover:text-red-500 cursor-pointer transition-colors"},nn={class:"font-medium"},on={class:"font-medium"},rn={class:"flex items-center gap-4"},an={key:0,class:"flex items-center gap-1.5 hover:text-vikinger-green cursor-pointer transition-colors"},dn={class:"font-medium"},un={key:1,class:"flex items-center gap-1.5 hover:text-amber-500 cursor-pointer transition-colors"},cn={class:"font-medium"},gn={class:"flex items-center gap-2"},fn={class:"text-sm font-medium"},vn={class:"text-sm font-medium"},mn={class:"text-sm font-medium"},pn={class:"mt-4"},hn=["disabled"],bn={class:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700"},yn={class:"flex gap-3"},xn=["src"],kn={class:"flex-1 flex gap-2"},wn=["disabled","onKeydown"],_n=["disabled"],$n={key:0,class:"mt-4 space-y-4"},Cn=["src","alt"],An={class:"flex-1"},Sn={class:"bg-gray-100 dark:bg-gray-700 rounded-2xl p-3"},Ln={class:"font-semibold text-sm text-gray-800 dark:text-white"},Fn={class:"text-sm text-gray-700 dark:text-gray-300 mt-1 whitespace-pre-wrap"},jn={key:0,class:"flex items-center gap-3 mt-1 px-2 text-[11px] text-gray-500 dark:text-gray-400"},Tn={key:0,class:"flex items-center gap-1"},Dn={class:"font-medium"},En={key:1,class:"flex items-center gap-1"},Bn={class:"font-medium"},In={class:"flex items-center gap-3 mt-1 text-xs text-gray-500 dark:text-gray-400 px-2"},qn=["onClick","disabled"],Un=["onClick","disabled"],Vn=["onClick"],Mn={key:0},zn={key:1},On=["onClick"],Rn={key:1,class:"mt-3 pl-4 border-l-2 border-vikinger-purple/30"},Pn={class:"flex gap-2"},Nn=["src"],Hn={class:"flex-1 flex gap-2"},Zn=["placeholder","disabled","onKeydown"],Yn=["onClick","disabled"],Qn={key:2,class:"mt-3 pl-4 border-l-2 border-gray-200 dark:border-gray-600 space-y-3"},Gn=["src","alt"],Kn={class:"flex-1"},Xn={class:"bg-gray-50 dark:bg-gray-600 rounded-xl p-2.5"},Wn={class:"font-semibold text-xs text-gray-800 dark:text-white"},Jn={class:"text-xs text-gray-700 dark:text-gray-300 mt-0.5 whitespace-pre-wrap"},eo={class:"flex items-center gap-2 mt-1 text-[10px] text-gray-500 dark:text-gray-400 px-1"},to=["onClick","disabled"],so={key:0},lo=["onClick","disabled"],no={key:0},oo=["onClick"],ro={key:1,class:"mt-4 text-center"},ao=["disabled"],io={key:2,class:"mt-4 text-center py-6 text-gray-500 dark:text-gray-400"},uo={key:0,class:"mb-4 flex justify-end"},co={key:2,class:"flex flex-col items-center justify-center py-12 text-center"},go={class:"w-20 h-20 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4"},fo={class:"text-gray-500 dark:text-gray-400 max-w-sm"},vo=se({__name:"LessonInteractionTabs",props:{lesson:{},isAdmin:{type:Boolean,default:!1}},emits:["like","dislike","bookmark","share","comment","add-comment","complete"],setup(t,{emit:$}){const s=t,L=$,{getAvatarUrl:F}=lt(),b=Ct(),c=_e(),a=$e(),A=w("reaction"),y=w(s.lesson.is_liked_by_auth||!1),T=w(s.lesson.is_disliked_by_auth||!1),E=w(s.lesson.is_bookmarked_by_auth||!1),U=w(s.lesson.progress?.status==="completed"||!1),N=w(!1),D=w(s.lesson.like_count||0),B=w(s.lesson.dislike_count||0),m=w(s.lesson.bookmarks_count||0),g=w(s.lesson.comment_count||0),_=w(s.lesson.share_count||0),h=w(""),v=w(!1),x=q(()=>F(b.user)),k=w(!1),I=w(!1),R=w(null),re=w(null),le=q(()=>s.isAdmin||b.user?.id===s.lesson.creater?.id),ge=()=>{R.value=null,k.value=!0},fe=n=>{re.value=n,I.value=!0},X=n=>{R.value=n,k.value=!0},O=async n=>{if(await a.confirm("ลบแบบฝึกหัด",`คุณแน่ใจหรือไม่ที่จะลบ "${n.title}"?`))try{if(await c.delete(`/api/lessons/${s.lesson.id}/assignments/${n.id}`)){const S=s.lesson.assignments.findIndex(M=>M.id===n.id);S!==-1&&(s.lesson.assignments.splice(S,1),a.toast("ลบแบบฝึกหัดสำเร็จ","success"))}}catch(o){console.error("Failed to delete assignment:",o),a.error(o?.data?.message||"ไม่สามารถลบแบบฝึกหัดได้")}},j=async(n,f)=>{try{const o=new FormData;o.append("content",f.content),s.lesson.course_id&&o.append("course_id",s.lesson.course_id.toString()),f.files&&f.files.forEach(M=>{o.append("images[]",M)}),f.deleted_images&&f.deleted_images.length>0&&f.deleted_images.forEach(M=>{o.append("deleted_images[]",M.toString())});const S=await c.post(`/api/assignments/${n}/answers`,o);if(S.success){const M=s.lesson.assignments.find(be=>be.id===n);if(M){M.answers||(M.answers=[]);const be=M.answers.findIndex(Le=>{const Fe=b.user?.id;return Le.user_id===Fe||Le.user===Fe||Le.student?.id===Fe});be!==-1?M.answers[be]=S.newAnswer:M.answers.push(S.newAnswer)}a.toast("ส่งคำตอบเรียบร้อยแล้ว","success")}}catch(o){console.error("Failed to submit answer:",o),a.error(o?.data?.message||"ไม่สามารถส่งคำตอบได้")}},Q=w(!1),P=w(null),ve=()=>{P.value=null,Q.value=!0},Ve=n=>{P.value=n,Q.value=!0},Me=n=>{if(n)if(s.lesson.questions||(s.lesson.questions=[]),s.lesson.questions=s.lesson.questions.filter(f=>f&&f.id),P.value){const f=s.lesson.questions.findIndex(o=>o.id===n.id);f!==-1&&(s.lesson.questions[f]=n)}else s.lesson.questions.push(n)},ze=n=>{s.lesson.questions=n},he=n=>{if(R.value){const f=s.lesson.assignments.findIndex(o=>o.id===n.id);f!==-1&&(s.lesson.assignments[f]=n)}else s.lesson.assignments||(s.lesson.assignments=[]),s.lesson.assignments.push(n)};q(()=>s.lesson.assignments&&s.lesson.assignments.length>0),q(()=>s.lesson.questions&&s.lesson.questions.length>0);const Ae=q(()=>s.lesson.assignments?.length||0),Se=q(()=>s.lesson.questions?.length||0),Oe=n=>F(n?.user||n?.author),dt=q(()=>[{id:"reaction",label:"รีแอคชั่น",icon:"fluent:emoji-24-regular",activeIcon:"fluent:emoji-24-filled",count:D.value+g.value,color:"blue"},{id:"assignment",label:"แบบฝึกหัด",icon:"fluent:clipboard-task-24-regular",activeIcon:"fluent:clipboard-task-24-filled",count:Ae.value,color:"green"},{id:"quiz",label:"แบบทดสอบ",icon:"fluent:quiz-new-24-regular",activeIcon:"fluent:quiz-new-24-filled",count:Se.value,color:"orange"}]),ut=()=>{y.value?(y.value=!1,D.value--):(y.value=!0,D.value++,T.value&&(T.value=!1,B.value--)),L("like")},ct=()=>{T.value?(T.value=!1,B.value--):(T.value=!0,B.value++,y.value&&(y.value=!1,D.value--)),L("dislike")},gt=()=>{E.value=!E.value,m.value+=E.value?1:-1,L("bookmark")},ft=()=>{_.value++,L("share")},vt=async()=>{if(!N.value){N.value=!0;try{const n=await c.post(`/api/lessons/${s.lesson.id}/progress/toggle`);n.success&&(U.value=n.completed,n.completed?a.toast("ทำเครื่องหมายว่าอ่านแล้ว ✓","success"):a.toast("ยกเลิกเครื่องหมายอ่านแล้ว","info"),L("complete",s.lesson.id))}catch(n){console.error("Failed to toggle progress:",n),a.error(n?.data?.message||"ไม่สามารถอัพเดทสถานะได้")}finally{N.value=!1}}},mt=async()=>{try{const n=await c.get(`/api/lessons/${s.lesson.id}/progress`);n.success&&n.progress&&(U.value=n.progress.is_completed)}catch(n){console.error("Failed to fetch progress:",n)}};oe(()=>{mt()});const Re=()=>{L("comment","")},G=w(s.lesson.comments||[]);w(null);const ue=w(!1),Pe=q(()=>G.value.length<g.value),ee=w(null),te=w(""),ce=w(!1),me=w({}),Ne=n=>{const f=b.user?.id,o=n.user?.id;return f===o||s.isAdmin||s.lesson.creater?.id===f},pt=async(n,f)=>{if(await a.confirm("ลบความคิดเห็น","คุณแน่ใจหรือไม่ที่จะลบความคิดเห็นนี้?"))try{(await c.delete(`/api/lessons/${s.lesson.id}/comments/${n.id}`)).success&&(G.value.splice(f,1),g.value--,a.success("ความคิดเห็นถูกลบแล้ว","สำเร็จ"))}catch(S){console.error("Failed to delete comment:",S),a.error(S?.data?.message||"ไม่สามารถลบความคิดเห็นได้")}},ht=async(n,f,o)=>{if(await a.confirm("ลบการตอบกลับ","คุณแน่ใจหรือไม่ที่จะลบการตอบกลับนี้?"))try{(await c.delete(`/api/lessons/${s.lesson.id}/comments/${f.id}`)).success&&(n.replies.splice(o,1),a.success("การตอบกลับถูกลบแล้ว","สำเร็จ"))}catch(M){console.error("Failed to delete reply:",M),a.error(M?.data?.message||"ไม่สามารถลบการตอบกลับได้")}},bt=async()=>{if(!(ue.value||!Pe.value)){ue.value=!0;try{const n=Math.ceil(G.value.length/10)+1,f=await c.get(`/api/lessons/${s.lesson.id}/comments?page=${n}`);if(f.data&&f.data.length>0){const o=new Set(G.value.map(M=>M.id)),S=f.data.filter(M=>!o.has(M.id));S.length>0?G.value.push(...S):(g.value=G.value.length,a.toast("ไม่มีความคิดเห็นเพิ่มเติมแล้ว","info"))}else g.value=G.value.length,a.toast("ไม่มีความคิดเห็นเพิ่มเติมแล้ว","info")}catch(n){console.error("Failed to load more comments:",n),a.error("ไม่สามารถโหลดความคิดเห็นเพิ่มเติมได้")}finally{ue.value=!1}}},He=async()=>{if(!(!h.value.trim()||v.value)){v.value=!0;try{const n=await c.post(`/api/lessons/${s.lesson.id}/comments`,{content:h.value.trim()});n.success&&n.comment?(G.value.unshift(n.comment),g.value++,h.value="",L("add-comment",n.comment)):a.error(n.message||"ไม่สามารถส่งความคิดเห็นได้")}catch(n){console.error("Failed to post comment:",n),a.error(n?.data?.message||"ไม่สามารถส่งความคิดเห็นได้ กรุณาลองใหม่อีกครั้ง")}finally{v.value=!1}}},Ze=async n=>{if(n.isLiking)return;if(b.user?.id===n.user?.id){a.warning("คุณไม่สามารถกดถูกใจคอมเมนต์ของตัวเองได้");return}n.isLiking=!0;const f=n.isLikedByAuth;n.isLikedByAuth=!f,n.likes=(n.likes||0)+(f?-1:1),!f&&n.isDislikedByAuth&&(n.isDislikedByAuth=!1,n.dislikes=(n.dislikes||0)-1);try{(await c.post(`/api/lessons/${s.lesson.id}/comments/${n.id}/like`)).success||(n.isLikedByAuth=f,n.likes=(n.likes||0)+(f?1:-1))}catch(o){n.isLikedByAuth=f,n.likes=(n.likes||0)+(f?1:-1),console.error("Failed to like comment:",o)}finally{n.isLiking=!1}},Ye=async n=>{if(n.isDisliking)return;if(b.user?.id===n.user?.id){a.warning("คุณไม่สามารถกดไม่ถูกใจคอมเมนต์ของตัวเองได้");return}n.isDisliking=!0;const f=n.isDislikedByAuth;n.isDislikedByAuth=!f,n.dislikes=(n.dislikes||0)+(f?-1:1),!f&&n.isLikedByAuth&&(n.isLikedByAuth=!1,n.likes=(n.likes||0)-1);try{(await c.post(`/api/lessons/${s.lesson.id}/comments/${n.id}/dislike`)).success||(n.isDislikedByAuth=f,n.dislikes=(n.dislikes||0)+(f?1:-1))}catch(o){n.isDislikedByAuth=f,n.dislikes=(n.dislikes||0)+(f?1:-1),console.error("Failed to dislike comment:",o)}finally{n.isDisliking=!1}},yt=n=>{ee.value===n?(ee.value=null,te.value="",me.value[n]=!1):(ee.value=n,te.value="",me.value[n]=!0)},xt=()=>{ee.value=null,te.value=""},Qe=async n=>{if(!(!te.value.trim()||ce.value)){ce.value=!0;try{const f=await c.post(`/api/lessons/${s.lesson.id}/comments`,{content:te.value.trim(),parent_id:n.id});f.success&&f.comment?(n.replies||(n.replies=[]),n.replies.push(f.comment),me.value[n.id]=!0,ee.value=null,te.value=""):a.error(f.message||"ไม่สามารถตอบกลับได้")}catch(f){console.error("Failed to submit reply:",f),a.error(f?.data?.message||"ไม่สามารถตอบกลับได้ กรุณาลองใหม่อีกครั้ง")}finally{ce.value=!1}}};return(n,f)=>(l(),i(Y,null,[e("div",Ql,[e("div",Gl,[(l(!0),i(Y,null,K(dt.value,o=>(l(),i("button",{key:o.id,onClick:S=>A.value=o.id,class:V(["flex-1 flex items-center justify-center gap-2 py-3 px-4 rounded-lg font-medium text-sm transition-all duration-200",[A.value===o.id?`bg-white dark:bg-gray-800 text-${o.color}-600 dark:text-${o.color}-400 shadow-md`:"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"]])},[u(r(d),{icon:A.value===o.id?o.activeIcon:o.icon,class:"w-5 h-5"},null,8,["icon"]),e("span",null,p(o.label),1),o.count>0?(l(),i("span",{key:0,class:V(["px-2 py-0.5 text-xs font-bold rounded-full",[A.value===o.id?`bg-${o.color}-100 dark:bg-${o.color}-900/30 text-${o.color}-600 dark:text-${o.color}-400`:"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-400"]])},p(o.count),3)):C("",!0)],10,Kl))),128))]),e("div",Xl,[Z(e("div",Wl,[e("div",Jl,[e("div",en,[D.value>0||B.value>0?(l(),i("span",tn,[u(r(d),{icon:"fluent:thumb-like-24-filled",class:"w-4 h-4 text-vikinger-purple"}),e("span",sn,p(D.value),1)])):C("",!0),B.value>0?(l(),i("span",ln,[u(r(d),{icon:"fluent:thumb-dislike-24-filled",class:"w-4 h-4 text-red-500"}),e("span",nn,p(B.value),1)])):C("",!0),g.value>0?(l(),i("span",{key:2,onClick:Re,class:"flex items-center gap-1.5 hover:text-vikinger-cyan cursor-pointer transition-colors"},[u(r(d),{icon:"fluent:comment-24-regular",class:"w-4 h-4"}),e("span",on,p(g.value),1)])):C("",!0)]),e("div",rn,[_.value>0?(l(),i("span",an,[u(r(d),{icon:"fluent:share-24-regular",class:"w-4 h-4"}),e("span",dn,p(_.value),1)])):C("",!0),m.value>0?(l(),i("span",un,[u(r(d),{icon:"fluent:bookmark-24-filled",class:"w-4 h-4 text-amber-500"}),e("span",cn,p(m.value),1)])):C("",!0)])]),e("div",gn,[e("button",{onClick:ut,class:V(["flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg transition-all duration-300",y.value?"bg-vikinger-purple/10 text-vikinger-purple":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300"])},[u(r(d),{icon:y.value?"fluent:thumb-like-24-filled":"fluent:thumb-like-24-regular",class:"w-5 h-5 transition-transform hover:scale-110"},null,8,["icon"]),e("span",fn,p(y.value?"ถูกใจแล้ว":"ถูกใจ"),1)],2),e("button",{onClick:ct,class:V(["flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg transition-all duration-300",T.value?"bg-red-500/10 text-red-500":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300"])},[u(r(d),{icon:T.value?"fluent:thumb-dislike-24-filled":"fluent:thumb-dislike-24-regular",class:"w-5 h-5 transition-transform hover:scale-110"},null,8,["icon"]),e("span",vn,p(T.value?"ไม่ถูกใจแล้ว":"ไม่ถูกใจ"),1)],2),e("button",{onClick:Re,class:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"},[u(r(d),{icon:"fluent:comment-24-regular",class:"w-5 h-5 text-gray-600 dark:text-gray-300 group-hover:text-vikinger-cyan transition-colors"}),f[6]||(f[6]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"ความคิดเห็น",-1))]),e("button",{onClick:ft,class:"flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors group"},[u(r(d),{icon:"fluent:share-24-regular",class:"w-5 h-5 text-gray-600 dark:text-gray-300 group-hover:text-vikinger-green transition-colors"}),f[7]||(f[7]=e("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"แชร์",-1))]),e("button",{onClick:gt,class:V(["flex-1 flex items-center justify-center gap-2 py-2.5 rounded-lg transition-all duration-300",E.value?"bg-amber-500/10 text-amber-500":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-600 dark:text-gray-300"])},[u(r(d),{icon:E.value?"fluent:bookmark-24-filled":"fluent:bookmark-24-regular",class:"w-5 h-5 transition-transform hover:scale-110"},null,8,["icon"]),e("span",mn,p(E.value?"บันทึกแล้ว":"บันทึก"),1)],2)]),e("div",pn,[e("button",{onClick:vt,disabled:N.value,class:V(["w-full flex items-center justify-center gap-3 py-3 px-6 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02]",U.value?"bg-gradient-to-r from-green-500 to-emerald-600 text-white shadow-lg shadow-green-500/30":"bg-gradient-to-r from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30 hover:from-blue-600 hover:to-blue-700"])},[N.value?(l(),z(r(d),{key:0,icon:"eos-icons:bubble-loading",class:"w-6 h-6"})):(l(),i(Y,{key:1},[u(r(d),{icon:U.value?"fluent:checkmark-circle-24-filled":"fluent:checkbox-unchecked-24-regular",class:"w-6 h-6"},null,8,["icon"]),e("span",null,p(U.value?"✓ อ่านแล้ว":"ทำเครื่องหมายว่าอ่านแล้ว"),1)],64))],10,hn)]),e("div",bn,[e("div",yn,[e("img",{src:x.value,class:"w-10 h-10 flex-shrink-0 rounded-full object-cover ring-2 ring-vikinger-purple/20",alt:"Your avatar"},null,8,xn),e("div",kn,[Z(e("input",{"onUpdate:modelValue":f[0]||(f[0]=o=>h.value=o),type:"text",placeholder:"เขียนความคิดเห็นเกี่ยวกับบทเรียนนี้...",class:"flex-1 px-4 py-2.5 rounded-full bg-gray-100 dark:bg-gray-700 border-none outline-none text-gray-800 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-vikinger-purple/30 transition-all",disabled:v.value,onKeydown:Ge(Ke(He,["prevent"]),["enter"])},null,40,wn),[[W,h.value]]),e("button",{onClick:He,disabled:v.value||!h.value.trim(),class:"p-2.5 rounded-full bg-gradient-to-r from-vikinger-purple to-vikinger-cyan text-white hover:shadow-lg transition-all duration-300 hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"},[v.value?(l(),z(r(d),{key:1,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):(l(),z(r(d),{key:0,icon:"fluent:send-24-filled",class:"w-5 h-5"}))],8,_n)])])]),G.value.length>0?(l(),i("div",$n,[(l(!0),i(Y,null,K(G.value,o=>(l(),i("div",{key:o.id,class:"flex gap-3"},[e("img",{src:Oe(o),class:"w-10 h-10 flex-shrink-0 aspect-square rounded-full object-cover",alt:o.user?.username||o.author?.username},null,8,Cn),e("div",An,[e("div",Sn,[e("h6",Ln,p(o.user?.username||o.author?.username||"ผู้ใช้"),1),e("p",Fn,p(o.content),1)]),o.likes||o.dislikes?(l(),i("div",jn,[o.likes?(l(),i("span",Tn,[u(r(d),{icon:"fluent:thumb-like-16-filled",class:"w-3 h-3 text-vikinger-purple"}),e("span",Dn,p(o.likes),1)])):C("",!0),o.dislikes?(l(),i("span",En,[u(r(d),{icon:"fluent:thumb-dislike-16-filled",class:"w-3 h-3 text-red-500"}),e("span",Bn,p(o.dislikes),1)])):C("",!0)])):C("",!0),e("div",In,[e("span",null,p(o.create_at||o.created_at_for_humans||"เมื่อสักครู่"),1),e("button",{onClick:S=>Ze(o),disabled:o.isLiking||r(b).user?.id===o.user?.id,class:V(["flex items-center gap-1 font-medium transition-colors px-1.5 py-0.5 rounded-md",o.isLikedByAuth?"text-vikinger-purple bg-vikinger-purple/10":"hover:text-vikinger-purple hover:bg-gray-100 dark:hover:bg-gray-600",r(b).user?.id===o.user?.id?"opacity-50 cursor-not-allowed":""])},[u(r(d),{icon:o.isLikedByAuth?"fluent:thumb-like-20-filled":"fluent:thumb-like-20-regular",class:"w-3.5 h-3.5"},null,8,["icon"]),e("span",null,p(o.isLikedByAuth?"ถูกใจแล้ว":"ถูกใจ"),1)],10,qn),e("button",{onClick:S=>Ye(o),disabled:o.isDisliking||r(b).user?.id===o.user?.id,class:V(["flex items-center gap-1 font-medium transition-colors px-1.5 py-0.5 rounded-md",o.isDislikedByAuth?"text-red-500 bg-red-500/10":"hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-600",r(b).user?.id===o.user?.id?"opacity-50 cursor-not-allowed":""])},[u(r(d),{icon:o.isDislikedByAuth?"fluent:thumb-dislike-20-filled":"fluent:thumb-dislike-20-regular",class:"w-3.5 h-3.5"},null,8,["icon"]),e("span",null,p((o.isDislikedByAuth,"ไม่ถูกใจ")),1)],10,Un),e("button",{onClick:S=>yt(o.id),class:V(["flex items-center gap-1 font-medium px-1.5 py-0.5 rounded-md transition-colors",ee.value===o.id||me.value[o.id]?"text-vikinger-cyan bg-vikinger-cyan/10":"hover:text-vikinger-cyan hover:bg-gray-100 dark:hover:bg-gray-600"])},[u(r(d),{icon:ee.value===o.id?"fluent:chevron-up-20-regular":"fluent:arrow-reply-20-regular",class:"w-3.5 h-3.5"},null,8,["icon"]),o.replies&&o.replies.length>0?(l(),i("span",Mn,p(ee.value===o.id?"ซ่อน":"ตอบกลับ")+" ("+p(o.replies.length)+") ",1)):(l(),i("span",zn,"ตอบกลับ"))],10,Vn),Ne(o)?(l(),i("button",{key:0,onClick:S=>pt(o,G.value.indexOf(o)),class:"flex items-center gap-1 font-medium px-1.5 py-0.5 rounded-md transition-colors text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20"},[u(r(d),{icon:"fluent:delete-20-regular",class:"w-3.5 h-3.5"}),f[8]||(f[8]=e("span",null,"ลบ",-1))],8,On)):C("",!0)]),ee.value===o.id?(l(),i("div",Rn,[e("div",Pn,[e("img",{src:x.value,class:"w-8 h-8 flex-shrink-0 rounded-full object-cover",alt:"Your avatar"},null,8,Nn),e("div",Hn,[Z(e("input",{"onUpdate:modelValue":f[1]||(f[1]=S=>te.value=S),type:"text",placeholder:`ตอบกลับ ${o.user?.username||"ผู้ใช้"}...`,class:"flex-1 px-3 py-2 rounded-full bg-gray-100 dark:bg-gray-700 border-none outline-none text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-vikinger-purple/30 transition-all",disabled:ce.value,onKeydown:Ge(Ke(S=>Qe(o),["prevent"]),["enter"])},null,40,Zn),[[W,te.value]]),e("button",{onClick:S=>Qe(o),disabled:ce.value||!te.value.trim(),class:"p-2 rounded-full bg-vikinger-purple text-white hover:bg-vikinger-purple/90 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[ce.value?(l(),z(r(d),{key:1,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin"})):(l(),z(r(d),{key:0,icon:"fluent:send-24-filled",class:"w-4 h-4"}))],8,Yn),e("button",{onClick:xt,class:"p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-500 transition-colors"},[u(r(d),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})])])])])):C("",!0),me.value[o.id]&&o.replies&&o.replies.length>0?(l(),i("div",Qn,[(l(!0),i(Y,null,K(o.replies,S=>(l(),i("div",{key:S.id,class:"flex gap-2"},[e("img",{src:Oe(S),class:"w-8 h-8 flex-shrink-0 aspect-square rounded-full object-cover",alt:S.user?.username},null,8,Gn),e("div",Kn,[e("div",Xn,[e("h6",Wn,p(S.user?.username||"ผู้ใช้"),1),e("p",Jn,p(S.content),1)]),e("div",eo,[e("span",null,p(S.create_at||"เมื่อสักครู่"),1),e("button",{onClick:M=>Ze(S),disabled:S.isLiking||r(b).user?.id===S.user?.id,class:V(["flex items-center gap-0.5 font-medium transition-colors",S.isLikedByAuth?"text-vikinger-purple":"hover:text-vikinger-purple",r(b).user?.id===S.user?.id?"opacity-50 cursor-not-allowed":""])},[u(r(d),{icon:S.isLikedByAuth?"fluent:thumb-like-16-filled":"fluent:thumb-like-16-regular",class:"w-3 h-3"},null,8,["icon"]),S.likes?(l(),i("span",so,p(S.likes),1)):C("",!0)],10,to),e("button",{onClick:M=>Ye(S),disabled:S.isDisliking||r(b).user?.id===S.user?.id,class:V(["flex items-center gap-0.5 font-medium transition-colors",S.isDislikedByAuth?"text-red-500":"hover:text-red-500",r(b).user?.id===S.user?.id?"opacity-50 cursor-not-allowed":""])},[u(r(d),{icon:S.isDislikedByAuth?"fluent:thumb-dislike-16-filled":"fluent:thumb-dislike-16-regular",class:"w-3 h-3"},null,8,["icon"]),S.dislikes?(l(),i("span",no,p(S.dislikes),1)):C("",!0)],10,lo),Ne(S)?(l(),i("button",{key:0,onClick:M=>ht(o,S,o.replies.indexOf(S)),class:"flex items-center gap-0.5 font-medium transition-colors text-gray-400 hover:text-red-500"},[u(r(d),{icon:"fluent:delete-16-regular",class:"w-3 h-3"}),f[9]||(f[9]=e("span",null,"ลบ",-1))],8,oo)):C("",!0)])])]))),128))])):C("",!0)])]))),128))])):C("",!0),Pe.value&&G.value.length>0?(l(),i("div",ro,[e("button",{onClick:bt,disabled:ue.value,class:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors disabled:opacity-50"},[ue.value?(l(),z(r(d),{key:0,icon:"eos-icons:bubble-loading",class:"w-4 h-4"})):(l(),z(r(d),{key:1,icon:"fluent:chevron-down-20-regular",class:"w-4 h-4"})),H(" "+p(ue.value?"กำลังโหลด...":"ดูความคิดเห็นเพิ่มเติม"),1)],8,ao)])):G.value.length===0?(l(),i("div",io,[u(r(d),{icon:"fluent:comment-24-regular",class:"w-10 h-10 mx-auto mb-2 opacity-50"}),f[10]||(f[10]=e("p",{class:"text-sm"},"ยังไม่มีความคิดเห็น เป็นคนแรกที่แสดงความคิดเห็น!",-1))])):C("",!0)],512),[[pe,A.value==="reaction"]]),Z(e("div",null,[le.value?(l(),i("div",uo,[e("button",{onClick:ge,class:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors flex items-center gap-2 shadow-sm"},[u(r(d),{icon:"fluent:add-24-filled",class:"w-4 h-4"}),f[11]||(f[11]=H(" เพิ่มแบบฝึกหัด ",-1))])])):C("",!0),t.lesson.assignments?.length?(l(),z(St,{key:1,assignments:t.lesson.assignments,"lesson-id":t.lesson.id,"course-id":t.lesson.course_id,"is-creator":le.value,onSubmit:j,onClose:f[2]||(f[2]=o=>A.value="reaction"),onEdit:X,onDelete:O,onViewSubmissions:fe},null,8,["assignments","lesson-id","course-id","is-creator"])):(l(),i("div",co,[e("div",go,[u(r(d),{icon:"fluent:clipboard-task-24-regular",class:"w-10 h-10 text-green-500 dark:text-green-400"})]),f[12]||(f[12]=e("h4",{class:"text-lg font-semibold text-gray-900 dark:text-white mb-2"}," ยังไม่มีแบบฝึกหัด ",-1)),e("p",fo," บทเรียนนี้ยังไม่มีแบบฝึกหัดให้ทำ "+p(le.value?"คุณสามารถเพิ่มแบบฝึกหัดได้โดยคลิกที่ปุ่มด้านบน":"กรุณารอผู้สอนเพิ่มแบบฝึกหัด"),1)]))],512),[[pe,A.value==="assignment"]]),Z(e("div",null,[u(Lt,{questions:t.lesson.questions||[],"lesson-id":t.lesson.id,"is-creator":le.value,onCreate:ve,onEdit:Ve,"onUpdate:questions":ze},null,8,["questions","lesson-id","is-creator"])],512),[[pe,A.value==="quiz"]])])]),u(Ss,{show:k.value,"lesson-id":t.lesson.id,assignment:R.value,onClose:f[3]||(f[3]=o=>k.value=!1),onSubmit:he},null,8,["show","lesson-id","assignment"]),u(vl,{show:I.value,"lesson-id":t.lesson.id,assignment:re.value,onClose:f[4]||(f[4]=o=>I.value=!1)},null,8,["show","lesson-id","assignment"]),u(Yl,{show:Q.value,"lesson-id":t.lesson.id,question:P.value,onClose:f[5]||(f[5]=o=>Q.value=!1),onSubmit:Me},null,8,["show","lesson-id","question"])],64))}}),mo=we(vo,[["__scopeId","data-v-dbec9499"]]),po={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 overflow-hidden mb-6 border border-gray-200 dark:border-gray-700"},ho={class:"relative"},bo={class:"relative h-40 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-blue-900/20 dark:via-purple-900/20 dark:to-pink-900/20 overflow-hidden rounded-t-2xl"},yo={class:"w-full h-full flex items-center justify-center bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 dark:from-blue-900/30 dark:via-purple-900/30 dark:to-pink-900/30"},xo={class:"absolute top-4 left-4 flex flex-wrap gap-2"},ko={class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-blue-500/90 backdrop-blur-md text-white text-sm font-bold shadow-lg ring-1 ring-white/20 transition-transform hover:scale-105"},wo={class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/90 backdrop-blur-md text-white text-sm font-bold shadow-lg ring-1 ring-white/20 transition-transform hover:scale-105"},_o={key:0,class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-500/90 backdrop-blur-md text-white text-sm font-bold shadow-lg ring-1 ring-white/20 transition-transform hover:scale-105"},$o={key:0,class:"absolute top-4 right-4"},Co={class:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/90 backdrop-blur-md text-white text-sm font-bold shadow-lg ring-1 ring-white/20 transition-transform hover:scale-105"},Ao={class:"p-6 space-y-6"},So={class:"text-3xl font-bold text-gray-900 dark:text-white mb-4 leading-tight"},Lo={class:"flex items-center justify-between mb-4"},Fo={class:"flex items-center gap-3"},jo=["src","alt"],To={class:"font-medium text-gray-900 dark:text-white"},Do={class:"text-sm text-gray-500 dark:text-gray-400"},Eo={class:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400"},Bo={class:"flex items-center gap-1"},Io={key:0,class:"flex items-center gap-1"},qo={key:0,class:"bg-gray-200 dark:bg-gray-700 rounded-full h-2 overflow-hidden"},Uo={key:1,class:"text-xs text-gray-500 dark:text-gray-400 mt-1"},Vo={key:0,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800"},Mo={class:"text-gray-700 dark:text-gray-300 leading-relaxed"},zo={class:"relative"},Oo={key:0,class:"absolute bottom-0 inset-x-0 h-24 bg-gradient-to-t from-white dark:from-gray-800 to-transparent flex items-end justify-center pb-2"},Ro={key:1,class:"mt-6"},Po={class:"flex items-center gap-2 text-lg font-semibold text-gray-900 dark:text-white mb-4"},No={class:"aspect-video"},Ho=["src","alt"],Zo={class:"absolute inset-0 flex items-center justify-center bg-gradient-to-t from-black/60 via-black/20 to-transparent group-hover:from-black/70 group-hover:via-black/30 transition-all duration-300"},Yo={class:"w-20 h-20 bg-red-600 rounded-full flex items-center justify-center shadow-2xl transform transition-all duration-300 group-hover:scale-110 group-hover:shadow-red-500/50"},Qo={class:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent"},Go={class:"flex items-center justify-between"},Ko={class:"text-white font-medium truncate"},Xo={class:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-red-600/90 text-white text-sm font-medium"},Wo={key:2},Jo={class:"flex items-center gap-3"},er={class:"text-left"},tr={class:"text-sm text-gray-600 dark:text-gray-400"},sr={class:"mt-4 space-y-2"},lr={key:3,class:"flex items-center justify-between gap-4 px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 rounded-b-2xl"},nr={class:"text-left"},or={class:"text-sm font-semibold text-gray-700 dark:text-gray-200 line-clamp-1 max-w-[150px] md:max-w-[200px]"},rr={key:1,class:"flex-1"},ar={key:2,class:"hidden md:flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-700 rounded-full shadow"},ir={class:"text-sm font-medium text-gray-600 dark:text-gray-300"},dr={class:"text-right"},ur={class:"text-sm font-semibold text-gray-700 dark:text-gray-200 line-clamp-1 max-w-[150px] md:max-w-[200px]"},cr={key:4,class:"flex-1"},gr=384,xr=se({__name:"LessonPost",props:{lesson:{},isAdmin:{type:Boolean,default:!1},currentUser:{},prevLesson:{},nextLesson:{},currentIndex:{},totalLessons:{},showNavigation:{type:Boolean,default:!0}},emits:["edit","delete","like","dislike","bookmark","share","comment","navigate"],setup(t,{emit:$}){const s=t,L=$,F=w(!1),b=w(!1),c=w([]),a=w(!1),A=w(null),y=w(!1),T=()=>{if(A.value){const O=A.value.scrollHeight;y.value=O>gr}};let E=null;oe(()=>{Xe(()=>{T(),A.value&&typeof ResizeObserver<"u"&&(E=new ResizeObserver(()=>{F.value||T()}),E.observe(A.value))})}),ke(()=>{E&&E.disconnect()}),de(()=>s.lesson.content,()=>{Xe(()=>{T()})});const U=q(()=>s.lesson.status===1?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-700/30 dark:text-gray-400"),N=q(()=>s.lesson.status===1?"เผยแพร่แล้ว":"แบบร่าง"),D=q(()=>s.lesson.topics&&s.lesson.topics.length>0);q(()=>s.lesson.assignments&&s.lesson.assignments.length>0),q(()=>s.lesson.questions&&s.lesson.questions.length>0);const B=q(()=>D.value?Math.round(c.value.length/s.lesson.topics.length*100):0),m=q(()=>{const O=s.lesson.content||"",j=s.lesson.description||"",P=(O.replace(/<[^>]*>/g,"")+" "+j).trim().split(/\s+/).filter(Boolean).length,ve=Math.ceil(P/200);return ve>0?ve:1}),g=q(()=>s.showNavigation&&(s.prevLesson||s.nextLesson)),_=q(()=>s.currentIndex!==void 0&&s.totalLessons?`${s.currentIndex+1}/${s.totalLessons}`:null),h=O=>{if(!O)return null;if(/^[a-zA-Z0-9_-]{11}$/.test(O))return O;const j=[/(?:youtube\.com\/watch\?v=|youtube\.com\/watch\?.+&v=)([a-zA-Z0-9_-]{11})/,/youtu\.be\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/v\/([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/];for(const Q of j){const P=O.match(Q);if(P&&P[1])return P[1]}return null},v=q(()=>h(s.lesson.youtube_url)),x=q(()=>!!v.value);q(()=>v.value?`https://www.youtube.com/embed/${v.value}`:null);const k=q(()=>v.value?`https://img.youtube.com/vi/${v.value}/maxresdefault.jpg`:null),I=()=>{a.value=!0},R=()=>{a.value=!1},re=()=>{F.value=!F.value},le=()=>{b.value=!b.value},ge=()=>{L("edit",s.lesson)},fe=()=>{L("delete",s.lesson.id)},X=O=>{const j=c.value.indexOf(O);j>-1?c.value.splice(j,1):c.value.push(O)};return(O,j)=>{const Q=kt;return l(),i("article",po,[e("div",ho,[e("div",bo,[e("div",yo,[u(r(d),{icon:"fluent:book-24-filled",class:"w-20 h-20 text-blue-400/40 dark:text-blue-300/30 animate-pulse"})]),j[4]||(j[4]=e("div",{class:"absolute inset-0 bg-gradient-to-t from-black/40 via-transparent to-transparent"},null,-1))]),e("div",xo,[e("span",{class:V([U.value,"inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold shadow-lg backdrop-blur-md bg-white/20 dark:bg-gray-900/30 ring-1 ring-white/20 transition-transform hover:scale-105"])},[t.lesson.status===1?(l(),z(r(d),{key:0,icon:"fluent:checkmark-circle-24-filled",class:"w-4 h-4"})):(l(),z(r(d),{key:1,icon:"fluent:draft-24-regular",class:"w-4 h-4"})),H(" "+p(N.value),1)],2),e("span",ko,[u(r(d),{icon:"fluent:number-symbol-24-filled",class:"w-4 h-4"}),H(" บทที่ "+p(t.lesson.order),1)]),e("span",wo,[u(r(d),{icon:"fluent:clock-24-filled",class:"w-4 h-4"}),H(" "+p(m.value)+" นาที ",1)]),_.value?(l(),i("span",_o,[u(r(d),{icon:"fluent:list-24-filled",class:"w-4 h-4"}),H(" "+p(_.value),1)])):C("",!0)]),t.lesson.point_tuition_fee>0?(l(),i("div",$o,[e("span",Co,[u(r(d),{icon:"fluent:diamond-24-filled",class:"w-4 h-4"}),H(" "+p(t.lesson.point_tuition_fee)+" พอยต์ ",1)])])):C("",!0),t.isAdmin?(l(),i("div",{key:1,class:V(["absolute top-4 right-4 flex gap-2",{"top-16":t.lesson.point_tuition_fee>0}])},[e("button",{onClick:ge,class:"p-3 bg-white/95 dark:bg-gray-800/95 rounded-xl hover:bg-white dark:hover:bg-gray-800 transition-all duration-200 backdrop-blur-md shadow-lg ring-1 ring-gray-200/50 dark:ring-gray-700/50 hover:scale-105",title:"แก้ไข"},[u(r(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-blue-600 dark:text-blue-400"})]),e("button",{onClick:fe,class:"p-3 bg-white/95 dark:bg-gray-800/95 rounded-xl hover:bg-white dark:hover:bg-gray-800 transition-all duration-200 backdrop-blur-md shadow-lg ring-1 ring-gray-200/50 dark:ring-gray-700/50 hover:scale-105",title:"ลบ"},[u(r(d),{icon:"fluent:delete-24-regular",class:"w-5 h-5 text-red-600 dark:text-red-400"})])],2)):C("",!0)]),e("div",Ao,[e("div",null,[e("h2",So,p(t.lesson.title),1),e("div",Lo,[e("div",Fo,[e("img",{src:t.lesson.creater?.avatar||"/images/default-avatar.png",alt:t.lesson.creater?.name,class:"w-10 h-10 rounded-full ring-2 ring-blue-500 object-cover"},null,8,jo),e("div",null,[e("p",To,p(t.lesson.creater?.name),1),e("p",Do,p(t.lesson.created_at_for_humans),1)])]),e("div",Eo,[e("div",Bo,[u(r(d),{icon:"fluent:clock-24-regular",class:"w-4 h-4"}),e("span",null,p(t.lesson.min_read)+" นาที",1)]),t.lesson.view_count?(l(),i("div",Io,[u(r(d),{icon:"fluent:eye-24-regular",class:"w-4 h-4"}),e("span",null,p(t.lesson.view_count),1)])):C("",!0)])]),D.value&&!t.isAdmin?(l(),i("div",qo,[e("div",{class:"bg-gradient-to-r from-blue-500 to-purple-500 h-full transition-all duration-500",style:At({width:`${B.value}%`})},null,4)])):C("",!0),D.value&&!t.isAdmin?(l(),i("p",Uo," ความคืบหน้า: "+p(B.value)+"% ("+p(c.value.length)+"/"+p(t.lesson.topics.length)+" หัวข้อ) ",1)):C("",!0)]),t.lesson.description?(l(),i("div",Vo,[e("p",Mo,p(t.lesson.description),1)])):C("",!0),e("div",zo,[e("div",{ref_key:"contentRef",ref:A,class:V(["prose prose-blue dark:prose-invert max-w-none transition-all duration-300",!F.value&&y.value&&"max-h-96 overflow-hidden"])},[u(st,{content:t.lesson.content},null,8,["content"])],2),y.value&&!F.value?(l(),i("div",Oo,[e("button",{onClick:re,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors font-medium shadow-lg"},[j[5]||(j[5]=H(" อ่านต่อ ",-1)),u(r(d),{icon:"fluent:chevron-down-24-regular",class:"w-4 h-4 inline ml-1"})])])):C("",!0),y.value&&F.value?(l(),i("button",{key:1,onClick:re,class:"mt-4 w-full px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium"},[j[6]||(j[6]=H(" ย่อเนื้อหา ",-1)),u(r(d),{icon:"fluent:chevron-up-24-regular",class:"w-4 h-4 inline ml-1"})])):C("",!0)]),x.value?(l(),i("div",Ro,[e("h3",Po,[u(r(d),{icon:"fluent:video-24-filled",class:"w-6 h-6 text-red-600 dark:text-red-400"}),j[7]||(j[7]=H(" วิดีโอประกอบบทเรียน ",-1))]),e("div",{class:"relative rounded-2xl overflow-hidden cursor-pointer group shadow-lg border border-gray-200 dark:border-gray-700",onClick:I},[e("div",No,[e("img",{src:k.value,alt:t.lesson.title,class:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"},null,8,Ho)]),e("div",Zo,[e("div",Yo,[u(r(d),{icon:"fluent:play-24-filled",class:"w-10 h-10 text-white ml-1"})])]),e("div",Qo,[e("div",Go,[e("span",Ko,p(t.lesson.title),1),e("span",Xo,[u(r(d),{icon:"logos:youtube-icon",class:"w-4 h-4"}),j[8]||(j[8]=H(" YouTube ",-1))])])])])])):C("",!0),D.value?(l(),i("div",Wo,[e("button",{onClick:le,class:"w-full flex items-center justify-between p-4 bg-purple-50 dark:bg-purple-900/20 rounded-xl border border-purple-200 dark:border-purple-800 hover:bg-purple-100 dark:hover:bg-purple-900/30 transition-colors"},[e("div",Jo,[u(r(d),{icon:"fluent:book-open-24-filled",class:"w-6 h-6 text-purple-600 dark:text-purple-400"}),e("div",er,[j[9]||(j[9]=e("h3",{class:"font-semibold text-gray-900 dark:text-white"},"หัวข้อย่อย",-1)),e("p",tr,p(t.lesson.topics.length)+" หัวข้อ ",1)])]),u(r(d),{icon:b.value?"fluent:chevron-up-24-filled":"fluent:chevron-down-24-filled",class:"w-5 h-5 text-gray-600 dark:text-gray-400"},null,8,["icon"])]),Z(e("div",sr,[(l(!0),i(Y,null,K(t.lesson.topics,P=>(l(),z(is,{key:P.id,topic:P,"is-completed":c.value.includes(P.id),onToggleComplete:X},null,8,["topic","is-completed"]))),128))],512),[[pe,b.value]])])):C("",!0),u(mo,{lesson:t.lesson,isAdmin:t.isAdmin,onLike:j[0]||(j[0]=P=>O.$emit("like",t.lesson.id)),onDislike:j[1]||(j[1]=P=>O.$emit("dislike",t.lesson.id)),onBookmark:j[2]||(j[2]=P=>O.$emit("bookmark",t.lesson.id)),onShare:j[3]||(j[3]=P=>O.$emit("share",t.lesson))},null,8,["lesson","isAdmin"]),g.value?(l(),i("div",lr,[t.prevLesson?(l(),z(Q,{key:0,to:`/courses/${t.lesson.course_id}/lessons/${t.prevLesson.id}`,class:"flex items-center gap-3 px-4 py-3 rounded-xl bg-white dark:bg-gray-700 shadow-md hover:shadow-lg transition-all group hover:-translate-x-1"},{default:J(()=>[u(r(d),{icon:"fluent:chevron-left-24-filled",class:"w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors"}),e("div",nr,[j[10]||(j[10]=e("p",{class:"text-xs text-gray-400 uppercase tracking-wide"},"บทก่อนหน้า",-1)),e("p",or,p(t.prevLesson.title),1)])]),_:1},8,["to"])):(l(),i("div",rr)),_.value?(l(),i("div",ar,[u(r(d),{icon:"fluent:book-open-24-regular",class:"w-4 h-4 text-blue-500"}),e("span",ir,p(_.value),1)])):C("",!0),t.nextLesson?(l(),z(Q,{key:3,to:`/courses/${t.lesson.course_id}/lessons/${t.nextLesson.id}`,class:"flex items-center gap-3 px-4 py-3 rounded-xl bg-white dark:bg-gray-700 shadow-md hover:shadow-lg transition-all group hover:translate-x-1"},{default:J(()=>[e("div",dr,[j[11]||(j[11]=e("p",{class:"text-xs text-gray-400 uppercase tracking-wide"},"บทถัดไป",-1)),e("p",ur,p(t.nextLesson.title),1)]),u(r(d),{icon:"fluent:chevron-right-24-filled",class:"w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors"})]),_:1},8,["to"])):(l(),i("div",cr))])):C("",!0)]),a.value?(l(),z(Qt,{key:0,"youtube-url":t.lesson.youtube_url,title:t.lesson.title,onClose:R},null,8,["youtube-url","title"])):C("",!0)])}}});export{xr as _};
