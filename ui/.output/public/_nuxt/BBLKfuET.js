import{q as U,n as C,c as d,a as r,b,u as s,d as $,F as N,k as G,o as i,I as x,T as v,t as m,a9 as F,ay as P,r as _,z as D,U as L,a3 as E,e as q,$ as Q,aa as H,aB as J,g as R}from"./CHs-R6Sv.js";import{u as K}from"./Bk_v_Y9k.js";import{u as O}from"./CWbKy_m_.js";import{M as W}from"./cJcCQ7yW.js";import{S as B}from"./BQxta0Da.js";import"./BWv91NqQ.js";const X={class:"bg-slate-900 rounded-xl p-5 shadow-lg border border-slate-800 text-white"},Y={class:"flex items-center gap-2 mb-6"},Z={class:"flex flex-col gap-4"},ee={class:"flex items-center gap-3"},te={class:"relative"},re=["src","alt"],se={class:"flex flex-col"},oe={class:"text-sm font-semibold truncate max-w-[120px] md:max-w-[150px]"},ae={class:"text-xs text-slate-400"},ne={class:"text-green-500 font-bold font-mono text-lg"},le={key:0,class:"text-center py-4 text-slate-500 text-sm"},ie=U({__name:"TopPerformers",props:{members:{type:Array,required:!0,default:()=>[]}},setup(T){const g=T,p=C(()=>[...g.members].sort((u,a)=>{const c=Number(u.achieved_score||0);return Number(a.achieved_score||0)-c}).slice(0,5)),w=l=>{switch(l){case 0:return"bg-yellow-400 text-yellow-900 ring-yellow-400";case 1:return"bg-gray-300 text-gray-800 ring-gray-300";case 2:return"bg-orange-400 text-orange-900 ring-orange-400";default:return"bg-gray-700 text-white ring-gray-600"}};return(l,u)=>(i(),d("div",X,[r("div",Y,[b(s(x),{icon:"solar:cup-star-bold",class:"w-6 h-6 text-yellow-400"}),u[0]||(u[0]=r("h2",{class:"text-lg font-bold"},"Top Performers",-1))]),r("div",Z,[(i(!0),d(N,null,G(p.value,(a,c)=>(i(),d("div",{key:a.id,class:"flex items-center justify-between group"},[r("div",ee,[r("div",te,[r("div",{class:v(["absolute -top-1 -right-1 w-5 h-5 flex items-center justify-center rounded-full text-[10px] font-bold shadow-md z-10 border-2 border-slate-900",w(c)])},m(c+1),3),r("img",{src:a.avatar||a.user?.avatar||a.user?.profile_photo_url||"/images/default-avatar.png",alt:a.name,class:"w-10 h-10 rounded-full object-cover ring-2 ring-slate-800 group-hover:ring-slate-700 transition-all"},null,8,re)]),r("div",se,[r("span",oe,m(a.member_name||a.user?.name||a.student?.name||"Unknown"),1),r("span",ae," F • "+m(a.percentage||0)+"% ",1)])]),r("div",ne,m(a.achieved_score||0),1)]))),128)),p.value.length===0?(i(),d("div",le," No ranking data yet ")):$("",!0)])]))}}),de={class:"container mx-auto px-4 py-8 max-w-7xl"},ue={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6"},ce={class:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3"},ge={key:0,class:"text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full"},me={class:"flex flex-col sm:flex-row gap-3 w-full md:w-auto"},pe={class:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-lg"},be={class:"relative w-full sm:w-64"},xe={class:"grid grid-cols-1 lg:grid-cols-4 gap-6"},fe={class:"lg:col-span-3 order-2 lg:order-1"},ye={key:0,class:"mb-6"},he={class:"flex flex-wrap items-center gap-2 p-2 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700"},_e=["onClick"],ve={key:1,class:"mb-6"},we={class:"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-xl border border-blue-100 dark:border-blue-800"},ke={class:"text-sm font-medium text-blue-700 dark:text-blue-300"},Ce={key:2,class:"flex justify-center py-20"},$e={class:"flex flex-col items-center gap-3"},Be={key:3},Ne={class:"flex flex-col gap-3"},Ge={key:4,class:"text-center py-20 bg-white dark:bg-gray-800 rounded-xl border border-dashed border-gray-300 dark:border-gray-700"},Te={class:"inline-flex p-4 rounded-full bg-gray-50 dark:bg-gray-900 mb-4"},Ae={class:"lg:col-span-1 order-1 lg:order-2"},Re=U({__name:"index",setup(T){const g=L("course"),p=L("isCourseAdmin"),w=F();P();const l=K(),u=O(),a=_(""),c=_(0);_("grid");const k=_(!1),y=_("number"),A=()=>{if(!p.value){const t=u.member?.group_id;if(t){const n=l.groups.findIndex(f=>f.id===t);return n>=0?n+1:0}return 0}const o=u.member?.last_accessed_group_tab;if(!o)return 0;const e=l.groups.findIndex(t=>t.id===o);return e>=0?e+1:0};async function S(o){if(c.value=o,p.value&&o>0&&g?.value?.id&&!k.value){k.value=!0;try{const e=l.groups[o-1]?.id;e&&(await w.patch(`/api/courses/${g.value.id}/members/update-last-access-group`,{last_accessed_group_tab:Number(e)}),u.member&&(u.member.last_accessed_group_tab=Number(e)))}catch(e){console.error("Error saving last accessed group tab:",e)}finally{k.value=!1}}}const h=C(()=>{let o=[];if(c.value===0){const e=l.groups.flatMap(n=>n.members||[]),t=new Set;o=e.filter(n=>{const f=t.has(n.id);return t.add(n.id),!f})}else o=l.groups[c.value-1]?.members||[];if(!p.value&&u.member?.group_id){const e=Number(u.member.group_id);o=o.filter(t=>t.group_id===e)}if(a.value){const e=a.value.toLowerCase();o=o.filter(t=>(t.member_name||t.user?.name||t.student?.name||t.name||"").toLowerCase().includes(e)||(t.user?.email||"").toLowerCase().includes(e)||(t.student_id||"").toLowerCase().includes(e))}return o.sort((e,t)=>{if(y.value==="score"){const I=Number(e.achieved_score||0),M=Number(t.achieved_score||0);if(I!==M)return M-I}const n=e.order_number!=null?Number(e.order_number):1/0,f=t.order_number!=null?Number(t.order_number):1/0;return n-f}),o}),j=C(()=>l.isLoading),V=C(()=>h.value.length);D(async()=>{g?.value?.id&&await l.fetchGroups(g.value.id),c.value=A()}),E(()=>g?.value?.id,async o=>{o&&(await l.fetchGroups(o),c.value=A())});const z=async({memberId:o,memberName:e})=>{if((await B.fire({title:"ยืนยันการลบสมาชิก?",text:`คุณต้องการลบ "${e}" ออกจากรายวิชานี้ใช่หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await w.delete(`/api/courses/${g.value.id}/members/${o}`),B.fire("ลบสำเร็จ!","สมาชิกธถูกลบออกจากรายวิชาเรียบร้อยแล้ว.","success"),await l.fetchGroups(g.value.id,!0)}catch(n){console.error("Failed to remove member:",n),B.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบสมาชิกได้.","error")}};return(o,e)=>(i(),d("div",de,[r("div",ue,[r("div",null,[r("h1",ce,[b(s(x),{icon:"ph:users-three-duotone",class:"w-8 h-8 text-blue-500"}),e[4]||(e[4]=q(" สมาชิกในรายวิชา ",-1)),s(j)?$("",!0):(i(),d("span",ge,m(s(V))+" คน ",1))]),e[5]||(e[5]=r("p",{class:"mt-1 text-gray-500 dark:text-gray-400 text-sm"}," รายชื่อนักเรียนและผู้สอนทั้งหมดในรายวิชานี้ ",-1))]),r("div",me,[r("div",pe,[r("button",{onClick:e[0]||(e[0]=t=>y.value="number"),class:v(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",s(y)==="number"?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"])}," เรียงตามเลขที่ ",2),r("button",{onClick:e[1]||(e[1]=t=>y.value="score"),class:v(["px-3 py-1.5 text-sm font-medium rounded-md transition-all",s(y)==="score"?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"])}," เรียงตามคะแนน ",2)]),r("div",be,[b(s(x),{icon:"heroicons:magnifying-glass",class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),Q(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>J(a)?a.value=t:null),type:"text",placeholder:"ค้นหาชื่อ, รหัสนักศึกษา...",class:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all placeholder:text-gray-400 dark:placeholder:text-gray-500 dark:text-white"},null,512),[[H,s(a)]])])])]),r("div",xe,[r("div",fe,[s(p)&&s(l).groups.length>0?(i(),d("div",ye,[r("div",he,[r("button",{onClick:e[3]||(e[3]=t=>S(0)),class:v(["inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium rounded-lg transition-all duration-200",s(c)===0?"bg-blue-500 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"])},[b(s(x),{icon:"heroicons:users",class:"w-4 h-4 mr-2"}),q(" ทั้งหมด ("+m(s(l).groups.reduce((t,n)=>t+(n.members?.length||0),0))+") ",1)],2),(i(!0),d(N,null,G(s(l).groups,(t,n)=>(i(),d("button",{key:t.id,onClick:f=>S(n+1),class:v(["inline-flex items-center justify-center px-4 py-2.5 text-sm font-medium rounded-lg transition-all duration-200",s(c)===n+1?"bg-blue-500 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"])},m(t.name)+" ("+m(t.members?.length||0)+") ",11,_e))),128))])])):!s(p)&&s(u).member?.group_id?(i(),d("div",ve,[r("div",we,[b(s(x),{icon:"heroicons:user-group-solid",class:"w-5 h-5 text-blue-500"}),r("span",ke," กลุ่มเรียน: "+m(s(l).groups.find(t=>t.id===s(u).member?.group_id)?.name||"ไม่ระบุ"),1)])])):$("",!0),s(j)?(i(),d("div",Ce,[r("div",$e,[b(s(x),{icon:"svg-spinners:ring-resize",class:"w-10 h-10 text-blue-500"}),e[6]||(e[6]=r("span",{class:"text-gray-500 animate-pulse"},"กำลังโหลดข้อมูลสมาชิก...",-1))])])):s(h).length>0?(i(),d("div",Be,[r("ul",Ne,[(i(!0),d(N,null,G(s(h),(t,n)=>(i(),R(W,{key:t.id,member:t,"data-index":n,onRequestUnmemberCourse:z},null,8,["member","data-index"]))),128))])])):(i(),d("div",Ge,[r("div",Te,[b(s(x),{icon:"ph:users-three-duotone",class:"w-12 h-12 text-gray-400"})]),e[7]||(e[7]=r("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-1"},"ไม่พบสมาชิก",-1)),e[8]||(e[8]=r("p",{class:"text-gray-500"},"ลองเปลี่ยนคำค้นหา หรือตัวกรองกลุ่มเรียน",-1))]))]),r("div",Ae,[s(h).length>0?(i(),R(ie,{key:0,members:s(h)},null,8,["members"])):$("",!0)])])]))}});export{Re as default};
