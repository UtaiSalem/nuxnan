import{q as ee,a9 as te,r as d,n as S,a3 as se,z as re,W as ae,c as o,a as r,d as k,b as c,e as h,u as b,t as l,$ as A,aa as G,T as p,F as I,k as M,w as oe,a1 as ne,o as n,I as m,a0 as H}from"./DvtEeXFW.js";import{u as le}from"./CaSR6SuD.js";import{u as ie}from"./D4UTVVq6.js";const de={class:"space-y-4"},ue={class:"flex items-center justify-between mb-4"},ge={class:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2"},ce={class:"relative mb-4"},pe={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},ve={key:0,class:"flex flex-wrap gap-2 mb-4 border-b border-gray-200 dark:border-gray-700 pb-3"},be=["onClick"],me={class:"flex flex-wrap gap-2 mb-4"},ye={class:"px-1.5 py-0.5 rounded-full text-[10px] bg-white/20"},xe={key:1,class:"flex justify-center py-8"},fe={key:2,class:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center text-gray-500 border border-dashed border-gray-300 dark:border-gray-700 text-sm"},he={key:3,class:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center text-gray-500 border border-dashed border-gray-300 dark:border-gray-700 text-sm"},ke={key:4,class:"space-y-3"},_e={key:0,class:"text-sm text-gray-500 dark:text-gray-400"},we={class:"grid gap-3"},Ce={class:"flex items-start gap-3"},Ae=["src"],$e={class:"flex-1 min-w-0"},Ue={class:"flex justify-between"},Pe={class:"font-bold text-gray-900 dark:text-white text-sm"},Se={key:0},Te={class:"text-right flex items-center gap-2"},Le=["onClick"],Ve={class:"text-xs font-normal text-gray-400"},Ee={class:"mt-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap border border-gray-100 dark:border-gray-800"},Ge={key:0,class:"mt-3 flex flex-wrap gap-2"},Ie=["src"],Me={class:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 flex items-center gap-3"},je=["onUpdate:modelValue","max"],De=["onUpdate:modelValue","max"],Fe=["onClick","disabled"],Be={key:1,class:"flex justify-center mt-4"},Ne=["disabled"],He=ee({__name:"AssignmentGradingView",props:{assignment:{},courseId:{}},setup(_){const u=_,$=te(),j=le(),{getAvatarUrl:Q}=ie(),y=d([]),g=d([]),v=d(null),T=d(null),w=d(!1),D=d(!1),L=d(1),F=d(1),V=d(!1),B=d(0);d(!1);const x=d(""),i=d("all"),W=async()=>{D.value=!0;try{const t=await $.get(`/api/courses/${u.courseId}/groups`);if(g.value=t.groups||[],t.courseMemberOfAuth)if(T.value=t.courseMemberOfAuth.id,t.courseMemberOfAuth.last_accessed_group_tab){const s=t.courseMemberOfAuth.last_accessed_group_tab;g.value.some(e=>e.id===s)?v.value=s:g.value.length>0&&(v.value=g.value[0].id)}else g.value.length>0&&(v.value=g.value[0].id);else g.value.length>0&&(v.value=g.value[0].id)}catch(t){console.error(t),g.value=[]}finally{D.value=!1}},E=async(t=1,s=!1)=>{w.value=!0;try{const e=await $.get(`/api/assignments/${u.assignment.id}/answers`,{params:{page:t,group_id:v.value||"all"}}),a=(u.assignment.points||0)/2,P=(e.data||[]).map(f=>{const Z=f.points!==null&&f.points!==void 0&&f.points>=a;return{...f,points:f.points,originalPoints:f.points,isUpdating:!1,isExpanded:!Z}});s?y.value=P:y.value=[...y.value,...P],L.value=e.meta.current_page,F.value=e.meta.last_page,B.value=e.meta.total,V.value=!0}catch(e){console.error("Failed to fetch answers:",e)}finally{w.value=!1}},C=S(()=>{let t=y.value;const s=(u.assignment.points||0)/2;if(i.value==="ungraded"?t=t.filter(e=>e.points===null||e.points===void 0):i.value==="graded"?t=t.filter(e=>e.points!==null&&e.points!==void 0&&e.points>=s):i.value==="failed"&&(t=t.filter(e=>e.points!==null&&e.points!==void 0&&e.points<s)),x.value.trim()){const e=x.value.trim().toLowerCase();t=t.filter(a=>{const P=(a.member_name||a.student?.username||"").toLowerCase(),f=String(a.member_number||a.student?.member_number||""),q=String(a.student_id||a.student?.student_id||a.student?.id||"");return P.includes(e)||f.includes(e)||q.includes(e)})}return t}),U=S(()=>{const t=(u.assignment.points||0)/2;return{all:y.value.length,ungraded:y.value.filter(s=>s.points===null||s.points===void 0).length,graded:y.value.filter(s=>s.points!==null&&s.points!==void 0&&s.points>=t).length,failed:y.value.filter(s=>s.points!==null&&s.points!==void 0&&s.points<t).length}});S(()=>C.value.filter(t=>t.points===null||t.points===void 0)),S(()=>C.value.filter(t=>t.points!==null&&t.points!==void 0)),se(v,async(t,s)=>{if(V.value&&E(1,!0),t&&s!==void 0&&T.value)try{await $.post(`/api/courses/${u.courseId}/members/${T.value}/set-active-group-tab`,{group_tab:t})}catch(e){console.error("Failed to save group selection:",e)}});const Y=async t=>{try{t.isUpdating=!0,await $.post(`/api/assignments/${u.assignment.id}/answers/${t.id}/set-points`,{points:t.points,course_id:u.courseId}),t.originalPoints=t.points,t.status="graded",t.isUpdating=!1;const s=(u.assignment.points||0)/2;t.isExpanded=t.points<s,j.toast("บันทึกคะแนนเรียบร้อย","success")}catch(s){console.error("Grading error:",s),j.toast("บันทึกคะแนนไม่สำเร็จ","error"),t.isUpdating=!1}},J=t=>t?new Date(t).toLocaleString("th-TH",{dateStyle:"medium",timeStyle:"short"}):"-",N=t=>u.assignment.due_date?new Date(t.created_at)>new Date(u.assignment.due_date):!1,K=t=>Q(t),R=t=>{if(t.points===null||t.points===void 0)return"bg-gray-50 dark:bg-gray-800 border-gray-300 dark:border-gray-600";const s=(u.assignment.points||0)/2;return t.points>=s?"bg-green-50 dark:bg-green-900/20 border-green-300 dark:border-green-700":"bg-red-50 dark:bg-red-900/20 border-red-300 dark:border-red-700"};re(()=>{W(),E(1,!0),window.addEventListener("scroll",z)}),ae(()=>{window.removeEventListener("scroll",z)});const O=d(!1),z=()=>{O.value=window.scrollY>300},X=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(t,s)=>(n(),o("div",de,[r("div",ue,[r("h2",ge,[c(b(m),{icon:"fluent:people-community-24-regular",class:"w-5 h-5"}),h(" การส่งงาน ("+l(V.value?B.value:u.assignment.answer_count||0)+") ",1)])]),r("div",ce,[r("div",pe,[c(b(m),{icon:"fluent:search-24-regular",class:"w-5 h-5 text-gray-400"})]),A(r("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>x.value=e),type:"text",placeholder:"ค้นหาด้วย ชื่อ, เลขที่ หรือรหัสนักเรียน...",class:"w-full pl-10 pr-10 py-2.5 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl text-sm focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition-all"},null,512),[[G,x.value]]),x.value?(n(),o("button",{key:0,onClick:s[1]||(s[1]=e=>x.value=""),class:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600"},[c(b(m),{icon:"fluent:dismiss-circle-24-filled",class:"w-5 h-5"})])):k("",!0)]),g.value&&g.value.length>0?(n(),o("div",ve,[r("button",{onClick:s[2]||(s[2]=e=>v.value=null),class:p(["px-4 py-2 rounded-lg text-sm font-medium transition-all",v.value===null?"bg-indigo-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"])}," ทั้งหมด ",2),(n(!0),o(I,null,M(g.value,e=>(n(),o("button",{key:e.id,onClick:a=>v.value=e.id,class:p(["px-4 py-2 rounded-lg text-sm font-medium transition-all",v.value===e.id?"bg-indigo-600 text-white shadow-md":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"])},l(e.name),11,be))),128))])):k("",!0),r("div",me,[r("button",{onClick:s[3]||(s[3]=e=>i.value="all"),class:p(["px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1.5",i.value==="all"?"bg-gray-700 text-white shadow-md":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"])},[c(b(m),{icon:"fluent:list-24-regular",class:"w-4 h-4"}),s[8]||(s[8]=h(" ทั้งหมด ",-1)),r("span",ye,l(U.value.all),1)],2),r("button",{onClick:s[4]||(s[4]=e=>i.value="ungraded"),class:p(["px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1.5",i.value==="ungraded"?"bg-gray-500 text-white shadow-md":"bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700"])},[c(b(m),{icon:"fluent:clock-24-regular",class:"w-4 h-4"}),s[9]||(s[9]=h(" รอตรวจ ",-1)),r("span",{class:p(["px-1.5 py-0.5 rounded-full text-[10px]",i.value==="ungraded"?"bg-white/20":"bg-gray-200 dark:bg-gray-700"])},l(U.value.ungraded),3)],2),r("button",{onClick:s[5]||(s[5]=e=>i.value="graded"),class:p(["px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1.5",i.value==="graded"?"bg-green-600 text-white shadow-md":"bg-green-50 dark:bg-green-900/20 text-green-600 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/40"])},[c(b(m),{icon:"fluent:checkmark-circle-24-regular",class:"w-4 h-4"}),s[10]||(s[10]=h(" ผ่าน ",-1)),r("span",{class:p(["px-1.5 py-0.5 rounded-full text-[10px]",i.value==="graded"?"bg-white/20":"bg-green-100 dark:bg-green-900/40"])},l(U.value.graded),3)],2),r("button",{onClick:s[6]||(s[6]=e=>i.value="failed"),class:p(["px-3 py-1.5 rounded-lg text-xs font-medium transition-all flex items-center gap-1.5",i.value==="failed"?"bg-red-600 text-white shadow-md":"bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 hover:bg-red-100 dark:hover:bg-red-900/40"])},[c(b(m),{icon:"fluent:dismiss-circle-24-regular",class:"w-4 h-4"}),s[11]||(s[11]=h(" ไม่ผ่าน ",-1)),r("span",{class:p(["px-1.5 py-0.5 rounded-full text-[10px]",i.value==="failed"?"bg-white/20":"bg-red-100 dark:bg-red-900/40"])},l(U.value.failed),3)],2)]),w.value&&y.value.length===0?(n(),o("div",xe,[c(b(m),{icon:"eos-icons:loading",class:"w-8 h-8 text-orange-500"})])):y.value.length===0?(n(),o("div",fe,l(v.value?"ไม่มีงานที่ส่งในกลุ่มนี้":"ยังไม่มีนักเรียนส่งงาน"),1)):C.value.length===0&&x.value?(n(),o("div",he,[c(b(m),{icon:"fluent:search-24-regular",class:"w-8 h-8 mx-auto mb-2 text-gray-400"}),r("p",null,'ไม่พบผลลัพธ์สำหรับ "'+l(x.value)+'"',1)])):(n(),o("div",ke,[x.value?(n(),o("p",_e," พบ "+l(C.value.length)+" รายการ ",1)):k("",!0),r("div",we,[(n(!0),o(I,null,M(C.value,e=>(n(),o("div",{key:e.id,class:p(["rounded-xl p-4 border shadow-sm transition-shadow hover:shadow-md",R(e)])},[r("div",Ce,[r("img",{src:K(e.student),class:"w-10 h-10 rounded-full object-cover ring-2 ring-gray-100 dark:ring-gray-700"},null,8,Ae),r("div",$e,[r("div",Ue,[r("div",null,[r("h3",Pe,l(e.member_name||e.student?.username||"Unknown Student"),1),r("p",{class:p(["text-xs flex items-center gap-1",N(e)?"text-red-500 font-bold":"text-green-600"])},[h(l(J(e.created_at))+" ",1),N(e)?(n(),o("span",Se,"(Late)")):k("",!0)],2)]),r("div",Te,[r("button",{onClick:a=>e.isExpanded=!e.isExpanded,class:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-400"},[c(b(m),{icon:e.isExpanded?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-5 h-5"},null,8,["icon"])],8,Le),r("div",{class:p(["text-xl font-bold",e.points!==null?e.points>=(_.assignment.passing_score||0)?"text-green-600":"text-red-500":"text-gray-300"])},[h(l(e.points??"-")+" ",1),r("span",Ve,"/ "+l(_.assignment.points),1)],2)])]),A(r("div",null,[r("div",Ee,[h(l(e.content)+" ",1),e.images?.length?(n(),o("div",Ge,[(n(!0),o(I,null,M(e.images,a=>(n(),o("img",{key:a.id,src:a.full_url||a.image_url,class:"w-12 h-12 object-cover rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer"},null,8,Ie))),128))])):k("",!0)])],512),[[H,e.isExpanded]]),r("div",Me,[A(r("input",{type:"number","onUpdate:modelValue":a=>e.points=a,min:0,max:_.assignment.points,class:"w-16 px-2 py-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-center font-bold text-sm focus:ring-2 focus:ring-orange-500 outline-none"},null,8,je),[[G,e.points,void 0,{number:!0}]]),A(r("input",{type:"range","onUpdate:modelValue":a=>e.points=a,min:0,max:_.assignment.points,class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-orange-500"},null,8,De),[[G,e.points,void 0,{number:!0}]]),r("button",{onClick:a=>Y(e),disabled:e.isUpdating||e.points===null&&e.originalPoints===null||e.points===e.originalPoints,class:"px-3 py-1 text-xs font-bold text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},l(e.isUpdating?"...":"บันทึก"),9,Fe)])])])],2))),128))]),L.value<F.value?(n(),o("div",Be,[r("button",{onClick:s[7]||(s[7]=e=>E(L.value+1)),disabled:w.value,class:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-300 font-medium disabled:opacity-50 flex items-center gap-2"},l(w.value?"กำลังโหลด...":"โหลดเพิ่ม"),9,Ne)])):k("",!0)])),c(ne,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 translate-y-10","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-300","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-10"},{default:oe(()=>[A(r("button",{onClick:X,class:"fixed bottom-6 right-6 p-3 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all z-50 animate-bounce-slow",title:"Back to Top"},[c(b(m),{icon:"fluent:arrow-up-24-filled",class:"w-6 h-6"})],512),[[H,O.value]])]),_:1})]))}});export{He as _};
