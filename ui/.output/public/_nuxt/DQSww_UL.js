import{_ as q}from"./BGzz-v_u.js";import{q as J,a9 as W,r as m,a3 as Y,n as H,c as n,a as t,b as u,e as _,u as p,t as I,$ as f,d as $,aa as v,T as E,w as F,F as S,k as j,j as y,ab as K,g as T,o,I as b}from"./CHs-R6Sv.js";import{_ as Q}from"./BpBR7DAR.js";const X={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden"},Z={class:"bg-gradient-to-r from-blue-600 via-cyan-600 to-purple-600 p-6"},ee={class:"text-2xl font-bold text-white flex items-center gap-3"},te={key:0,class:"mt-1 text-sm text-red-500"},re={key:0,class:"mb-4 grid grid-cols-2 md:grid-cols-4 gap-4"},le=["src","alt"],ae=["onClick"],oe={key:1,class:"mb-4 grid grid-cols-2 md:grid-cols-4 gap-4"},se=["src","alt"],ne=["onClick"],ie={class:"text-center"},de={class:"relative"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},pe={class:"flex items-center justify-end gap-4 pt-6 border-t border-gray-200 dark:border-gray-700"},be=["disabled"],fe=J({__name:"LessonForm",props:{lesson:{},courseId:{},isEdit:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(x,{emit:B}){const s=x,V=B,C=W(),l=m({title:"",description:"",content:"",youtube_url:"",min_read:0,point_tuition_fee:0,order:0,status:1}),c=m([]),k=m([]),w=m(!1),h=m(!1),i=m({});Y(()=>s.lesson,r=>{r&&(l.value={title:r.title||"",description:r.description||"",content:r.content||"",youtube_url:r.youtube_url||"",min_read:r.min_read||0,point_tuition_fee:r.point_tuition_fee||0,order:r.order||0,status:r.status??1},k.value=r.images||[])},{immediate:!0});const L=H(()=>s.isEdit?"แก้ไขบทเรียน":"สร้างบทเรียนใหม่"),U=()=>{w.value=!w.value},N=r=>{w.value=!1;const e=r.dataTransfer?.files;e&&D(e)},A=r=>{const e=r.target;e.files&&D(e.files)},D=r=>{Array.from(r).forEach(e=>{if(e.type.startsWith("image/")){const d=URL.createObjectURL(e);c.value.push({file:e,url:d})}})},M=r=>{URL.revokeObjectURL(c.value[r].url),c.value.splice(r,1)},O=async(r,e)=>{if(confirm("ต้องการลบรูปภาพนี้หรือไม่?"))try{await C.delete(`/api/lessons/${s.lesson.id}/images/${e}`),k.value.splice(r,1)}catch(d){console.error("Failed to delete image:",d),alert("ไม่สามารถลบรูปภาพได้")}},R=()=>(i.value={},l.value.title.trim()||(i.value.title="กรุณากรอกชื่อบทเรียน"),Object.keys(i.value).length===0),G=async()=>{if(R()){h.value=!0;try{const r=new FormData;r.append("title",l.value.title),r.append("description",l.value.description),r.append("content",l.value.content),r.append("youtube_url",l.value.youtube_url),r.append("min_read",String(l.value.min_read)),r.append("point_tuition_fee",String(l.value.point_tuition_fee)),r.append("order",String(l.value.order)),r.append("status",String(l.value.status)),c.value.forEach((d,a)=>{r.append(`images[${a}]`,d.file)});let e;s.isEdit&&s.lesson?(r.append("_method","PUT"),e=await C.post(`/api/courses/${s.courseId}/lessons/${s.lesson.id}`,r)):e=await C.post(`/api/courses/${s.courseId}/lessons`,r),V("submit",e)}catch(r){console.error("Failed to save lesson:",r),r.data?.errors&&(i.value=r.data.errors),alert(r.data?.message||"ไม่สามารถบันทึกบทเรียนได้")}finally{h.value=!1}}},P=()=>{V("cancel")};return(r,e)=>{const d=q;return o(),n("div",X,[t("div",Z,[t("h2",ee,[u(p(b),{icon:x.isEdit?"fluent:edit-24-filled":"fluent:add-circle-24-filled",class:"w-7 h-7"},null,8,["icon"]),_(" "+I(L.value),1)])]),t("form",{onSubmit:y(G,["prevent"]),class:"p-6 space-y-6"},[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"},[_(" ชื่อบทเรียน "),t("span",{class:"text-red-500"},"*")],-1)),f(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>l.value.title=a),type:"text",placeholder:"กรอกชื่อบทเรียน...",class:E(["w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all",{"border-red-500":i.value.title}])},null,2),[[v,l.value.title]]),i.value.title?(o(),n("p",te,I(i.value.title),1)):$("",!0)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," คำอธิบายบทเรียน ",-1)),f(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.description=a),rows:"3",placeholder:"อธิบายเกี่ยวกับบทเรียนนี้...",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all resize-none"},null,512),[[v,l.value.description]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," เนื้อหาบทเรียน ",-1)),u(d,null,{fallback:F(()=>[...e[11]||(e[11]=[t("div",{class:"w-full h-[300px] bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center"},[t("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})],-1)])]),default:F(()=>[u(Q,{modelValue:l.value.content,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.content=a),placeholder:"พิมพ์เนื้อหาบทเรียน... (รองรับ การจัดรูปแบบตัวอักษร, รูปภาพ, ตาราง, โค้ด และอื่นๆ)","min-height":"300px"},null,8,["modelValue"])]),_:1})]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," รูปภาพประกอบ ",-1)),k.value.length>0?(o(),n("div",re,[(o(!0),n(S,null,j(k.value,(a,g)=>(o(),n("div",{key:a.id,class:"relative group"},[t("img",{src:a.full_url,alt:`Image ${g+1}`,class:"w-full h-32 object-cover rounded-lg"},null,8,le),t("button",{type:"button",onClick:z=>O(g,a.id),class:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600"},[u(p(b),{icon:"fluent:delete-24-filled",class:"w-4 h-4"})],8,ae)]))),128))])):$("",!0),c.value.length>0?(o(),n("div",oe,[(o(!0),n(S,null,j(c.value,(a,g)=>(o(),n("div",{key:g,class:"relative group"},[t("img",{src:a.url,alt:`New Image ${g+1}`,class:"w-full h-32 object-cover rounded-lg"},null,8,se),t("button",{type:"button",onClick:z=>M(g),class:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600"},[u(p(b),{icon:"fluent:delete-24-filled",class:"w-4 h-4"})],8,ne),e[13]||(e[13]=t("div",{class:"absolute bottom-2 left-2 px-2 py-0.5 bg-green-500 text-white text-xs rounded"}," ใหม่ ",-1))]))),128))])):$("",!0),t("div",{class:E(["relative w-full p-8 border-2 border-dashed rounded-xl transition-all cursor-pointer",w.value?"bg-blue-50 border-blue-400 dark:bg-blue-900/20":"border-gray-300 dark:border-gray-600 hover:border-blue-400 hover:bg-gray-50 dark:hover:bg-gray-700"]),onDragenter:y(U,["prevent"]),onDragleave:y(U,["prevent"]),onDragover:e[3]||(e[3]=y(()=>{},["prevent"])),onDrop:y(N,["prevent"]),onClick:e[4]||(e[4]=a=>{r.$refs.fileInput.click()})},[t("input",{ref:"fileInput",type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:A},null,544),t("div",ie,[u(p(b),{icon:"fluent:cloud-arrow-up-24-regular",class:"w-12 h-12 mx-auto text-gray-400 dark:text-gray-500 mb-3"}),e[14]||(e[14]=t("p",{class:"text-gray-600 dark:text-gray-400 font-medium"},[_(" ลากไฟล์มาวางที่นี่ หรือ "),t("span",{class:"text-blue-600 dark:text-blue-400"},"คลิกเพื่อเลือก")],-1)),e[15]||(e[15]=t("p",{class:"text-sm text-gray-500 dark:text-gray-500 mt-1"},"PNG, JPG, GIF สูงสุด 4MB",-1))])],34)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ลิงก์ YouTube (ถ้ามี) ",-1)),t("div",de,[u(p(b),{icon:"logos:youtube-icon",class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5"}),f(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.value.youtube_url=a),type:"text",placeholder:"https://www.youtube.com/watch?v=...",class:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all"},null,512),[[v,l.value.youtube_url]])])]),t("div",ue,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," แต้มค่าธรรมเนียม ",-1)),f(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.point_tuition_fee=a),type:"number",min:"0",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all"},null,512),[[v,l.value.point_tuition_fee,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ลำดับบทเรียน ",-1)),f(t("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.order=a),type:"number",min:"0",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all"},null,512),[[v,l.value.order,void 0,{number:!0}]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," สถานะ ",-1)),f(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.status=a),class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent dark:bg-gray-700 dark:text-white transition-all"},[...e[20]||(e[20]=[t("option",{value:1},"เผยแพร่",-1),t("option",{value:0},"แบบร่าง",-1)])],512),[[K,l.value.status,void 0,{number:!0}]])])]),t("div",pe,[t("button",{type:"button",onClick:P,class:"px-6 py-3 text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors font-medium"}," ยกเลิก "),t("button",{type:"submit",disabled:h.value,class:"px-8 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl hover:from-blue-700 hover:to-cyan-700 transition-all shadow-lg hover:shadow-xl font-bold disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"},[h.value?(o(),T(p(b),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):(o(),T(p(b),{key:1,icon:x.isEdit?"fluent:save-24-filled":"fluent:add-circle-24-filled",class:"w-5 h-5"},null,8,["icon"])),_(" "+I(x.isEdit?"บันทึกการแก้ไข":"สร้างบทเรียน"),1)],8,be)])],32)])}}});export{fe as _};
