import{_ as A}from"./BP2gnDQ3.js";import{q as H,ay as L,i as q,y as R,c as r,a as e,b as d,w as O,t as i,u,F as G,k as J,g as U,j as K,$ as k,aa as S,ab as Q,d as N,e as E,a4 as W,p as X,n as $,r as _,o,I as c}from"./Brb_7992.js";import"./unovbEJl.js";import{S as f}from"./BQxta0Da.js";const Y={class:"min-h-screen bg-gradient-to-br from-purple-100 via-white to-purple-200"},Z={class:"bg-white shadow-sm sticky top-0 z-40"},ee={class:"max-w-7xl mx-auto px-4 py-4"},te={class:"flex items-center justify-between"},se={class:"flex items-center gap-4"},le={class:"flex items-center gap-2"},oe={class:"text-xl font-bold text-gray-800"},ae={class:"text-sm text-gray-500"},ne={key:0,class:"flex items-center justify-center py-20"},re={key:1,class:"max-w-7xl mx-auto px-4 py-6"},ie={key:0,class:"text-center py-20"},de={key:1,class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"},ue={class:"relative aspect-[1.6/1] bg-gradient-to-br from-purple-500 to-purple-600 p-4"},ce={class:"absolute top-2 right-2 bg-white/20 backdrop-blur px-2 py-1 rounded text-xs text-white"},pe={class:"flex items-center gap-3 h-full"},me={class:"w-20 h-24 bg-white rounded-lg overflow-hidden flex-shrink-0 relative group"},fe=["src","alt"],_e={key:1,class:"w-full h-full flex items-center justify-center bg-gray-100"},ge={class:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer"},ve=["onChange"],he={class:"flex-1 min-w-0 text-white"},xe={class:"font-semibold text-sm truncate"},be={class:"text-xs opacity-80"},ye={class:"p-3 border-t"},we={class:"flex items-center justify-between"},ke={class:"text-sm text-gray-500"},$e=["onClick"],Ce={class:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"},je={class:"sticky top-0 bg-white border-b px-6 py-4 flex items-center justify-between"},Se={class:"p-6"},Ne={class:"flex items-center gap-6 mb-6"},Be={class:"relative"},Ve={class:"w-28 h-36 bg-gray-100 rounded-xl overflow-hidden"},De=["src","alt"],Te={key:1,class:"w-full h-full flex items-center justify-center"},Ue={class:"absolute -bottom-2 -right-2 p-2 bg-purple-500 text-white rounded-full cursor-pointer hover:bg-purple-600 transition-colors shadow-lg"},Ee={class:"text-lg font-bold text-gray-800"},Fe={class:"text-sm text-gray-500"},Ie={class:"space-y-4"},Me={class:"flex gap-2"},Pe=["disabled"],ze={class:"grid grid-cols-3 gap-3"},Ae={class:"flex justify-end"},He=["disabled"],Le=["value"],qe={key:2,class:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center"},We=H({__name:"[room]",setup(Re){const B=L(),h=X().public.apiBase||"",V=$(()=>Number(B.params.level)),g=$(()=>Number(B.params.room)),x=$(()=>["","ม.1","ม.2","ม.3","ม.4","ม.5","ม.6"][V.value]||"");q({title:$(()=>`จัดการบัตรนักเรียน ${x.value}/${g.value}`)});const v=_([]),a=_(null),C=_(!0),j=_(!1),p=_(!1),n=_({student_number:"",title_name:"",first_name_thai:"",last_name_thai:"",first_name_english:"",last_name_english:""}),b=async()=>{C.value=!0;try{const s=await $fetch(`${h}/student-card/admin/students/${V.value}/${g.value}`);v.value=s.students||[]}catch(s){console.error("Error fetching students:",s),f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถโหลดข้อมูลนักเรียนได้"})}finally{C.value=!1}},F=async(s,t)=>{j.value=!0;const m=new FormData;m.append("photo",t);try{await $fetch(`${h}/student-card/admin/upload-photo/${s}`,{method:"POST",body:m}),f.fire({icon:"success",title:"สำเร็จ",text:"อัปโหลดรูปภาพเรียบร้อยแล้ว",timer:1500,showConfirmButton:!1}),await b(),a.value?.id===s&&(a.value=v.value.find(l=>l.id===s))}catch(l){console.error("Error uploading photo:",l),f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถอัปโหลดรูปภาพได้"})}finally{j.value=!1}},I=async s=>{p.value=!0;try{await $fetch(`${h}/student-card/admin/update-name-th/${s}`,{method:"PATCH",body:{title_name:n.value.title_name,first_name_thai:n.value.first_name_thai,last_name_thai:n.value.last_name_thai}}),f.fire({icon:"success",title:"สำเร็จ",text:"บันทึกข้อมูลเรียบร้อยแล้ว",timer:1500,showConfirmButton:!1}),await b(),w()}catch(t){console.error("Error updating student:",t),f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถบันทึกข้อมูลได้"})}finally{p.value=!1}},M=async s=>{p.value=!0;try{await $fetch(`${h}/student-card/admin/update-code/${s}`,{method:"PATCH",body:{student_number:n.value.student_number}}),f.fire({icon:"success",title:"สำเร็จ",text:"บันทึกรหัสนักเรียนเรียบร้อยแล้ว",timer:1500,showConfirmButton:!1}),await b(),w()}catch(t){console.error("Error updating student ID:",t),f.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถบันทึกรหัสนักเรียนได้"})}finally{p.value=!1}},D=(s,t)=>{const m=s.target,l=m.files?.[0];l&&F(t,l),m.value=""},y=s=>s.profile_image?`/storage/images/students/${s.class_level}/${s.class_section}/${s.profile_image}`:null,P=s=>!s||s.length!==13?s:s.replace(/(\d)(\d{4})(\d{5})(\d{2})(\d{1})/,"$1-$2-$3-$4-$5"),z=s=>{a.value=s,n.value={student_number:s.student_number||"",title_name:s.title_name||"",first_name_thai:s.first_name_thai||"",last_name_thai:s.last_name_thai||"",first_name_english:s.first_name_english||"",last_name_english:s.last_name_english||""}},w=()=>{a.value=null};return R(()=>{b()}),(s,t)=>{const m=A;return o(),r("div",Y,[e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[d(m,{to:"/student-card/admin",class:"p-2 hover:bg-gray-100 rounded-lg transition-colors"},{default:O(()=>[d(u(c),{icon:"heroicons:arrow-left",class:"w-6 h-6 text-gray-600"})]),_:1}),e("div",null,[e("div",le,[e("h1",oe,"จัดการบัตรนักเรียน "+i(x.value)+"/"+i(g.value),1),t[7]||(t[7]=e("span",{class:"px-2 py-0.5 bg-purple-100 text-purple-700 rounded text-xs font-medium"},"Admin",-1))]),e("p",ae,i(v.value.length)+" คน",1)])])])])]),C.value?(o(),r("div",ne,[...t[8]||(t[8]=[e("div",{class:"text-center"},[e("div",{class:"w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e("p",{class:"text-gray-600"},"กำลังโหลดข้อมูล...")],-1)])])):(o(),r("div",re,[v.value.length===0?(o(),r("div",ie,[d(u(c),{icon:"heroicons:user-group",class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t[9]||(t[9]=e("p",{class:"text-gray-500"},"ไม่พบข้อมูลนักเรียน",-1))])):(o(),r("div",de,[(o(!0),r(G,null,J(v.value,l=>(o(),r("div",{key:l.id,class:"bg-white rounded-xl shadow-md overflow-hidden"},[e("div",ue,[e("div",ce,i(l.student_number),1),e("div",pe,[e("div",me,[y(l)?(o(),r("img",{key:0,src:y(l),alt:l.full_name_thai,class:"w-full h-full object-cover"},null,8,fe)):(o(),r("div",_e,[d(u(c),{icon:"heroicons:user",class:"w-8 h-8 text-gray-400"})])),e("label",ge,[d(u(c),{icon:"heroicons:camera",class:"w-6 h-6 text-white"}),e("input",{type:"file",accept:"image/*",class:"hidden",onChange:T=>D(T,l.id)},null,40,ve)])]),e("div",he,[e("p",xe,i(l.full_name_thai||`${l.title_name}${l.first_name_thai} ${l.last_name_thai}`),1),e("p",be,i(x.value)+"/"+i(g.value),1)])])]),e("div",ye,[e("div",we,[e("span",ke,"เลขที่ "+i(l.order_no),1),e("button",{onClick:T=>z(l),class:"px-3 py-1.5 bg-purple-100 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-200 transition-colors"},[d(u(c),{icon:"heroicons:pencil-square",class:"w-4 h-4 inline mr-1"}),t[10]||(t[10]=E(" แก้ไข ",-1))],8,$e)])])]))),128))]))])),(o(),U(W,{to:"body"},[a.value?(o(),r("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",onClick:K(w,["self"])},[e("div",Ce,[e("div",je,[t[11]||(t[11]=e("h2",{class:"text-lg font-bold text-gray-800"},"แก้ไขข้อมูลนักเรียน",-1)),e("button",{onClick:w,class:"p-2 hover:bg-gray-100 rounded-lg"},[d(u(c),{icon:"heroicons:x-mark",class:"w-6 h-6 text-gray-500"})])]),e("div",Se,[e("div",Ne,[e("div",Be,[e("div",Ve,[y(a.value)?(o(),r("img",{key:0,src:y(a.value),alt:a.value.full_name_thai,class:"w-full h-full object-cover"},null,8,De)):(o(),r("div",Te,[d(u(c),{icon:"heroicons:user",class:"w-12 h-12 text-gray-400"})]))]),e("label",Ue,[d(u(c),{icon:"heroicons:camera",class:"w-5 h-5"}),e("input",{type:"file",accept:"image/*",class:"hidden",onChange:t[0]||(t[0]=l=>D(l,a.value.id))},null,32)])]),e("div",null,[e("p",Ee,i(a.value.full_name_thai),1),e("p",Fe,i(x.value)+"/"+i(g.value)+" เลขที่ "+i(a.value.order_no),1)])]),e("div",Ie,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"รหัสนักเรียน",-1)),e("div",Me,[k(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.value.student_number=l),type:"text",class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[S,n.value.student_number]]),e("button",{onClick:t[2]||(t[2]=l=>M(a.value.id)),disabled:p.value,class:"px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 disabled:opacity-50 transition-colors"}," บันทึก ",8,Pe)])]),e("div",ze,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"คำนำหน้า",-1)),k(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>n.value.title_name=l),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"},[...t[13]||(t[13]=[e("option",{value:""},"เลือก",-1),e("option",{value:"นางสาว"},"นางสาว",-1),e("option",{value:"นาย"},"นาย",-1),e("option",{value:"เด็กหญิง"},"เด็กหญิง",-1),e("option",{value:"เด็กชาย"},"เด็กชาย",-1)])],512),[[Q,n.value.title_name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ชื่อ (ไทย)",-1)),k(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.first_name_thai=l),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[S,n.value.first_name_thai]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"นามสกุล (ไทย)",-1)),k(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.last_name_thai=l),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[S,n.value.last_name_thai]])])]),e("div",Ae,[e("button",{onClick:t[6]||(t[6]=l=>I(a.value.id)),disabled:p.value,class:"px-6 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 disabled:opacity-50 transition-colors"},[p.value?(o(),U(u(c),{key:0,icon:"heroicons:arrow-path",class:"w-5 h-5 animate-spin inline mr-2"})):N("",!0),t[17]||(t[17]=E(" บันทึกชื่อ-นามสกุล ",-1))],8,He)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"เลขบัตรประชาชน",-1)),e("input",{value:P(a.value.national_id),type:"text",disabled:"",class:"w-full px-4 py-2 border border-gray-200 rounded-lg bg-gray-50 text-gray-500 font-mono"},null,8,Le)])])])])])):N("",!0)])),j.value?(o(),r("div",qe,[...t[19]||(t[19]=[e("div",{class:"bg-white rounded-xl p-6 text-center"},[e("div",{class:"w-12 h-12 border-4 border-purple-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e("p",{class:"text-gray-600"},"กำลังอัปโหลดรูปภาพ...")],-1)])])):N("",!0)])}}});export{We as default};
