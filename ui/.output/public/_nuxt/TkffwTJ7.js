import{r as g,y as F,n as G,z as O,g as N,w as P,o as r,a as e,c as a,d as v,b as i,u as d,I as c,F as A,T as j,t as p,e as E,k as I,a4 as R,j as q,$ as H,aa as Q}from"./CHs-R6Sv.js";import{S as _}from"./BQxta0Da.js";import J from"./C9_48ukM.js";import"./BLVhfM2G.js";import"./DROJGjoa.js";import"./DJsVOgax.js";import"./Cpj98o6Y.js";import"./C6kxWCFL.js";import"./3QJUtkDr.js";import"./o5TVmNQv.js";import"./BqoYaAWO.js";import"./DI_pZzms.js";const K={class:"mt-4"},W={key:0,class:"flex justify-center items-center h-[40vh]"},X={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden mb-6"},Y={class:"text-center text-white"},Z={class:"text-sm font-medium bg-white/20 px-3 py-1 rounded-full"},ee={class:"p-6"},te={class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"},se={key:0,class:"text-gray-500 dark:text-gray-400"},oe={class:"flex items-center gap-4 mt-4"},re={class:"flex items-center gap-2 text-gray-600 dark:text-gray-300"},ae={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6"},le={class:"flex items-center justify-between mb-6"},ne={class:"text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2"},ie={key:0,class:"space-y-3"},de={class:"flex items-center gap-4"},ce=["src","alt"],ue={class:"font-semibold text-gray-900 dark:text-white"},ge={key:0,class:"flex items-center gap-2"},pe=["value","onChange"],me=["onClick"],ve={key:1,class:"text-center py-12"},he={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},ye={class:"bg-gradient-to-r from-purple-500 to-blue-500 px-6 py-4"},be={class:"text-xl font-bold text-white flex items-center gap-2"},fe={class:"p-6 space-y-4"},xe={class:"relative"},ke={key:0,class:"mt-2 max-h-48 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-xl"},we=["onClick"],_e=["src","alt"],$e={class:"font-medium text-gray-900 dark:text-white"},Ce={key:0,class:"flex items-center gap-3 p-3 bg-purple-50 dark:bg-purple-900/30 rounded-xl"},Ae=["src","alt"],Be={class:"font-medium text-gray-900 dark:text-white"},je={class:"grid grid-cols-3 gap-2"},Ee=["onClick"],Ie={class:"text-sm font-medium"},Te={class:"px-6 py-4 bg-gray-50 dark:bg-gray-700/50 flex justify-end gap-3"},Me=["disabled"],qe={__name:"GroupDetail",props:{academy:Object,isAcademyAdmin:Boolean,groupId:[String,Number]},setup(x){const k=x,h=g(null),u=g([]),B=g(!0),w=g(!1),m=g(""),y=g([]),T=g(!1),n=g(null),$=g("student"),{$api:b}=F(),S=async()=>{try{B.value=!0;const o=await b(`/academies/groups/${k.groupId}`);o.success&&(h.value=o.group)}catch(o){console.error("Error fetching group:",o)}},V=async()=>{try{const o=await b(`/academies/groups/${k.groupId}/members`);o.success&&(u.value=o.members)}catch(o){console.error("Error fetching members:",o)}finally{B.value=!1}},z=async()=>{if(!m.value||m.value.length<2){y.value=[];return}try{T.value=!0;const o=await b(`/api/users/search?q=${m.value}`);if(o.success){const s=u.value.map(t=>t.id);y.value=o.users.filter(t=>!s.includes(t.id))}}catch(o){console.error("Error searching users:",o)}finally{T.value=!1}},D=async()=>{if(n.value)try{(await b(`/academies/groups/${k.groupId}/members`,{method:"POST",body:{user_id:n.value.id,role:$.value}})).success&&(u.value.push({...n.value,pivot:{role:$.value}}),w.value=!1,n.value=null,m.value="",y.value=[],_.fire({icon:"success",title:"เพิ่มสมาชิกสำเร็จ",timer:2e3,showConfirmButton:!1}))}catch(o){console.error("Error adding member:",o),_.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:o.message||"ไม่สามารถเพิ่มสมาชิกได้"})}},L=async o=>{if((await _.fire({icon:"warning",title:"ยืนยันการลบ",text:"คุณต้องการลบสมาชิกคนนี้ออกจากกลุ่มหรือไม่?",showCancelButton:!0,confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก",confirmButtonColor:"#dc2626"})).isConfirmed)try{(await b(`/academies/groups/${k.groupId}/members`,{method:"DELETE",body:{user_id:o}})).success&&(u.value=u.value.filter(l=>l.id!==o),_.fire({icon:"success",title:"ลบสมาชิกสำเร็จ",timer:2e3,showConfirmButton:!1}))}catch(t){console.error("Error removing member:",t)}},U=async(o,s)=>{try{if((await b(`/academies/groups/${k.groupId}/members/role`,{method:"PATCH",body:{user_id:o,role:s}})).success){const l=u.value.find(M=>M.id===o);l&&(l.pivot.role=s),_.fire({icon:"success",title:"อัปเดตบทบาทสำเร็จ",timer:2e3,showConfirmButton:!1})}}catch(t){console.error("Error updating role:",t)}},C=G(()=>{const o={department:{label:"ฝ่ายงาน",icon:"heroicons:briefcase-solid",color:"indigo"},classroom:{label:"ห้องเรียน",icon:"heroicons:academic-cap-solid",color:"cyan"},club:{label:"ชมรม",icon:"heroicons:star-solid",color:"green"}};return o[h.value?.type]||o.classroom}),f={student:{label:"นักเรียน",color:"blue"},teacher:{label:"ครู",color:"purple"},admin:{label:"ผู้ดูแล",color:"red"}};return O(()=>{S(),V()}),(o,s)=>(r(),N(J,{academy:x.academy,isAcademyAdmin:x.isAcademyAdmin},{academyContent:P(()=>[e("div",K,[B.value?(r(),a("div",W,[i(d(c),{icon:"svg-spinners:ring-resize",class:"w-12 h-12 text-purple-500"})])):h.value?(r(),a(A,{key:1},[e("div",X,[e("div",{class:j(["h-32 bg-gradient-to-br flex items-center justify-center",`from-${C.value.color}-400 to-${C.value.color}-600`])},[e("div",Y,[i(d(c),{icon:C.value.icon,class:"w-12 h-12 mx-auto mb-2"},null,8,["icon"]),e("span",Z,p(C.value.label),1)])],2),e("div",ee,[e("h1",te,p(h.value.name),1),h.value.description?(r(),a("p",se,p(h.value.description),1)):v("",!0),e("div",oe,[e("div",re,[i(d(c),{icon:"heroicons:users-solid",class:"w-5 h-5"}),e("span",null,p(u.value.length)+" สมาชิก",1)])])])]),e("div",ae,[e("div",le,[e("h2",ne,[i(d(c),{icon:"heroicons:users-solid",class:"w-6 h-6 text-purple-500"}),s[5]||(s[5]=E(" สมาชิกในกลุ่ม ",-1))]),x.isAcademyAdmin?(r(),a("button",{key:0,onClick:s[0]||(s[0]=t=>w.value=!0),class:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transition-all"},[i(d(c),{icon:"heroicons:user-plus-solid",class:"w-5 h-5"}),s[6]||(s[6]=E(" เพิ่มสมาชิก ",-1))])):v("",!0)]),u.value.length>0?(r(),a("div",ie,[(r(!0),a(A,null,I(u.value,t=>(r(),a("div",{key:t.id,class:"flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[e("div",de,[e("img",{src:t.profile_photo_url||"/images/default-avatar.png",alt:t.name,class:"w-12 h-12 rounded-full object-cover"},null,8,ce),e("div",null,[e("h3",ue,p(t.name),1),e("span",{class:j(["text-xs px-2 py-0.5 rounded-full",`bg-${f[t.pivot?.role||"student"].color}-100 text-${f[t.pivot?.role||"student"].color}-700 dark:bg-${f[t.pivot?.role||"student"].color}-900/30 dark:text-${f[t.pivot?.role||"student"].color}-300`])},p(f[t.pivot?.role||"student"].label),3)])]),x.isAcademyAdmin?(r(),a("div",ge,[e("select",{value:t.pivot?.role||"student",onChange:l=>U(t.id,l.target.value),class:"text-sm border border-gray-200 dark:border-gray-600 rounded-lg px-3 py-1.5 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"},[...s[7]||(s[7]=[e("option",{value:"student"},"นักเรียน",-1),e("option",{value:"teacher"},"ครู",-1),e("option",{value:"admin"},"ผู้ดูแล",-1)])],40,pe),e("button",{onClick:l=>L(t.id),class:"p-2 text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors",title:"ลบสมาชิก"},[i(d(c),{icon:"heroicons:trash-solid",class:"w-5 h-5"})],8,me)])):v("",!0)]))),128))])):(r(),a("div",ve,[i(d(c),{icon:"heroicons:users",class:"w-16 h-16 text-gray-300 dark:text-gray-600 mx-auto mb-4"}),s[8]||(s[8]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ยังไม่มีสมาชิกในกลุ่มนี้",-1))]))])],64)):v("",!0),(r(),N(R,{to:"body"},[w.value?(r(),a("div",{key:0,class:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:s[4]||(s[4]=q(t=>w.value=!1,["self"]))},[e("div",he,[e("div",ye,[e("h3",be,[i(d(c),{icon:"heroicons:user-plus-solid",class:"w-6 h-6"}),s[9]||(s[9]=E(" เพิ่มสมาชิก ",-1))])]),e("div",fe,[e("div",null,[s[10]||(s[10]=e("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ค้นหาผู้ใช้ ",-1)),e("div",xe,[H(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>m.value=t),onInput:z,type:"text",class:"w-full px-4 py-3 pl-10 border border-gray-200 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"พิมพ์ชื่อผู้ใช้..."},null,544),[[Q,m.value]]),i(d(c),{icon:"heroicons:magnifying-glass-solid",class:"w-5 h-5 text-gray-400 absolute left-3 top-1/2 -translate-y-1/2"})]),y.value.length>0?(r(),a("div",ke,[(r(!0),a(A,null,I(y.value,t=>(r(),a("button",{key:t.id,onClick:l=>{n.value=t,m.value=t.name,y.value=[]},class:"w-full flex items-center gap-3 p-3 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[e("img",{src:t.profile_photo_url||"/images/default-avatar.png",alt:t.name,class:"w-10 h-10 rounded-full object-cover"},null,8,_e),e("span",$e,p(t.name),1)],8,we))),128))])):v("",!0)]),n.value?(r(),a("div",Ce,[e("img",{src:n.value.profile_photo_url||"/images/default-avatar.png",alt:n.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Ae),e("span",Be,p(n.value.name),1),e("button",{onClick:s[2]||(s[2]=t=>{n.value=null,m.value=""}),class:"ml-auto p-1 text-gray-400 hover:text-gray-600"},[i(d(c),{icon:"heroicons:x-mark-solid",class:"w-5 h-5"})])])):v("",!0),e("div",null,[s[11]||(s[11]=e("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," บทบาท ",-1)),e("div",je,[(r(),a(A,null,I(f,(t,l)=>e("button",{key:l,onClick:M=>$.value=l,class:j(["flex flex-col items-center p-3 rounded-xl border-2 transition-all",$.value===l?`border-${t.color}-500 bg-${t.color}-50 dark:bg-${t.color}-900/30`:"border-gray-200 dark:border-gray-600 hover:border-gray-300"])},[e("span",Ie,p(t.label),1)],10,Ee)),64))])])]),e("div",Te,[e("button",{onClick:s[3]||(s[3]=t=>w.value=!1),class:"px-4 py-2 text-gray-600 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"}," ยกเลิก "),e("button",{onClick:D,disabled:!n.value,class:"px-6 py-2 bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white font-semibold rounded-lg shadow disabled:opacity-50 disabled:cursor-not-allowed transition-all"}," เพิ่มสมาชิก ",8,Me)])])])):v("",!0)]))])]),_:1},8,["academy","isAcademyAdmin"]))}};export{qe as default};
