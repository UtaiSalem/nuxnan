import{_ as q,r as x,n as L,a3 as B,g as z,b as r,w as F,a1 as G,a4 as P,o as a,c as l,d as m,j as k,a as t,e as _,u as d,I as u,t as f,F as X,k as J,T as M,$ as K,aa as W}from"./cTealXVQ.js";import{S as C}from"./BQxta0Da.js";const Q={class:"px-6 py-4 border-b border-gray-200 bg-white relative"},Y={class:"text-lg font-semibold text-gray-900 flex items-center gap-2 pr-12"},Z={class:"text-sm text-gray-600 mt-1"},ee={class:"relative bg-black",style:{height:"60vh"}},te={key:0,class:"h-full flex items-center justify-center"},se=["src","alt"],oe={class:"absolute bottom-4 left-1/2 -translate-x-1/2 bg-black bg-opacity-75 text-white px-4 py-2 rounded-full text-sm"},ae=["href","download"],ie={key:1,class:"h-full flex items-center justify-center text-white"},le={class:"text-center"},ne={key:0,class:"p-4 bg-gray-100 border-t border-gray-200"},re={class:"flex gap-3 overflow-x-auto pb-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100"},ce=["onClick"],de=["src","alt"],ue={key:0,class:"absolute inset-0 bg-green-500 bg-opacity-30 rounded-lg flex items-center justify-center pointer-events-none"},ge={class:"bg-green-600 rounded-full p-1"},he={class:"absolute top-1 left-1 bg-black bg-opacity-60 text-white text-xs px-2 py-0.5 rounded-full font-medium"},me={key:1,class:"px-6 py-4 bg-white border-t border-gray-200"},fe={class:"flex items-center justify-between"},ve={class:"flex-1"},be={class:"flex items-center gap-2"},pe={key:0},ye={key:2,class:"flex items-center gap-2"},xe=["disabled"],we=["disabled"],ke={class:"text-xs text-gray-500 mt-1"},_e={class:"flex items-center gap-2"},Ce=["disabled"],Ie={__name:"ImageGalleryModal",props:{show:{type:Boolean,default:!1},visit:{type:Object,default:null},images:{type:Array,default:()=>[]}},emits:["close"],setup(n,{emit:N}){const g=n,S=N,o=x(0),h=L(()=>g.images[o.value]),I=L(()=>h.value?w(h.value):"");function w(e){return e?e.image_url?e.image_url:e.image_path?`/storage/${e.image_path.replace(/^public\//,"")}`:"":""}function b(){o.value=0,S("close")}function j(){o.value=o.value>0?o.value-1:g.images.length-1}function D(){o.value=o.value<g.images.length-1?o.value+1:0}function T(e){e.target.src="/images/placeholder.png"}function V(e){return e?new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"}):""}function A(e){return e?new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}async function H(){for(let e=0;e<g.images.length;e++){const s=g.images[e],c=w(s),i=document.createElement("a");i.href=c,i.download=`home_visit_${g.visit?.id}_${e+1}.jpg`,document.body.appendChild(i),i.click(),document.body.removeChild(i),await new Promise($=>setTimeout($,500))}}B(()=>g.show,e=>{e&&(o.value=0)}),B(()=>g.show,e=>{e?document.addEventListener("keydown",E):document.removeEventListener("keydown",E)});function E(e){if(g.show)switch(e.key){case"ArrowLeft":j();break;case"ArrowRight":D();break;case"Escape":b();break}}const p=x(!1),v=x(""),y=x(!1);function O(){v.value=h.value?.description||"",p.value=!0}function R(){p.value=!1,v.value=""}async function U(){if(h.value){y.value=!0;try{const e=h.value.id,c=await(await fetch(`/api/home-visit/image/${e}/update-description`,{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({description:v.value})})).json();c.success?(h.value.description=v.value,await C.fire({title:"สำเร็จ",text:"อัปเดตคำอธิบายรูปภาพเรียบร้อย",icon:"success",timer:1500,showConfirmButton:!1}),p.value=!1):await C.fire({title:"เกิดข้อผิดพลาด",text:c.message||"ไม่สามารถอัปเดตคำอธิบายได้",icon:"error"})}catch(e){await C.fire({title:"เกิดข้อผิดพลาด",text:e.message||"ไม่สามารถอัปเดตคำอธิบายได้",icon:"error"})}finally{y.value=!1}}}return(e,s)=>(a(),z(P,{to:"body"},[r(G,{name:"modal"},{default:F(()=>[n.show?(a(),l("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:k(b,["self"])},[t("div",{class:"fixed inset-0 bg-black bg-opacity-75 transition-opacity",onClick:b}),t("div",{class:"relative min-h-screen flex items-center justify-center p-4",onClick:k(b,["self"])},[t("div",{class:"relative bg-white rounded-lg shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-hidden",onClick:s[2]||(s[2]=k(()=>{},["stop"]))},[t("div",Q,[t("h3",Y,[r(d(u),{icon:"heroicons:photo-20-solid",class:"w-6 h-6 text-green-600"}),s[3]||(s[3]=_(" รูปภาพการเยี่ยมบ้าน ",-1))]),t("p",Z," วันที่ "+f(V(n.visit?.visit_date))+" - "+f(n.images.length)+" รูป ",1),t("button",{onClick:b,class:"absolute top-4 right-4 w-10 h-10 bg-red-600 hover:bg-red-700 text-white rounded-full flex items-center justify-center transition-all hover:scale-110 shadow-lg"},[r(d(u),{icon:"heroicons:x-mark",class:"w-6 h-6"})])]),t("div",ee,[n.images.length>0?(a(),l("div",te,[t("img",{src:I.value,alt:`รูปที่ ${o.value+1}`,class:"max-h-full max-w-full object-contain",onError:T},null,40,se),n.images.length>1?(a(),l("button",{key:0,onClick:j,class:"absolute left-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-800 w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110"},[r(d(u),{icon:"heroicons:chevron-left-20-solid",class:"w-8 h-8"})])):m("",!0),n.images.length>1?(a(),l("button",{key:1,onClick:D,class:"absolute right-4 top-1/2 -translate-y-1/2 bg-white bg-opacity-90 hover:bg-opacity-100 text-gray-800 w-14 h-14 rounded-full flex items-center justify-center shadow-lg transition-all hover:scale-110"},[r(d(u),{icon:"heroicons:chevron-right-20-solid",class:"w-8 h-8"})])):m("",!0),t("div",oe,f(o.value+1)+" / "+f(n.images.length),1),t("a",{href:I.value,download:`home_visit_${n.visit?.id}_${o.value+1}.jpg`,class:"absolute top-4 right-4 bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-lg flex items-center gap-2 shadow-xl transition-all hover:scale-105 font-bold"},[r(d(u),{icon:"heroicons:arrow-down-tray-20-solid",class:"w-6 h-6"}),s[4]||(s[4]=t("span",{class:"text-base"},"ดาวน์โหลด",-1))],8,ae)])):(a(),l("div",ie,[t("div",le,[r(d(u),{icon:"heroicons:photo",class:"w-24 h-24 mb-4 opacity-50"}),s[5]||(s[5]=t("p",{class:"text-lg"},"ไม่มีรูปภาพ",-1))])]))]),n.images.length>1?(a(),l("div",ne,[t("div",re,[(a(!0),l(X,null,J(n.images,(c,i)=>(a(),l("button",{key:i,onClick:$=>o.value=i,class:M(["flex-shrink-0 relative group transition-all",o.value===i?"ring-4 ring-green-500 rounded-lg scale-105":"opacity-60 hover:opacity-100"])},[t("img",{src:w(c),alt:`ภาพย่อที่ ${i+1}`,class:M(["w-28 h-28 object-cover rounded-lg cursor-pointer transition-all border-2",o.value===i?"border-green-500":"border-gray-300 group-hover:border-green-400"]),onError:T},null,42,de),o.value===i?(a(),l("div",ue,[t("div",ge,[r(d(u),{icon:"heroicons:check-20-solid",class:"w-8 h-8 text-white"})])])):m("",!0),t("div",he,f(i+1),1)],10,ce))),128))])])):m("",!0),n.images.length>0&&h.value?(a(),l("div",me,[t("div",fe,[t("div",ve,[t("div",be,[r(d(u),{icon:"heroicons:information-circle-20-solid",class:"w-5 h-5"}),p.value?m("",!0):(a(),l("span",pe,f(h.value.description||"รูปภาพหลักฐานการเยี่ยมบ้าน"),1)),p.value?(a(),l("div",ye,[K(t("input",{"onUpdate:modelValue":s[0]||(s[0]=c=>v.value=c),class:"border px-2 py-1 rounded text-sm",placeholder:"แก้ไขคำอธิบาย..."},null,512),[[W,v.value]]),t("button",{onClick:U,disabled:y.value,class:"px-2 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700"},"บันทึก",8,xe),t("button",{onClick:R,disabled:y.value,class:"px-2 py-1 text-xs bg-gray-300 text-gray-700 rounded hover:bg-gray-400"},"ยกเลิก",8,we)])):(a(),l("button",{key:1,onClick:O,class:"ml-2 px-2 py-1 text-xs bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200"},"แก้ไข"))]),t("p",ke," อัปโหลดเมื่อ: "+f(A(h.value.created_at)),1)]),t("div",_e,[t("button",{onClick:H,class:"px-5 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg transition-colors flex items-center gap-2"},[r(d(u),{icon:"heroicons:arrow-down-tray-20-solid",class:"w-5 h-5"}),s[6]||(s[6]=_(" ดาวน์โหลดทั้งหมด ",-1))]),t("button",{onClick:s[1]||(s[1]=(...c)=>e.confirmDeleteImage&&e.confirmDeleteImage(...c)),disabled:e.deletingImage,class:"px-5 py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded-lg transition-colors flex items-center gap-2"},[r(d(u),{icon:"heroicons:trash-20-solid",class:"w-5 h-5"}),s[7]||(s[7]=_(" ลบรูปนี้ ",-1))],8,Ce)])])])):m("",!0)])])])):m("",!0)]),_:1})]))}},Te=q(Ie,[["__scopeId","data-v-e9882d8d"]]);export{Te as default};
