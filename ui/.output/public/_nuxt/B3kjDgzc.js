import{_ as ne,y as ue,l as ce,r as a,n as de,a3 as P,g as O,o as i,b as d,w as Q,c as v,d as b,a as s,u as o,I as f,t as k,T as E,j as w,e as ve,a1 as W,F as X,k as fe,$ as ge,aa as he,aj as pe,a4 as me}from"./CHs-R6Sv.js";import{u as ke}from"./CaSR6SuD.js";const xe={class:"absolute top-4 left-4 z-10 px-3 py-1.5 bg-black/50 rounded-full text-white text-sm"},be={class:"flex flex-1 h-full"},we=["src"],ye={class:"absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent"},_e={class:"flex items-center justify-between"},Ce={class:"flex items-center gap-4 text-white/80 text-sm"},Le={key:0,class:"flex items-center gap-1.5"},De={class:"flex items-center gap-2"},$e=["disabled"],Ie={class:"text-sm font-medium"},Ae=["disabled"],Be={class:"text-sm font-medium"},Ee={class:"text-sm font-medium"},Me={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},Se={class:"flex-1 overflow-y-auto p-4 space-y-4"},Te={key:0,class:"flex justify-center py-8"},je={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Ne=["src"],ze={class:"flex-1 min-w-0"},Ve={class:"bg-gray-100 dark:bg-vikinger-dark-200 rounded-xl px-3 py-2"},Pe={class:"font-medium text-sm text-gray-800 dark:text-white"},Oe={class:"text-sm text-gray-700 dark:text-gray-300 break-words"},Fe={class:"flex items-center gap-3 mt-1 px-1 text-xs text-gray-500"},Ke=["onClick"],He=["onClick"],Re={key:1,class:"flex justify-center py-2"},Ue={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30"},qe={class:"flex gap-2"},Ge=["src"],Je={class:"flex-1 relative"},Qe=["disabled"],We=["disabled"],Xe={__name:"ImageLightbox",props:{show:{type:Boolean,default:!1},images:{type:Array,default:()=>[]},initialIndex:{type:Number,default:0},postId:{type:[Number,String],default:null}},emits:["close","image-updated"],setup(M,{emit:Y}){const C=M,Z=Y,{$apiFetch:L}=ue(),I=ce(),p=ke(),m=a(0),r=de(()=>C.images[m.value]||null),g=a(!1),h=a(!1),n=a(0),u=a(0),A=a(0),j=a(0),S=a(!1),T=a(!1),D=a(!1),$=a(!1),x=a(!1),c=a([]),y=a(""),N=a(!0),B=a(1);P(()=>C.show,e=>{e?(m.value=C.initialIndex,F()):ee()}),P(m,()=>{F()});const F=()=>{if(!r.value)return;const e=r.value;g.value=e.isLikedByAuth||!1,h.value=e.isDislikedByAuth||!1,n.value=e.likes||0,u.value=e.dislikes||0,A.value=e.comments||0,j.value=e.views||0,c.value=e.image_comments||[],B.value=1,N.value=A.value>c.value.length},ee=()=>{x.value=!1,c.value=[],y.value="",B.value=1},z=()=>{Z("close")},K=()=>{m.value>0&&m.value--},H=()=>{m.value<C.images.length-1&&m.value++},R=e=>{if(C.show)switch(e.key){case"Escape":z();break;case"ArrowLeft":K();break;case"ArrowRight":H();break}};typeof window<"u"&&P(()=>C.show,e=>{e?window.addEventListener("keydown",R):window.removeEventListener("keydown",R)});const te=async()=>{if(!r.value?.id||S.value)return;S.value=!0;const e=g.value,t=h.value;e?(g.value=!1,n.value--):(g.value=!0,n.value++,t&&(h.value=!1,u.value--));try{const l=await L(`/api/post_images/${r.value.id}/like`,{method:"POST"});l.success?I.user&&(I.user.pp=l.user_pp??I.user.pp):(g.value=e,n.value=e?n.value+1:n.value-1,t&&(h.value=!0,u.value++),p.error(l.message||"ไม่สามารถกดถูกใจได้"))}catch(l){console.error("Error liking image:",l),g.value=e,n.value=e?n.value+1:n.value-1,t&&(h.value=!0,u.value++),p.error("เกิดข้อผิดพลาด")}finally{S.value=!1}},se=async()=>{if(!r.value?.id||T.value)return;T.value=!0;const e=g.value,t=h.value;t?(h.value=!1,u.value--):(h.value=!0,u.value++,e&&(g.value=!1,n.value--));try{const l=await L(`/api/post_images/${r.value.id}/dislike`,{method:"POST"});l.success||(h.value=t,u.value=t?u.value+1:u.value-1,e&&(g.value=!0,n.value++),p.error(l.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(l){console.error("Error disliking image:",l),h.value=t,u.value=t?u.value+1:u.value-1,e&&(g.value=!0,n.value++),p.error("เกิดข้อผิดพลาด")}finally{T.value=!1}},le=()=>{x.value=!x.value,x.value&&c.value.length===0&&U()},U=async()=>{if(!(!r.value?.id||D.value)){D.value=!0;try{const e=await L(`/api/postimage/${r.value.id}/comments?page=${B.value}`);if(e.success||e.data){const t=e.data||e.comments||[];B.value===1?c.value=t:c.value=[...c.value,...t],N.value=t.length>=10}}catch(e){console.error("Error loading comments:",e)}finally{D.value=!1}}},ae=()=>{B.value++,U()},q=async()=>{if(!(!y.value.trim()||!r.value?.id||$.value)){$.value=!0;try{const e=await L(`/api/postimage/${r.value.id}/comments`,{method:"POST",body:{content:y.value}});if(e.success){const t=e.comment||e.data;t&&(c.value.unshift(t),A.value++),y.value="",p.toast("แสดงความคิดเห็นสำเร็จ","success")}else p.error(e.message||"ไม่สามารถแสดงความคิดเห็นได้")}catch(e){console.error("Error submitting comment:",e),p.error("เกิดข้อผิดพลาด")}finally{$.value=!1}}},ie=async e=>{if(await p.confirmDelete("ความคิดเห็นนี้"))try{const l=await L(`/api/post_image_comments/${e}`,{method:"DELETE"});l.success?(c.value=c.value.filter(_=>_.id!==e),A.value--,p.toast("ลบความคิดเห็นสำเร็จ","success")):p.error(l.message||"ไม่สามารถลบความคิดเห็นได้")}catch(l){console.error("Error deleting comment:",l),p.error("เกิดข้อผิดพลาด")}},oe=async e=>{try{(await L(`/api/post_image_comments/${e.id}/like`,{method:"POST"})).success&&(e.isLikedByAuth=!e.isLikedByAuth,e.isLikedByAuth?(e.likes=(e.likes||0)+1,e.isDislikedByAuth&&(e.isDislikedByAuth=!1,e.dislikes=Math.max(0,(e.dislikes||0)-1))):e.likes=Math.max(0,(e.likes||0)-1))}catch(t){console.error("Error liking comment:",t)}},re=e=>{if(!e)return"";const t=new Date(e),_=new Date-t,V=Math.floor(_/6e4),G=Math.floor(_/36e5),J=Math.floor(_/864e5);return V<1?"เมื่อสักครู่":V<60?`${V} นาทีที่แล้ว`:G<24?`${G} ชั่วโมงที่แล้ว`:J<7?`${J} วันที่แล้ว`:t.toLocaleDateString("th-TH")};return(e,t)=>(i(),O(me,{to:"body"},[d(W,{name:"fade"},{default:Q(()=>[M.show&&r.value?(i(),v("div",{key:0,class:"fixed inset-0 z-[100] bg-black/95 flex",onClick:w(z,["self"])},[s("button",{class:"absolute top-4 right-4 z-10 p-2 bg-black/50 hover:bg-black/70 rounded-full text-white/80 hover:text-white transition-all",onClick:z},[d(o(f),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6"})]),s("div",xe,k(m.value+1)+" / "+k(M.images.length),1),s("div",be,[s("div",{class:E(["flex-1 flex items-center justify-center relative",x.value?"w-2/3":"w-full"])},[m.value>0?(i(),v("button",{key:0,class:"absolute left-4 z-10 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white/80 hover:text-white transition-all",onClick:w(K,["stop"])},[d(o(f),{icon:"fluent:chevron-left-24-regular",class:"w-8 h-8"})])):b("",!0),s("img",{src:r.value.url||r.value.full_url,class:"max-w-full max-h-full object-contain",onClick:t[0]||(t[0]=w(()=>{},["stop"]))},null,8,we),m.value<M.images.length-1?(i(),v("button",{key:1,class:"absolute right-4 z-10 p-3 bg-black/50 hover:bg-black/70 rounded-full text-white/80 hover:text-white transition-all",onClick:w(H,["stop"])},[d(o(f),{icon:"fluent:chevron-right-24-regular",class:"w-8 h-8"})])):b("",!0),s("div",ye,[s("div",_e,[s("div",Ce,[j.value>0?(i(),v("span",Le,[d(o(f),{icon:"fluent:eye-24-regular",class:"w-4 h-4"}),ve(" "+k(j.value.toLocaleString()),1)])):b("",!0)]),s("div",De,[s("button",{onClick:w(te,["stop"]),disabled:S.value,class:E(["flex items-center gap-2 px-4 py-2 rounded-full transition-all",g.value?"bg-vikinger-purple text-white":"bg-white/10 hover:bg-white/20 text-white"])},[d(o(f),{icon:g.value?"fluent:thumb-like-24-filled":"fluent:thumb-like-24-regular",class:"w-5 h-5"},null,8,["icon"]),s("span",Ie,k(n.value||"ถูกใจ"),1)],10,$e),s("button",{onClick:w(se,["stop"]),disabled:T.value,class:E(["flex items-center gap-2 px-4 py-2 rounded-full transition-all",h.value?"bg-red-500 text-white":"bg-white/10 hover:bg-white/20 text-white"])},[d(o(f),{icon:h.value?"fluent:thumb-dislike-24-filled":"fluent:thumb-dislike-24-regular",class:"w-5 h-5"},null,8,["icon"]),s("span",Be,k(u.value||""),1)],10,Ae),s("button",{onClick:w(le,["stop"]),class:E(["flex items-center gap-2 px-4 py-2 rounded-full transition-all",x.value?"bg-vikinger-cyan text-white":"bg-white/10 hover:bg-white/20 text-white"])},[d(o(f),{icon:"fluent:comment-24-regular",class:"w-5 h-5"}),s("span",Ee,k(A.value||"ความคิดเห็น"),1)],2)])])])],2),d(W,{name:"slide-left"},{default:Q(()=>[x.value?(i(),v("div",{key:0,class:"w-96 bg-white dark:bg-vikinger-dark-300 h-full flex flex-col border-l border-gray-200 dark:border-vikinger-dark-50/30",onClick:t[3]||(t[3]=w(()=>{},["stop"]))},[s("div",Me,[t[4]||(t[4]=s("h3",{class:"font-bold text-gray-800 dark:text-white"},"ความคิดเห็น",-1)),s("button",{onClick:t[1]||(t[1]=l=>x.value=!1),class:"p-1 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(o(f),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5 text-gray-500"})])]),s("div",Se,[D.value&&c.value.length===0?(i(),v("div",Te,[d(o(f),{icon:"fluent:spinner-ios-20-regular",class:"w-6 h-6 animate-spin text-vikinger-purple"})])):c.value.length===0?(i(),v("div",je,[d(o(f),{icon:"fluent:comment-24-regular",class:"w-12 h-12 mx-auto mb-2 opacity-50"}),t[5]||(t[5]=s("p",null,"ยังไม่มีความคิดเห็น",-1)),t[6]||(t[6]=s("p",{class:"text-sm"},"เป็นคนแรกที่แสดงความคิดเห็น!",-1))])):(i(),v(X,{key:2},[(i(!0),v(X,null,fe(c.value,l=>(i(),v("div",{key:l.id,class:"flex gap-3"},[s("img",{src:l.user?.avatar||"https://i.pravatar.cc/40",class:"w-8 h-8 rounded-full object-cover flex-shrink-0"},null,8,Ne),s("div",ze,[s("div",Ve,[s("div",Pe,k(l.user?.name||l.user?.username||"ผู้ใช้"),1),s("p",Oe,k(l.content),1)]),s("div",Fe,[s("span",null,k(re(l.created_at)),1),s("button",{onClick:_=>oe(l),class:E(l.isLikedByAuth?"text-vikinger-purple font-medium":"hover:text-vikinger-purple")}," ถูกใจ "+k(l.likes>0?`(${l.likes})`:""),11,Ke),l.user?.id===o(I).user?.id?(i(),v("button",{key:0,onClick:_=>ie(l.id),class:"text-red-500 hover:text-red-600"}," ลบ ",8,He)):b("",!0)])])]))),128)),N.value&&!D.value?(i(),v("button",{key:0,onClick:ae,class:"w-full py-2 text-sm text-vikinger-purple hover:text-vikinger-purple/80 transition-colors"}," โหลดเพิ่มเติม... ")):b("",!0),D.value?(i(),v("div",Re,[d(o(f),{icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin text-vikinger-purple"})])):b("",!0)],64))]),s("div",Ue,[s("div",qe,[s("img",{src:o(I).user?.avatar||"https://i.pravatar.cc/40",class:"w-8 h-8 rounded-full object-cover flex-shrink-0"},null,8,Ge),s("div",Je,[ge(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>y.value=l),onKeydown:pe(q,["enter"]),type:"text",placeholder:"เขียนความคิดเห็น...",class:"w-full px-4 py-2 pr-10 bg-gray-100 dark:bg-vikinger-dark-200 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-vikinger-purple/50",disabled:$.value},null,40,Qe),[[he,y.value]]),s("button",{onClick:q,disabled:!y.value.trim()||$.value,class:"absolute right-2 top-1/2 -translate-y-1/2 p-1 text-vikinger-purple disabled:opacity-50"},[$.value?(i(),O(o(f),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):(i(),O(o(f),{key:1,icon:"fluent:send-24-filled",class:"w-5 h-5"}))],8,We)])])])])):b("",!0)]),_:1})])])):b("",!0)]),_:1})]))}},et=ne(Xe,[["__scopeId","data-v-8813098c"]]);export{et as I};
