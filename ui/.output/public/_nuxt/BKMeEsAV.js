import{q as N,o,c as r,a as t,T,d as C,n as S,ay as E,a9 as Q,l as G,y as H,b as g,u as n,e as z,F as j,k as I,$ as U,ab as J,aF as R,aa as O,aj as P,r as b,U as V,I as y,t as h}from"./Brb_7992.js";import{S as _}from"./BQxta0Da.js";const W={class:"relative inline-block"},X=["src","alt"],M=N({__name:"BaseAvatar",props:{src:{type:String,default:""},name:{type:String,default:""},alt:{type:String,default:"User Avatar"},size:{type:String,default:"md",validator:m=>["sm","md","lg","xl"].includes(m)},status:{type:String,default:null,validator:m=>[null,"online","offline","busy"].includes(m)}},setup(m){const l=m,f=S(()=>({sm:"w-8 h-8",md:"w-10 h-10",lg:"w-12 h-12",xl:"w-16 h-16"})[l.size]),w=S(()=>{const d={online:"bg-green-500",offline:"bg-gray-400",busy:"bg-red-500"};return l.status?d[l.status]:""}),p=S(()=>{if(l.src)return l.src;if(l.name){const d=["94a3b8","64748b","78716c","6b7280","71717a","737373","a3a3a3","9ca3af","a1a1aa","a8a29e"];let i=0;for(let v=0;v<l.name.length;v++)i=l.name.charCodeAt(v)+((i<<5)-i);const x=Math.abs(i)%d.length,u=d[x];return`https://ui-avatars.com/api/?name=${encodeURIComponent(l.name)}&background=${u}&color=fff&size=128`}return"/images/default-avatar.png"});return(d,i)=>(o(),r("div",W,[t("img",{src:p.value,alt:m.alt,class:T(["rounded-full object-cover border-2 border-white dark:border-gray-800",f.value])},null,10,X),m.status?(o(),r("span",{key:0,class:T(["absolute bottom-0 right-0 block w-3 h-3 rounded-full ring-2 ring-white dark:ring-gray-800",w.value])},null,2)):C("",!0)]))}}),Y={class:"container mx-auto px-4 py-8 max-w-6xl"},Z={class:"flex justify-between items-center mb-6"},ee={class:"text-2xl font-bold flex items-center gap-2"},te={key:0,class:"text-center py-10"},se={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ae={key:0,class:"absolute top-0 right-0 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},ne={key:1,class:"absolute top-0 right-0 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},oe={class:"flex-1 min-w-0"},re={class:"font-semibold text-gray-900 dark:text-gray-100 truncate"},le={class:"text-sm text-gray-500 truncate"},ie={class:"flex items-center gap-2 mt-2"},de=["onClick"],ce={key:0,class:"col-span-full text-center py-10 text-gray-500"},ue={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4"},ge={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]"},me={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center"},ve={class:"p-4 space-y-4"},fe={class:"flex gap-2"},pe={class:"flex-1 overflow-y-auto min-h-[200px] border rounded-lg p-2 bg-gray-50 dark:bg-gray-900/50"},xe={key:0,class:"text-center py-4"},be={key:1,class:"space-y-2"},ye={class:"flex items-center gap-3"},he={class:"font-medium text-sm"},_e={class:"text-xs text-gray-500"},we=["onClick"],ke={key:2,class:"text-center py-4 text-gray-500"},ze=N({__name:"admin",setup(m){const l=E(),f=Q(),w=G(),p=l.params.id;V("isCourseAdmin");const d=b([]),i=b(!0),x=b(!1),u=b(""),v=b([]),$=b(!1),k=b(3),A=async()=>{i.value=!0;try{const s=await f.get(`/api/courses/${p}/admins`);if(s.success){const e=s.admins.map(c=>({...c,status:1})),a=(s.invitations||[]).map(c=>({id:`invite-${c.id}`,user:c.invitee,role:c.role,status:2,is_invitation:!0,invitation_id:c.id}));d.value=[...e,...a]}}catch(s){console.error("Failed to fetch admins",s)}finally{i.value=!1}};H(()=>{A()});const B=async()=>{if(!(u.value.length<2)){$.value=!0;try{const s=await f.post(`/api/courses/${p}/admins/search`,{query:u.value});s.success&&(v.value=s.users)}catch(s){console.error("Search failed",s)}finally{$.value=!1}}},F=async s=>{try{i.value=!0,(await f.post(`/api/courses/${p}/admins/invite`,{user_id:s.id,role:k.value})).success&&(_.fire("สำเร็จ","ส่งคำเชิญเรียบร้อยแล้ว","success"),x.value=!1,u.value="",v.value=[],A())}catch(e){_.fire("ข้อผิดพลาด",e.response?.data?.message||"ไม่สามารถเชิญได้","error")}finally{i.value=!1}},q=async s=>{const e=s.is_invitation,a=e?"ยกเลิกคำเชิญ?":"ยืนยันการลบ?",c=e?`คุณต้องการยกเลิกคำเชิญ "${s.user?.name}"?`:`คุณต้องการลบ "${s.user?.name}" ออกจากผู้ดูแล?`;if((await _.fire({title:a,text:c,icon:"warning",showCancelButton:!0,confirmButtonText:e?"ยกเลิกคำเชิญ":"ลบเลย",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33"})).isConfirmed)try{e?await f.delete(`/api/courses/${p}/admins/invitations/${s.invitation_id}`):await f.delete(`/api/courses/${p}/admins/${s.id}`),_.fire(e?"ยกเลิกสำเร็จ":"ลบสำเร็จ","","success"),A()}catch{_.fire("ผิดพลาด","ไม่สามารถดำเนินการได้","error")}},D=V("course"),K=s=>D?.value?.user_id===s.user_id?"แอดมิน (Admin)":s.role===4?"ผู้ดูแล (Admin)":"ผู้ช่วยสอน (TA)",L=s=>s.user?.avatar?s.user.avatar:w.user?.id===s.user?.id?w.user?.avatar:null;return(s,e)=>(o(),r("div",Y,[t("div",Z,[t("div",null,[t("h1",ee,[g(n(y),{icon:"eos-icons:admin-outlined",class:"text-blue-600"}),e[4]||(e[4]=z(" จัดการผู้ดูแลรายวิชา ",-1))]),e[5]||(e[5]=t("p",{class:"text-gray-500 text-sm mt-1"},"เพิ่มหรือลบผู้ดูแลและผู้ช่วยสอน",-1))]),t("button",{onClick:e[0]||(e[0]=a=>x.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow transition-all"},[g(n(y),{icon:"mdi:plus"}),e[6]||(e[6]=z(" เพิ่มผู้ดูแล ",-1))])]),n(i)&&!n(x)?(o(),r("div",te,[g(n(y),{icon:"svg-spinners:ring-resize",class:"w-10 h-10 mx-auto text-blue-500"})])):(o(),r("div",se,[(o(!0),r(j,null,I(n(d),a=>(o(),r("div",{key:a.id,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center gap-4 relative overflow-hidden"},[a.status===2?(o(),r("div",ae," รอการตอบรับ ")):(o(),r("div",ne,h(K(a)),1)),g(M,{src:L(a),name:a.user?.name,size:"xl"},null,8,["src","name"]),t("div",oe,[t("h3",re,h(a.user?.name||"Unknown"),1),t("p",le,h(a.user?.email),1),t("div",ie,[t("button",{onClick:c=>q(a),class:"text-red-500 hover:text-red-700 text-xs flex items-center gap-1 bg-red-50 px-2 py-1 rounded-md transition-colors"},[g(n(y),{icon:"mdi:trash-can-outline"}),e[7]||(e[7]=z(" ลบ/ยกเลิก ",-1))],8,de)])])]))),128)),n(d).length===0?(o(),r("div",ce," ยังไม่มีผู้ดูแล ")):C("",!0)])),n(x)?(o(),r("div",ue,[t("div",ge,[t("div",me,[e[8]||(e[8]=t("h3",{class:"font-bold text-lg"},"เชิญผู้ดูแล / TA",-1)),t("button",{onClick:e[1]||(e[1]=a=>x.value=!1),class:"text-gray-500 hover:text-gray-700"},[g(n(y),{icon:"mdi:close",class:"w-6 h-6"})])]),t("div",ve,[t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-1"},"ตำแหน่ง",-1)),U(t("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>R(k)?k.value=a:null),class:"w-full border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700"},[...e[9]||(e[9]=[t("option",{value:3},"ผู้ช่วยสอน (TA) - จัดการเนื้อหา/การบ้านได้",-1),t("option",{value:4},"ผู้ดูแลระบบ (Admin) - จัดการทุกอย่างได้",-1)])],512),[[J,n(k)]])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-1"},"ค้นหาผู้ใช้งาน (ชื่อ, อีเมล, รหัสอ้างอิง)",-1)),t("div",fe,[U(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>R(u)?u.value=a:null),onKeyup:P(B,["enter"]),type:"text",class:"flex-1 border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700",placeholder:"พิมพ์ชื่อเพื่อค้นหา..."},null,544),[[O,n(u)]]),t("button",{onClick:B,class:"bg-blue-600 text-white px-4 rounded-lg hover:bg-blue-700"},[g(n(y),{icon:"heroicons:magnifying-glass"})])])]),t("div",pe,[n($)?(o(),r("div",xe,[g(n(y),{icon:"svg-spinners:ring-resize",class:"w-6 h-6 mx-auto text-blue-500"})])):n(v).length>0?(o(),r("div",be,[(o(!0),r(j,null,I(n(v),a=>(o(),r("div",{key:a.id,class:"flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded shadow-sm hover:shadow-md transition-shadow"},[t("div",ye,[g(M,{src:a.avatar,name:a.name,size:"md"},null,8,["src","name"]),t("div",null,[t("p",he,h(a.name),1),t("p",_e,h(a.email),1)])]),t("button",{onClick:c=>F(a),class:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors"}," เชิญ ",8,we)]))),128))])):n(u).length>1?(o(),r("div",ke," ไม่พบผู้ใช้งาน ")):C("",!0)])])])])):C("",!0)]))}});export{ze as default};
