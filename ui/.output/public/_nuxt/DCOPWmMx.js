import{r as m,c as n,h as g,a as e,d as V,$ as v,ab as z,aa as w,e as c,F as L,k as H,t as p,o as l}from"./cTealXVQ.js";import{r as F}from"./DUwVLjCh.js";const D={class:"bg-white rounded-lg sm:rounded-xl shadow-sm border border-gray-200 overflow-hidden"},S={class:"p-4 sm:p-6 bg-gradient-to-br from-amber-50 to-yellow-50"},U={class:"space-y-6"},$={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6"},O={class:"space-y-2"},q={class:"space-y-2"},A={class:"space-y-2"},R={class:"border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-6 text-center hover:border-amber-400 transition-colors"},E={class:"space-y-2"},N={class:"text-sm sm:text-base text-gray-600"},G={key:0,class:"space-y-3"},P={class:"space-y-2"},T={class:"flex items-center min-w-0 flex-1"},I={class:"ml-3 min-w-0 flex-1"},J={class:"text-sm font-medium text-gray-900 truncate"},K={class:"text-xs text-gray-500"},X={class:"flex items-center space-x-2 ml-3"},Q=["onClick"],W=["onClick"],Y=["onClick"],Z={class:"space-y-2"},ee={class:"px-4 py-4 sm:px-6 sm:py-6 bg-gray-50 border-t border-gray-200"},te={class:"flex justify-between items-center"},se={class:"text-xs sm:text-sm text-gray-500"},oe={key:0,class:"flex items-center"},re={key:1,class:"flex items-center text-green-600"},ne={key:2,class:"flex items-center text-red-600"},le={key:3},ae=["disabled"],ie={key:0,class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},de={key:1,class:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},me={__name:"DocumentsCard",props:{student:{type:Object,required:!0},isLoading:{type:Boolean,default:!1}},emits:["save","update"],setup(k,{emit:y}){const h=k,x=y,r=m({documents:{document_type:"birth_certificate",document_name:"",notes:"",is_required:!1}}),d=m(!1),i=m(null),a=m([]),b=s=>{Array.from(s.target.files).forEach(o=>{o.size<=10*1024*1024?a.value.push(o):alert(`ไฟล์ ${o.name} มีขนาดเกิน 10MB`)}),s.target.value=""},_=s=>{a.value.splice(s,1)},C=s=>{if(s===0)return"0 Bytes";const t=1024,o=["Bytes","KB","MB","GB"],u=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,u)).toFixed(2))+" "+o[u]},M=s=>{const t=URL.createObjectURL(s);window.open(t,"_blank")},B=s=>{const t=URL.createObjectURL(s),o=document.createElement("a");o.href=t,o.download=s.name,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)},j=async()=>{d.value=!0,i.value=null;try{const s=new FormData;s.append("student_id",h.student?.student_id||h.student?.id),s.append("document_type",r.value.documents.document_type||""),s.append("document_name",r.value.documents.document_name||""),s.append("notes",r.value.documents.notes||""),s.append("is_required",r.value.documents.is_required||!1),a.value.forEach((t,o)=>{s.append(`files[${o}]`,t)}),await F.post(route("homevisit.student.update.documents"),s,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{i.value="success",x("save",{success:!0,type:"documents",data:{document_type:r.value.documents.document_type,document_name:r.value.documents.document_name,notes:r.value.documents.notes,is_required:r.value.documents.is_required,files:a.value}}),a.value=[],setTimeout(()=>{i.value=null},3e3)},onError:t=>{i.value="error",x("save",{success:!1,type:"documents",message:Object.values(t).join(", ")}),console.error("Save errors:",t)}})}catch(s){i.value="error",console.error("Save error:",s)}finally{d.value=!1}};return(s,t)=>(l(),n("div",D,[t[22]||(t[22]=g('<div class="bg-gradient-to-r from-amber-500 to-yellow-600 px-4 py-3 sm:px-6 sm:py-4"><div class="flex items-center"><div class="w-7 h-7 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div><div class="ml-2 sm:ml-3 min-w-0 flex-1"><h3 class="text-base sm:text-lg font-semibold text-white truncate"> เอกสารประกอบ (ตาราง student_documents) </h3><p class="text-amber-100 text-xs sm:text-sm">เอกสารและไฟล์แนบของนักเรียน</p></div></div></div>',1)),e("div",S,[e("div",U,[e("div",$,[e("div",O,[t[5]||(t[5]=e("label",{class:"flex items-center text-xs sm:text-sm font-medium text-gray-700"},[e("svg",{class:"w-3 h-3 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a2 2 0 012-2z"})]),e("span",{class:"truncate"},"ประเภทเอกสาร")],-1)),v(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>r.value.documents.document_type=o),class:"w-full px-3 py-2.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors text-sm sm:text-base touch-manipulation placeholder-gray-400"},[...t[4]||(t[4]=[g('<option value="birth_certificate">สูติบัตร</option><option value="id_card">สำเนาบัตรประชาชน</option><option value="house_registration">สำเนาทะเบียนบ้าน</option><option value="transcript">ใบรายงานผลการเรียน</option><option value="medical_certificate">ใบรับรองแพทย์</option><option value="vaccination_record">บันทึกการฉีดวัคซีน</option><option value="guardian_id">สำเนาบัตรประชาชนผู้ปกครอง</option><option value="other">อื่นๆ</option>',8)])],512),[[z,r.value.documents.document_type]])]),e("div",q,[t[6]||(t[6]=e("label",{class:"flex items-center text-xs sm:text-sm font-medium text-gray-700"},[e("svg",{class:"w-3 h-3 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),e("span",{class:"truncate"},"ชื่อเอกสาร")],-1)),v(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=o=>r.value.documents.document_name=o),class:"w-full px-3 py-2.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors text-sm sm:text-base touch-manipulation placeholder-gray-400",placeholder:"กรอกชื่อเอกสาร"},null,512),[[w,r.value.documents.document_name]])])]),e("div",A,[t[10]||(t[10]=e("label",{class:"flex items-center text-xs sm:text-sm font-medium text-gray-700"},[e("svg",{class:"w-3 h-3 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})]),e("span",{class:"truncate"},"อัพโหลดไฟล์")],-1)),e("div",R,[e("input",{type:"file",onChange:b,multiple:"",accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",class:"hidden",ref:"fileInput"},null,544),e("div",E,[t[8]||(t[8]=e("svg",{class:"mx-auto h-8 w-8 sm:h-12 sm:w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48"},[e("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)),e("div",N,[e("button",{type:"button",onClick:t[2]||(t[2]=o=>s.$refs.fileInput.click()),class:"font-medium text-amber-600 hover:text-amber-500 transition-colors"}," คลิกเพื่อเลือกไฟล์ "),t[7]||(t[7]=e("span",{class:"hidden sm:inline"}," หรือลากไฟล์มาวางที่นี่",-1))]),t[9]||(t[9]=e("p",{class:"text-xs sm:text-sm text-gray-500"}," PDF, JPG, PNG, DOC, DOCX (สูงสุด 10MB) ",-1))])])]),a.value.length>0?(l(),n("div",G,[t[15]||(t[15]=e("h4",{class:"text-sm sm:text-base font-medium text-gray-700 flex items-center"},[e("svg",{class:"w-4 h-4 mr-2 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),c(" ไฟล์ที่อัพโหลด ")],-1)),e("div",P,[(l(!0),n(L,null,H(a.value,(o,u)=>(l(),n("div",{key:u,class:"flex items-center justify-between p-3 bg-white border border-gray-200 rounded-lg"},[e("div",T,[t[11]||(t[11]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),e("div",I,[e("p",J,p(o.name),1),e("p",K,p(C(o.size)),1)])]),e("div",X,[e("button",{type:"button",onClick:f=>M(o),class:"p-1.5 text-blue-600 hover:text-blue-500 transition-colors",title:"ดูไฟล์"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])],8,Q),e("button",{type:"button",onClick:f=>B(o),class:"p-1.5 text-green-600 hover:text-green-500 transition-colors",title:"ดาวน์โหลด"},[...t[13]||(t[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])],8,W),e("button",{type:"button",onClick:f=>_(u),class:"p-1.5 text-red-600 hover:text-red-500 transition-colors",title:"ลบไฟล์"},[...t[14]||(t[14]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Y)])]))),128))])])):V("",!0),e("div",Z,[t[16]||(t[16]=e("label",{class:"flex items-center text-xs sm:text-sm font-medium text-gray-700"},[e("svg",{class:"w-3 h-3 sm:w-4 sm:h-4 mr-1.5 sm:mr-2 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})]),e("span",{class:"truncate"},"หมายเหตุ")],-1)),v(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=o=>r.value.documents.notes=o),rows:"3",class:"w-full px-3 py-2.5 sm:py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition-colors text-sm sm:text-base touch-manipulation resize-none",placeholder:"หมายเหตุเพิ่มเติมเกี่ยวกับเอกสาร"},null,512),[[w,r.value.documents.notes]])])]),e("div",ee,[e("div",te,[e("div",se,[d.value?(l(),n("span",oe,[...t[17]||(t[17]=[e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-amber-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),c(" กำลังบันทึก... ",-1)])])):i.value==="success"?(l(),n("span",re,[...t[18]||(t[18]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),c(" บันทึกสำเร็จ ",-1)])])):i.value==="error"?(l(),n("span",ne,[...t[19]||(t[19]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),c(" เกิดข้อผิดพลาด ",-1)])])):(l(),n("span",le,"เอกสารและไฟล์แนบ ("+p(a.value.length)+" ไฟล์)",1))]),e("button",{type:"button",onClick:j,disabled:d.value,class:"inline-flex items-center px-4 py-2 sm:px-6 sm:py-2.5 bg-amber-600 text-white text-sm sm:text-base font-medium rounded-lg hover:bg-amber-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-amber-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors touch-manipulation placeholder-gray-400"},[d.value?(l(),n("svg",de,[...t[21]||(t[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 714 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(l(),n("svg",ie,[...t[20]||(t[20]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h8m0 0h2a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4 0V5a2 2 0 011-1h4a2 2 0 011 1v2M8 7V5a2 2 0 011-1h4a2 2 0 011 1v2m0 0v4m0 0h-4m4 0V9H8v4z"},null,-1)])])),c(" "+p(d.value?"กำลังบันทึก...":"บันทึกเอกสาร"),1)],8,ae)])])])]))}};export{me as default};
