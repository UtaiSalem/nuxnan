import{l as $,n as u,r as p,p as E}from"./CHs-R6Sv.js";const k=()=>{const r=$(),h=E(),l=u(()=>h.public.apiBase||""),n=p(!1),a=p(null),s=u(()=>r.points),i=u(()=>r.user),d=async()=>{try{n.value=!0,a.value=null;const e=await $fetch(`${l.value}/api/points/balance`,{method:"GET",headers:{Authorization:`Bearer ${r.token}`}});if(e.success)return e.data&&r.setPoints(e.data.current_points||0),e.data;throw new Error(e.message||"Failed to get points balance")}catch(e){throw a.value=e.message||"Failed to get points balance",console.error("Get points balance error:",e),e}finally{n.value=!1}},f=async e=>{try{n.value=!0,a.value=null;const t=await $fetch(`${l.value}/api/points/earn`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`},body:e});if(t.success)return t.data&&r.addPoints(t.data.points_earned||0),t.data.achievements_unlocked&&t.data.achievements_unlocked.length>0&&t.data.achievements_unlocked.forEach(o=>{_(o)}),t.data;throw new Error(t.message||"Failed to earn points")}catch(t){throw a.value=t.message||"Failed to earn points",console.error("Earn points error:",t),e.amount&&r.rollback(e.amount),t}finally{n.value=!1}},v=async e=>{try{if(n.value=!0,a.value=null,s.value<e.amount)throw new Error(`‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${e.amount} ‡πÅ‡∏ï‡πâ‡∏°, ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ${s.value} ‡πÅ‡∏ï‡πâ‡∏°)`);if(!r.deductPoints(e.amount))throw new Error("‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");const o=await $fetch(`${l.value}/api/points/spend`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`},body:e});if(o.success)return o.data;throw r.rollback(e.amount),new Error(o.message||"Failed to spend points")}catch(t){throw a.value=t.message||"Failed to spend points",console.error("Spend points error:",t),t}finally{n.value=!1}},g=async e=>{try{if(n.value=!0,a.value=null,s.value<e)throw new Error(`‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${e} ‡πÅ‡∏ï‡πâ‡∏°, ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ${s.value} ‡πÅ‡∏ï‡πâ‡∏°)`);const o=e/1200;if(!r.deductPoints(e))throw new Error("‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");const c=await $fetch(`${l.value}/api/points/convert`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`},body:{points:e,target:"wallet"}});if(c.success)return c.data&&r.setPoints(c.data.new_points_balance||0),c.data;throw r.rollback(e),new Error(c.message||"Failed to convert points")}catch(t){throw a.value=t.message||"Failed to convert points",console.error("Convert points error:",t),t}finally{n.value=!1}},w=async e=>{try{if(n.value=!0,a.value=null,e.amount<=0)throw new Error("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0");if(s.value<e.amount)throw new Error(`‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ (‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ ${e.amount} ‡πÅ‡∏ï‡πâ‡∏°, ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ${s.value} ‡πÅ‡∏ï‡πâ‡∏°)`);if(e.recipient_id===r.user?.id)throw new Error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ");if(!r.deductPoints(e.amount))throw new Error("‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠");const o=await $fetch(`${l.value}/api/points/transfer`,{method:"POST",headers:{Authorization:`Bearer ${r.token}`},body:{recipient_id:e.recipient_id,amount:e.amount,message:e.message||""}});if(o.success)return o.data&&r.setPoints(o.data.new_balance||s.value-e.amount),o.data;throw r.rollback(e.amount),new Error(o.message||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏î‡πâ")}catch(t){throw a.value=t.message||"‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏î‡πâ",console.error("Transfer points error:",t),t}finally{n.value=!1}},m=async(e={})=>{try{n.value=!0,a.value=null;const t=new URLSearchParams;e.type&&t.append("type",e.type),e.source_type&&t.append("source_type",e.source_type),e.date_from&&t.append("date_from",e.date_from),e.date_to&&t.append("date_to",e.date_to),e.page&&t.append("page",e.page.toString()),e.per_page&&t.append("per_page",e.per_page.toString());const o=await $fetch(`${l.value}/api/points/transactions?${t.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${r.token}`}});if(o.success)return o.data;throw new Error(o.message||"Failed to get transactions")}catch(t){throw a.value=t.message||"Failed to get transactions",console.error("Get transactions error:",t),t}finally{n.value=!1}},y=e=>new Intl.NumberFormat("th-TH").format(e),_=e=>{const t=window.Swal;typeof t<"u"&&t.fire({icon:"success",title:"üéâ ‡∏ö‡∏£‡∏£‡∏•‡∏∏‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",html:`
          <div style="text-align: center;">
            <img src="${e.icon||"/icons/achievement.png"}" style="width: 64px; height: 64px; margin-bottom: 10px;">
            <h3 style="margin: 0 0 10px 0;">${e.name}</h3>
            <p style="margin: 0 0 10px 0; color: #666;">${e.description||""}</p>
            ${e.points_reward?`<p style="margin: 0; font-weight: bold; color: #10b981;">+${e.points_reward} ‡πÅ‡∏ï‡πâ‡∏°</p>`:""}
          </div>
        `,confirmButtonText:"‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö",confirmButtonColor:"#10b981"})};return{points:s,user:i,isLoading:n,error:a,getBalance:d,earn:f,spend:v,transfer:w,convertToWallet:g,getTransactions:m,formatPoints:y,canSpend:e=>s.value>=e,getPointsForNextLevel:()=>i.value?(i.value.xp_for_next_level||0)-(i.value.current_xp||0):0,getLevelProgress:()=>{if(!i.value)return 0;const e=i.value.xp_for_next_level||100,t=i.value.current_xp||0;return Math.round(t/e*100)}}};export{k as u};
