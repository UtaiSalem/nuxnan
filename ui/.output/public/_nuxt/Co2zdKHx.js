import{_ as F}from"./DROJGjoa.js";import{q as A,p as I,v as L,ay as R,r as k,V as E,z as O,c as n,a as e,b as p,w as U,t as i,u as c,F as h,d as b,$ as d,e as y,aa as g,T as f,ab as C,k as $,ai as q,g as B,j as H,aH as T,o as l,I as m}from"./CHs-R6Sv.js";const P={class:"space-y-6 max-w-2xl mx-auto"},G={class:"flex items-center gap-4"},J={class:"text-gray-500 dark:text-gray-400 mt-1"},K={key:0,class:"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-100 dark:border-gray-700"},Q={class:"text-center"},W={key:0,class:"p-4 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-xl"},X={class:"flex items-center gap-2 text-green-700 dark:text-green-400"},Y={key:1,class:"p-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-xl"},Z={class:"flex items-center gap-2 text-red-700 dark:text-red-400"},ee={key:0,class:"mt-1 text-sm text-red-500"},te={key:0,class:"mt-1 text-sm text-red-500"},re={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ae=["value"],oe={class:"relative"},se={class:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"},le={key:0,class:"mt-1 text-sm text-red-500"},de={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ne={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ie={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ue={key:0,class:"mt-1 text-sm text-red-500"},ge={key:0,class:"mt-1 text-sm text-red-500"},ce=["value"],pe={class:"p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl"},be={class:"flex items-center gap-3 cursor-pointer"},ye={class:"flex flex-col sm:flex-row gap-3 pt-4"},me=["disabled"],we=A({__name:"edit",setup(xe){const V=I().public.apiBase,M=L(),_=R().params.id,w=k(!0),x=k(!1),o=k({}),v=k(""),r=E({code:"",name:"",description:"",discount_type:"percentage",discount_value:0,min_purchase:0,max_discount:0,usage_limit:null,per_user_limit:1,start_date:"",end_date:"",is_active:!0,applicable_to:"all"}),S=[{value:"percentage",label:"เปอร์เซ็นต์ (%)"},{value:"fixed",label:"จำนวนเงิน (บาท)"}],j=[{value:"all",label:"ทุกสินค้า/บริการ"},{value:"courses",label:"เฉพาะคอร์สเรียน"},{value:"products",label:"เฉพาะสินค้า"}],z=async()=>{w.value=!0;try{const u=T("token"),t=await $fetch(`${V}/api/admin/coupons/${_}`,{headers:{Authorization:`Bearer ${u.value}`}});if(t.success){const s=t.data;r.code=s.code||"",r.name=s.name||"",r.description=s.description||"",r.discount_type=s.discount_type||"percentage",r.discount_value=s.discount_value||0,r.min_purchase=s.min_purchase||0,r.max_discount=s.max_discount||0,r.usage_limit=s.usage_limit,r.per_user_limit=s.per_user_limit||1,r.start_date=s.start_date?s.start_date.slice(0,16):"",r.end_date=s.end_date?s.end_date.slice(0,16):"",r.is_active=s.is_active??!0,r.applicable_to=s.applicable_to||"all"}}catch(u){console.error("Failed to fetch coupon:",u),o.value.general="ไม่สามารถโหลดข้อมูลคูปองได้"}finally{w.value=!1}},N=()=>(o.value={},r.code||(o.value.code="กรุณากรอกรหัสคูปอง"),r.name||(o.value.name="กรุณากรอกชื่อคูปอง"),r.discount_value<=0&&(o.value.discount_value="กรุณากรอกมูลค่าส่วนลด"),r.discount_type==="percentage"&&r.discount_value>100&&(o.value.discount_value="เปอร์เซ็นต์ต้องไม่เกิน 100"),r.start_date||(o.value.start_date="กรุณาเลือกวันที่เริ่มต้น"),r.end_date||(o.value.end_date="กรุณาเลือกวันที่สิ้นสุด"),r.start_date&&r.end_date&&new Date(r.start_date)>new Date(r.end_date)&&(o.value.end_date="วันที่สิ้นสุดต้องหลังจากวันที่เริ่มต้น"),Object.keys(o.value).length===0),D=async()=>{if(N()){x.value=!0,v.value="";try{const u=T("token");(await $fetch(`${V}/api/admin/coupons/${_}`,{method:"PUT",headers:{Authorization:`Bearer ${u.value}`,"Content-Type":"application/json"},body:r})).success&&(v.value="บันทึกคูปองสำเร็จ",setTimeout(()=>{M.push("/nuxnan-admin/coupons")},1500))}catch(u){u.data?.errors?o.value=u.data.errors:o.value.general=u.data?.message||"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง"}finally{x.value=!1}}};return O(()=>{z()}),(u,t)=>{const s=F;return l(),n("div",P,[e("div",G,[p(s,{to:"/nuxnan-admin/coupons",class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors"},{default:U(()=>[p(c(m),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"})]),_:1}),e("div",null,[t[13]||(t[13]=e("h1",{class:"text-2xl font-bold text-gray-800 dark:text-white"},"แก้ไขคูปอง",-1)),e("p",J,"แก้ไขข้อมูลคูปอง #"+i(c(_)),1)])]),w.value?(l(),n("div",K,[e("div",Q,[p(c(m),{icon:"fluent:spinner-ios-20-regular",class:"w-8 h-8 text-indigo-600 animate-spin mx-auto"}),t[14]||(t[14]=e("p",{class:"text-gray-500 mt-2"},"กำลังโหลดข้อมูล...",-1))])])):(l(),n(h,{key:1},[v.value?(l(),n("div",W,[e("div",X,[p(c(m),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5"}),e("span",null,i(v.value),1)])])):b("",!0),o.value.general?(l(),n("div",Y,[e("div",Z,[p(c(m),{icon:"fluent:error-circle-24-filled",class:"w-5 h-5"}),e("span",null,i(o.value.general),1)])])):b("",!0),e("form",{onSubmit:H(D,["prevent"]),class:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 space-y-6"},[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" รหัสคูปอง "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>r.code=a),type:"text",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent uppercase",{"border-red-500":o.value.code}]),placeholder:"SAVE20"},null,2),[[g,r.code]]),o.value.code?(l(),n("p",ee,i(o.value.code),1)):b("",!0)]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" ชื่อคูปอง "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>r.name=a),type:"text",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":o.value.name}]),placeholder:"ส่วนลด 20% สำหรับสมาชิกใหม่"},null,2),[[g,r.name]]),o.value.name?(l(),n("p",te,i(o.value.name),1)):b("",!0)]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," คำอธิบาย ",-1)),d(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=a=>r.description=a),rows:"3",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none",placeholder:"รายละเอียดเพิ่มเติมของคูปอง"},null,512),[[g,r.description]])]),e("div",re,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ประเภทส่วนลด ",-1)),d(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>r.discount_type=a),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"},[(l(),n(h,null,$(S,a=>e("option",{key:a.value,value:a.value},i(a.label),9,ae)),64))],512),[[C,r.discount_type]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" มูลค่าส่วนลด "),e("span",{class:"text-red-500"},"*")],-1)),e("div",oe,[d(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>r.discount_value=a),type:"number",min:"0",class:f(["w-full px-4 py-2.5 pr-10 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":o.value.discount_value}])},null,2),[[g,r.discount_value,void 0,{number:!0}]]),e("span",se,i(r.discount_type==="percentage"?"%":"฿"),1)]),o.value.discount_value?(l(),n("p",le,i(o.value.discount_value),1)):b("",!0)])]),e("div",de,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ยอดสั่งซื้อขั้นต่ำ (บาท) ",-1)),d(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>r.min_purchase=a),type:"number",min:"0",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0"},null,512),[[g,r.min_purchase,void 0,{number:!0}]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ส่วนลดสูงสุด (บาท) ",-1)),d(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>r.max_discount=a),type:"number",min:"0",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0 = ไม่จำกัด"},null,512),[[g,r.max_discount,void 0,{number:!0}]])])]),e("div",ne,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," จำนวนใช้งานทั้งหมด ",-1)),d(e("input",{"onUpdate:modelValue":t[7]||(t[7]=a=>r.usage_limit=a),type:"number",min:"0",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"ไม่จำกัด"},null,512),[[g,r.usage_limit,void 0,{number:!0}]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," จำกัดต่อผู้ใช้ ",-1)),d(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>r.per_user_limit=a),type:"number",min:"1",class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},null,512),[[g,r.per_user_limit,void 0,{number:!0}]])])]),e("div",ie,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" วันที่เริ่มต้น "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[9]||(t[9]=a=>r.start_date=a),type:"datetime-local",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":o.value.start_date}])},null,2),[[g,r.start_date]]),o.value.start_date?(l(),n("p",ue,i(o.value.start_date),1)):b("",!0)]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[y(" วันที่สิ้นสุด "),e("span",{class:"text-red-500"},"*")],-1)),d(e("input",{"onUpdate:modelValue":t[10]||(t[10]=a=>r.end_date=a),type:"datetime-local",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":o.value.end_date}])},null,2),[[g,r.end_date]]),o.value.end_date?(l(),n("p",ge,i(o.value.end_date),1)):b("",!0)])]),e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ใช้ได้กับ ",-1)),d(e("select",{"onUpdate:modelValue":t[11]||(t[11]=a=>r.applicable_to=a),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"},[(l(),n(h,null,$(j,a=>e("option",{key:a.value,value:a.value},i(a.label),9,ce)),64))],512),[[C,r.applicable_to]])]),e("div",pe,[e("label",be,[d(e("input",{"onUpdate:modelValue":t[12]||(t[12]=a=>r.is_active=a),type:"checkbox",class:"w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[q,r.is_active]]),t[27]||(t[27]=e("span",{class:"text-gray-700 dark:text-gray-300"},"เปิดใช้งาน",-1))])]),e("div",ye,[e("button",{type:"submit",disabled:x.value,class:"flex-1 inline-flex justify-center items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 rounded-xl text-white font-medium transition-colors"},[x.value?(l(),B(c(m),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):(l(),B(c(m),{key:1,icon:"fluent:save-24-regular",class:"w-5 h-5"})),y(" "+i(x.value?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"),1)],8,me),p(s,{to:"/nuxnan-admin/coupons",class:"flex-1 inline-flex justify-center items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl text-gray-700 dark:text-gray-300 font-medium transition-colors"},{default:U(()=>[p(c(m),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"}),t[28]||(t[28]=y(" ยกเลิก ",-1))]),_:1})])],32)],64))])}}});export{we as default};
