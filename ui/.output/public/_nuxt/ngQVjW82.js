import{l as h,p as m,r as d,n as g}from"./DvtEeXFW.js";const P=()=>{const s=h(),n=m().public.apiBase,r=d(!1),t=d(null),i=d([]),c=d([]),u=g(()=>s.points),w=g(()=>s.user),f=async(a={})=>{try{r.value=!0,t.value=null;const e=new URLSearchParams;a.type&&e.append("type",a.type),a.is_active!==void 0&&e.append("is_active",a.is_active.toString()),a.page&&e.append("page",a.page.toString()),a.per_page&&e.append("per_page",a.per_page.toString());const o=await $fetch(`${n}/api/rewards?${e.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${s.token}`}});if(o.success)return i.value=o.data.rewards||o.data,o.data;throw new Error(o.message||"Failed to get rewards")}catch(e){throw t.value=e.message||"Failed to get rewards",console.error("Get rewards error:",e),e}finally{r.value=!1}},p=async a=>{try{r.value=!0,t.value=null;const e=await $fetch(`${n}/api/rewards/${a}`,{method:"GET",headers:{Authorization:`Bearer ${s.token}`}});if(e.success)return e.data;throw new Error(e.message||"Failed to get reward")}catch(e){throw t.value=e.message||"Failed to get reward",console.error("Get reward error:",e),e}finally{r.value=!1}},l=async(a={})=>{try{r.value=!0,t.value=null;const e=new URLSearchParams;a.status&&e.append("status",a.status),a.page&&e.append("page",a.page.toString()),a.per_page&&e.append("per_page",a.per_page.toString());const o=await $fetch(`${n}/api/rewards/my?${e.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${s.token}`}});if(o.success)return c.value=o.data.rewards||o.data,o.data;throw new Error(o.message||"Failed to get user rewards")}catch(e){throw t.value=e.message||"Failed to get user rewards",console.error("Get user rewards error:",e),e}finally{r.value=!1}};return{rewards:i,userRewards:c,points:u,user:w,isLoading:r,error:t,getRewards:f,getReward:p,getMyRewards:l,redeemReward:async a=>{try{r.value=!0,t.value=null;const e=await $fetch(`${n}/api/rewards/redeem`,{method:"POST",headers:{Authorization:`Bearer ${s.token}`},body:{reward_id:a}});if(e.success)return e.data.new_points_balance!==void 0&&s.setPoints(e.data.new_points_balance),await l(),e.data;throw new Error(e.message||"Failed to redeem reward")}catch(e){throw t.value=e.message||"Failed to redeem reward",console.error("Redeem reward error:",e),e}finally{r.value=!1}},claimReward:async a=>{try{r.value=!0,t.value=null;const e=await $fetch(`${n}/api/rewards/${a}/claim`,{method:"POST",headers:{Authorization:`Bearer ${s.token}`}});if(e.success)return await l(),e.data;throw new Error(e.message||"Failed to claim reward")}catch(e){throw t.value=e.message||"Failed to claim reward",console.error("Claim reward error:",e),e}finally{r.value=!1}},cancelReward:async a=>{try{r.value=!0,t.value=null;const e=await $fetch(`${n}/api/rewards/${a}/cancel`,{method:"POST",headers:{Authorization:`Bearer ${s.token}`}});if(e.success)return e.data.new_points_balance!==void 0&&s.setPoints(e.data.new_points_balance),await l(),e.data;throw new Error(e.message||"Failed to cancel reward")}catch(e){throw t.value=e.message||"Failed to cancel reward",console.error("Cancel reward error:",e),e}finally{r.value=!1}},getStats:async()=>{try{r.value=!0,t.value=null;const a=await $fetch(`${n}/api/rewards/stats`,{method:"GET",headers:{Authorization:`Bearer ${s.token}`}});if(a.success)return a.data;throw new Error(a.message||"Failed to get reward stats")}catch(a){throw t.value=a.message||"Failed to get reward stats",console.error("Get reward stats error:",a),a}finally{r.value=!1}},canRedeem:a=>{if(u.value<a.points_required||!a.is_active||a.is_limited&&a.quantity_redeemed>=a.quantity_available)return!1;const e=new Date;return!(a.start_date&&new Date(a.start_date)>e||a.end_date&&new Date(a.end_date)<e)},getTypeLabel:a=>({wallet:"เงินเข้ากระเป๋า",badge:"เหรียญตรา",feature:"ฟีเจอร์พิเศษ",discount:"ส่วนลด"})[a]||a,getTypeIcon:a=>({wallet:"mdi:wallet",badge:"mdi:medal",feature:"mdi:star-shooting",discount:"mdi:percent"})[a]||"mdi:gift",getStatusLabel:a=>({pending:"รอรับ",claimed:"รับแล้ว",used:"ใช้แล้ว",expired:"หมดอายุ",cancelled:"ยกเลิก"})[a]||a,getStatusColor:a=>({pending:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",claimed:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",used:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300",expired:"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300",cancelled:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"})[a]||"bg-gray-100 text-gray-800",formatPoints:a=>new Intl.NumberFormat("th-TH").format(a)}};export{P as u};
