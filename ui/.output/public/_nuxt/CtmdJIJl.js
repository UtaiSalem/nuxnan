import{r as b,z as be,c as l,a as t,b as F,e as m,d as c,j as f,$ as g,aa as p,ab as G,F as y,k as v,T as M,t as h,o as r,u as w,I as k,g as J,ae as xe}from"./cTealXVQ.js";import{S}from"./BQxta0Da.js";import ye from"./C6rFwqvj.js";const ve={class:"bg-white shadow overflow-hidden sm:rounded-lg"},he={class:"px-4 py-5 sm:p-6"},we={key:0,class:"mb-6 p-4 bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200"},ke={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Fe=["value"],Ie={class:"bg-white p-4 rounded-lg border border-gray-200"},Ve={key:0,class:"text-sm text-gray-500 text-center py-4"},Ce={key:1,class:"space-y-3"},De={class:"flex-1"},Ue=["onUpdate:modelValue"],_e=["onClick"],je={class:"flex flex-col items-center"},Te={key:0,class:"text-xs text-green-700 font-normal mt-1"},$e={key:0,class:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center pointer-events-none rounded-lg"},Se={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},Ne=["src"],ze=["onClick"],Oe={class:"flex justify-end gap-3"},Pe=["disabled"],Ae={key:0,class:"space-y-6"},Ee={class:"p-4 bg-gray-50 border-b border-gray-200"},Ge={class:"flex items-start justify-between"},Me={class:"flex items-center gap-2"},Je=["onClick"],Re=["onSubmit"],qe={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Be=["value","onInput"],He=["onUpdate:modelValue"],Le=["onUpdate:modelValue"],Xe=["value"],Ke={key:0,class:"mt-1 text-xs text-gray-500"},Ye={class:"bg-white p-4 rounded-lg border border-gray-200"},Qe={class:"flex items-center justify-between mb-3"},Ze={class:"block text-sm font-medium text-gray-700"},We=["onClick"],et={key:0,class:"text-sm text-gray-500 text-center py-4"},tt={key:1,class:"space-y-3"},st={class:"flex-1"},ot=["onUpdate:modelValue"],nt=["onClick"],rt=["onUpdate:modelValue"],lt=["onUpdate:modelValue"],at=["onUpdate:modelValue"],it={class:"text-sm font-medium text-gray-700 mb-2 flex items-center"},dt=["onDragover","onDragleave","onDrop","onClick"],mt=["onChange"],ut={class:"flex flex-col items-center"},gt={key:0,class:"text-xs text-green-700 font-normal mt-1"},ct=["onClick"],pt={key:0,class:"absolute inset-0 bg-green-100 bg-opacity-50 flex items-center justify-center pointer-events-none rounded-lg"},ft={key:0,class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},bt=["src"],xt=["onClick"],yt={key:1},vt={class:"grid grid-cols-2 sm:grid-cols-4 gap-4"},ht=["src"],wt=["onClick"],kt={class:"absolute bottom-1 left-1 bg-black bg-opacity-60 text-white text-xs px-2 py-0.5 rounded"},Ft={class:"flex justify-end gap-3 pt-4 border-t border-gray-200"},It=["onClick"],Vt=["disabled"],Ct={key:1,class:"text-center py-12 bg-gray-50 rounded-lg border border-dashed border-gray-300"},$t={__name:"HomeVisitCard",props:{homeVisits:Array,visitForm:Object,zones:{type:Array,default:()=>[]},createNewHomeVisit:Function,handleImageUpload:Function,removeImage:Function},emits:["view-visit-images","visit-updated"],setup(a,{emit:Dt}){function R(o){if(!o)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(o))return o;if(o.includes("T"))return o.split("T")[0];const e=new Date(o);return isNaN(e)?"":e.toISOString().split("T")[0]}const d=a,V=b(!1),C=b(!1),N=b(null),z=b(!1),j=b(null),D=b({}),A=b({}),U=b({}),O=b({});be(()=>{q(),B()});function q(){const o=new Date,e=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0"),i=String(o.getHours()).padStart(2,"0"),u=String(o.getMinutes()).padStart(2,"0");d.visitForm.visit_date=`${e}-${s}-${n}`,d.visitForm.visit_time=`${i}:${u}`,d.visitForm.participants||(d.visitForm.participants=[]),d.visitForm.participants.length===0&&P(),d.visitForm.recommendations=d.visitForm.recommendations||"",d.visitForm.follow_up=d.visitForm.follow_up||"",d.visitForm.next_visit=d.visitForm.next_visit||""}function B(){d.homeVisits&&d.homeVisits.forEach(o=>{O.value[o.id]=JSON.parse(JSON.stringify(o)),o.newImages||(o.newImages=[]),o.imagesToDelete||(o.imagesToDelete=[])})}function T(){V.value=!V.value,V.value&&d.visitForm.participants.length===0&&P()}function H(o){j.value=o,z.value=!0}function L(){z.value=!1,j.value=null}async function X(o){if(!o.participants||o.participants.length===0){await S.fire({title:"ข้อมูลไม่ครบถ้วน",text:"กรุณาเพิ่มครูผู้เข้าร่วมอย่างน้อย 1 คน",icon:"warning"});return}U.value[o.id]=!0;try{const e=new FormData;e.append("visit_date",o.visit_date),e.append("visit_time",o.visit_time),e.append("observations",o.observations||""),e.append("notes",o.notes||""),e.append("recommendations",o.recommendations||""),o.zone_id&&e.append("zone_id",o.zone_id),o.participants.forEach((i,u)=>{e.append(`participants[${u}][participant_name]`,i.participant_name)}),o.newImages&&o.newImages.forEach((i,u)=>{e.append(`new_images[${u}]`,i.file)}),o.imagesToDelete&&o.imagesToDelete.forEach(i=>{e.append("images_to_delete[]",i)});const n=await(await fetch(`/api/home-visit/${o.id}/update`,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:e})).json();n.success?(await S.fire({title:"สำเร็จ",text:"อัปเดตข้อมูลการเยี่ยมบ้านเรียบร้อย",icon:"success",timer:1500,showConfirmButton:!1}),Object.assign(o,n.visit),O.value[o.id]=JSON.parse(JSON.stringify(n.visit)),o.newImages=[],o.imagesToDelete=[]):await S.fire({title:"เกิดข้อผิดพลาด",text:n.message||"ไม่สามารถอัปเดตข้อมูลได้",icon:"error"})}catch(e){await S.fire({title:"เกิดข้อผิดพลาด",text:e.message||"ไม่สามารถอัปเดตข้อมูลได้",icon:"error"})}finally{U.value[o.id]=!1}}function K(o){const e=O.value[o.id];e&&(Object.assign(o,JSON.parse(JSON.stringify(e))),o.newImages=[],o.imagesToDelete=[])}function P(){d.visitForm.participants.push({participant_name:""})}function Y(o){d.visitForm.participants.splice(o,1)}function Q(o){o.participants||(o.participants=[]),o.participants.push({participant_name:""})}function Z(o,e){o.participants.splice(e,1)}function W(o){xe(()=>{const e=A.value[o];e&&e.click()})}function ee(o,e){D.value[e]=!0}function te(o,e){D.value[e]=!1}function se(o,e){D.value[e]=!1;const s=Array.from(o.dataTransfer.files);s.length&&E({target:{files:s}},e)}async function E(o,e){const s=Array.from(o.target.files),n=d.homeVisits.find(i=>i.id===e);if(n){n.newImages||(n.newImages=[]);for(const i of s){const u=await le(i),x=new FileReader;x.onload=I=>{n.newImages.push({file:u,preview:I.target.result})},x.readAsDataURL(u)}}}function oe(o,e){o.newImages.splice(e,1)}function ne(o){o.newImages=[]}function re(o,e){const s=o.images[e];s&&(o.imagesToDelete||(o.imagesToDelete=[]),o.imagesToDelete.push(s.id),o.images[e]._deleted=!0)}async function le(o,e=1200,s=.8){return new Promise(n=>{const i=new FileReader;i.onload=u=>{const x=new Image;x.onload=()=>{const I=document.createElement("canvas");let _=x.width,$=x.height;_>e&&($=$*e/_,_=e),I.width=_,I.height=$,I.getContext("2d").drawImage(x,0,0,_,$),I.toBlob(pe=>{const fe=new File([pe],o.name,{type:"image/jpeg",lastModified:Date.now()});n(fe)},"image/jpeg",s)},x.src=u.target.result},i.readAsDataURL(o)})}function ae(){N.value&&N.value.click()}function ie(o){C.value=!0}function de(o){C.value=!1}function me(o){C.value=!1;const e=Array.from(o.dataTransfer.files);if(e.length){const s={target:{files:e}};d.handleImageUpload(s)}}function ue(){d.visitForm.images&&d.visitForm.images.splice(0,d.visitForm.images.length)}function ge(){if(d.visitForm.participants.length===0){alert("กรุณาเพิ่มครูผู้เข้าร่วมอย่างน้อย 1 คน");return}d.createNewHomeVisit(),V.value=!1}function ce(o){return o?o.image_url?o.image_url:o.image_path?`/storage/${o.image_path.replace(/^public\//,"")}`:"/images/placeholder.png":"/images/placeholder.png"}return(o,e)=>(r(),l("div",ve,[t("div",{class:"px-4 py-5 sm:px-6 bg-gradient-to-r from-green-50 to-emerald-50"},[t("div",{class:"flex items-center justify-between"},[e[8]||(e[8]=t("div",null,[t("h3",{class:"text-lg leading-6 font-medium text-gray-900"},[t("i",{class:"fas fa-home mr-2 text-green-600"}),m(" การเยี่ยมบ้าน ")]),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500"}," จัดการข้อมูลการเยี่ยมบ้านและอัพโหลดรูปภาพหลักฐาน ")],-1)),t("button",{onClick:T,class:"inline-flex items-center px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-colors"},[...e[7]||(e[7]=[t("i",{class:"fas fa-plus mr-2"},null,-1),m(" สร้างการเยี่ยมบ้านใหม่ ",-1)])])])]),t("div",he,[V.value?(r(),l("div",we,[t("div",{class:"flex items-center justify-between mb-4"},[e[10]||(e[10]=t("h4",{class:"text-md font-medium text-gray-900"},"สร้างการเยี่ยมบ้านใหม่",-1)),t("button",{onClick:T,class:"text-gray-500 hover:text-gray-700"},[...e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)])])]),t("form",{onSubmit:f(ge,["prevent"]),class:"space-y-6"},[t("div",ke,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"วันที่เยี่ยม *",-1)),g(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.visitForm.visit_date=s),type:"date",required:"",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm"},null,512),[[p,a.visitForm.visit_date]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"เวลาเยี่ยม",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>a.visitForm.visit_time=s),type:"time",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm"},null,512),[[p,a.visitForm.visit_time]])])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[t("i",{class:"fas fa-map-marker-alt mr-2 text-green-600"}),m(" โซน "),t("span",{class:"text-gray-500 text-xs"},"(ไม่บังคับ)")],-1)),g(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.visitForm.zone_id=s),class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm"},[e[13]||(e[13]=t("option",{value:""},"ไม่ระบุโซน",-1)),(r(!0),l(y,null,v(a.zones,s=>(r(),l("option",{key:s.id,value:s.id},h(s.zone_name),9,Fe))),128))],512),[[G,a.visitForm.zone_id]])]),t("div",Ie,[t("div",{class:"flex items-center justify-between mb-3"},[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},[t("i",{class:"fas fa-users mr-2 text-green-600"}),m(" ครูผู้เข้าร่วมการเยี่ยมบ้าน ")],-1)),t("button",{onClick:P,type:"button",class:"inline-flex items-center px-3 py-1 text-xs font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded-md transition-colors"},[...e[15]||(e[15]=[t("i",{class:"fas fa-plus mr-1"},null,-1),m(" เพิ่มครู ",-1)])])]),a.visitForm.participants.length===0?(r(),l("div",Ve," ยังไม่มีครูผู้เข้าร่วม กรุณาเพิ่มอย่างน้อย 1 คน ")):(r(),l("div",Ce,[(r(!0),l(y,null,v(a.visitForm.participants,(s,n)=>(r(),l("div",{key:n,class:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200"},[t("div",De,[g(t("input",{"onUpdate:modelValue":i=>s.participant_name=i,type:"text",placeholder:"ชื่อครู *",required:"",class:"w-full px-3 py-2 text-sm border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 placeholder:text-gray-400"},null,8,Ue),[[p,s.participant_name]])]),t("button",{onClick:i=>Y(n),type:"button",class:"flex-shrink-0 text-red-600 hover:text-red-800 p-2",title:"ลบ"},[...e[17]||(e[17]=[t("i",{class:"fas fa-trash-alt"},null,-1)])],8,_e)]))),128))]))]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"การสังเกตการณ์",-1)),g(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.visitForm.observations=s),rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm placeholder:text-gray-400",placeholder:"บันทึกสภาพแวดล้อมบ้าน สภาพความเป็นอยู่ และการสังเกตการณ์..."},null,512),[[p,a.visitForm.observations]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"บันทึกเพิ่มเติม",-1)),g(t("textarea",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.visitForm.notes=s),rows:"2",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm placeholder:text-gray-400",placeholder:"หมายเหตุ..."},null,512),[[p,a.visitForm.notes]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"ข้อเสนอแนะ",-1)),g(t("textarea",{"onUpdate:modelValue":e[5]||(e[5]=s=>a.visitForm.recommendations=s),rows:"3",class:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 sm:text-sm placeholder:text-gray-400",placeholder:"ข้อเสนอแนะสำหรับการพัฒนานักเรียน..."},null,512),[[p,a.visitForm.recommendations]])]),t("div",null,[e[25]||(e[25]=t("label",{class:"text-sm font-medium text-gray-700 mb-2 flex items-center"},[t("i",{class:"fas fa-image mr-2 text-green-600"}),m(" อัพโหลดรูปภาพหลักฐาน ")],-1)),t("div",{class:M(["relative flex flex-col items-center justify-center border-2 border-dashed rounded-lg p-6 cursor-pointer transition bg-white hover:bg-green-50",{"border-green-500 bg-green-50":C.value}]),onDragover:f(ie,["prevent"]),onDragleave:f(de,["prevent"]),onDrop:f(me,["prevent"]),onClick:ae},[t("input",{ref_key:"fileInput",ref:N,onChange:e[6]||(e[6]=(...s)=>a.handleImageUpload&&a.handleImageUpload(...s)),type:"file",multiple:"",accept:"image/*",class:"hidden"},null,544),t("div",je,[e[21]||(e[21]=t("i",{class:"fas fa-cloud-upload-alt text-3xl text-green-500 mb-2"},null,-1)),e[22]||(e[22]=t("span",{class:"text-sm text-gray-700 font-semibold"},[m("ลากไฟล์รูปภาพมาวาง หรือ "),t("span",{class:"underline text-green-700"},"คลิกเพื่อเลือกไฟล์")],-1)),e[23]||(e[23]=t("span",{class:"text-xs text-gray-500 mt-1"},"รองรับไฟล์ JPG, PNG, GIF (ขนาดจะถูกบีบอัดอัตโนมัติ)",-1)),a.visitForm.images&&a.visitForm.images.length>0?(r(),l("span",Te," เลือกแล้ว "+h(a.visitForm.images.length)+" ไฟล์ ",1)):c("",!0),a.visitForm.images&&a.visitForm.images.length>0?(r(),l("button",{key:1,onClick:f(ue,["stop"]),type:"button",class:"mt-2 text-xs text-red-600 hover:underline"},"ลบทั้งหมด")):c("",!0)]),C.value?(r(),l("div",$e,[...e[24]||(e[24]=[t("span",{class:"text-green-700 font-normal text-lg"},"ปล่อยไฟล์ที่นี่เพื่ออัพโหลด",-1)])])):c("",!0)],34)]),a.visitForm.images&&a.visitForm.images.length>0?(r(),l("div",Se,[(r(!0),l(y,null,v(a.visitForm.images,(s,n)=>(r(),l("div",{key:n,class:"relative group"},[t("img",{src:s.preview,alt:"Preview",class:"w-full h-24 object-cover rounded-lg border-2 border-gray-200"},null,8,Ne),t("button",{onClick:i=>a.removeImage(n),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 opacity-80 group-hover:opacity-100 transition"},"×",8,ze)]))),128))])):c("",!0),t("div",Oe,[t("button",{type:"button",onClick:T,class:"px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium rounded-lg transition-colors"}," ยกเลิก "),t("button",{type:"submit",disabled:a.visitForm.participants.length===0,class:"px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed"},[...e[26]||(e[26]=[t("i",{class:"fas fa-save mr-2"},null,-1),m(" บันทึกการเยี่ยมบ้าน ",-1)])],8,Pe)])],32)])):c("",!0),t("div",null,[e[44]||(e[44]=t("h4",{class:"text-md font-medium text-gray-900 mb-4 flex items-center"},[t("i",{class:"fas fa-history mr-2 text-green-600"}),m(" ประวัติการเยี่ยมบ้าน ")],-1)),a.homeVisits&&a.homeVisits.length>0?(r(),l("div",Ae,[(r(!0),l(y,null,v(a.homeVisits,s=>(r(),l("div",{key:s.id,class:"bg-white rounded-lg shadow-sm border-2 border-gray-200 overflow-hidden"},[t("div",Ee,[t("div",Ge,[t("div",Me,[s.images&&s.images.length>0?(r(),l("button",{key:0,onClick:n=>H(s),class:"text-blue-600 hover:text-blue-800 text-sm px-3 py-1 rounded hover:bg-blue-50 flex items-center gap-1"},[F(w(k),{icon:"heroicons:photo",class:"w-4 h-4"}),m(" รูปภาพ ("+h(s.images.length)+") ",1)],8,Je)):c("",!0)])])]),t("form",{onSubmit:f(n=>X(s),["prevent"]),class:"p-4 space-y-4"},[t("div",qe,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"วันที่เยี่ยม *",-1)),t("input",{value:R(s.visit_date),onInput:n=>s.visit_date=n.target.value,type:"date",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"},null,40,Be)]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"เวลาเยี่ยม",-1)),g(t("input",{"onUpdate:modelValue":n=>s.visit_time=n,type:"time",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"},null,8,He),[[p,s.visit_time]])])]),t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[t("i",{class:"fas fa-map-marker-alt mr-2 text-green-600"}),m(" โซน "),t("span",{class:"text-gray-500 text-xs"},"(ไม่บังคับ)")],-1)),g(t("select",{"onUpdate:modelValue":n=>s.zone_id=n,class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500"},[e[29]||(e[29]=t("option",{value:null},"ไม่ระบุโซน",-1)),(r(!0),l(y,null,v(a.zones,n=>(r(),l("option",{key:n.id,value:n.id},h(n.zone_name),9,Xe))),128))],8,Le),[[G,s.zone_id]]),s.zone?(r(),l("p",Ke," โซนปัจจุบัน: "+h(s.zone.zone_name),1)):c("",!0)]),t("div",Ye,[t("div",Qe,[t("label",Ze,[F(w(k),{icon:"heroicons:users-20-solid",class:"w-5 h-5 inline mr-2 text-green-600"}),e[31]||(e[31]=m(" ครูผู้เข้าร่วมการเยี่ยมบ้าน ",-1))]),t("button",{onClick:n=>Q(s),type:"button",class:"inline-flex items-center px-3 py-1 text-xs font-medium text-green-700 bg-green-100 hover:bg-green-200 rounded-md transition-colors"},[F(w(k),{icon:"heroicons:plus-20-solid",class:"w-4 h-4 mr-1"}),e[32]||(e[32]=m(" เพิ่มครู ",-1))],8,We)]),!s.participants||s.participants.length===0?(r(),l("div",et," ยังไม่มีครูผู้เข้าร่วม กรุณาเพิ่มอย่างน้อย 1 คน ")):(r(),l("div",tt,[(r(!0),l(y,null,v(s.participants,(n,i)=>(r(),l("div",{key:i,class:"flex items-start gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200"},[t("div",st,[g(t("input",{"onUpdate:modelValue":u=>n.participant_name=u,type:"text",placeholder:"ชื่อครู *",required:"",class:"w-full px-3 py-2 text-sm border-gray-300 rounded-md focus:ring-green-500 focus:border-green-500 placeholder:text-gray-400"},null,8,ot),[[p,n.participant_name]])]),t("button",{onClick:u=>Z(s,i),type:"button",class:"flex-shrink-0 text-red-600 hover:text-red-800 p-2",title:"ลบ"},[F(w(k),{icon:"heroicons:trash-20-solid",class:"w-4 h-4"})],8,nt)]))),128))]))]),t("div",null,[e[33]||(e[33]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"การสังเกตการณ์",-1)),g(t("textarea",{"onUpdate:modelValue":n=>s.observations=n,rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 placeholder:text-gray-400",placeholder:"บันทึกสภาพแวดล้อมบ้าน สภาพความเป็นอยู่ และการสังเกตการณ์..."},null,8,rt),[[p,s.observations]])]),t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"บันทึกเพิ่มเติม",-1)),g(t("textarea",{"onUpdate:modelValue":n=>s.notes=n,rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 placeholder:text-gray-400",placeholder:"หมายเหตุ..."},null,8,lt),[[p,s.notes]])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ข้อเสนอแนะ",-1)),g(t("textarea",{"onUpdate:modelValue":n=>s.recommendations=n,rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-green-500 focus:border-green-500 placeholder:text-gray-400",placeholder:"ข้อเสนอแนะสำหรับการพัฒนานักเรียน..."},null,8,at),[[p,s.recommendations]])]),t("div",null,[t("label",it,[F(w(k),{icon:"heroicons:photo-20-solid",class:"w-5 h-5 mr-2 text-green-600"}),e[36]||(e[36]=m(" เพิ่มรูปภาพหลักฐาน ",-1))]),t("div",{class:M(["relative flex flex-col items-center justify-center border-2 border-dashed rounded-lg p-6 cursor-pointer transition bg-white hover:bg-green-50",{"border-green-500 bg-green-50":D.value[s.id]}]),onDragover:f(n=>ee(n,s.id),["prevent"]),onDragleave:f(n=>te(n,s.id),["prevent"]),onDrop:f(n=>se(n,s.id),["prevent"]),onClick:n=>W(s.id)},[t("input",{ref_for:!0,ref:n=>{n&&(A.value[s.id]=n)},onChange:n=>E(n,s.id),type:"file",multiple:"",accept:"image/*",class:"hidden"},null,40,mt),t("div",ut,[F(w(k),{icon:"heroicons:cloud-arrow-up-20-solid",class:"w-8 h-8 text-green-500 mb-2"}),e[37]||(e[37]=t("span",{class:"text-sm text-gray-700 font-normal"},[m("ลากไฟล์รูปภาพมาวาง หรือ "),t("span",{class:"underline text-green-700"},"คลิกเพื่อเลือกไฟล์")],-1)),e[38]||(e[38]=t("span",{class:"text-xs text-gray-500 mt-1"},"รองรับไฟล์ JPG, PNG, GIF (ขนาดจะถูกบีบอัดอัตโนมัติ)",-1)),s.newImages&&s.newImages.length>0?(r(),l("span",gt," เลือกแล้ว "+h(s.newImages.length)+" ไฟล์ ",1)):c("",!0),s.newImages&&s.newImages.length>0?(r(),l("button",{key:1,onClick:f(n=>ne(s),["stop"]),type:"button",class:"mt-2 text-xs text-red-600 hover:underline"},"ลบทั้งหมด",8,ct)):c("",!0)]),D.value[s.id]?(r(),l("div",pt,[...e[39]||(e[39]=[t("span",{class:"text-green-700 font-normal text-lg"},"ปล่อยไฟล์ที่นี่เพื่ออัพโหลด",-1)])])):c("",!0)],42,dt)]),s.newImages&&s.newImages.length>0?(r(),l("div",ft,[(r(!0),l(y,null,v(s.newImages,(n,i)=>(r(),l("div",{key:i,class:"relative group"},[t("img",{src:n.preview,alt:"Preview",class:"w-full h-24 object-cover rounded-lg border-2 border-gray-200"},null,8,bt),t("button",{onClick:u=>oe(s,i),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 opacity-80 group-hover:opacity-100 transition"},"×",8,xt)]))),128))])):c("",!0),s.images&&s.images.length>0?(r(),l("div",yt,[e[40]||(e[40]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"รูปภาพที่มีอยู่",-1)),t("div",vt,[(r(!0),l(y,null,v(s.images.filter(n=>!n._deleted),(n,i)=>(r(),l("div",{key:i,class:"relative group"},[t("img",{src:ce(n),alt:"Existing image",class:"w-full h-24 object-cover rounded-lg border-2 border-gray-200"},null,8,ht),t("button",{onClick:u=>re(s,i),type:"button",class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 opacity-80 group-hover:opacity-100 transition"},"×",8,wt),t("div",kt,h(i+1),1)]))),128))])])):c("",!0),t("div",Ft,[t("button",{type:"button",onClick:n=>K(s),class:"px-6 py-2.5 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium min-w-[100px]"}," คืนค่า ",8,It),t("button",{type:"submit",disabled:!s.participants||s.participants.length===0||U.value[s.id],class:"px-6 py-2.5 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 min-w-[150px] justify-center"},[U.value[s.id]?(r(),J(w(k),{key:0,icon:"heroicons:arrow-path-20-solid",class:"w-4 h-4 animate-spin"})):(r(),J(w(k),{key:1,icon:"heroicons:check-circle-20-solid",class:"w-4 h-4"})),m(" "+h(U.value[s.id]?"กำลังบันทึก...":"บันทึกการแก้ไข"),1)],8,Vt)])],40,Re)]))),128))])):(r(),l("div",Ct,[e[42]||(e[42]=t("i",{class:"fas fa-home text-4xl text-gray-300 mb-3"},null,-1)),e[43]||(e[43]=t("p",{class:"text-gray-500 mb-2"},"ยังไม่มีประวัติการเยี่ยมบ้าน",-1)),t("button",{onClick:T,class:"inline-flex items-center px-4 py-2 text-sm text-green-600 hover:text-green-700 font-medium"},[...e[41]||(e[41]=[t("i",{class:"fas fa-plus mr-2"},null,-1),m(" สร้างการเยี่ยมบ้านแรก ",-1)])])]))])]),F(ye,{show:z.value,visit:j.value,images:j.value?.images||[],onClose:L},null,8,["show","visit","images"])]))}};export{$t as default};
