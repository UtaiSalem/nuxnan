import{q as B,a9 as M,a3 as S,o as s,g as v,b as c,w as V,c as i,j as N,a as e,u as o,I as n,$ as U,aa as $,d as p,F as z,k as q,t as h,e as D,a1 as F,a4 as O,r as u,_ as A}from"./Brb_7992.js";import{S as m}from"./BQxta0Da.js";const E={class:"relative bg-white dark:bg-vikinger-dark-200 rounded-2xl shadow-xl w-full max-w-lg max-h-[80vh] flex flex-col overflow-hidden"},L={class:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700"},Q={class:"flex items-center gap-3"},R={class:"w-10 h-10 rounded-lg bg-vikinger-purple/10 flex items-center justify-center"},G={class:"px-6 py-4 border-b border-gray-200 dark:border-gray-700"},H={class:"relative"},J={key:0,class:"mt-2 text-sm text-gray-500"},K={class:"flex-1 overflow-y-auto px-6 py-4"},P={key:0,class:"text-center py-8"},W={key:1,class:"text-center py-8"},X={key:2,class:"space-y-2"},Y={class:"flex items-center gap-3"},Z={class:"w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden"},ee=["src","alt"],te={class:"font-medium text-gray-900 dark:text-white"},ae={class:"flex items-center gap-2 text-sm text-gray-500"},se={key:0},re={key:1},le=["onClick","disabled"],ie={class:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-vikinger-dark-100"},oe={class:"text-xs text-gray-500 dark:text-gray-400 text-center"},ne=B({__name:"InviteMemberModal",props:{isOpen:{type:Boolean},academyId:{}},emits:["close","invited"],setup(k,{emit:I}){const C=k,b=I,_=M(),l=u(""),d=u([]),y=u(!1),g=u(!1),f=u(null),x=u(null);S(l,r=>{if(x.value&&clearTimeout(x.value),r.length<2){d.value=[];return}x.value=setTimeout(()=>{T()},300)});const T=async()=>{if(!(l.value.length<2)){y.value=!0;try{const r=await _.get("/api/users/search",{params:{q:l.value,limit:10}});r.success&&(d.value=r.data||[])}catch(r){console.error("Search users error:",r)}finally{y.value=!1}}},j=async r=>{if(!g.value){g.value=!0,f.value=r.id;try{const t=await _.post(`/api/academies/${C.academyId}/invite`,{user_id:r.id});t.success?(m.fire({icon:"success",title:"ส่งคำเชิญสำเร็จ",text:`ส่งคำเชิญให้ ${r.name} เรียบร้อยแล้ว`,timer:2e3,showConfirmButton:!1}),d.value=d.value.filter(a=>a.id!==r.id),b("invited")):m.fire({icon:"error",title:"ไม่สามารถเชิญได้",text:t.message||"เกิดข้อผิดพลาด"})}catch(t){m.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:t?.data?.message||"ไม่สามารถส่งคำเชิญได้"})}finally{g.value=!1,f.value=null}}},w=()=>{l.value="",d.value=[],b("close")};return(r,t)=>(s(),v(O,{to:"body"},[c(F,{name:"modal"},{default:V(()=>[k.isOpen?(s(),i("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:N(w,["self"])},[t[6]||(t[6]=e("div",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm"},null,-1)),e("div",E,[e("div",L,[e("div",Q,[e("div",R,[c(o(n),{icon:"fluent:person-add-24-regular",class:"w-5 h-5 text-vikinger-purple"})]),t[1]||(t[1]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"},"เชิญสมาชิก"),e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"ค้นหาและเชิญผู้ใช้เข้าร่วมโรงเรียน")],-1))]),e("button",{onClick:w,class:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"},[c(o(n),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5 text-gray-500"})])]),e("div",G,[e("div",H,[c(o(n),{icon:"fluent:search-24-regular",class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),U(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a),type:"text",placeholder:"ค้นหาด้วยชื่อ, อีเมล, หรือรหัสอ้างอิง...",class:"w-full pl-10 pr-4 py-3 rounded-xl bg-gray-50 dark:bg-vikinger-dark-100 text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-vikinger-purple/50"},null,512),[[$,l.value]]),y.value?(s(),v(o(n),{key:0,icon:"svg-spinners:ring-resize",class:"absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-vikinger-purple"})):p("",!0)]),l.value.length>0&&l.value.length<2?(s(),i("p",J," พิมพ์อย่างน้อย 2 ตัวอักษร ")):p("",!0)]),e("div",K,[!l.value||l.value.length<2?(s(),i("div",P,[c(o(n),{icon:"fluent:search-24-regular",class:"w-16 h-16 text-gray-200 dark:text-gray-700 mx-auto mb-4"}),t[2]||(t[2]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ค้นหาผู้ใช้ที่ต้องการเชิญ",-1))])):d.value.length===0&&!y.value?(s(),i("div",W,[c(o(n),{icon:"fluent:person-search-24-regular",class:"w-16 h-16 text-gray-200 dark:text-gray-700 mx-auto mb-4"}),t[3]||(t[3]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ไม่พบผู้ใช้ที่ค้นหา",-1))])):(s(),i("div",X,[(s(!0),i(z,null,q(d.value,a=>(s(),i("div",{key:a.id,class:"flex items-center justify-between p-3 rounded-xl bg-gray-50 dark:bg-vikinger-dark-100 hover:bg-gray-100 dark:hover:bg-vikinger-dark-300 transition-colors"},[e("div",Y,[e("div",Z,[a.avatar||a.profile_photo_url?(s(),i("img",{key:0,src:a.avatar||a.profile_photo_url,alt:a.name,class:"w-full h-full object-cover"},null,8,ee)):(s(),v(o(n),{key:1,icon:"fluent:person-24-regular",class:"w-full h-full p-2 text-gray-400"}))]),e("div",null,[e("h4",te,h(a.name),1),e("div",ae,[a.reference_code?(s(),i("span",se,"@"+h(a.reference_code),1)):p("",!0),a.email?(s(),i("span",re,h(a.email),1)):p("",!0)])])]),e("button",{onClick:de=>j(a),disabled:g.value&&f.value===a.id,class:"px-4 py-2 bg-vikinger-purple text-white rounded-lg text-sm font-medium hover:bg-vikinger-purple/90 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 transition-colors"},[g.value&&f.value===a.id?(s(),v(o(n),{key:0,icon:"svg-spinners:ring-resize",class:"w-4 h-4"})):(s(),v(o(n),{key:1,icon:"fluent:person-add-24-regular",class:"w-4 h-4"})),t[4]||(t[4]=e("span",null,"เชิญ",-1))],8,le)]))),128))]))]),e("div",ie,[e("p",oe,[c(o(n),{icon:"fluent:info-16-regular",class:"inline w-4 h-4 mr-1"}),t[5]||(t[5]=D(" ผู้ใช้ที่ถูกเชิญจะได้รับแจ้งเตือนและสามารถยอมรับหรือปฏิเสธคำเชิญได้ ",-1))])])])])):p("",!0)]),_:1})]))}}),ge=A(ne,[["__scopeId","data-v-fb024ca7"]]);export{ge as default};
