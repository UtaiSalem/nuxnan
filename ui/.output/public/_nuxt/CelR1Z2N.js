import{q as D,a9 as N,r as c,a3 as q,c as l,a as t,b as v,e as C,u as p,t as w,d as h,F as E,k as F,g as L,o,I as f}from"./CHs-R6Sv.js";import{_ as R}from"./DporBo20.js";import{u as U}from"./CaSR6SuD.js";const P={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700 shadow-lg"},T={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},z={class:"space-y-4"},G={class:"flex items-center justify-center w-full"},H={class:"flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-xl cursor-pointer bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:border-gray-700 dark:hover:border-gray-500 dark:hover:bg-gray-800 transition-colors"},J={class:"flex flex-col items-center justify-center pt-5 pb-6"},K={key:0,class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3"},M=["src","alt"],O={class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},Q=["onClick"],W={class:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2"},X={class:"text-white text-xs truncate"},Y={key:1,class:"space-y-2"},Z={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3"},ee=["src"],te={class:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"},se=["onClick"],ae={class:"mt-6 flex gap-3 justify-end"},oe=["disabled"],ie=D({__name:"AssignmentSubmissionForm",props:{assignment:{},courseId:{},existingAnswer:{},isEditing:{type:Boolean},showCancel:{type:Boolean}},emits:["submitted","cancel"],setup(u,{emit:j}){const y=u,k=j,A=N(),_=U(),n=c(""),r=c([]),g=c([]),i=c([]),b=c([]),m=c(!1);q(()=>y.existingAnswer,s=>{s?(n.value=s.content||"",i.value=[...s.images||[]]):(n.value="",i.value=[])},{immediate:!0,deep:!0});const I=s=>{const e=s.target;if(e.files){const a=Array.from(e.files);r.value=[...r.value,...a],a.forEach(d=>{const x=new FileReader;x.onload=V=>{g.value.push(V.target?.result)},x.readAsDataURL(d)})}e.value=""},S=s=>{r.value.splice(s,1),g.value.splice(s,1)},B=s=>{const e=i.value.findIndex(a=>a.id===s);e!==-1&&(i.value.splice(e,1),b.value.push(s))},$=async()=>{if(!(!n.value.trim()&&r.value.length===0&&i.value.length===0)){m.value=!0;try{const s=new FormData;s.append("content",n.value),s.append("course_id",y.courseId),r.value.forEach((e,a)=>{s.append(`images[${a}]`,e)}),b.value.length>0&&b.value.forEach((e,a)=>{s.append(`deleted_images[${a}]`,e.toString())}),await A.post(`/api/assignments/${y.assignment.id}/answers`,s),_.toast("ส่งคำตอบเรียบร้อยแล้ว","success"),k("submitted"),n.value="",r.value=[],g.value=[],b.value=[]}catch(s){console.error("Submission error:",s),_.toast("ส่งคำตอบไม่สำเร็จ","error")}finally{m.value=!1}}};return(s,e)=>(o(),l("div",P,[t("h3",T,[v(p(f),{icon:"fluent:form-new-24-regular",class:"w-6 h-6 text-orange-500"}),C(" "+w(u.isEditing?"แก้ไขการส่งงาน":"ส่งงาน"),1)]),t("div",z,[v(R,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=a=>n.value=a),placeholder:"พิมพ์คำตอบของคุณ...",class:"min-h-[120px]"},null,8,["modelValue"]),t("div",null,[e[3]||(e[3]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"แนบรูปภาพผลงาน",-1)),t("div",G,[t("label",H,[t("div",J,[v(p(f),{icon:"fluent:image-add-24-regular",class:"w-8 h-8 text-gray-400 mb-1"}),e[2]||(e[2]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"คลิกเพื่ออัพโหลดรูปภาพ",-1))]),t("input",{type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:I},null,32)])])]),g.value.length?(o(),l("div",K,[(o(!0),l(E,null,F(g.value,(a,d)=>(o(),l("div",{key:d,class:"relative group aspect-square rounded-xl overflow-hidden border-2 border-gray-200 dark:border-gray-700 bg-gray-100 dark:bg-gray-900"},[t("img",{src:a,class:"w-full h-full object-cover",alt:r.value[d]?.name||"preview"},null,8,M),t("div",O,[t("button",{onClick:x=>S(d),class:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"},[v(p(f),{icon:"fluent:delete-16-filled",class:"w-5 h-5"})],8,Q)]),t("div",W,[t("p",X,w(r.value[d]?.name),1)])]))),128))])):h("",!0),i.value.length?(o(),l("div",Y,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-600 dark:text-gray-400"},"รูปภาพที่อัปโหลดแล้ว:",-1)),t("div",Z,[(o(!0),l(E,null,F(i.value,a=>(o(),l("div",{key:a.id,class:"relative group aspect-square rounded-xl overflow-hidden border-2 border-green-200 dark:border-green-700 bg-gray-100 dark:bg-gray-900"},[t("img",{src:a.full_url||a.image_url,class:"w-full h-full object-cover"},null,8,ee),t("div",te,[t("button",{onClick:d=>B(a.id),class:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors shadow-lg"},[v(p(f),{icon:"fluent:delete-16-filled",class:"w-5 h-5"})],8,se)]),e[4]||(e[4]=t("div",{class:"absolute top-2 left-2"},[t("span",{class:"px-2 py-0.5 bg-green-500 text-white text-[10px] font-bold rounded-full"},"อัปโหลดแล้ว")],-1))]))),128))])])):h("",!0)]),t("div",ae,[u.isEditing&&u.showCancel!==!1?(o(),l("button",{key:0,onClick:e[1]||(e[1]=a=>k("cancel")),class:"px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors"}," ยกเลิก ")):h("",!0),t("button",{onClick:$,disabled:m.value,class:"px-8 py-2.5 rounded-xl font-bold text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 shadow-lg hover:shadow-orange-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"},[m.value?(o(),L(p(f),{key:0,icon:"eos-icons:loading",class:"w-5 h-5"})):h("",!0),C(" "+w(m.value?"กำลังส่ง...":u.isEditing?"บันทึกการแก้ไข":"ส่งงาน"),1)],8,oe)])]))}});export{ie as _};
