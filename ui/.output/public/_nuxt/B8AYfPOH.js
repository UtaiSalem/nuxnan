import{q as X,i as Y,l as Z,y as q,K as ee,c as o,a as e,b as d,w as h,g as z,j as te,F as N,u,t as r,d as g,$ as b,aa as _,e as m,a4 as ae,r as i,n as I,o as l,I as c,ab as se,aj as re,k as le,T as oe,p as ne}from"./Brb_7992.js";import{_ as w}from"./B56lO0ps.js";const de={class:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4 sm:px-6 lg:px-8"},ie={class:"max-w-7xl mx-auto"},ue={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8"},ce={class:"p-4 flex items-center gap-4"},ge={class:"w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-full flex items-center justify-center"},xe={class:"text-2xl font-bold text-gray-900 dark:text-white"},pe={class:"p-4 flex items-center gap-4"},ye={class:"w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center"},me={class:"text-2xl font-bold text-gray-900 dark:text-white"},ve={class:"p-4 flex items-center gap-4"},be={class:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center"},_e={class:"text-2xl font-bold text-gray-900 dark:text-white"},fe={class:"p-4"},ke={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},he={class:"overflow-x-auto"},we={key:0,class:"py-12 text-center"},je={key:1,class:"w-full"},Ce={class:"divide-y divide-gray-200 dark:divide-gray-700"},$e={class:"px-4 py-4"},Ae={class:"flex items-center gap-3"},Te=["src","alt"],Be={class:"font-medium text-gray-900 dark:text-white"},Ve={class:"text-xs text-gray-500"},Se={class:"text-xs text-primary-500"},Me={class:"px-4 py-4"},Fe={class:"font-semibold text-lg text-gray-900 dark:text-white"},Ue={class:"text-xs text-gray-500"},Re={class:"px-4 py-4"},Pe={class:"text-sm"},ze={key:0},Ne={key:1},De={key:2},He={class:"px-4 py-4"},Ie=["src","onClick"],Ke={key:1,class:"text-gray-400"},Le={class:"px-4 py-4"},Ee={class:"text-sm text-gray-900 dark:text-white"},Oe={class:"px-4 py-4"},Ge={class:"px-4 py-4 text-right"},Qe={key:0,class:"flex justify-end gap-2"},Je=["onClick"],We=["onClick"],Xe={key:1,class:"text-sm text-gray-500"},Ye={key:0},Ze={key:1,class:"text-red-500 text-xs mt-1"},qe={key:2,class:"py-12 text-center text-gray-500 dark:text-gray-400"},et={key:0,class:"p-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between"},tt={class:"text-sm text-gray-600 dark:text-gray-400"},at={class:"flex gap-2"},st=["disabled"],rt={class:"px-3 py-1 bg-primary-500 text-white rounded-lg"},lt=["disabled"],ot={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-y-auto"},nt={class:"p-6"},dt={class:"text-center mb-6"},it={class:"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-4"},ut={key:0,class:"bg-gray-50 dark:bg-gray-700 rounded-xl p-4 mb-6"},ct={class:"flex items-center gap-3 mb-3"},gt=["src"],xt={class:"font-medium text-gray-900 dark:text-white"},pt={class:"text-sm text-gray-500"},yt={class:"text-2xl font-bold text-green-600 text-center"},mt={class:"mb-6"},vt={class:"flex gap-3"},bt=["disabled"],_t={class:"text-center mb-6"},ft={class:"w-16 h-16 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center mx-auto mb-4"},kt={key:0,class:"bg-gray-50 dark:bg-gray-700 rounded-xl p-4 mb-6"},ht={class:"flex items-center gap-3 mb-3"},wt=["src"],jt={class:"font-medium text-gray-900 dark:text-white"},Ct={class:"text-sm text-gray-500"},$t={class:"text-2xl font-bold text-gray-900 dark:text-white text-center"},At={class:"mb-4"},Tt={class:"mb-6"},Bt={class:"flex gap-3"},Vt=["disabled"],Ut=X({__name:"DepositApproval",setup(St){Y({title:"อนุมัติคำขอเติมเงิน - Admin"});const j=Z(),K=ne(),C=i([]),U=i(!0),y=i(!1),n=i(null),$=i(!1),A=i("approve"),T=i("pending"),B=i(""),V=i(""),S=i(""),M=i({pending:0,approved_today:0,total_pending_amount:0}),v=i(1),R=i(1),D=i(0),x=i({rejection_reason:"",admin_note:""}),F=i({admin_note:""}),L=I(()=>j.user?.is_plearnd_admin),P=I(()=>K.public.apiBase||""),p=async()=>{try{U.value=!0;const s=new URLSearchParams;T.value&&s.append("status",T.value),B.value&&s.append("search",B.value),V.value&&s.append("from_date",V.value),S.value&&s.append("to_date",S.value),s.append("page",v.value.toString()),s.append("per_page","20");const t=await $fetch(`${P.value}/api/admin/deposit-requests?${s}`,{method:"GET",headers:{Authorization:`Bearer ${j.token}`}});t.success&&(C.value=t.data,M.value=t.stats,v.value=t.pagination.current_page,R.value=t.pagination.last_page,D.value=t.pagination.total)}catch(s){console.error("Failed to load deposit requests:",s)}finally{U.value=!1}},E=s=>{n.value=s,A.value="approve",F.value.admin_note="",$.value=!0},O=s=>{n.value=s,A.value="reject",x.value.rejection_reason="",x.value.admin_note="",$.value=!0},f=()=>{$.value=!1,n.value=null},G=async()=>{if(n.value)try{y.value=!0;const s=await $fetch(`${P.value}/api/admin/deposit-requests/${n.value.id}/approve`,{method:"POST",headers:{Authorization:`Bearer ${j.token}`},body:{admin_note:F.value.admin_note}});s.success?(alert(`อนุมัติสำเร็จ! เติมเงิน ${k(n.value.amount)} ให้ ${n.value.user.name}`),f(),await p()):alert(s.message||"เกิดข้อผิดพลาด")}catch(s){alert(s.data?.message||s.message||"เกิดข้อผิดพลาด")}finally{y.value=!1}},Q=async()=>{if(n.value){if(!x.value.rejection_reason.trim()){alert("กรุณาระบุเหตุผลที่ปฏิเสธ");return}try{y.value=!0;const s=await $fetch(`${P.value}/api/admin/deposit-requests/${n.value.id}/reject`,{method:"POST",headers:{Authorization:`Bearer ${j.token}`},body:{rejection_reason:x.value.rejection_reason,admin_note:x.value.admin_note}});s.success?(alert("ปฏิเสธคำขอสำเร็จ"),f(),await p()):alert(s.message||"เกิดข้อผิดพลาด")}catch(s){alert(s.data?.message||s.message||"เกิดข้อผิดพลาด")}finally{y.value=!1}}},k=s=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(s),J=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";case"approved":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"rejected":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";default:return"bg-gray-100 text-gray-800"}},W=s=>{window.open(s,"_blank")};return q(async()=>{if(!L.value){ee("/");return}await p()}),(s,t)=>(l(),o("div",de,[e("div",ie,[t[25]||(t[25]=e("div",{class:"mb-8"},[e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"อนุมัติคำขอเติมเงิน"),e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ตรวจสอบและอนุมัติคำขอเติมเงินจากผู้ใช้")],-1)),e("div",ue,[d(w,null,{default:h(()=>[e("div",ce,[e("div",ge,[d(u(c),{icon:"mdi:clock-outline",class:"w-6 h-6 text-yellow-600 dark:text-yellow-400"})]),e("div",null,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"รอดำเนินการ",-1)),e("p",xe,r(M.value.pending),1)])])]),_:1}),d(w,null,{default:h(()=>[e("div",pe,[e("div",ye,[d(u(c),{icon:"mdi:check-circle",class:"w-6 h-6 text-green-600 dark:text-green-400"})]),e("div",null,[t[10]||(t[10]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"อนุมัติวันนี้",-1)),e("p",me,r(M.value.approved_today),1)])])]),_:1}),d(w,null,{default:h(()=>[e("div",ve,[e("div",be,[d(u(c),{icon:"mdi:cash-multiple",class:"w-6 h-6 text-blue-600 dark:text-blue-400"})]),e("div",null,[t[11]||(t[11]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"ยอดรอดำเนินการ",-1)),e("p",_e,r(k(M.value.total_pending_amount)),1)])])]),_:1})]),d(w,{class:"mb-6"},{default:h(()=>[e("div",fe,[e("div",ke,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"สถานะ",-1)),b(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>T.value=a),class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",onChange:p},[...t[12]||(t[12]=[e("option",{value:""},"ทั้งหมด",-1),e("option",{value:"pending"},"รอดำเนินการ",-1),e("option",{value:"approved"},"อนุมัติแล้ว",-1),e("option",{value:"rejected"},"ปฏิเสธแล้ว",-1)])],544),[[se,T.value]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"ค้นหา",-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>B.value=a),type:"text",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",placeholder:"ชื่อ, อีเมล, รหัสอ้างอิง",onKeyup:re(p,["enter"])},null,544),[[_,B.value]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"จากวันที่",-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>V.value=a),type:"date",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",onChange:p},null,544),[[_,V.value]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"},"ถึงวันที่",-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>S.value=a),type:"date",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg",onChange:p},null,544),[[_,S.value]])])])])]),_:1}),d(w,null,{default:h(()=>[e("div",he,[U.value?(l(),o("div",we,[d(u(c),{icon:"mdi:loading",class:"w-8 h-8 text-primary-500 animate-spin mx-auto"}),t[17]||(t[17]=e("p",{class:"text-gray-500 mt-2"},"กำลังโหลด...",-1))])):C.value.length>0?(l(),o("table",je,[t[23]||(t[23]=e("thead",{class:"bg-gray-50 dark:bg-gray-800"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"ผู้ใช้"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"จำนวนเงิน"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"ข้อมูลการโอน"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"สลิป"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"วันที่"),e("th",{class:"px-4 py-3 text-left text-sm font-medium text-gray-700 dark:text-gray-300"},"สถานะ"),e("th",{class:"px-4 py-3 text-right text-sm font-medium text-gray-700 dark:text-gray-300"},"จัดการ")])],-1)),e("tbody",Ce,[(l(!0),o(N,null,le(C.value,a=>(l(),o("tr",{key:a.id,class:"hover:bg-gray-50 dark:hover:bg-gray-800/50"},[e("td",$e,[e("div",Ae,[e("img",{src:a.user.avatar||"/default-avatar.png",alt:a.user.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Te),e("div",null,[e("p",Be,r(a.user.name),1),e("p",Ve,r(a.user.email),1),e("p",Se,r(a.user.reference_code),1)])])]),e("td",Me,[e("p",Fe,r(k(a.amount)),1),e("p",Ue,r(a.payment_method_label),1)]),e("td",Re,[e("div",Pe,[a.bank_name?(l(),o("p",ze,[t[18]||(t[18]=e("span",{class:"text-gray-500"},"ธนาคาร:",-1)),m(" "+r(a.bank_name),1)])):g("",!0),a.transfer_date?(l(),o("p",Ne,[t[19]||(t[19]=e("span",{class:"text-gray-500"},"วันที่โอน:",-1)),m(" "+r(a.transfer_date),1)])):g("",!0),a.reference_number?(l(),o("p",De,[t[20]||(t[20]=e("span",{class:"text-gray-500"},"อ้างอิง:",-1)),m(" "+r(a.reference_number),1)])):g("",!0)])]),e("td",He,[a.transfer_slip?(l(),o("img",{key:0,src:a.transfer_slip,alt:"Transfer slip",class:"w-16 h-16 object-cover rounded-lg cursor-pointer hover:opacity-80 border",onClick:H=>W(a.transfer_slip)},null,8,Ie)):(l(),o("span",Ke,"-"))]),e("td",Le,[e("p",Ee,r(a.created_at),1)]),e("td",Oe,[e("span",{class:oe(["px-3 py-1 text-xs font-medium rounded-full",J(a.status)])},r(a.status_label),3)]),e("td",Ge,[a.status==="pending"?(l(),o("div",Qe,[e("button",{class:"px-3 py-1.5 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 transition-colors",onClick:H=>E(a)},[d(u(c),{icon:"mdi:check",class:"w-4 h-4 inline mr-1"}),t[21]||(t[21]=m(" อนุมัติ ",-1))],8,Je),e("button",{class:"px-3 py-1.5 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors",onClick:H=>O(a)},[d(u(c),{icon:"mdi:close",class:"w-4 h-4 inline mr-1"}),t[22]||(t[22]=m(" ปฏิเสธ ",-1))],8,We)])):(l(),o("div",Xe,[a.reviewed_at?(l(),o("p",Ye,r(a.reviewed_at),1)):g("",!0),a.rejection_reason?(l(),o("p",Ze,r(a.rejection_reason),1)):g("",!0)]))])]))),128))])])):(l(),o("div",qe,[d(u(c),{icon:"mdi:inbox-outline",class:"w-16 h-16 mx-auto mb-4"}),t[24]||(t[24]=e("p",null,"ไม่พบคำขอเติมเงิน",-1))]))]),R.value>1?(l(),o("div",et,[e("p",tt," แสดง "+r(C.value.length)+" จาก "+r(D.value)+" รายการ ",1),e("div",at,[e("button",{disabled:v.value<=1,class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-lg disabled:opacity-50",onClick:t[4]||(t[4]=a=>{v.value--,p()})},[d(u(c),{icon:"mdi:chevron-left",class:"w-5 h-5"})],8,st),e("span",rt,r(v.value),1),e("button",{disabled:v.value>=R.value,class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-lg disabled:opacity-50",onClick:t[5]||(t[5]=a=>{v.value++,p()})},[d(u(c),{icon:"mdi:chevron-right",class:"w-5 h-5"})],8,lt)])])):g("",!0)]),_:1})]),(l(),z(ae,{to:"body"},[$.value?(l(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:te(f,["self"])},[e("div",ot,[e("div",nt,[A.value==="approve"?(l(),o(N,{key:0},[e("div",dt,[e("div",it,[d(u(c),{icon:"mdi:check-circle",class:"w-8 h-8 text-green-600"})]),t[26]||(t[26]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"อนุมัติการเติมเงิน",-1)),t[27]||(t[27]=e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ยืนยันอนุมัติการเติมเงินนี้?",-1))]),n.value?(l(),o("div",ut,[e("div",ct,[e("img",{src:n.value.user.avatar||"/default-avatar.png",class:"w-12 h-12 rounded-full"},null,8,gt),e("div",null,[e("p",xt,r(n.value.user.name),1),e("p",pt,r(n.value.user.email),1)])]),e("p",yt,r(k(n.value.amount)),1)])):g("",!0),e("div",mt,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"หมายเหตุ Admin (ถ้ามี)",-1)),b(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=a=>F.value.admin_note=a),rows:"2",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"หมายเหตุเพิ่มเติม..."},null,512),[[_,F.value.admin_note]])]),e("div",vt,[e("button",{class:"flex-1 px-4 py-3 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",onClick:f}," ยกเลิก "),e("button",{class:"flex-1 px-4 py-3 bg-green-500 text-white font-medium rounded-xl hover:bg-green-600 transition-colors disabled:opacity-50",disabled:y.value,onClick:G},[y.value?(l(),z(u(c),{key:0,icon:"mdi:loading",class:"w-5 h-5 animate-spin inline mr-2"})):g("",!0),t[29]||(t[29]=m(" ยืนยันอนุมัติ ",-1))],8,bt)])],64)):A.value==="reject"?(l(),o(N,{key:1},[e("div",_t,[e("div",ft,[d(u(c),{icon:"mdi:close-circle",class:"w-8 h-8 text-red-600"})]),t[30]||(t[30]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"ปฏิเสธการเติมเงิน",-1)),t[31]||(t[31]=e("p",{class:"text-gray-600 dark:text-gray-400 mt-2"},"ยืนยันปฏิเสธคำขอเติมเงินนี้?",-1))]),n.value?(l(),o("div",kt,[e("div",ht,[e("img",{src:n.value.user.avatar||"/default-avatar.png",class:"w-12 h-12 rounded-full"},null,8,wt),e("div",null,[e("p",jt,r(n.value.user.name),1),e("p",Ct,r(n.value.user.email),1)])]),e("p",$t,r(k(n.value.amount)),1)])):g("",!0),e("div",At,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[m(" เหตุผลที่ปฏิเสธ "),e("span",{class:"text-red-500"},"*")],-1)),b(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>x.value.rejection_reason=a),rows:"3",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"กรุณาระบุเหตุผล..."},null,512),[[_,x.value.rejection_reason]])]),e("div",Tt,[t[33]||(t[33]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"หมายเหตุ Admin (ถ้ามี)",-1)),b(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=a=>x.value.admin_note=a),rows:"2",class:"w-full px-4 py-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl",placeholder:"หมายเหตุเพิ่มเติม..."},null,512),[[_,x.value.admin_note]])]),e("div",Bt,[e("button",{class:"flex-1 px-4 py-3 bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 font-medium rounded-xl hover:bg-gray-300 dark:hover:bg-gray-500 transition-colors",onClick:f}," ยกเลิก "),e("button",{class:"flex-1 px-4 py-3 bg-red-500 text-white font-medium rounded-xl hover:bg-red-600 transition-colors disabled:opacity-50",disabled:y.value||!x.value.rejection_reason.trim(),onClick:Q},[y.value?(l(),z(u(c),{key:0,icon:"mdi:loading",class:"w-5 h-5 animate-spin inline mr-2"})):g("",!0),t[34]||(t[34]=m(" ยืนยันปฏิเสธ ",-1))],8,Vt)])],64)):g("",!0)])])])):g("",!0)]))]))}});export{Ut as default};
