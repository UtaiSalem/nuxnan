import{c,o as d,a as e,t as l,F as E,k as G,T as L,a7 as z,a9 as W,r as _,n as $,b as m,w as I,e as C,u as T,I as B,$ as J,aa as K,d as S,j as P,g as R}from"./cTealXVQ.js";import X from"./BFyhvphK.js";import{_ as Y}from"./B4QNxFN5.js";import{_ as V}from"./mnJICWpN.js";import{_ as Z}from"./BL-z8FvV.js";import"./Dtfmjnau.js";import"./ChBnuzYQ.js";import"./DJsVOgax.js";import"./Cpj98o6Y.js";import"./CYLt1a9j.js";import"./srasqk13.js";import"./BZ03tRGr.js";import"./lnTR9AaX.js";import"./VPWt-suZ.js";import"./CaSR6SuD.js";import"./BQxta0Da.js";const ee={class:"bg-white p-4 rounded-xl shadow-lg border border-gray-100"},te={class:"font-bold mb-4 ml-4 text-gray-700"},se={class:"overflow-x-auto"},oe={class:"w-full text-left"},re={class:"p-3"},ae={class:"font-medium text-gray-800"},le={class:"text-xs text-gray-500"},ne={class:"p-3 text-center"},ie={class:"p-3 text-center"},de={class:"w-full bg-gray-200 rounded-full h-2 mb-1"},ce={class:"text-xs text-gray-500"},ue={class:"p-3 text-center"},be={class:"w-full bg-gray-200 rounded-full h-2 mb-1"},pe={class:"text-xs text-gray-500"},ge={class:"p-3 text-center"},me={class:"w-full bg-gray-200 rounded-full h-2 mb-1"},xe={class:"text-xs text-gray-500"},_e={class:"p-3 text-center"},he={class:"font-bold text-gray-700"},fe={class:"p-3 text-center"},ve={class:"px-2 py-1 rounded text-xs font-bold bg-blue-100 text-blue-700"},ye={class:"p-3 text-center"},we=["onClick"],$e={__name:"MembersProgress",props:{groupName:String,members:Array,isCourseAdmin:Boolean},emits:["view"],setup(h){const f=s=>s?s>=80?"text-green-600":s>=50?"text-orange-600":"text-red-600":"text-gray-400";return(s,k)=>(d(),c("div",ee,[e("h3",te,"ลำดับความคืบหน้าของสมาชิก - "+l(h.groupName),1),e("div",se,[e("table",oe,[k[0]||(k[0]=e("thead",null,[e("tr",{class:"bg-gray-50 text-gray-600 text-sm"},[e("th",{class:"p-3 font-semibold"},"ชื่อ-นามสกุล"),e("th",{class:"p-3 font-semibold text-center"},"การเข้าเรียน"),e("th",{class:"p-3 font-semibold text-center"},"บทเรียน"),e("th",{class:"p-3 font-semibold text-center"},"งาน"),e("th",{class:"p-3 font-semibold text-center"},"แบบทดสอบ"),e("th",{class:"p-3 font-semibold text-center"},"คะแนนรวม"),e("th",{class:"p-3 font-semibold text-center"},"เกรด"),e("th",{class:"p-3 font-semibold text-center"},"จัดการ")])],-1)),e("tbody",null,[(d(!0),c(E,null,G(h.members,r=>(d(),c("tr",{key:r.id,class:"border-t hover:bg-blue-50/50 transition-colors"},[e("td",re,[e("div",ae,l(r.member_name),1),e("div",le,l(r.member_code||"-"),1)]),e("td",ne,[e("div",{class:L(["text-sm font-bold",f(r.attendance_rate)])},l(r.attendance_rate||0)+"% ",3)]),e("td",ie,[e("div",de,[e("div",{class:"bg-blue-600 h-2 rounded-full",style:z(`width: ${r.lessons_progress||0}%`)},null,4)]),e("span",ce,l(r.lessons_progress||0)+"%",1)]),e("td",ue,[e("div",be,[e("div",{class:"bg-green-600 h-2 rounded-full",style:z(`width: ${r.assignments_progress||0}%`)},null,4)]),e("span",pe,l(r.assignments_progress||0)+"%",1)]),e("td",ge,[e("div",me,[e("div",{class:"bg-purple-600 h-2 rounded-full",style:z(`width: ${r.quizzes_progress||0}%`)},null,4)]),e("span",xe,l(r.quizzes_progress||0)+"%",1)]),e("td",_e,[e("span",he,l(r.scores?.total_score||0),1)]),e("td",fe,[e("span",ve,l(r.scores?.grade_name||"-"),1)]),e("td",ye,[e("button",{onClick:A=>s.$emit("view",r),class:"bg-blue-50 text-blue-600 hover:bg-blue-100 px-3 py-1 rounded-lg text-sm transition-colors font-medium"}," รายละเอียด ",8,we)])]))),128))])])])]))}},Ce={key:0,class:"md:-ml-4 md:mr-4"},ke={class:"mb-6 px-4"},Ae={class:"bg-white rounded-xl shadow-lg p-6 border border-gray-100"},Me={class:"flex justify-end mb-4"},Oe=["disabled"],je={class:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4"},ze={class:"bg-blue-50 p-4 rounded-lg border border-blue-100"},Ie={class:"text-2xl font-bold text-blue-700"},Te={class:"bg-green-50 p-4 rounded-lg border border-green-100"},Be={class:"text-2xl font-bold text-green-700"},Se={class:"text-sm text-gray-500"},Le={class:"bg-purple-50 p-4 rounded-lg border border-purple-100"},Ne={class:"text-2xl font-bold text-purple-700"},Pe={class:"bg-red-50 p-4 rounded-lg border border-red-100"},Re={class:"text-2xl font-bold text-red-700"},Ve={class:"bg-orange-50 p-4 rounded-lg border border-orange-100"},Ee={class:"text-2xl font-bold text-orange-700"},Ge={class:"bg-indigo-50 p-4 rounded-lg border border-indigo-100"},qe={class:"text-2xl font-bold text-indigo-700"},De={class:"px-4 mb-4"},Ue={class:"relative"},Fe={class:"","aria-multiselectable":"false"},He={key:0,class:"flex flex-wrap items-center border-b plearnd-card bg-gradient-to-r from-blue-50 via-green-50 to-yellow-50",role:"tablist"},Qe=["onClick"],We={key:0,class:"w-1/2 md:w-1/3 lg:w-1/4",role:"presentation "},Je={class:""},Ke={class:"bg-gradient-to-br from-blue-50 via-green-50 to-yellow-50 mt-4 p-4 rounded-xl shadow-lg border border-blue-100",id:"tab-panel-1a","aria-hidden":"false",role:"tabpanel","aria-labelledby":"tab-label-1a",tabindex:"-1"},Xe={key:1,class:"p-4"},Ye={class:"text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2"},Ze={key:1,class:"text-center text-gray-500 py-10"},et={class:"p-6"},tt={class:"flex justify-between items-center mb-6"},st={class:"flex items-center gap-3"},ot={class:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold"},rt={class:"text-xl font-bold text-gray-800 dark:text-white"},at={class:"text-sm text-gray-500"},lt={class:"max-h-[80vh] overflow-y-auto"},$t={__name:"CourseMembersProgress",props:{course:Object,groups:Object,isCourseAdmin:Boolean,courseMemberOfAuth:Object,members:Object,assignments:Object,quizzes:Object,courseMembersProgress:Object},setup(h){const f=W(),s=h,r=_((()=>{const o=s.courseMemberOfAuth?.last_accessed_group_tab;if(!o)return 0;const a=(s.groups?.data||[]).findIndex(n=>n.id===o);return a>=0?a:0})());async function A(o){r.value=o;const t=s.groups?.data||[];if(o<t.length&&s.courseMemberOfAuth){const a=t[o].id;try{(await f.post(`/api/courses/${s.course.data.id}/members/${s.courseMemberOfAuth.id}/set-active-group-tab`,{group_tab:a})).success&&(s.courseMemberOfAuth.last_accessed_group_tab=a)}catch(n){console.error("Error saving group tab:",n)}}}const M=$(()=>{const o=s.members?.data||[],t=s.course?.data?.user?.id;return o.filter(a=>!a.group).filter(a=>a.user?.id!==t)}),p=$(()=>{const o=s.courseMembersProgress||[];if(!o.length)return{average:0,max:0,min:0,passCount:0,failCount:0,passRate:0,avgAttendance:0,totalAttendSessions:0};const t=o.map(b=>b.scores?.total_score||0),n=t.reduce((b,j)=>b+j,0)/t.length||0,i=Math.max(...t),u=Math.min(...t),N=o.map(b=>b.attendance_rate||0),F=N.reduce((b,j)=>b+j,0)/N.length,H=o[0]?.total_attendance||0,Q=(s.course?.data?.total_score||100)/2,O=t.filter(b=>b>=Q).length;return{average:n.toFixed(1),max:i,min:u,passCount:O,failCount:t.length-O,passRate:(O/t.length*100).toFixed(1),avgAttendance:F.toFixed(1),totalAttendSessions:H}}),x=_(!1),q=async()=>{if(!x.value){x.value=!0;try{const o=s.groups?.data||[],t=r.value<o.length?o[r.value].id:"all",a=await f.get(`/api/courses/${s.course.data.id}/export/results`,{params:{group_id:t},responseType:"blob"}),n=new Blob([a],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=window.URL.createObjectURL(n),u=document.createElement("a");u.href=i,u.setAttribute("download",`results-${s.course.data.id}-${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(i)}catch(o){console.error("Export failed:",o),alert("เกิดข้อผิดพลาดในการส่งออกข้อมูล กรุณาลองใหม่อีกครั้ง")}finally{x.value=!1}}},v=_(""),D=$(()=>{const o=s.groups?.data||[];let t=[];if(r.value<o.length?t=o[r.value]?.members||[]:t=M.value,s.courseMembersProgress&&(t=t.map(n=>{const i=s.courseMembersProgress.find(u=>u.member.id===n.id);return i?{...n,scores:i.scores,attendance_rate:i.attendance_rate,lessons_progress:i.lessons_progress,assignments_progress:i.assignments_progress,quizzes_progress:i.quizzes_progress,overall_progress:i.overall_progress}:n})),!v.value)return t;const a=v.value.toLowerCase();return t.filter(n=>n.member_name&&n.member_name.toLowerCase().includes(a)||n.member_code&&n.member_code.toLowerCase().includes(a))}),y=$(()=>s.groups?.data||[]),w=_(!1),g=_(null),U=o=>{g.value=o,w.value=!0};return(o,t)=>(d(),c("div",null,[m(X,{course:s.course,lessons:s.lessons,groups:s.groups,isCourseAdmin:s.isCourseAdmin,courseMemberOfAuth:s.courseMemberOfAuth,activeTab:10},{courseContent:I(()=>[s.isCourseAdmin?(d(),c("div",Ce,[e("div",ke,[e("div",Ae,[t[10]||(t[10]=e("h2",{class:"text-2xl font-bold text-gray-800 mb-4 flex items-center"},[e("svg",{class:"w-6 h-6 mr-2 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})]),C(" ภาพรวมผลการเรียน (Dashboard) ")],-1)),e("div",Me,[e("button",{onClick:q,disabled:x.value,class:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors shadow-md disabled:opacity-50"},[m(T(B),{icon:x.value?"line-md:loading-twotone-loop":"lucide:file-spreadsheet",class:"w-5 h-5"},null,8,["icon"]),C(" "+l(x.value?"กำลังส่งออก...":"ส่งออก Excel"),1)],8,Oe)]),e("div",je,[e("div",ze,[t[4]||(t[4]=e("p",{class:"text-sm text-gray-600"},"คะแนนเฉลี่ย",-1)),e("p",Ie,l(p.value.average),1)]),e("div",Te,[t[5]||(t[5]=e("p",{class:"text-sm text-gray-600"},"ผ่านเกณฑ์",-1)),e("p",Be,[C(l(p.value.passCount)+" ",1),e("span",Se,"("+l(p.value.passRate)+"%)",1)])]),e("div",Le,[t[6]||(t[6]=e("p",{class:"text-sm text-gray-600"},"คะแนนสูงสุด",-1)),e("p",Ne,l(p.value.max),1)]),e("div",Pe,[t[7]||(t[7]=e("p",{class:"text-sm text-gray-600"},"คะแนนต่ำสุด",-1)),e("p",Re,l(p.value.min),1)]),e("div",Ve,[t[8]||(t[8]=e("p",{class:"text-sm text-gray-600"},"การเข้าเรียนเฉลี่ย",-1)),e("p",Ee,l(p.value.avgAttendance)+"%",1)]),e("div",Ge,[t[9]||(t[9]=e("p",{class:"text-sm text-gray-600"},"จำนวนคาบเรียน",-1)),e("p",qe,l(p.value.totalAttendSessions),1)])])])]),e("div",De,[e("div",Ue,[t[11]||(t[11]=e("span",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[e("svg",{class:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),J(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>v.value=a),type:"text",class:"w-full py-2 pl-10 pr-4 text-gray-700 bg-white border rounded-lg focus:border-blue-400 focus:outline-none focus:ring focus:ring-blue-300 focus:ring-opacity-40",placeholder:"ค้นหาสมาชิกด้วยชื่อ หรือ รหัสนักศึกษา..."},null,512),[[K,v.value]])])]),e("section",Fe,[s.isCourseAdmin?(d(),c("ul",He,[(d(!0),c(E,null,G(y.value,(a,n)=>(d(),c("li",{key:n,class:"w-1/2 md:w-1/3 lg:w-1/4",role:"presentation "},[e("button",{onClick:P(i=>A(n),["prevent"]),class:L(["inline-flex items-center justify-center w-full h-12 gap-2 px-6 mb-2 text-sm tracking-wide transition duration-200 border-b-2 rounded-t focus-visible:outline-none whitespace-nowrap font-medium shadow-sm hover:scale-105",r.value===n?"border-blue-500 bg-gradient-to-r from-blue-200 via-green-100 to-yellow-100 text-blue-900 font-bold shadow-lg":"border-transparent bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700"]),id:"tab-label-1a",role:"tab","aria-setsize":"3","aria-posinset":"1",tabindex:"0","aria-controls":"tab-panel-1a","aria-selected":"true"},[e("span",null,l(a.name+" ("+(a.members?.length||0)+")"),1)],10,Qe)]))),128)),M.value.length>0?(d(),c("li",We,[e("button",{onClick:t[1]||(t[1]=P(a=>A(y.value.length),["prevent"])),class:L(["inline-flex items-center justify-center w-full h-12 gap-2 px-6 mb-2 text-sm tracking-wide transition duration-200 border-b-2 rounded-t focus-visible:outline-none whitespace-nowrap font-medium shadow-sm hover:scale-105",r.value===y.value.length?"border-blue-500 bg-gradient-to-r from-blue-200 via-green-100 to-yellow-100 text-blue-900 font-bold shadow-lg":"border-transparent bg-white text-gray-600 hover:bg-blue-100 hover:text-blue-700"]),id:"tab-label-1a",role:"tab","aria-setsize":"3","aria-posinset":"1",tabindex:"0","aria-controls":"tab-panel-1a","aria-selected":"true"},[e("span",null,l("ไม่มีกลุ่ม ("+M.value.length+")"),1)],2)])):S("",!0)])):S("",!0)]),e("section",Je,[e("div",Ke,[m(Y,{duration:50,tag:"ul",class:"flex flex-col w-full"},{default:I(()=>[m($e,{groupName:y.value[r.value]?.name||"ไม่มีกลุ่ม",members:D.value,isCourseAdmin:s.isCourseAdmin,onView:U},null,8,["groupName","members","isCourseAdmin"])]),_:1})])])])):(d(),c("div",Xe,[e("h2",Ye,[m(T(B),{icon:"fluent:chart-person-24-filled",class:"text-blue-600"}),t[12]||(t[12]=C(" ผลการเรียนของฉัน (My Progress) ",-1))]),s.courseMemberOfAuth?(d(),R(V,{key:0,courseId:s.course.data.id,memberId:s.courseMemberOfAuth.id},null,8,["courseId","memberId"])):(d(),c("div",Ze," ไม่พบข้อมูลสมาชิกของท่านในรายวิชานี้ "))]))]),_:1},8,["course","lessons","groups","isCourseAdmin","courseMemberOfAuth"]),m(Z,{show:w.value,onClose:t[3]||(t[3]=a=>w.value=!1),maxWidth:"4xl"},{default:I(()=>[e("div",et,[e("div",tt,[e("div",st,[e("div",ot,l(g.value?.member_name?.charAt(0)||"U"),1),e("div",null,[e("h3",rt," ผลการเรียนของ "+l(g.value?.member_name),1),e("p",at,l(g.value?.member_code||"-"),1)])]),e("button",{onClick:t[2]||(t[2]=a=>w.value=!1),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors text-gray-500"},[m(T(B),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6"})])]),e("div",lt,[g.value?(d(),R(V,{courseId:s.course.data.id,memberId:g.value.id,key:g.value.id},null,8,["courseId","memberId"])):S("",!0)])])]),_:1},8,["show"])]))}};export{$t as default};
