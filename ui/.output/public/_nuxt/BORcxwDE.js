import{_ as ge,a9 as ve,r as u,n as J,g as H,o as l,b as d,w as re,c as a,d as f,j as de,a as e,u as n,I as c,$ as X,t as b,F as K,k as Q,T as te,aj as ue,aa as le,a0 as $e,ab as qe,a1 as ce,a4 as Ce,q as fe,l as Ge,a3 as Ae,e as Y,z as He,W as Qe,aO as We,h as Je}from"./CHs-R6Sv.js";import{u as pe}from"./DEvg0A1a.js";import{u as he}from"./CaSR6SuD.js";import{u as De}from"./B34yIM1Q.js";import{_ as Xe}from"./DROJGjoa.js";import{P as Ye,S as Ze}from"./5TcqFHpY.js";import{I as et}from"./B3kjDgzc.js";import"./BQxta0Da.js";const tt={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},st={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},lt={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},at={class:"flex items-center gap-2"},rt={class:"p-4 max-h-[70vh] overflow-y-auto"},it={class:"flex items-center gap-3 mb-4"},ot=["src"],nt={class:"flex-1"},dt={class:"font-medium text-gray-800 dark:text-white"},ut={class:"flex items-center gap-1 text-xs text-gray-500"},ct={class:"flex border-b border-gray-200 dark:border-vikinger-dark-50/30 mb-4"},gt=["onClick"],vt={class:"rounded-lg mb-4 min-h-[120px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},pt=["onKeydown","disabled"],kt={key:0,class:"mb-4"},ft={class:"flex flex-wrap gap-2"},ht=["src"],bt=["onClick"],xt={class:"text-xs text-gray-500 mt-1"},yt={key:1,class:"mb-4 space-y-2"},mt={class:"flex items-center gap-3"},_t={class:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},wt={class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[200px]"},$t={class:"text-xs text-gray-500"},Ct=["onClick"],At={class:"mb-4"},Dt={class:"p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-700/30"},It={class:"flex items-center justify-between mb-3"},Bt={class:"flex items-center gap-2"},Lt={class:"space-y-3 mb-4"},jt={class:"w-7 h-7 rounded-full bg-vikinger-purple text-white flex items-center justify-center text-xs font-bold flex-shrink-0"},Mt=["onUpdate:modelValue","placeholder"],St=["onClick"],Pt={class:"mt-3 pt-3 border-t border-amber-200 dark:border-amber-700/30"},Tt={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400"},Ft={class:"grid grid-cols-2 gap-4 mt-6"},Ut={class:"relative flex items-center"},Ot={class:"absolute left-3 text-vikinger-cyan"},Et={class:"relative flex items-center"},Rt={class:"absolute left-3 text-vikinger-orange"},Vt={class:"mt-4 p-4 bg-vikinger-cyan/5 dark:bg-vikinger-cyan/10 border border-vikinger-cyan/20 rounded-xl"},zt={class:"flex items-start gap-3"},Nt={class:"text-sm dark:text-gray-200 w-full"},Kt={class:"space-y-1.5"},qt={class:"flex justify-between items-center text-gray-600 dark:text-gray-400"},Gt={class:"font-semibold"},Ht={class:"flex justify-between items-center pt-2 border-t border-vikinger-cyan/20 font-bold text-gray-800 dark:text-white mt-1"},Qt={class:"mt-3 flex items-center gap-2 text-xs text-green-600 dark:text-green-400 font-medium"},Wt={key:0,class:"text-xs text-red-500 font-bold mt-2"},Jt={key:0,class:"flex flex-wrap gap-2 border-t border-gray-200 dark:border-vikinger-dark-50/30 pt-4"},Xt=["disabled"],Yt=["disabled"],Zt={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30"},es=["disabled"],ts={__name:"CourseCreatePostModal",props:{show:{type:Boolean,default:!1},courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["close","post-created"],setup(_,{emit:W}){const i=_,V=W,{user:L}=pe(),j=ve(),k=he(),w=u(""),y=u(!1),S=u([]),M=u([]),m=u(null),I=u(null),C=u("status"),U=[{id:"status",label:"สถานะ",icon:"fluent:edit-24-regular"},{id:"poll",label:"โพล",icon:"fluent:poll-24-regular"}],P=u(""),B=u(["",""]),T=u(24),z=u(12e3),q=u(100),se=u("course"),O=J(()=>typeof window>"u"?[]:S.value.map(v=>({file:v,url:URL.createObjectURL(v)}))),G=()=>{V("close")},E=async()=>{if(!(!w.value.trim()&&S.value.length===0&&C.value!=="poll")&&!y.value){if(C.value==="poll"){if(!P.value.trim()){k.warning("กรุณาใส่คำถามสำหรับโพล");return}if(B.value.filter(o=>o.trim()).length<2){k.warning("กรุณาใส่ตัวเลือกอย่างน้อย 2 ตัวเลือก");return}}y.value=!0;try{const v=new FormData;v.append("content",w.value),v.append("privacy",se.value),i.groupId&&v.append("group_id",i.groupId),S.value.forEach(($,h)=>{v.append(`images[${h}]`,$)}),M.value.forEach(($,h)=>{v.append(`attachments[${h}]`,$)}),C.value==="poll"&&P.value.trim()&&(v.append("poll_question",P.value),B.value.filter(h=>h.trim()).forEach((h,ee)=>{v.append(`poll_options[${ee}]`,h)}),v.append("poll_duration",T.value),v.append("poll_points_pool",z.value),v.append("poll_max_votes",q.value));const o=await j.post(`/api/courses/${i.courseId}/posts`,v);if(o.success||o.data){const $=o.data||o.post;V("post-created",$),Z(),k.toast("สร้างโพสต์สำเร็จ!","success")}else k.error(o.message||"ไม่สามารถสร้างโพสต์ได้")}catch(v){console.error("Error creating post:",v);let o="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";v?.data?.message&&(o=v.data.message),k.error(o)}finally{y.value=!1}}},Z=()=>{w.value="",S.value=[],M.value=[],C.value="status",P.value="",B.value=["",""],T.value=24,z.value=12e3,q.value=100,G()},ie=v=>{const o=Array.from(v.target.files);S.value=[...S.value,...o].slice(0,10),v.target.value=""},D=v=>{S.value.splice(v,1)},p=()=>{m.value?.click()},A=v=>{const o=Array.from(v.target.files);M.value=[...M.value,...o].slice(0,5),v.target.value=""},F=v=>{M.value.splice(v,1)},R=()=>{I.value?.click()},N=()=>{B.value.length<10&&B.value.push("")},oe=v=>{B.value.length>2&&B.value.splice(v,1)},ae=v=>{if(v===0)return"0 Bytes";const o=1024,$=["Bytes","KB","MB","GB"],h=Math.floor(Math.log(v)/Math.log(o));return parseFloat((v/Math.pow(o,h)).toFixed(2))+" "+$[h]};return(v,o)=>(l(),H(Ce,{to:"body"},[d(ce,{name:"modal"},{default:re(()=>[_.show?(l(),a("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(G,["self"])},[e("div",tt,[e("div",st,[e("div",lt,[e("div",at,[d(n(c),{icon:"fluent:book-24-regular",class:"w-5 h-5 text-blue-500"}),o[5]||(o[5]=e("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"โพสต์ในรายวิชา",-1))]),e("button",{onClick:G,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(n(c),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),e("div",rt,[e("input",{type:"file",ref_key:"imageInput",ref:m,class:"hidden",accept:"image/*",multiple:"",onChange:ie},null,544),e("input",{type:"file",ref_key:"fileInput",ref:I,class:"hidden",multiple:"",onChange:A},null,544),e("div",it,[e("img",{src:n(L)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,ot),e("div",nt,[e("div",dt,b(n(L)?.name),1),e("div",ut,[d(n(c),{icon:"fluent:people-community-24-regular",class:"w-3 h-3"}),o[6]||(o[6]=e("span",null,"โพสต์ในรายวิชา",-1))])])]),e("div",ct,[(l(),a(K,null,Q(U,$=>e("button",{key:$.id,onClick:h=>C.value=$.id,class:te(["flex-1 pb-3 text-sm font-medium flex items-center justify-center gap-2 border-b-2 transition-colors relative",C.value===$.id?"text-blue-600 border-blue-600 dark:text-blue-400 dark:border-blue-400":"text-gray-500 dark:text-gray-400 border-transparent hover:text-gray-700 dark:hover:text-gray-300"])},[d(n(c),{icon:$.icon,class:"w-5 h-5"},null,8,["icon"]),e("span",null,b($.label),1)],10,gt)),64))]),X(e("div",null,[e("div",vt,[X(e("textarea",{"onUpdate:modelValue":o[0]||(o[0]=$=>w.value=$),placeholder:"แชร์ความรู้หรือถามคำถามในรายวิชานี้...",rows:"4",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(E,["ctrl"]),["enter"]),disabled:y.value},null,40,pt),[[le,w.value]])]),O.value.length>0?(l(),a("div",kt,[e("div",ft,[(l(!0),a(K,null,Q(O.value,($,h)=>(l(),a("div",{key:h,class:"relative group"},[e("img",{src:$.url,class:"w-24 h-24 object-cover rounded-lg border border-gray-200 dark:border-vikinger-dark-50/30"},null,8,ht),e("button",{onClick:ee=>D(h),class:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-sm md:opacity-0 md:group-hover:opacity-100 transition-opacity"},[d(n(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,bt)]))),128)),O.value.length<10?(l(),a("button",{key:0,onClick:p,class:"w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center hover:border-vikinger-purple hover:bg-vikinger-purple/5 transition-all"},[d(n(c),{icon:"fluent:add-24-regular",class:"w-8 h-8 text-gray-400"})])):f("",!0)]),e("p",xt,b(O.value.length)+"/10 รูป",1)])):f("",!0),M.value.length>0?(l(),a("div",yt,[(l(!0),a(K,null,Q(M.value,($,h)=>(l(),a("div",{key:h,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-vikinger-dark-200 rounded-lg"},[e("div",mt,[e("div",_t,[d(n(c),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"})]),e("div",null,[e("p",wt,b($.name),1),e("p",$t,b(ae($.size)),1)])]),e("button",{onClick:ee=>F(h),class:"p-1 hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 rounded-full"},[d(n(c),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4 text-gray-400 hover:text-red-500"})],8,Ct)]))),128))])):f("",!0)],512),[[$e,C.value==="status"]]),X(e("div",At,[e("div",Dt,[e("div",It,[e("div",Bt,[d(n(c),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-600"}),o[7]||(o[7]=e("span",{class:"font-medium text-amber-700 dark:text-amber-300"},"รายละเอียดโพล",-1))])]),X(e("input",{"onUpdate:modelValue":o[1]||(o[1]=$=>P.value=$),type:"text",placeholder:"คำถามโพล...",class:"w-full px-3 py-2 mb-3 rounded-lg border border-amber-200 dark:border-amber-700/50 bg-white dark:bg-vikinger-dark-200 text-gray-800 dark:text-white"},null,512),[[le,P.value]]),e("div",Lt,[(l(!0),a(K,null,Q(B.value,($,h)=>(l(),a("div",{key:h,class:"flex items-center gap-3 p-3 bg-white dark:bg-vikinger-dark-100 rounded-xl border border-gray-200 dark:border-vikinger-dark-50/30"},[e("div",jt,b(h+1),1),X(e("input",{"onUpdate:modelValue":ee=>B.value[h]=ee,type:"text",placeholder:`ตัวเลือกที่ ${h+1}`,class:"flex-1 bg-transparent border-none outline-none text-gray-800 dark:text-white text-sm"},null,8,Mt),[[le,B.value[h]]]),B.value.length>2?(l(),a("button",{key:0,onClick:ee=>oe(h),class:"p-1 text-gray-400 hover:text-red-500 transition-colors"},[d(n(c),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"})],8,St)):f("",!0)]))),128))]),B.value.length<10?(l(),a("button",{key:0,onClick:N,class:"w-full h-11 border-2 border-dashed border-gray-200 dark:border-vikinger-dark-50/20 rounded-xl flex items-center justify-center gap-2 text-sm text-gray-500 hover:border-vikinger-cyan hover:text-vikinger-cyan transition-all mb-4"},[d(n(c),{icon:"fluent:add-24-regular",class:"w-5 h-5"}),o[8]||(o[8]=e("span",null,"เพิ่มตัวเลือก (สูงสุด 10 ตัวเลือก)",-1))])):f("",!0),e("div",Pt,[e("label",Tt,[d(n(c),{icon:"fluent:clock-24-regular",class:"w-4 h-4"}),o[10]||(o[10]=e("span",null,"ระยะเวลาโพล:",-1)),X(e("select",{"onUpdate:modelValue":o[2]||(o[2]=$=>T.value=$),class:"px-2 py-1 rounded border border-gray-200 dark:border-vikinger-dark-50/30 bg-white dark:bg-vikinger-dark-100 text-sm"},[...o[9]||(o[9]=[e("option",{value:1},"1 ชั่วโมง",-1),e("option",{value:6},"6 ชั่วโมง",-1),e("option",{value:12},"12 ชั่วโมง",-1),e("option",{value:24},"1 วัน",-1),e("option",{value:72},"3 วัน",-1),e("option",{value:168},"1 สัปดาห์",-1)])],512),[[qe,T.value]])])])]),e("div",Ft,[e("div",null,[o[11]||(o[11]=e("label",{class:"block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider"}," แต้มรางวัลรวม ",-1)),e("div",Ut,[e("div",Ot,[d(n(c),{icon:"mdi:piggy-bank",class:"w-4 h-4"})]),X(e("input",{"onUpdate:modelValue":o[3]||(o[3]=$=>z.value=$),type:"number",min:"0",step:"100",class:"w-full pl-9 pr-3 py-2.5 bg-gray-50 dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/10 rounded-xl text-sm focus:ring-1 focus:ring-vikinger-cyan outline-none",placeholder:"0"},null,512),[[le,z.value,void 0,{number:!0}]])])]),e("div",null,[o[12]||(o[12]=e("label",{class:"block text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider"}," จำนวนคนโหวตสูงสุด ",-1)),e("div",Et,[e("div",Rt,[d(n(c),{icon:"mdi:account-group",class:"w-4 h-4"})]),X(e("input",{"onUpdate:modelValue":o[4]||(o[4]=$=>q.value=$),type:"number",min:"1",class:"w-full pl-9 pr-3 py-2.5 bg-gray-50 dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/10 rounded-xl text-sm focus:ring-1 focus:ring-vikinger-cyan outline-none",placeholder:"100"},null,512),[[le,q.value,void 0,{number:!0}]])])])]),e("div",Vt,[e("div",zt,[d(n(c),{icon:"fluent:info-24-regular",class:"w-6 h-6 text-vikinger-cyan flex-shrink-0 mt-0.5"}),e("div",Nt,[o[17]||(o[17]=e("p",{class:"font-bold text-vikinger-cyan mb-2"},"สรุปแต้มที่ต้องใช้:",-1)),e("ul",Kt,[o[15]||(o[15]=e("li",{class:"flex justify-between items-center text-gray-600 dark:text-gray-400"},[e("span",null,"ค่าธรรมเนียมสร้างโพล"),e("span",{class:"font-semibold"},"180 แต้ม")],-1)),e("li",qt,[o[13]||(o[13]=e("span",null,"แต้มรางวัลสำหรับคนโหวต",-1)),e("span",Gt,b(z.value)+" แต้ม",1)]),e("li",Ht,[o[14]||(o[14]=e("span",null,"รวมทั้งหมด",-1)),e("span",null,b(180+z.value)+" แต้ม",1)])]),e("div",Qt,[d(n(c),{icon:"fluent:gift-24-regular",class:"w-4 h-4"}),o[16]||(o[16]=e("span",null,"ผู้ร่วมโหวตจะได้รับแต้มรางวัลโดยอัตโนมัติ!",-1))]),n(L)&&n(L).pp<180+z.value?(l(),a("p",Wt," ! คุณมีแต้มไม่เพียงพอ (ปัจจุบัน "+b(n(L).pp)+" แต้ม) ",1)):f("",!0)])])])],512),[[$e,C.value==="poll"]]),C.value==="status"?(l(),a("div",Jt,[e("button",{onClick:p,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all",disabled:y.value},[d(n(c),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),o[18]||(o[18]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"รูปภาพ",-1))],8,Xt),e("button",{onClick:R,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all",disabled:y.value},[d(n(c),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),o[19]||(o[19]=e("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"ไฟล์แนบ",-1))],8,Yt)])):f("",!0)]),e("div",Zt,[e("button",{onClick:E,disabled:y.value||C.value==="status"&&!w.value.trim()&&O.value.length===0||C.value==="poll"&&!P.value.trim(),class:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[y.value?(l(),H(n(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):f("",!0),e("span",null,b(y.value?"กำลังโพสต์...":"โพสต์"),1)],8,es)])])])])):f("",!0)]),_:1})]))}},ss=ge(ts,[["__scopeId","data-v-240cdcfa"]]),ls={class:"bg-white dark:bg-vikinger-dark-100 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-vikinger-dark-50/20"},as={class:"flex items-center gap-3 mb-3"},rs=["src"],is={class:"flex items-center justify-around pt-2 border-t border-gray-100 dark:border-vikinger-dark-50/20"},os={__name:"CourseCreatePostBox",props:{courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["post-created"],setup(_,{emit:W}){const i=W,{user:V}=pe(),{getAvatarUrl:L}=De(),j=u(!1),k=J(()=>L(V.value)),w=()=>{j.value=!0},y=()=>{j.value=!1},S=M=>{i("post-created",M),y()};return(M,m)=>(l(),a("div",ls,[e("div",as,[e("img",{src:k.value,alt:"Avatar",class:"w-10 h-10 rounded-full object-cover ring-2 ring-vikinger-purple/20"},null,8,rs),e("button",{onClick:w,class:"flex-1 text-left px-4 py-2.5 bg-gray-100 dark:bg-vikinger-dark-200/50 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-vikinger-dark-200 transition-colors text-sm"}," โพสต์อะไรในรายวิชานี้... ")]),e("div",is,[e("button",{onClick:w,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(n(c),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),m[0]||(m[0]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"รูปภาพ",-1))]),e("button",{onClick:w,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(n(c),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),m[1]||(m[1]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"ไฟล์แนบ",-1))]),e("button",{onClick:w,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(n(c),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-500"}),m[2]||(m[2]=e("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"โพล",-1))])]),d(ss,{show:j.value,"course-id":_.courseId,"group-id":_.groupId,onClose:y,onPostCreated:S},null,8,["show","course-id","group-id"])]))}},ns={class:"bg-white dark:bg-vikinger-dark-200 rounded-xl shadow-sm overflow-hidden"},ds={class:"p-4 flex items-start gap-3"},us=["src","alt"],cs={class:"flex-1 min-w-0"},gs={class:"flex items-center gap-2"},vs={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},ps={class:"text-sm text-gray-500 dark:text-gray-400"},ks={key:0,class:"text-gray-400"},fs={key:0,class:"relative"},hs={key:0,class:"absolute right-0 top-full mt-1 w-36 bg-white dark:bg-vikinger-dark-300 rounded-lg shadow-lg border border-gray-200 dark:border-vikinger-dark-50/30 py-1 z-10"},bs={class:"px-4 pb-3"},xs={key:0,class:"prose dark:prose-invert prose-sm max-w-none whitespace-pre-wrap"},ys={key:0,class:"relative"},ms=["src","alt"],_s=["onClick"],ws=["src","alt"],$s={key:0,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},Cs={class:"text-2xl font-bold text-white"},As={key:1,class:"px-4 py-2"},Ds={class:"space-y-2"},Is=["href"],Bs={class:"flex-1 text-sm text-gray-700 dark:text-gray-300 truncate"},Ls={class:"text-xs text-gray-400"},js={key:2,class:"px-4 mb-3"},Ms={class:"px-4 py-2 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},Ss={class:"flex items-center gap-3"},Ps={key:0,class:"flex items-center gap-1"},Ts={class:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center"},Fs={key:1,class:"flex items-center gap-1"},Us={class:"w-5 h-5 rounded-full bg-gray-400 flex items-center justify-center"},Os={class:"flex items-center gap-4"},Es={key:1},Rs={class:"px-4 py-2 border-t border-gray-100 dark:border-vikinger-dark-50/30 flex items-center"},Vs=["disabled"],zs=["disabled"],Ns={key:0,class:"border-t border-gray-100 dark:border-vikinger-dark-50/30"},Ks={class:"p-4 flex gap-3"},qs=["src","alt"],Gs={class:"flex-1 flex gap-2"},Hs=["disabled"],Qs=["disabled"],Ws={key:1},Js={key:0,class:"px-4 pb-4 space-y-4"},Xs={class:"flex gap-2"},Ys=["src","alt"],Zs={class:"flex-1"},el={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},tl={class:"flex items-center gap-2"},sl={class:"font-medium text-sm text-gray-900 dark:text-white"},ll={key:0,class:"px-1.5 py-0.5 text-xs rounded bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},al={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},rl={class:"flex items-center gap-4 mt-1 ml-2 text-xs text-gray-500"},il=["onClick"],ol=["onClick"],nl=["onClick"],dl=["onClick"],ul={key:0,class:"mt-2 flex gap-2"},cl=["src","alt"],gl={class:"flex-1 flex gap-2"},vl=["placeholder","disabled"],pl=["disabled"],kl={key:1},fl=["onClick"],hl={key:2,class:"mt-2 ml-8"},bl={key:3,class:"mt-2 ml-8 space-y-3"},xl=["src","alt"],yl={class:"flex-1"},ml={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},_l={class:"font-medium text-xs text-gray-900 dark:text-white"},wl={class:"text-xs text-gray-700 dark:text-gray-300"},$l={class:"flex items-center gap-3 mt-1 ml-2 text-xs text-gray-500"},Cl=["onClick"],Al=["onClick"],Dl=["disabled"],Il={key:1,class:"px-4 pb-4 text-center text-sm text-gray-500 dark:text-gray-400"},Bl=fe({__name:"CourseFeedPost",props:{post:{},courseId:{},currentUserId:{},isCourseAdmin:{type:Boolean,default:!1}},emits:["edit","delete","post-updated"],setup(_,{emit:W}){const i=_,V=W,L=Ge(),j=ve(),k=he(),{getAvatarUrl:w}=De(),y=J(()=>L.user),S=u(!1),M=u(!0),m=u(!1),I=u(null),C=u(i.post?.isLikedByAuth||i.post?.is_liked||!1),U=u(i.post?.isDislikedByAuth||i.post?.is_disliked||!1),P=u(i.post?.likes||i.post?.likes_count||0),B=u(i.post?.dislikes||i.post?.dislikes_count||0),T=u(i.post?.comments_count||0),z=u(i.post?.shares||i.post?.shares_count||0),q=u(!1),se=u(!1),O=u(!1),G=u(""),E=u(i.post?.post_comments||i.post?.comments||[]),Z=u(!1),ie=u(1),D=u(!0),p=u(null),A=u(""),F=u(!1),R=u({}),N=u({}),oe=u({}),ae=J(()=>{const t=y.value;return i.post.user?.id===i.currentUserId||t&&i.post.user?.id===t.id}),v=J(()=>i.post.author||i.post.user||{}),o=J(()=>w(v.value)),$=J(()=>w(y.value)),h=J(()=>i.post.imagesResources?.length?i.post.imagesResources:i.post.images?.length?i.post.images:i.post.media?.length?i.post.media:[]),ee=J(()=>i.post.attachments||[]),be=J(()=>i.post.poll||null),ke=t=>{if(!t)return"";if(typeof t=="string"&&(t.includes("ที่แล้ว")||t.includes("เมื่อสักครู่")))return t;const r=new Date(t),s=new Date().getTime()-r.getTime(),g=Math.floor(s/6e4),ne=Math.floor(s/36e5),we=Math.floor(s/864e5);return g<1?"เมื่อสักครู่":g<60?`${g} นาทีที่แล้ว`:ne<24?`${ne} ชั่วโมงที่แล้ว`:we<7?`${we} วันที่แล้ว`:r.toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Ie=J(()=>i.post.diff_humans_created_at||ke(i.post.created_at));Ae(()=>i.post,t=>{t&&(C.value=t.isLikedByAuth||t.is_liked||!1,U.value=t.isDislikedByAuth||t.is_disliked||!1,P.value=t.likes||t.likes_count||0,B.value=t.dislikes||t.dislikes_count||0,T.value=t.comments_count||0,z.value=t.shares||t.shares_count||0,E.value=t.post_comments||t.comments||[])},{immediate:!0});const Be=async()=>{if(q.value||!i.post?.id)return;if(ae.value){k.warning("คุณไม่สามารถกดถูกใจโพสต์ของตัวเองได้");return}q.value=!0;const t=C.value;C.value=!t,P.value+=t?-1:1,!t&&U.value&&(U.value=!1,B.value--);try{const r=await j.call(`/api/courses/${i.courseId}/posts/${i.post.id}/like`,{method:"POST"});r.success||(C.value=t,P.value+=t?1:-1,k.error(r.message||"ไม่สามารถกดถูกใจได้"))}catch(r){C.value=t,P.value+=t?1:-1,console.error("Failed to like:",r)}finally{q.value=!1}},Le=async()=>{if(se.value||!i.post?.id)return;if(ae.value){k.warning("คุณไม่สามารถกดไม่ถูกใจโพสต์ของตัวเองได้");return}se.value=!0;const t=U.value;U.value=!t,B.value+=t?-1:1,!t&&C.value&&(C.value=!1,P.value--);try{const r=await j.call(`/api/courses/${i.courseId}/posts/${i.post.id}/dislike`,{method:"POST"});r.success||(U.value=t,B.value+=t?1:-1,k.error(r.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(r){U.value=t,B.value+=t?1:-1,console.error("Failed to dislike:",r)}finally{se.value=!1}},xe=async()=>{if(!(!G.value.trim()||O.value)){O.value=!0;try{const t=await j.call(`/api/courses/${i.courseId}/posts/${i.post.id}/comments`,{method:"POST",body:{content:G.value}});t.success&&t.comment?(E.value.unshift(t.comment),T.value++,G.value=""):k.error(t.message||"ไม่สามารถเพิ่มความคิดเห็นได้")}catch(t){console.error("Failed to add comment:",t),k.error("เกิดข้อผิดพลาดในการเพิ่มความคิดเห็น")}finally{O.value=!1}}},je=async()=>{if(!(Z.value||!D.value)){Z.value=!0;try{const t=ie.value+1,r=await j.get(`/api/courses/${i.courseId}/posts/${i.post.id}/comments?page=${t}`);if(r.comments?.length){const x=new Set(E.value.map(g=>g.id)),s=r.comments.filter(g=>!x.has(g.id));E.value.push(...s),ie.value=t}r.pagination?D.value=r.pagination.has_more:r.comments?.length||(D.value=!1)}catch(t){console.error("Failed to load comments:",t)}finally{Z.value=!1}}},Me=async t=>{const r=t.user||t.author;if(y.value?.id===r?.id){k.warning("คุณไม่สามารถกดถูกใจคอมเมนต์ของตัวเองได้");return}if(t.isLiking)return;t.isLiking=!0;const x=t.isLikedByAuth||t.is_liked||!1;t.isLikedByAuth=!x,t.is_liked=!x,t.likes=(t.likes||0)+(x?-1:1),!x&&(t.isDislikedByAuth||t.is_disliked)&&(t.isDislikedByAuth=!1,t.is_disliked=!1,t.dislikes=(t.dislikes||0)-1);try{const s=await j.call(`/api/courses/posts/comments/${t.id}/like`,{method:"POST"});s.success||(t.isLikedByAuth=x,t.is_liked=x,t.likes=(t.likes||0)+(x?1:-1),k.error(s.message||"ไม่สามารถกดถูกใจได้"))}catch(s){t.isLikedByAuth=x,t.is_liked=x,t.likes=(t.likes||0)+(x?1:-1),console.error("Failed to like comment:",s)}finally{t.isLiking=!1}},Se=async t=>{const r=t.user||t.author;if(y.value?.id===r?.id){k.warning("คุณไม่สามารถกดไม่ถูกใจคอมเมนต์ของตัวเองได้");return}if(t.isDisliking)return;t.isDisliking=!0;const x=t.isDislikedByAuth||t.is_disliked||!1;t.isDislikedByAuth=!x,t.is_disliked=!x,t.dislikes=(t.dislikes||0)+(x?-1:1),!x&&(t.isLikedByAuth||t.is_liked)&&(t.isLikedByAuth=!1,t.is_liked=!1,t.likes=(t.likes||0)-1);try{const s=await j.call(`/api/courses/posts/comments/${t.id}/dislike`,{method:"POST"});s.success||(t.isDislikedByAuth=x,t.is_disliked=x,t.dislikes=(t.dislikes||0)+(x?1:-1),k.error(s.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(s){t.isDislikedByAuth=x,t.is_disliked=x,t.dislikes=(t.dislikes||0)+(x?1:-1),console.error("Failed to dislike comment:",s)}finally{t.isDisliking=!1}},Pe=t=>{p.value=t,A.value=""},ye=()=>{p.value=null,A.value=""},me=async()=>{if(!(!A.value.trim()||!p.value||F.value)){F.value=!0;try{const t=await j.call(`/api/courses/posts/comments/${p.value.id}/replies`,{method:"POST",body:{content:A.value}});t.success&&t.reply?(N.value[p.value.id]||(N.value[p.value.id]=[]),N.value[p.value.id].unshift(t.reply),p.value.replies_count!==void 0&&p.value.replies_count++,R.value[p.value.id]=!0,ye()):k.error(t.message||"ไม่สามารถตอบกลับได้")}catch(t){console.error("Failed to submit reply:",t),k.error("เกิดข้อผิดพลาดในการตอบกลับ")}finally{F.value=!1}}},Te=async t=>{if(!oe.value[t]){oe.value[t]=!0;try{const r=await j.get(`/api/courses/posts/comments/${t}/replies`);r.replies&&(N.value[t]=r.replies,R.value[t]=!0)}catch(r){console.error("Failed to load replies:",r)}finally{oe.value[t]=!1}}},Fe=t=>{R.value[t]?R.value[t]=!1:N.value[t]?R.value[t]=!0:Te(t)},Ue=async(t,r)=>{const x=t.user||t.author;if(y.value?.id===x?.id){k.warning("คุณไม่สามารถกดถูกใจการตอบกลับของตัวเองได้");return}if(t.isLiking)return;t.isLiking=!0;const s=t.isLikedByAuth||t.is_liked||!1;t.isLikedByAuth=!s,t.is_liked=!s,t.likes=(t.likes||0)+(s?-1:1);try{(await j.call(`/api/courses/posts/comments/replies/${t.id}/like`,{method:"POST"})).success||(t.isLikedByAuth=s,t.is_liked=s,t.likes=(t.likes||0)+(s?1:-1))}catch(g){t.isLikedByAuth=s,t.is_liked=s,t.likes=(t.likes||0)+(s?1:-1),console.error("Failed to like reply:",g)}finally{t.isLiking=!1}},Oe=async(t,r)=>{const x=t.user||t.author;if(y.value?.id===x?.id){k.warning("คุณไม่สามารถกดไม่ถูกใจการตอบกลับของตัวเองได้");return}if(t.isDisliking)return;t.isDisliking=!0;const s=t.isDislikedByAuth||t.is_disliked||!1;t.isDislikedByAuth=!s,t.is_disliked=!s,t.dislikes=(t.dislikes||0)+(s?-1:1);try{(await j.call(`/api/courses/posts/comments/replies/${t.id}/dislike`,{method:"POST"})).success||(t.isDislikedByAuth=s,t.is_disliked=s,t.dislikes=(t.dislikes||0)+(s?1:-1))}catch(g){t.isDislikedByAuth=s,t.is_disliked=s,t.dislikes=(t.dislikes||0)+(s?1:-1),console.error("Failed to dislike reply:",g)}finally{t.isDisliking=!1}},Ee=async()=>{if(await k.confirm("คุณต้องการลบโพสต์นี้หรือไม่?","ลบโพสต์"))try{const r=await j.call(`/api/courses/${i.courseId}/posts/${i.post.id}`,{method:"DELETE"});r.success?(V("delete",i.post.id),k.toast("ลบโพสต์สำเร็จ","success")):k.error(r.message||"ไม่สามารถลบโพสต์ได้")}catch(r){console.error("Failed to delete post:",r),k.error("เกิดข้อผิดพลาดในการลบโพสต์")}},Re=async t=>{if(await k.confirm("คุณต้องการลบความคิดเห็นนี้หรือไม่?","ลบความคิดเห็น"))try{const x=await j.call(`/api/courses/posts/comments/${t.id}`,{method:"DELETE"});x.success?(E.value=E.value.filter(s=>s.id!==t.id),T.value--,k.toast("ลบความคิดเห็นสำเร็จ","success")):k.error(x.message||"ไม่สามารถลบความคิดเห็นได้")}catch(x){console.error("Failed to delete comment:",x),k.error("เกิดข้อผิดพลาดในการลบความคิดเห็น")}},Ve=()=>{m.value=!0},ze=()=>{z.value++,m.value=!1},_e=t=>{I.value=t},Ne=t=>{i.post.poll&&Object.assign(i.post.poll,t),V("post-updated",i.post)},Ke=()=>{V("delete",i.post.id)};return(t,r)=>{const x=Xe;return l(),a("div",ns,[e("div",ds,[d(x,{to:`/profile/${v.value.username}`},{default:re(()=>[e("img",{src:o.value,alt:v.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,us)]),_:1},8,["to"]),e("div",cs,[e("div",gs,[d(x,{to:`/profile/${v.value.username}`,class:"font-medium text-gray-900 dark:text-white hover:underline"},{default:re(()=>[Y(b(v.value.name),1)]),_:1},8,["to"]),v.value.role==="teacher"||v.value.role==="admin"?(l(),a("span",vs," ผู้สอน ")):f("",!0)]),e("p",ps,[Y(b(Ie.value)+" ",1),_.post.is_edited?(l(),a("span",ks," · แก้ไขแล้ว")):f("",!0)])]),ae.value||_.isCourseAdmin?(l(),a("div",fs,[e("button",{onClick:r[0]||(r[0]=s=>S.value=!S.value),class:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 text-gray-400"},[d(n(c),{icon:"fluent:more-horizontal-24-regular",class:"w-5 h-5"})]),d(ce,{name:"fade"},{default:re(()=>[S.value?(l(),a("div",hs,[ae.value?(l(),a("button",{key:0,onClick:r[1]||(r[1]=s=>{V("edit",_.post),S.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 flex items-center gap-2"},[d(n(c),{icon:"fluent:edit-24-regular",class:"w-4 h-4"}),r[10]||(r[10]=Y(" แก้ไข ",-1))])):f("",!0),e("button",{onClick:r[2]||(r[2]=s=>{Ee(),S.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2"},[d(n(c),{icon:"fluent:delete-24-regular",class:"w-4 h-4"}),r[11]||(r[11]=Y(" ลบ ",-1))])])):f("",!0)]),_:1})])):f("",!0)]),e("div",bs,[_.post.content?(l(),a("div",xs,b(_.post.content),1)):f("",!0)]),h.value.length>0?(l(),a("div",ys,[h.value.length===1?(l(),a("img",{key:0,src:h.value[0].url||h.value[0],alt:h.value[0].alt||"Post image",class:"w-full max-h-96 object-cover cursor-pointer",onClick:r[3]||(r[3]=s=>_e(0))},null,8,ms)):(l(),a("div",{key:1,class:te(["grid gap-1",[h.value.length===2?"grid-cols-2":"",h.value.length===3?"grid-cols-3":"",h.value.length>=4?"grid-cols-2":""]])},[(l(!0),a(K,null,Q(h.value.slice(0,4),(s,g)=>(l(),a("div",{key:g,class:"relative aspect-square cursor-pointer",onClick:ne=>_e(g)},[e("img",{src:s.url||s,alt:s.alt||`Image ${g+1}`,class:"w-full h-full object-cover"},null,8,ws),g===3&&h.value.length>4?(l(),a("div",$s,[e("span",Cs,"+"+b(h.value.length-4),1)])):f("",!0)],8,_s))),128))],2))])):f("",!0),ee.value.length>0?(l(),a("div",As,[e("div",Ds,[(l(!0),a(K,null,Q(ee.value,s=>(l(),a("a",{key:s.id,href:s.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-vikinger-dark-100 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-50 transition-colors"},[d(n(c),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"}),e("span",Bs,b(s.name||s.filename),1),e("span",Ls,b(s.size),1)],8,Is))),128))])])):f("",!0),be.value?(l(),a("div",js,[d(Ye,{poll:be.value,"show-actions":ae.value,"is-nested":!0,onUpdate:Ne,onDelete:Ke},null,8,["poll","show-actions"])])):f("",!0),e("div",Ms,[e("div",Ss,[P.value>0?(l(),a("div",Ps,[e("div",Ts,[d(n(c),{icon:"fluent:thumb-like-24-filled",class:"w-3 h-3 text-white"})]),e("span",null,b(P.value),1)])):f("",!0),B.value>0?(l(),a("div",Fs,[e("div",Us,[d(n(c),{icon:"fluent:thumb-dislike-24-filled",class:"w-3 h-3 text-white"})]),e("span",null,b(B.value),1)])):f("",!0)]),e("div",Os,[T.value>0?(l(),a("button",{key:0,onClick:r[4]||(r[4]=s=>M.value=!M.value),class:"hover:underline"},b(T.value)+" ความคิดเห็น ",1)):f("",!0),z.value>0?(l(),a("span",Es,b(z.value)+" แชร์",1)):f("",!0)])]),e("div",Rs,[e("button",{onClick:Be,disabled:q.value,class:te(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",C.value?"text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(n(c),{icon:C.value?"fluent:thumb-like-24-filled":"fluent:thumb-like-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[12]||(r[12]=e("span",null,"ถูกใจ",-1))],10,Vs),e("button",{onClick:Le,disabled:se.value,class:te(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",U.value?"text-gray-700 dark:text-gray-200":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(n(c),{icon:U.value?"fluent:thumb-dislike-24-filled":"fluent:thumb-dislike-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[13]||(r[13]=e("span",null,"ไม่ถูกใจ",-1))],10,zs),e("button",{onClick:r[5]||(r[5]=s=>M.value=!M.value),class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(n(c),{icon:"fluent:chat-24-regular",class:"w-5 h-5"}),r[14]||(r[14]=e("span",null,"ความคิดเห็น",-1))]),e("button",{onClick:Ve,class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(n(c),{icon:"fluent:share-24-regular",class:"w-5 h-5"}),r[15]||(r[15]=e("span",null,"แชร์",-1))])]),d(ce,{name:"slide"},{default:re(()=>[M.value?(l(),a("div",Ns,[e("div",Ks,[e("img",{src:$.value,alt:y.value?.name,class:"w-8 h-8 rounded-full"},null,8,qs),e("div",Gs,[X(e("input",{"onUpdate:modelValue":r[6]||(r[6]=s=>G.value=s),type:"text",placeholder:"เขียนความคิดเห็น...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(xe,["enter"]),disabled:O.value},null,40,Hs),[[le,G.value]]),e("button",{onClick:xe,disabled:!G.value.trim()||O.value,class:"px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[O.value?(l(),H(n(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin"})):(l(),a("span",Ws,"ส่ง"))],8,Qs)])]),E.value.length>0?(l(),a("div",Js,[(l(!0),a(K,null,Q(E.value,s=>(l(),a("div",{key:s.id,class:"space-y-2"},[e("div",Xs,[e("img",{src:n(w)(s.user||s.author),alt:(s.user||s.author)?.name,class:"w-8 h-8 rounded-full"},null,8,Ys),e("div",Zs,[e("div",el,[e("div",tl,[e("p",sl,b((s.user||s.author)?.name),1),(s.user||s.author)?.role==="teacher"?(l(),a("span",ll," ผู้สอน ")):f("",!0)]),e("p",al,b(s.content),1)]),e("div",rl,[e("button",{onClick:g=>Me(s),class:te(["hover:text-blue-600",s.isLikedByAuth||s.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+b(s.likes>0?` (${s.likes})`:""),11,il),e("button",{onClick:g=>Se(s),class:te(["hover:text-gray-700",s.isDislikedByAuth||s.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+b(s.dislikes>0?` (${s.dislikes})`:""),11,ol),e("button",{onClick:g=>Pe(s),class:"hover:text-blue-600"}," ตอบกลับ ",8,nl),e("span",null,b(ke(s.created_at)),1),y.value?.id===(s.user||s.author)?.id||_.isCourseAdmin?(l(),a("button",{key:0,onClick:g=>Re(s),class:"hover:text-red-600"}," ลบ ",8,dl)):f("",!0)]),p.value?.id===s.id?(l(),a("div",ul,[e("img",{src:$.value,alt:y.value?.name,class:"w-6 h-6 rounded-full"},null,8,cl),e("div",gl,[X(e("input",{"onUpdate:modelValue":r[7]||(r[7]=g=>A.value=g),type:"text",placeholder:`ตอบกลับ ${(s.user||s.author)?.name}...`,class:"flex-1 px-3 py-1.5 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(me,["enter"]),disabled:F.value},null,40,vl),[[le,A.value]]),e("button",{onClick:me,disabled:!A.value.trim()||F.value,class:"px-3 py-1.5 bg-blue-600 text-white rounded-full text-xs font-medium hover:bg-blue-700 disabled:opacity-50"},[F.value?(l(),H(n(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-3 h-3 animate-spin"})):(l(),a("span",kl,"ส่ง"))],8,pl),e("button",{onClick:ye,class:"px-3 py-1.5 text-gray-500 hover:text-gray-700 text-xs"}," ยกเลิก ")])])):f("",!0),s.replies_count>0||N.value[s.id]?.length>0?(l(),a("button",{key:1,onClick:g=>Fe(s.id),class:"mt-2 ml-2 flex items-center gap-1 text-xs text-blue-600 hover:underline"},[d(n(c),{icon:R.value[s.id]?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-4 h-4"},null,8,["icon"]),Y(" "+b(R.value[s.id]?"ซ่อน":"ดู")+" "+b(s.replies_count||N.value[s.id]?.length||0)+" การตอบกลับ ",1)],8,fl)):f("",!0),oe.value[s.id]?(l(),a("div",hl,[d(n(c),{icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin text-gray-400"})])):f("",!0),R.value[s.id]&&N.value[s.id]?.length?(l(),a("div",bl,[(l(!0),a(K,null,Q(N.value[s.id],g=>(l(),a("div",{key:g.id,class:"flex gap-2"},[e("img",{src:n(w)(g.user||g.author),alt:(g.user||g.author)?.name,class:"w-6 h-6 rounded-full"},null,8,xl),e("div",yl,[e("div",ml,[e("p",_l,b((g.user||g.author)?.name),1),e("p",wl,b(g.content),1)]),e("div",$l,[e("button",{onClick:ne=>Ue(g,s.id),class:te(["hover:text-blue-600",g.isLikedByAuth||g.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+b(g.likes>0?` (${g.likes})`:""),11,Cl),e("button",{onClick:ne=>Oe(g,s.id),class:te(["hover:text-gray-700",g.isDislikedByAuth||g.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+b(g.dislikes>0?` (${g.dislikes})`:""),11,Al),e("span",null,b(ke(g.created_at)),1)])])]))),128))])):f("",!0)])])]))),128)),D.value&&T.value>E.value.length?(l(),a("button",{key:0,onClick:je,disabled:Z.value,class:"w-full py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"},[Z.value?(l(),H(n(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin inline mr-2"})):f("",!0),Y(" ดูความคิดเห็นเพิ่มเติม ("+b(T.value-E.value.length)+") ",1)],8,Dl)):f("",!0)])):(l(),a("div",Il," ยังไม่มีความคิดเห็น เป็นคนแรกที่แสดงความคิดเห็น! "))])):f("",!0)]),_:1}),m.value?(l(),H(Ze,{key:3,show:m.value,"shareable-type":"CoursePost","shareable-id":_.post.id,post:_.post,onClose:r[8]||(r[8]=s=>m.value=!1),onShared:ze},null,8,["show","shareable-id","post"])):f("",!0),I.value!==null?(l(),H(et,{key:4,images:h.value,"initial-index":I.value,onClose:r[9]||(r[9]=s=>I.value=null)},null,8,["images","initial-index"])):f("",!0)])}}}),Ll=ge(Bl,[["__scopeId","data-v-658cffb4"]]),jl={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},Ml={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},Sl={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},Pl={class:"flex items-center gap-2"},Tl={class:"p-4"},Fl={class:"flex items-center gap-3 mb-4"},Ul=["src"],Ol={class:"font-medium text-gray-800 dark:text-white"},El={class:"flex items-center gap-1 text-xs text-gray-500"},Rl={class:"rounded-lg mb-4 min-h-[150px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},Vl=["onKeydown","disabled"],zl={key:0,class:"mb-4"},Nl={class:"flex flex-wrap gap-2"},Kl=["src"],ql={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30 flex gap-3"},Gl=["disabled"],Hl=fe({__name:"CourseEditPostModal",props:{show:{type:Boolean},post:{},courseId:{}},emits:["close","post-updated"],setup(_,{emit:W}){const i=_,V=W,{user:L}=pe(),j=ve(),k=he(),w=u(i.post?.content||""),y=u(!1);Ae(()=>i.post,m=>{m&&(w.value=m.content||"")},{immediate:!0});const S=()=>{V("close")},M=async()=>{if(!w.value.trim()){k.warning("กรุณาใส่เนื้อหาโพสต์");return}if(!y.value){y.value=!0;try{const m=await j.put(`/api/courses/${i.courseId}/posts/${i.post.id}`,{content:w.value});if(m.success||m.data){const I=m.data||m.post||{...i.post,content:w.value,is_edited:!0};V("post-updated",I),k.toast("แก้ไขโพสต์สำเร็จ!","success")}else k.error(m.message||"ไม่สามารถแก้ไขโพสต์ได้")}catch(m){console.error("Error updating post:",m);let I="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";m?.data?.message&&(I=m.data.message),k.error(I)}finally{y.value=!1}}};return(m,I)=>(l(),H(Ce,{to:"body"},[d(ce,{name:"modal"},{default:re(()=>[_.show?(l(),a("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(S,["self"])},[e("div",jl,[e("div",Ml,[e("div",Sl,[e("div",Pl,[d(n(c),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-blue-500"}),I[1]||(I[1]=e("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"แก้ไขโพสต์",-1))]),e("button",{onClick:S,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(n(c),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),e("div",Tl,[e("div",Fl,[e("img",{src:_.post.user?.avatar||_.post.author?.avatar||n(L)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,Ul),e("div",null,[e("div",Ol,b(_.post.user?.name||_.post.author?.name||n(L)?.name),1),e("div",El,[d(n(c),{icon:"fluent:book-24-regular",class:"w-3 h-3"}),I[2]||(I[2]=e("span",null,"โพสต์ในรายวิชา",-1))])])]),e("div",Rl,[X(e("textarea",{"onUpdate:modelValue":I[0]||(I[0]=C=>w.value=C),placeholder:"แก้ไขเนื้อหาโพสต์...",rows:"6",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(M,["ctrl"]),["enter"]),disabled:y.value},null,40,Vl),[[le,w.value]])]),_.post.images?.length||_.post.media?.length?(l(),a("div",zl,[I[3]||(I[3]=e("p",{class:"text-sm text-gray-500 mb-2"},"รูปภาพในโพสต์ (ไม่สามารถแก้ไขได้)",-1)),e("div",Nl,[(l(!0),a(K,null,Q(_.post.images||_.post.media||_.post.imagesResources||[],(C,U)=>(l(),a("img",{key:U,src:C.url||C,class:"w-20 h-20 object-cover rounded-lg opacity-70"},null,8,Kl))),128))])])):f("",!0)]),e("div",ql,[e("button",{onClick:S,class:"flex-1 py-3 px-4 bg-gray-100 dark:bg-vikinger-dark-200 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 transition-all"}," ยกเลิก "),e("button",{onClick:M,disabled:y.value||!w.value.trim(),class:"flex-1 py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[y.value?(l(),H(n(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):f("",!0),e("span",null,b(y.value?"กำลังบันทึก...":"บันทึก"),1)],8,Gl)])])])])):f("",!0)]),_:1})]))}}),Ql=ge(Hl,[["__scopeId","data-v-1bfd21ea"]]),Wl={class:"space-y-4"},Jl={class:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide"},Xl=["onClick"],Yl={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-6 text-center"},Zl={class:"text-red-600 dark:text-red-400 mb-4"},ea={key:1,class:"space-y-4"},ta={class:"flex justify-center"},sa={key:1,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-8 text-center"},la={key:0,class:"flex items-center gap-2 px-6 py-3 bg-white dark:bg-vikinger-dark-200 text-blue-600 rounded-full shadow-sm"},aa={key:1,class:"h-4 w-full"},ra={key:3,class:"text-center py-6 text-gray-500 dark:text-gray-400"},ia=fe({__name:"CourseFeedsList",props:{courseId:{},isCourseAdmin:{type:Boolean,default:!1},groupId:{},initialTab:{default:"all"}},setup(_){const W=_,i=ve(),{user:V}=pe(),L=u([]),j=u(!0),k=u(!1),w=u(!0),y=u(1),S=u(10),M=u(null),m=u(!1),I=u(null),C=u(W.initialTab),U=[{id:"all",label:"ทั้งหมด",icon:"fluent:feed-24-regular"},{id:"discussions",label:"พูดคุย",icon:"fluent:chat-multiple-24-regular"},{id:"questions",label:"คำถาม",icon:"fluent:question-circle-24-regular"},{id:"materials",label:"เอกสาร",icon:"fluent:document-24-regular"},{id:"announcements",label:"ประกาศ",icon:"fluent:megaphone-24-regular"}],P=u(null);let B=null;const T=async(D=!1)=>{D&&(y.value=1,w.value=!0,M.value=null),j.value=D,k.value=!D;try{const p={page:y.value,per_page:S.value,group_id:W.groupId};C.value!=="all"&&(p.type=C.value);const A=await i.get(`/api/courses/${W.courseId}/posts`,{params:p}),F=A.data?.data||A.data||A.posts||[],R=A.pagination||A.meta||{};if(D)L.value=Array.isArray(F)?F:[];else{const N=Array.isArray(F)?F:[];L.value=[...L.value,...N]}R.has_more!==void 0?w.value=R.has_more:R.last_page!==void 0?w.value=y.value<R.last_page:w.value=Array.isArray(F)&&F.length===S.value}catch(p){console.error("Error fetching posts:",p),M.value="ไม่สามารถโหลดโพสต์ได้",D||(M.value=null)}finally{j.value=!1,k.value=!1}},z=async()=>{k.value||!w.value||(y.value++,await T(!1))},q=async()=>{await T(!0)},se=D=>{D&&L.value.unshift(D)},O=D=>{const p=L.value.findIndex(A=>A.id===D.id);p!==-1&&(L.value[p]={...L.value[p],...D}),m.value=!1,I.value=null},G=D=>{L.value=L.value.filter(p=>p.id!==D)},E=D=>{I.value={...D},m.value=!0},Z=D=>{C.value!==D&&(C.value=D,T(!0))},ie=()=>{B&&B.disconnect(),B=new IntersectionObserver(D=>{D[0].isIntersecting&&w.value&&!k.value&&!j.value&&z()},{root:null,rootMargin:"200px",threshold:.1}),P.value&&B.observe(P.value)};return He(()=>{T(!0),ie()}),Qe(()=>{B&&B.disconnect()}),(D,p)=>(l(),a("div",Wl,[d(os,{"course-id":_.courseId,"group-id":_.groupId,onPostCreated:se},null,8,["course-id","group-id"]),e("div",Jl,[(l(),a(K,null,Q(U,A=>e("button",{key:A.id,onClick:F=>Z(A.id),class:te(["flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all duration-300",C.value===A.id?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg":"bg-white dark:bg-vikinger-dark-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(n(c),{icon:A.icon,class:"w-4 h-4"},null,8,["icon"]),Y(" "+b(A.label),1)],10,Xl)),64))]),M.value&&!j.value?(l(),a("div",Yl,[d(n(c),{icon:"fluent:error-circle-24-regular",class:"w-12 h-12 mx-auto mb-3 text-red-500"}),e("p",Zl,b(M.value),1),e("button",{onClick:q,class:"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},[d(n(c),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4 inline mr-2"}),p[1]||(p[1]=Y(" ลองใหม่อีกครั้ง ",-1))])])):j.value?(l(),a("div",ea,[(l(),a(K,null,Q(3,A=>e("div",{key:A,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-6 animate-pulse"},[...p[2]||(p[2]=[Je('<div class="flex items-center gap-4 mb-4" data-v-0f6913ec><div class="w-10 h-10 bg-gray-200 dark:bg-vikinger-dark-100 rounded-full" data-v-0f6913ec></div><div class="flex-1 space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/4" data-v-0f6913ec></div><div class="h-3 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/6" data-v-0f6913ec></div></div></div><div class="space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-full" data-v-0f6913ec></div><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-3/4" data-v-0f6913ec></div></div>',2)])])),64))])):(l(),a(K,{key:2},[e("div",ta,[e("button",{onClick:q,class:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full transition-colors"},[d(n(c),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4"}),p[3]||(p[3]=Y(" รีเฟรชฟีด ",-1))])]),L.value.length>0?(l(),H(We,{key:0,tag:"div",name:"feed",class:"space-y-4"},{default:re(()=>[(l(!0),a(K,null,Q(L.value,A=>(l(),H(Ll,{key:A.id,post:A,"course-id":_.courseId,"current-user-id":n(V)?.id,"is-course-admin":_.isCourseAdmin,onEdit:E,onDelete:G,onPostUpdated:O},null,8,["post","course-id","current-user-id","is-course-admin"]))),128))]),_:1})):(l(),a("div",sa,[d(n(c),{icon:"fluent:chat-24-regular",class:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),p[4]||(p[4]=e("h3",{class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ยังไม่มีโพสต์ ",-1)),p[5]||(p[5]=e("p",{class:"text-gray-500 dark:text-gray-400"}," เป็นคนแรกที่โพสต์ในรายวิชานี้! ",-1))])),w.value&&L.value.length>0?(l(),a("div",{key:2,ref_key:"loadMoreTrigger",ref:P,class:"flex justify-center py-6"},[k.value?(l(),a("div",la,[d(n(c),{icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"}),p[6]||(p[6]=Y(" กำลังโหลด... ",-1))])):(l(),a("div",aa))],512)):f("",!0),!w.value&&L.value.length>0?(l(),a("div",ra,[d(n(c),{icon:"fluent:checkmark-circle-24-regular",class:"w-8 h-8 mx-auto mb-2 text-green-500"}),p[7]||(p[7]=e("p",null,"คุณได้ดูโพสต์ทั้งหมดแล้ว!",-1))])):f("",!0)],64)),m.value&&I.value?(l(),H(Ql,{key:3,show:m.value,post:I.value,"course-id":_.courseId,onClose:p[0]||(p[0]=A=>{m.value=!1,I.value=null}),onPostUpdated:O},null,8,["show","post","course-id"])):f("",!0)]))}}),ka=ge(ia,[["__scopeId","data-v-0f6913ec"]]);export{ka as C};
