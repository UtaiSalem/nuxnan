import{_ as T}from"./ChBnuzYQ.js";import{_ as U,p as F,l as R,r as o,n as M,a3 as q,W as E,g as z,o as a,w as S,c as r,d as _,a as e,b as l,u,I as f,t as j,e as V,a1 as H,s as W,q as G,i as J,z as K,F as N,k as L,h as Q}from"./cTealXVQ.js";import{_ as X}from"./DYAmsUQU.js";import{S as P}from"./BQxta0Da.js";const Y={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md"},Z={class:"relative bg-white dark:bg-gray-900 w-screen h-screen flex flex-col md:flex-row overflow-hidden"},ee={class:"w-full md:w-2/3 h-1/2 md:h-full bg-black flex items-center justify-center relative"},te=["src"],se=["src"],ae={class:"w-full md:w-1/3 h-1/2 md:h-full bg-white dark:bg-gray-800 p-8 flex flex-col items-center justify-center text-center relative"},re={class:"text-xl font-bold text-gray-900 dark:text-white mb-2 line-clamp-2"},le={key:0,class:"text-sm text-gray-500 dark:text-gray-400 mb-4 line-clamp-3"},oe=["href"],ne={key:2,class:"mb-6"},ie={key:3,class:"relative mb-8"},de={class:"w-32 h-32 transform -rotate-90"},ce=["stroke-dashoffset"],ue={class:"absolute inset-0 flex items-center justify-center flex-col"},fe={class:"text-3xl font-bold text-gray-800 dark:text-white"},ve={key:4,class:"mb-8 flex flex-col items-center animate-bounce-in"},me={class:"w-24 h-24 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mb-4"},ge={key:5,class:"mb-8 flex flex-col items-center"},xe={key:6,class:"mb-8 flex flex-col items-center"},ye={class:"w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4"},be={key:7,class:"mb-8 flex flex-col items-center"},he={key:8,class:"space-y-2"},pe={class:"text-2xl font-bold text-amber-500"},ke={key:9,class:"absolute bottom-4 left-0 right-0"},we={class:"flex items-center justify-center text-teal-500 gap-2"},_e=60,$e={__name:"AdViewerModal",props:{isOpen:Boolean,advert:Object},emits:["close","completed"],setup(v,{emit:y}){const n=v,k=y,I=F().public.apiBase,p=R(),i=o(0),d=o(null),h=o(!1),g=o(!1),w=o(0),$=o(!1),C=o(!1),A=2*Math.PI*_e,B=M(()=>{if(w.value===0)return 0;const m=i.value/w.value;return A*(1-m)}),c=M(()=>{if(!n.advert?.media_image)return!1;const m=n.advert.media_image.split(".").pop().toLowerCase();return["mp4","webm","ogg"].includes(m)});q(()=>n.isOpen,m=>{m&&n.advert?t():x()});function t(){if(i.value=n.advert.duration,w.value=n.advert.duration,h.value=!1,g.value=!1,$.value=!1,C.value=!1,n.advert.remaining_views<=0){C.value=!0,h.value=!0,i.value=0;return}d.value&&clearInterval(d.value),d.value=W(()=>{i.value--,i.value<=0&&(clearInterval(d.value),b())},1e3)}async function b(){g.value=!0;try{(await $fetch(`${I}/api/advertises/${n.advert.id}/view`,{method:"POST",headers:{Authorization:`Bearer ${p.token}`}})).success&&(p.fetchUser&&p.fetchUser(),$.value=!0,k("completed",n.advert))}catch(m){console.error(m);const s=m.data||{};m.statusCode===402?P.fire({icon:"error",title:"Insufficient Points",text:s.message||"Points not enough",customClass:{popup:"rounded-xl"}}):P.fire("Error","Failed to claim reward","error")}finally{g.value=!1,h.value=!0}}function x(){d.value&&clearInterval(d.value),i.value=0}function O(){x(),k("close")}return E(()=>{d.value&&clearInterval(d.value)}),(m,s)=>(a(),z(H,{name:"fade"},{default:S(()=>[v.isOpen?(a(),r("div",Y,[e("div",Z,[h.value?(a(),r("button",{key:0,onClick:O,class:"absolute top-4 right-4 z-10 text-white bg-black/50 hover:bg-black/70 rounded-full p-2 transition-colors"},[l(u(f),{icon:"mdi:close",class:"w-6 h-6"})])):_("",!0),e("div",ee,[c.value?(a(),r("video",{key:0,src:v.advert?.media_image,class:"w-full h-full object-contain",autoplay:"",loop:"",muted:"",playsinline:"",controls:""},null,8,te)):(a(),r("img",{key:1,src:v.advert?.media_image,class:"w-full h-full object-contain",alt:"Ad Content"},null,8,se))]),e("div",ae,[e("h3",re,j(v.advert?.title||"Product Advertisement"),1),v.advert?.description?(a(),r("p",le,j(v.advert.description),1)):_("",!0),v.advert?.media_link?(a(),r("a",{key:1,href:v.advert.media_link,target:"_blank",class:"mb-6 inline-flex items-center text-teal-600 hover:text-teal-700 font-medium text-sm"},[l(u(f),{icon:"mdi:link",class:"mr-1 w-4 h-4"}),s[0]||(s[0]=V(" เยี่ยมชมเว็บไซต์ ",-1))],8,oe)):(a(),r("div",ne)),i.value>0?(a(),r("div",ie,[(a(),r("svg",de,[s[1]||(s[1]=e("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor","stroke-width":"8",fill:"transparent",class:"text-gray-200 dark:text-gray-700"},null,-1)),e("circle",{cx:"64",cy:"64",r:"60",stroke:"currentColor","stroke-width":"8",fill:"transparent","stroke-dasharray":A,"stroke-dashoffset":B.value,class:"text-teal-500 transition-all duration-1000 ease-linear","stroke-linecap":"round"},null,8,ce)])),e("div",ue,[e("span",fe,j(i.value),1),s[2]||(s[2]=e("span",{class:"text-xs text-gray-500 uppercase"},"Seconds",-1))])])):$.value?(a(),r("div",ve,[e("div",me,[l(u(f),{icon:"mdi:check-bold",class:"w-12 h-12 text-green-600 dark:text-green-400"})]),s[3]||(s[3]=e("h4",{class:"text-2xl font-bold text-green-600 dark:text-green-400 mb-1"},"สำเร็จ!",-1)),s[4]||(s[4]=e("p",{class:"text-gray-600 dark:text-gray-400"},"ได้รับรางวัลเรียบร้อยแล้ว",-1))])):g.value?(a(),r("div",ge,[l(u(f),{icon:"svg-spinners:3-dots-fade",class:"w-24 h-24 text-teal-500"}),s[5]||(s[5]=e("h4",{class:"text-xl font-bold text-gray-600 dark:text-gray-300 mb-1"},"กำลังประมวลผล...",-1))])):C.value?(a(),r("div",xe,[e("div",ye,[l(u(f),{icon:"mdi:eye-off-outline",class:"w-12 h-12 text-gray-500 dark:text-gray-400"})]),s[6]||(s[6]=e("h4",{class:"text-2xl font-bold text-gray-600 dark:text-gray-300 mb-1"},"โฆษณานี้แสดงผลครบแล้ว",-1)),s[7]||(s[7]=e("p",{class:"text-gray-500 dark:text-gray-400 text-sm max-w-xs"}," โฆษณานี้มียอดการรับชมครบตามจำนวนที่กำหนดแล้ว ไม่สามารถรับรางวัลได้ ",-1))])):(a(),r("div",be,[l(u(f),{icon:"mdi:alert-circle",class:"w-24 h-24 text-red-500"}),s[8]||(s[8]=e("h4",{class:"text-xl font-bold text-red-500 mb-1"},"เสร็จสิ้น",-1)),s[9]||(s[9]=e("p",{class:"text-sm text-gray-500"},"กรุณารอผลสักครู่...",-1))])),i.value>0?(a(),r("div",he,[s[10]||(s[10]=e("p",{class:"text-gray-600 dark:text-gray-300"},"รับชมเพื่อรับรางวัล",-1)),e("p",pe,j((v.advert?.duration*.04).toFixed(2))+" ฿",1)])):_("",!0),g.value?(a(),r("div",ke,[e("div",we,[l(u(f),{icon:"svg-spinners:3-dots-fade",class:"w-6 h-6"}),s[11]||(s[11]=e("span",{class:"text-sm"},"Processing Reward...",-1))])])):_("",!0)])])])):_("",!0)]),_:1}))}},Ce=U($e,[["__scopeId","data-v-ba17de25"]]),Ae={class:"min-h-screen py-8 px-4 sm:px-6 lg:px-8 bg-gray-50 dark:bg-gray-900"},je={class:"max-w-7xl mx-auto"},Pe={class:"text-center mb-8"},Ie={class:"w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center shadow-lg"},Be={class:"flex justify-center mb-6"},Oe={class:"flex justify-center gap-4 mb-6"},Se={key:0,class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6 animate-pulse"},Ve={key:1,class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},Me={key:2,class:"text-center py-12 bg-white rounded-lg shadow"},Ne={key:3,class:"flex justify-center mt-8"},Le=["disabled"],Fe={key:1},Ue=G({__name:"index",setup(v){J({title:"ดูสินค้า - Nuxni"});const y=o([]),n=o(!0),k=R(),I=F().public.apiBase,p=o(null),i=o(!1),d=o(1),h=o(1),g=o(!1);async function w(c=1){c===1?n.value=!0:g.value=!0;try{const t=await $fetch(`${I}/api/advertises?page=${c}`);if(t&&t.adverts){const b=t.adverts.data||t.adverts;c===1?y.value=b:y.value=[...y.value,...b];const x=t.adverts.meta||{};d.value=x.current_page||c,h.value=x.last_page||1}}catch(t){console.error("Failed to fetch adverts",t)}finally{n.value=!1,g.value=!1}}function $(){d.value<h.value&&w(d.value+1)}function C(c){if(!k.isAuthenticated){P.fire({icon:"warning",title:"เข้าสู่ระบบ",text:"กรุณาเข้าสู่ระบบเพื่อรับชมโฆษณา"});return}const t=c.duration*20;if(k.points<t){P.fire({icon:"error",title:"คะแนนไม่เพียงพอ",text:`คุณต้องมีอย่างน้อย ${t} PP เพื่อรับชมโฆษณานี้ (คุณมี ${k.points} PP)`});return}p.value=c,i.value=!0}function A(){i.value=!1,p.value=null}function B(c){const t=y.value.findIndex(b=>b.id===c.id);t!==-1&&y.value[t].remaining_views--}return K(()=>{w()}),(c,t)=>{const b=T;return a(),r("div",Ae,[e("div",je,[e("div",Pe,[e("div",Ie,[l(u(f),{icon:"eos-icons:product-subscriptions-outlined",class:"w-10 h-10 text-white"})]),t[0]||(t[0]=e("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white mb-2"}," ดูสินค้า ",-1)),t[1]||(t[1]=e("p",{class:"text-gray-600 dark:text-gray-400 max-w-2xl mx-auto"}," ชมโฆษณาเพื่อรับรางวัลและสนับสนุนผู้ขาย ",-1))]),e("div",Be,[e("div",Oe,[l(b,{to:"/earn/advertise/create",class:"flex items-center px-4 py-2 bg-teal-500 text-white rounded-lg hover:bg-teal-600 shadow-md transition-colors"},{default:S(()=>[l(u(f),{icon:"mdi:plus-circle",class:"mr-2 w-5 h-5"}),t[2]||(t[2]=V(" ลงโฆษณาสินค้า ",-1))]),_:1}),l(b,{to:"/earn/donates/create",class:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 shadow-md transition-colors"},{default:S(()=>[l(u(f),{icon:"flat-color-icons:donate",class:"mr-2 w-5 h-5"}),t[3]||(t[3]=V(" ให้การสนับสนุนทุนการเรียนรู้ ",-1))]),_:1})])]),n.value?(a(),r("div",Se,[(a(),r(N,null,L(6,x=>e("div",{key:x,class:"bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-sm border border-gray-100 dark:border-gray-700"},[...t[4]||(t[4]=[Q('<div class="h-48 bg-gray-200 dark:bg-gray-700 w-full"></div><div class="p-4 space-y-3"><div class="h-6 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div><div class="flex justify-between items-end"><div class="w-1/3"><div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-full mb-1"></div><div class="h-5 bg-gray-200 dark:bg-gray-700 rounded w-1/2"></div></div><div class="h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/3"></div></div></div>',2)])])),64))])):y.value.length>0?(a(),r("div",Ve,[(a(!0),r(N,null,L(y.value,(x,O)=>(a(),r("div",{key:x.id,class:"transform hover:-translate-y-1 transition-transform duration-200"},[l(X,{advert:x,index:O,onClick:C},null,8,["advert","index"])]))),128))])):(a(),r("div",Me,[l(u(f),{icon:"mdi:inbox-outline",class:"w-16 h-16 mx-auto text-gray-300 mb-4"}),t[5]||(t[5]=e("p",{class:"text-gray-500 text-lg"},"ไม่มีโฆษณาในขณะนี้",-1))])),d.value<h.value?(a(),r("div",Ne,[e("button",{onClick:$,disabled:g.value,class:"px-6 py-2 bg-gray-200 text-gray-700 rounded-full hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center transition-colors"},[g.value?(a(),z(u(f),{key:0,icon:"svg-spinners:3-dots-fade",class:"w-5 h-5 mr-2"})):(a(),r("span",Fe,"โหลดเพิ่มเติม"))],8,Le)])):_("",!0)]),l(Ce,{isOpen:i.value,advert:p.value,onClose:A,onCompleted:B},null,8,["isOpen","advert"])])}}});export{Ue as default};
