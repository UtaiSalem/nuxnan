import{_ as I}from"./0NabHjdI.js";import{q as L,p as R,v as D,ay as P,r as k,V as q,z as E,c as l,a as r,b as m,w as U,t as d,u as g,F as h,d as p,$ as u,e as x,aa as b,T as f,ab as $,k as B,ai as C,g as M,j as H,aH as S,o,I as c}from"./DvtEeXFW.js";const O={class:"space-y-6 max-w-2xl mx-auto"},G={class:"flex items-center gap-4"},J={class:"text-gray-500 dark:text-gray-400 mt-1"},K={key:0,class:"bg-white dark:bg-gray-800 rounded-2xl p-8 shadow-sm border border-gray-100 dark:border-gray-700"},Q={class:"text-center"},W={key:0,class:"p-4 bg-green-50 dark:bg-green-900/30 border border-green-200 dark:border-green-700 rounded-xl"},X={class:"flex items-center gap-2 text-green-700 dark:text-green-400"},Y={key:1,class:"p-4 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-700 rounded-xl"},Z={class:"flex items-center gap-2 text-red-700 dark:text-red-400"},ee={key:0,class:"mt-1 text-sm text-red-500"},re={key:0,class:"mt-1 text-sm text-red-500"},ae={key:0,class:"mt-1 text-sm text-red-500"},se={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},te={key:0,class:"mt-1 text-sm text-red-500"},oe={key:0,class:"mt-1 text-sm text-red-500"},le={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},ne=["value"],de=["value"],ie={class:"space-y-3 p-4 bg-gray-50 dark:bg-gray-700/50 rounded-xl"},ue={class:"flex items-center gap-3 cursor-pointer"},ge={class:"flex items-center gap-3 cursor-pointer"},me={class:"flex flex-col sm:flex-row gap-3 pt-4"},pe=["disabled"],ve=L({__name:"edit",setup(ce){const V=R().public.apiBase,T=D(),w=P().params.id,_=k(!0),y=k(!1),s=k({}),v=k(""),a=q({name:"",email:"",username:"",password:"",password_confirmation:"",role:"user",is_super_admin:!1,is_plearnd_admin:!1,status:"active"}),j=[{value:"user",label:"ผู้ใช้ทั่วไป"},{value:"instructor",label:"ผู้สอน"},{value:"admin",label:"ผู้ดูแล"}],N=[{value:"active",label:"ใช้งาน"},{value:"inactive",label:"ไม่ใช้งาน"},{value:"suspended",label:"ระงับการใช้งาน"}],z=async()=>{_.value=!0;try{const i=S("token"),e=await $fetch(`${V}/api/admin/users/${w}`,{headers:{Authorization:`Bearer ${i.value}`}});if(e.success){const n=e.data;a.name=n.name||"",a.email=n.email||"",a.username=n.username||"",a.role=n.role||"user",a.is_super_admin=n.is_super_admin||!1,a.is_plearnd_admin=n.is_plearnd_admin||!1,a.status=n.status||"active"}}catch(i){console.error("Failed to fetch user:",i),s.value.general="ไม่สามารถโหลดข้อมูลผู้ใช้ได้"}finally{_.value=!1}},A=()=>(s.value={},a.name||(s.value.name="กรุณากรอกชื่อ"),a.email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)||(s.value.email="รูปแบบอีเมลไม่ถูกต้อง"):s.value.email="กรุณากรอกอีเมล",a.username||(s.value.username="กรุณากรอก Username"),a.password&&a.password.length<8&&(s.value.password="รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร"),a.password&&a.password!==a.password_confirmation&&(s.value.password_confirmation="รหัสผ่านไม่ตรงกัน"),Object.keys(s.value).length===0),F=async()=>{if(A()){y.value=!0,v.value="";try{const i=S("token"),e={name:a.name,email:a.email,username:a.username,role:a.role,is_super_admin:a.is_super_admin,is_plearnd_admin:a.is_plearnd_admin,status:a.status};a.password&&(e.password=a.password,e.password_confirmation=a.password_confirmation),(await $fetch(`${V}/api/admin/users/${w}`,{method:"PUT",headers:{Authorization:`Bearer ${i.value}`,"Content-Type":"application/json"},body:e})).success&&(v.value="บันทึกข้อมูลสำเร็จ",setTimeout(()=>{T.push("/nuxnan-admin/users")},1500))}catch(i){i.data?.errors?s.value=i.data.errors:s.value.general=i.data?.message||"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง"}finally{y.value=!1}}};return E(()=>{z()}),(i,e)=>{const n=I;return o(),l("div",O,[r("div",G,[m(n,{to:"/nuxnan-admin/users",class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors"},{default:U(()=>[m(g(c),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"})]),_:1}),r("div",null,[e[9]||(e[9]=r("h1",{class:"text-2xl font-bold text-gray-800 dark:text-white"},"แก้ไขผู้ใช้",-1)),r("p",J,"แก้ไขข้อมูลผู้ใช้ #"+d(g(w)),1)])]),_.value?(o(),l("div",K,[r("div",Q,[m(g(c),{icon:"fluent:spinner-ios-20-regular",class:"w-8 h-8 text-indigo-600 animate-spin mx-auto"}),e[10]||(e[10]=r("p",{class:"text-gray-500 mt-2"},"กำลังโหลดข้อมูล...",-1))])])):(o(),l(h,{key:1},[v.value?(o(),l("div",W,[r("div",X,[m(g(c),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5"}),r("span",null,d(v.value),1)])])):p("",!0),s.value.general?(o(),l("div",Y,[r("div",Z,[m(g(c),{icon:"fluent:error-circle-24-filled",class:"w-5 h-5"}),r("span",null,d(s.value.general),1)])])):p("",!0),r("form",{onSubmit:H(F,["prevent"]),class:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 space-y-6"},[r("div",null,[e[11]||(e[11]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[x(" ชื่อ "),r("span",{class:"text-red-500"},"*")],-1)),u(r("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>a.name=t),type:"text",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":s.value.name}]),placeholder:"กรอกชื่อผู้ใช้"},null,2),[[b,a.name]]),s.value.name?(o(),l("p",ee,d(s.value.name),1)):p("",!0)]),r("div",null,[e[12]||(e[12]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[x(" อีเมล "),r("span",{class:"text-red-500"},"*")],-1)),u(r("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>a.email=t),type:"email",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":s.value.email}]),placeholder:"example@email.com"},null,2),[[b,a.email]]),s.value.email?(o(),l("p",re,d(s.value.email),1)):p("",!0)]),r("div",null,[e[13]||(e[13]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[x(" Username "),r("span",{class:"text-red-500"},"*")],-1)),u(r("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>a.username=t),type:"text",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":s.value.username}]),placeholder:"username"},null,2),[[b,a.username]]),s.value.username?(o(),l("p",ae,d(s.value.username),1)):p("",!0)]),r("div",se,[r("div",null,[e[14]||(e[14]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[x(" รหัสผ่านใหม่ "),r("span",{class:"text-gray-400 text-xs"},"(เว้นว่างถ้าไม่เปลี่ยน)")],-1)),u(r("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>a.password=t),type:"password",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":s.value.password}]),placeholder:"••••••••"},null,2),[[b,a.password]]),s.value.password?(o(),l("p",te,d(s.value.password),1)):p("",!0)]),r("div",null,[e[15]||(e[15]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," ยืนยันรหัสผ่านใหม่ ",-1)),u(r("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.password_confirmation=t),type:"password",class:f(["w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent",{"border-red-500":s.value.password_confirmation}]),placeholder:"••••••••"},null,2),[[b,a.password_confirmation]]),s.value.password_confirmation?(o(),l("p",oe,d(s.value.password_confirmation),1)):p("",!0)])]),r("div",le,[r("div",null,[e[16]||(e[16]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," บทบาท ",-1)),u(r("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.role=t),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"},[(o(),l(h,null,B(j,t=>r("option",{key:t.value,value:t.value},d(t.label),9,ne)),64))],512),[[$,a.role]])]),r("div",null,[e[17]||(e[17]=r("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"}," สถานะ ",-1)),u(r("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.status=t),class:"w-full px-4 py-2.5 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-xl text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"},[(o(),l(h,null,B(N,t=>r("option",{key:t.value,value:t.value},d(t.label),9,de)),64))],512),[[$,a.status]])])]),r("div",ie,[e[20]||(e[20]=r("h3",{class:"font-medium text-gray-700 dark:text-gray-300"},"สิทธิ์ผู้ดูแล",-1)),r("label",ue,[u(r("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.is_super_admin=t),type:"checkbox",class:"w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[C,a.is_super_admin]]),e[18]||(e[18]=r("span",{class:"text-gray-700 dark:text-gray-300"},"Super Admin",-1))]),r("label",ge,[u(r("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.is_plearnd_admin=t),type:"checkbox",class:"w-5 h-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,512),[[C,a.is_plearnd_admin]]),e[19]||(e[19]=r("span",{class:"text-gray-700 dark:text-gray-300"},"Plearnd Admin",-1))])]),r("div",me,[r("button",{type:"submit",disabled:y.value,class:"flex-1 inline-flex justify-center items-center gap-2 px-6 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 rounded-xl text-white font-medium transition-colors"},[y.value?(o(),M(g(c),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):(o(),M(g(c),{key:1,icon:"fluent:save-24-regular",class:"w-5 h-5"})),x(" "+d(y.value?"กำลังบันทึก...":"บันทึกการเปลี่ยนแปลง"),1)],8,pe),m(n,{to:"/nuxnan-admin/users",class:"flex-1 inline-flex justify-center items-center gap-2 px-6 py-3 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded-xl text-gray-700 dark:text-gray-300 font-medium transition-colors"},{default:U(()=>[m(g(c),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"}),e[21]||(e[21]=x(" ยกเลิก ",-1))]),_:1})])],32)],64))])}}});export{ve as default};
