import{a9 as q,r as x,n as I,z as U,c as n,a as t,g as F,d as C,b as d,u as o,t as i,T as y,e as b,F as M,k as N,j as W,a4 as G,o as a,I as l,p as H}from"./cTealXVQ.js";import{_ as J}from"./CbvBzs4i.js";import{S as k}from"./BQxta0Da.js";const K={class:"py-6"},O={class:"mb-6"},Q={class:"flex items-center gap-3 mb-2"},X={class:"p-2 bg-purple-100 dark:bg-purple-900/30 rounded-lg"},Y={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6"},Z={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md border border-gray-200 dark:border-gray-700"},tt={class:"flex items-center gap-3"},et={class:"p-2 bg-gray-100 dark:bg-gray-700 rounded-lg"},st={class:"text-2xl font-bold text-gray-900 dark:text-white"},rt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md border border-yellow-200 dark:border-yellow-800"},at={class:"flex items-center gap-3"},ot={class:"p-2 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg"},lt={class:"text-2xl font-bold text-yellow-600 dark:text-yellow-400"},dt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md border border-green-200 dark:border-green-800"},nt={class:"flex items-center gap-3"},it={class:"p-2 bg-green-100 dark:bg-green-900/30 rounded-lg"},ct={class:"text-2xl font-bold text-green-600 dark:text-green-400"},gt={class:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md border border-red-200 dark:border-red-800"},xt={class:"flex items-center gap-3"},ut={class:"p-2 bg-red-100 dark:bg-red-900/30 rounded-lg"},pt={class:"text-2xl font-bold text-red-600 dark:text-red-400"},yt={class:"bg-white dark:bg-gray-800 rounded-xl shadow-md p-2 mb-6"},vt={class:"flex flex-wrap items-center justify-between gap-2"},bt={class:"flex flex-wrap gap-2"},kt={key:0,class:"bg-yellow-600 text-white text-xs px-2 py-0.5 rounded-full"},ht={class:"flex items-center gap-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1"},mt={key:0,class:"flex flex-col items-center justify-center py-20"},ft={key:1,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center"},wt={class:"text-red-600 dark:text-red-400 mb-4"},_t={key:2,class:"bg-gray-50 dark:bg-gray-800 rounded-xl p-12 text-center"},Ct={class:"text-lg font-medium text-gray-600 dark:text-gray-400"},jt={key:3,class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},Bt={key:4,class:"bg-white dark:bg-gray-800 rounded-xl shadow-md overflow-hidden"},$t={class:"overflow-x-auto"},Tt={class:"w-full"},St={class:"divide-y divide-gray-200 dark:divide-gray-700"},Ft={class:"px-4 py-3 text-sm text-gray-900 dark:text-white font-medium"},At={class:"px-4 py-3"},Dt={class:"flex items-center gap-2"},It={class:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 overflow-hidden flex items-center justify-center"},Mt=["src"],Nt={class:"text-sm text-gray-900 dark:text-white"},Pt={class:"px-4 py-3 text-sm text-blue-600 dark:text-blue-400 font-medium"},Rt={class:"px-4 py-3 text-sm text-purple-600 dark:text-purple-400 font-medium"},Vt={class:"px-4 py-3 text-sm text-gray-600 dark:text-gray-400"},zt={key:0,class:"text-xs text-gray-500"},Lt={class:"px-4 py-3"},Et=["onClick"],qt=["src"],Ut={key:1,class:"text-gray-400 text-sm"},Wt={class:"px-4 py-3"},Gt={class:"px-4 py-3"},Ht={key:0,class:"flex items-center justify-center gap-2"},Jt=["onClick"],Kt=["onClick"],Ot={key:1,class:"text-gray-400 text-sm"},Qt={class:"relative max-w-4xl max-h-[90vh]"},Xt=["src"],Yt={key:5,class:"mt-8 flex items-center justify-center gap-4"},Zt=["disabled"],te={class:"text-gray-600 dark:text-gray-400"},ee=["disabled"],le={__name:"ApproveDonation",setup(se){const j=q(),P=H(),g=x([]),B=x(!0),w=x(null),u=x(1),h=x(1),R=x(0),c=x("all"),m=x("card"),f=x(null),$=I(()=>{if(c.value==="all")return g.value;const r={pending:0,approved:1,rejected:2};return g.value.filter(e=>e.status===r[c.value])}),v=I(()=>{const r=g.value.filter(p=>p.status===0).length,e=g.value.filter(p=>p.status===1).length,s=g.value.filter(p=>p.status===2).length;return{pending:r,approved:e,rejected:s,total:g.value.length}}),_=async(r=1)=>{try{B.value=!0,w.value=null;const e=await j.get(`/api/plearnd-admin/supports/donates?page=${r}`);e.donates&&(g.value=e.donates.data||e.donates,u.value=e.donates.current_page||1,h.value=e.donates.last_page||1,R.value=e.donates.total||g.value.length)}catch(e){console.error("Failed to fetch donates:",e),w.value="ไม่สามารถโหลดข้อมูลได้ กรุณาลองใหม่อีกครั้ง"}finally{B.value=!1}},A=r=>{const e=g.value.find(s=>s.id===r);e&&(e.status=1)},D=r=>{const e=g.value.find(s=>s.id===r);e&&(e.status=2)},V=()=>{u.value<h.value&&_(u.value+1)},z=()=>{u.value>1&&_(u.value-1)},T=r=>r?r.startsWith("http")?r:`${P.public.apiBase}${r}`:null,S=r=>{switch(r){case 0:return{text:"รออนุมัติ",class:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400",icon:"mdi:clock-outline"};case 1:return{text:"อนุมัติแล้ว",class:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400",icon:"mdi:check-circle"};case 2:return{text:"ปฏิเสธ",class:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",icon:"mdi:close-circle"};default:return{text:"ไม่ทราบ",class:"bg-gray-100 text-gray-800",icon:"mdi:help-circle"}}},L=async r=>{try{(await k.fire({title:"ยืนยันการอนุมัติ?",text:`คุณต้องการอนุมัติการสนับสนุนนี้ใช่หรือไม่ (#${r.id})`,icon:"question",showCancelButton:!0,confirmButtonColor:"#10B981",cancelButtonColor:"#6B7280",confirmButtonText:"ยืนยัน, อนุมัติ!",cancelButtonText:"ยกเลิก"})).isConfirmed&&(await j.patch(`/api/plearnd-admin/supports/donates/${r.id}/recieve`,{})).success&&(A(r.id),k.fire("สำเร็จ!","อนุมัติการสนับสนุนเรียบร้อยแล้ว","success"))}catch(e){console.error("Failed to approve:",e),k.fire("เกิดข้อผิดพลาด","ไม่สามารถอนุมัติได้ กรุณาลองใหม่","error")}},E=async r=>{try{(await k.fire({title:"ยืนยันการปฏิเสธ?",text:"คุณแน่ใจหรือไม่ที่จะปฏิเสธการสนับสนุนนี้? การกระทำนี้ไม่สามารถย้อนกลับได้",icon:"warning",showCancelButton:!0,confirmButtonColor:"#EF4444",cancelButtonColor:"#6B7280",confirmButtonText:"ยืนยัน, ปฏิเสธ!",cancelButtonText:"ยกเลิก"})).isConfirmed&&(await j.patch(`/api/plearnd-admin/supports/donates/${r.id}/reject`,{})).success&&(D(r.id),k.fire("เรียบร้อย","ปฏิเสธการสนับสนุนแล้ว","success"))}catch(e){console.error("Failed to reject:",e),k.fire("เกิดข้อผิดพลาด","ไม่สามารถปฏิเสธได้ กรุณาลองใหม่","error")}};return U(()=>{_()}),(r,e)=>(a(),n("div",K,[t("div",O,[t("div",Q,[t("div",X,[d(o(l),{icon:"mdi:hand-coin",class:"w-6 h-6 text-purple-600 dark:text-purple-400"})]),e[9]||(e[9]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"อนุมัติการสนับสนุนแต้ม",-1))]),e[10]||(e[10]=t("p",{class:"text-gray-600 dark:text-gray-400"},"ตรวจสอบและอนุมัติการสนับสนุนจากผู้บริจาค",-1))]),t("div",Y,[t("div",Z,[t("div",tt,[t("div",et,[d(o(l),{icon:"mdi:format-list-bulleted",class:"w-5 h-5 text-gray-600 dark:text-gray-400"})]),t("div",null,[t("p",st,i(v.value.total),1),e[11]||(e[11]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"ทั้งหมด",-1))])])]),t("div",rt,[t("div",at,[t("div",ot,[d(o(l),{icon:"mdi:clock-outline",class:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})]),t("div",null,[t("p",lt,i(v.value.pending),1),e[12]||(e[12]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"รออนุมัติ",-1))])])]),t("div",dt,[t("div",nt,[t("div",it,[d(o(l),{icon:"mdi:check-circle",class:"w-5 h-5 text-green-600 dark:text-green-400"})]),t("div",null,[t("p",ct,i(v.value.approved),1),e[13]||(e[13]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"อนุมัติแล้ว",-1))])])]),t("div",gt,[t("div",xt,[t("div",ut,[d(o(l),{icon:"mdi:close-circle",class:"w-5 h-5 text-red-600 dark:text-red-400"})]),t("div",null,[t("p",pt,i(v.value.rejected),1),e[14]||(e[14]=t("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"ปฏิเสธ",-1))])])])]),t("div",yt,[t("div",vt,[t("div",bt,[t("button",{onClick:e[0]||(e[0]=s=>c.value="all"),class:y(["px-4 py-2 rounded-lg font-medium text-sm transition-colors",c.value==="all"?"bg-purple-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])}," ทั้งหมด ",2),t("button",{onClick:e[1]||(e[1]=s=>c.value="pending"),class:y(["px-4 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",c.value==="pending"?"bg-yellow-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},[d(o(l),{icon:"mdi:clock-outline",class:"w-4 h-4"}),e[15]||(e[15]=b(" รออนุมัติ ",-1)),v.value.pending>0?(a(),n("span",kt,i(v.value.pending),1)):C("",!0)],2),t("button",{onClick:e[2]||(e[2]=s=>c.value="approved"),class:y(["px-4 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",c.value==="approved"?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},[d(o(l),{icon:"mdi:check-circle",class:"w-4 h-4"}),e[16]||(e[16]=b(" อนุมัติแล้ว ",-1))],2),t("button",{onClick:e[3]||(e[3]=s=>c.value="rejected"),class:y(["px-4 py-2 rounded-lg font-medium text-sm transition-colors flex items-center gap-2",c.value==="rejected"?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"])},[d(o(l),{icon:"mdi:close-circle",class:"w-4 h-4"}),e[17]||(e[17]=b(" ปฏิเสธ ",-1))],2)]),t("div",ht,[t("button",{onClick:e[4]||(e[4]=s=>m.value="card"),class:y(["p-2 rounded-md transition-colors",m.value==="card"?"bg-white dark:bg-gray-600 shadow text-purple-600 dark:text-purple-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"]),title:"มุมมองแบบการ์ด"},[d(o(l),{icon:"mdi:view-grid",class:"w-5 h-5"})],2),t("button",{onClick:e[5]||(e[5]=s=>m.value="table"),class:y(["p-2 rounded-md transition-colors",m.value==="table"?"bg-white dark:bg-gray-600 shadow text-purple-600 dark:text-purple-400":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"]),title:"มุมมองแบบตาราง"},[d(o(l),{icon:"mdi:table",class:"w-5 h-5"})],2)])])]),B.value?(a(),n("div",mt,[d(o(l),{icon:"mdi:loading",class:"w-12 h-12 text-purple-500 animate-spin"}),e[18]||(e[18]=t("p",{class:"mt-4 text-gray-600 dark:text-gray-400"},"กำลังโหลดข้อมูล...",-1))])):w.value?(a(),n("div",ft,[d(o(l),{icon:"mdi:alert-circle",class:"w-12 h-12 text-red-500 mx-auto mb-4"}),t("p",wt,i(w.value),1),t("button",{onClick:_,class:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors"}," ลองใหม่อีกครั้ง ")])):$.value.length===0?(a(),n("div",_t,[d(o(l),{icon:"mdi:inbox-outline",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),t("p",Ct,i(c.value==="pending"?"ไม่มีรายการที่รออนุมัติ":"ไม่มีข้อมูลการสนับสนุน"),1)])):m.value==="card"?(a(),n("div",jt,[(a(!0),n(M,null,N($.value,s=>(a(),F(J,{key:s.id,donate:s,onApproved:A,onRejected:D},null,8,["donate"]))),128))])):(a(),n("div",Bt,[t("div",$t,[t("table",Tt,[e[19]||(e[19]=t("thead",{class:"bg-gray-50 dark:bg-gray-700"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"ID"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"ผู้บริจาค"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"จำนวนเงิน"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"แต้ม"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"วันที่/เวลาโอน"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"สลิป"),t("th",{class:"px-4 py-3 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"สถานะ"),t("th",{class:"px-4 py-3 text-center text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider"},"ดำเนินการ")])],-1)),t("tbody",St,[(a(!0),n(M,null,N($.value,s=>(a(),n("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors"},[t("td",Ft,"#"+i(s.id),1),t("td",At,[t("div",Dt,[t("div",It,[s.donor?.avatar?(a(),n("img",{key:0,src:s.donor.avatar,class:"w-full h-full object-cover"},null,8,Mt)):(a(),F(o(l),{key:1,icon:"mdi:account",class:"w-4 h-4 text-gray-400"}))]),t("span",Nt,i(s.donor_name||"ไม่ประสงค์ออกนาม"),1)])]),t("td",Pt,i(s.amounts),1),t("td",Rt,i(s.total_points?.toLocaleString()||0),1),t("td",Vt,[t("div",null,i(s.transfer_date||"-"),1),s.transfer_time?(a(),n("div",zt,i(s.transfer_time),1)):C("",!0)]),t("td",Lt,[T(s.slip)?(a(),n("button",{key:0,onClick:p=>f.value=T(s.slip),class:"w-12 h-12 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-600 hover:border-purple-500 transition-colors"},[t("img",{src:T(s.slip),class:"w-full h-full object-cover"},null,8,qt)],8,Et)):(a(),n("span",Ut,"-"))]),t("td",Wt,[t("span",{class:y([S(s.status).class,"px-2 py-1 rounded-full text-xs font-medium inline-flex items-center gap-1"])},[d(o(l),{icon:S(s.status).icon,class:"w-3 h-3"},null,8,["icon"]),b(" "+i(S(s.status).text),1)],2)]),t("td",Gt,[s.status===0?(a(),n("div",Ht,[t("button",{onClick:p=>L(s),class:"p-2 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-lg hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",title:"อนุมัติ"},[d(o(l),{icon:"mdi:check",class:"w-5 h-5"})],8,Jt),t("button",{onClick:p=>E(s),class:"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors",title:"ปฏิเสธ"},[d(o(l),{icon:"mdi:close",class:"w-5 h-5"})],8,Kt)])):(a(),n("span",Ot,"-"))])]))),128))])])])])),(a(),F(G,{to:"body"},[f.value?(a(),n("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4",onClick:e[8]||(e[8]=s=>f.value=null)},[t("div",Qt,[t("button",{onClick:e[6]||(e[6]=s=>f.value=null),class:"absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors"},[d(o(l),{icon:"mdi:close",class:"w-8 h-8"})]),t("img",{src:f.value,alt:"สลิปโอนเงิน",class:"max-w-full max-h-[85vh] object-contain rounded-lg",onClick:e[7]||(e[7]=W(()=>{},["stop"]))},null,8,Xt)])])):C("",!0)])),h.value>1?(a(),n("div",Yt,[t("button",{onClick:z,disabled:u.value<=1,class:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},[d(o(l),{icon:"mdi:chevron-left",class:"w-5 h-5"}),e[20]||(e[20]=b(" ก่อนหน้า ",-1))],8,Zt),t("span",te," หน้า "+i(u.value)+" จาก "+i(h.value),1),t("button",{onClick:V,disabled:u.value>=h.value,class:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"},[e[21]||(e[21]=b(" ถัดไป ",-1)),d(o(l),{icon:"mdi:chevron-right",class:"w-5 h-5"})],8,ee)])):C("",!0)]))}};export{le as default};
