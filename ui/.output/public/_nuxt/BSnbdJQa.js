import{l as $,n as u,r as d,p as E}from"./cTealXVQ.js";const b=()=>{const o=$(),w=E(),n=u(()=>w.public.apiBase||""),r=d(!1),s=d(null),l=u(()=>o.user?.wallet||0),p=u(()=>o.user),g=async()=>{try{r.value=!0,s.value=null;const t=await $fetch(`${n.value}/api/wallet/balance`,{method:"GET",headers:{Authorization:`Bearer ${o.token}`}});if(t.success)return t.data;throw new Error(t.message||"Failed to get wallet balance")}catch(t){const e=t.data?.message||t.response?._data?.message||t.message||"Failed to get wallet balance";throw s.value=e,console.error("Get wallet balance error:",t),new Error(e)}finally{r.value=!1}},h=async t=>{try{r.value=!0,s.value=null;const e=await $fetch(`${n.value}/api/wallet/deposit`,{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:t});if(e.success)return e.data;throw new Error(e.message||"Failed to deposit money")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"Failed to deposit money";throw s.value=a,console.error("Deposit error:",e),new Error(a)}finally{r.value=!1}},f=async t=>{try{r.value=!0,s.value=null;const e=await $fetch(`${n.value}/api/wallet/withdraw`,{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:t});if(e.success)return e.data;throw new Error(e.message||"Failed to withdraw money")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"Failed to withdraw money";throw s.value=a,console.error("Withdraw error:",e),new Error(a)}finally{r.value=!1}},m=async t=>{try{r.value=!0,s.value=null;const e=await $fetch(`${n.value}/api/wallet/transfer`,{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:t});if(e.success)return e.data;throw new Error(e.message||"Failed to transfer money")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"Failed to transfer money";throw s.value=a,console.error("Transfer error:",e),new Error(a)}finally{r.value=!1}},v=async(t={})=>{try{r.value=!0,s.value=null;const e=new URLSearchParams;t.type&&e.append("type",t.type),t.date_from&&e.append("date_from",t.date_from),t.date_to&&e.append("date_to",t.date_to),t.page&&e.append("page",t.page.toString()),t.per_page&&e.append("per_page",t.per_page.toString());const a=await $fetch(`${n.value}/api/wallet/transactions?${e.toString()}`,{method:"GET",headers:{Authorization:`Bearer ${o.token}`}});if(a.success)return a.data;throw new Error(a.message||"Failed to get transactions")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"Failed to get transactions";throw s.value=a,console.error("Get transactions error:",e),new Error(a)}finally{r.value=!1}},c=t=>new Intl.NumberFormat("th-TH",{style:"currency",currency:"THB"}).format(t),y=t=>t>=25&&l.value>=t,i=t=>t*.13;return{wallet:l,user:p,isLoading:r,error:s,getBalance:g,deposit:h,withdraw:f,transfer:m,convertToPoints:async t=>{try{if(r.value=!0,s.value=null,l.value<t)throw new Error(`ยอดเงินของคุณไม่เพียงพอ (ต้องการ ${c(t)}, มีอยู่ ${c(l.value)})`);const e=await $fetch(`${n.value}/api/wallet/convert-to-points`,{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:{amount:t}});if(e.success)return e.data&&o.setWallet(e.data.new_wallet_balance||0),e.data;throw new Error(e.message||"Failed to convert wallet to points")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"Failed to convert wallet to points";throw s.value=a,console.error("Convert wallet to points error:",e),new Error(a)}finally{r.value=!1}},getTransactions:v,createDepositRequest:async t=>{try{r.value=!0,s.value=null;const e=await $fetch(`${n.value}/api/wallet/deposit-request`,{method:"POST",headers:{Authorization:`Bearer ${o.token}`},body:t});if(e.success)return e.data;throw new Error(e.message||"ไม่สามารถสร้างคำขอเติมเงินได้")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"ไม่สามารถสร้างคำขอเติมเงินได้";throw s.value=a,console.error("Create deposit request error:",e),new Error(a)}finally{r.value=!1}},getDepositRequests:async(t={})=>{try{r.value=!0,s.value=null;const e=new URLSearchParams;t.status&&e.append("status",t.status),t.page&&e.append("page",t.page.toString()),t.per_page&&e.append("per_page",t.per_page.toString());const a=await $fetch(`${n.value}/api/wallet/deposit-requests?${e}`,{method:"GET",headers:{Authorization:`Bearer ${o.token}`}});if(a.success)return a.data;throw new Error(a.message||"ไม่สามารถดึงข้อมูลคำขอเติมเงินได้")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"ไม่สามารถดึงข้อมูลคำขอเติมเงินได้";throw s.value=a,console.error("Get deposit requests error:",e),new Error(a)}finally{r.value=!1}},cancelDepositRequest:async t=>{try{r.value=!0,s.value=null;const e=await $fetch(`${n.value}/api/wallet/deposit-requests/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o.token}`}});if(e.success)return e.data;throw new Error(e.message||"ไม่สามารถยกเลิกคำขอได้")}catch(e){const a=e.data?.message||e.response?._data?.message||e.message||"ไม่สามารถยกเลิกคำขอได้";throw s.value=a,console.error("Cancel deposit request error:",e),new Error(a)}finally{r.value=!1}},formatMoney:c,canWithdraw:y,calculateFee:i,getNetAmount:t=>{const e=i(t);return t-e}}};export{b as u};
