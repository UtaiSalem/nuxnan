import{a8 as B,r as c,n as v,a9 as i}from"./cTealXVQ.js";const j=B("courseGroup",()=>{const s=c([]),o=c(null),l=c(!1),r=c(null),p=c(null),f=c(null),$=300*1e3,x=v(()=>s.value.length),C=v(()=>e=>s.value.find(u=>u.id===e)),D=v(()=>s.value.length>0),h=v(()=>e=>!p.value||e&&f.value!=e?!1:Date.now()-p.value<$),G=(e,u)=>{s.value=e||[],p.value=Date.now(),u&&(f.value=u)},g=e=>{o.value=e},y=e=>{s.value.find(a=>a.id===e.id)||s.value.push(e)},w=(e,u)=>{const a=s.value.findIndex(t=>t.id===e);a!==-1&&(s.value[a]={...s.value[a],...u}),o.value?.id===e&&(o.value={...o.value,...u})},m=e=>{s.value=s.value.filter(u=>u.id!==e),o.value?.id===e&&(o.value=null)};return{groups:s,currentGroup:o,isLoading:l,error:r,groupsCount:x,getGroupById:C,hasGroups:D,isCacheValid:h,setGroups:G,setCurrentGroup:g,addGroup:y,updateGroup:w,removeGroup:m,clearGroups:()=>{s.value=[],o.value=null,r.value=null,p.value=null,f.value=null},fetchGroups:async(e,u=!1)=>{if(!u&&h.value(e))return{success:!0,groups:s.value};l.value=!0,r.value=null;try{const t=await i().get(`/api/courses/${e}/groups`);if(t.success)return G(t.groups||t.data,e),t}catch(a){throw r.value=a.data?.msg||"ไม่สามารถโหลดข้อมูลกลุ่มได้",a}finally{l.value=!1}},fetchGroupById:async(e,u)=>{l.value=!0,r.value=null;try{const t=await i().get(`/api/courses/${e}/groups/${u}`);if(t.success)return g(t.group||t.data),t}catch(a){throw r.value=a.data?.msg||"ไม่สามารถโหลดข้อมูลกลุ่มได้",a}finally{l.value=!1}},createGroup:async(e,u)=>{l.value=!0,r.value=null;try{const t=await i().post(`/api/courses/${e}/groups`,u),n=t.group||t.data||t;return n&&y(n),n}catch(a){throw r.value=a.data?.msg||"ไม่สามารถสร้างกลุ่มได้",a}finally{l.value=!1}},updateGroupData:async(e,u,a)=>{l.value=!0,r.value=null;try{const n=await i().patch(`/api/courses/${e}/groups/${u}`,a),d=n.group||n.data||n;return d&&w(u,d),d}catch(t){throw r.value=t.data?.msg||"ไม่สามารถอัพเดทกลุ่มได้",t}finally{l.value=!1}},deleteGroup:async(e,u)=>{l.value=!0,r.value=null;try{const t=await i().delete(`/api/courses/${e}/groups/${u}`);if(t.success)return m(u),t}catch(a){throw r.value=a.data?.msg||"ไม่สามารถลบกลุ่มได้",a}finally{l.value=!1}}}});export{j as u};
