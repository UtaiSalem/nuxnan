import{_ as A}from"./0NabHjdI.js";import{q as L,aE as E,n as v,ay as F,v as R,a9 as j,r as h,z as q,a3 as z,c as m,a,g as C,d as $,b as r,w as p,u as l,t as y,o as n,e as f,I as u,i as D}from"./DvtEeXFW.js";import{_ as H}from"./PAgS-cgi.js";import"./CSfkmZfu.js";import"./D5md19eB.js";import"./Cpj98o6Y.js";const M={class:"max-w-4xl mx-auto py-8 px-4"},T={class:"flex items-center gap-2 text-sm mb-6"},G={key:0,class:"flex justify-center items-center py-16"},J={key:1,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center"},K={class:"text-red-600 dark:text-red-400 mb-4"},O={key:2,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center"},ee=L({__name:"edit",setup(P){const b=E(),d=v(()=>b.currentCourse),I=v(()=>b.isCourseAdmin),k=F(),_=R(),N=j(),s=v(()=>k.params.id),c=v(()=>k.params.lessonId),o=h(null),g=h(!0),i=h(null),S=async()=>{if(!d.value||d.value.id!=s.value)try{await b.fetchCourse(s.value)}catch(t){console.error("Failed to fetch course:",t)}},w=async()=>{if(!(!s.value||!c.value)){g.value=!0,i.value=null;try{const t=await N.get(`/api/courses/${s.value}/lessons/${c.value}`);o.value=t.lesson||t.data||t}catch(t){console.error("Failed to fetch lesson:",t),i.value=t.data?.message||"ไม่สามารถโหลดข้อมูลบทเรียนได้"}finally{g.value=!1}}};q(async()=>{await S(),await w()});const B=t=>{_.push(`/courses/${s.value}/lessons/${c.value}`)},V=()=>{_.back()};return z(o,t=>{t?.title&&D({title:`แก้ไข: ${t.title} - ${d.value?.name||"รายวิชา"}`})}),(t,e)=>{const x=A;return n(),m("div",M,[a("nav",T,[r(x,{to:`/courses/${s.value}`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:p(()=>[f(y(d.value?.name||"รายวิชา"),1)]),_:1},8,["to"]),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),r(x,{to:`/courses/${s.value}/lessons`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:p(()=>[...e[0]||(e[0]=[f(" บทเรียน ",-1)])]),_:1},8,["to"]),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),o.value?(n(),C(x,{key:0,to:`/courses/${s.value}/lessons/${c.value}`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:p(()=>[f(y(o.value.title),1)]),_:1},8,["to"])):$("",!0),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),e[1]||(e[1]=a("span",{class:"text-gray-900 dark:text-white font-medium"},"แก้ไข",-1))]),g.value?(n(),m("div",G,[...e[2]||(e[2]=[a("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):i.value?(n(),m("div",J,[r(l(u),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[3]||(e[3]=a("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"เกิดข้อผิดพลาด",-1)),a("p",K,y(i.value),1),a("button",{onClick:w,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," ลองใหม่ ")])):I.value?o.value?(n(),C(H,{key:3,"course-id":s.value,lesson:o.value,"is-edit":!0,onSubmit:B,onCancel:V},null,8,["course-id","lesson"])):$("",!0):(n(),m("div",O,[r(l(u),{icon:"fluent:shield-error-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[5]||(e[5]=a("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"ไม่มีสิทธิ์เข้าถึง",-1)),e[6]||(e[6]=a("p",{class:"text-red-600 dark:text-red-400 mb-4"},"คุณไม่มีสิทธิ์ในการแก้ไขบทเรียน",-1)),r(x,{to:`/courses/${s.value}/lessons`,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:p(()=>[r(l(u),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"}),e[4]||(e[4]=f(" กลับไปหน้าบทเรียน ",-1))]),_:1},8,["to"])]))])}}});export{ee as default};
