import{N as n,_ as L,av as U,c as d,d as B,o as i,a as e,b as v,w as R,q as C,u as t,t as x,I as _,ae as V,z as T,af as P,an as F,r as I,f as O,Y as G,a4 as E,e as Q,l as j,y as Y,ay as q,p as H,F as A,n as z,j as J}from"./DuB962GZ.js";import{u as K}from"./BldT-Pqa.js";import{u as W}from"./C_KBwUJh.js";import{a as X}from"./Czq9JhUr.js";import{D as Z}from"./DW0O-uE9.js";import{S}from"./BQxta0Da.js";function ee(M,c){const s=n(()=>{if(!c.value||c.value===0)return 0;const h=M.value?.achieved_score||0;return Math.round(h/c.value*100)}),w=n(()=>{const h=s.value;return h>=80?"excellent":h>=50?"good":"fair"}),u=n(()=>{switch(w.value){case"excellent":return"ยอดเยี่ยม";case"good":return"ดี";default:return"พอใช้"}}),f=n(()=>{switch(w.value){case"excellent":return"fluent:ribbon-star-20-filled";case"good":return"fluent:thumb-like-20-filled";default:return"fluent:battery-3-20-filled"}}),m=n(()=>{switch(w.value){case"excellent":return{ring:"ring-green-500",bg:"bg-green-500",text:"text-green-600",gradient:"from-green-400 to-green-600"};case"good":return{ring:"ring-yellow-400",bg:"bg-yellow-400",text:"text-yellow-600",gradient:"from-yellow-300 to-yellow-500"};default:return{ring:"ring-orange-500",bg:"bg-orange-500",text:"text-orange-600",gradient:"from-orange-400 to-orange-600"}}}),b=n(()=>{const h=M.value?.achieved_score||0,y=c.value||0;return Math.max(0,y-h)}),$=n(()=>Math.max(0,100-s.value)),p=n(()=>({width:`${s.value}%`}));return{percentage:s,progressStatus:w,progressColor:m,statusMessage:u,statusIcon:f,remainingScore:b,remainingPercentage:$,progressBarStyle:p}}const te=["aria-label"],re={key:0,class:"absolute top-3 right-3 z-10"},se={class:"flex items-center w-full lg:w-64 lg:flex-shrink-0"},oe={class:"relative flex-shrink-0"},ae=["src","alt"],ne={class:"ml-4 min-w-0 flex-1"},le=["href","title"],ie={class:"truncate"},ue=["title"],de={class:"text-xs font-semibold"},ce={class:"flex items-center space-x-3 text-sm"},me={class:"font-medium"},ge={class:"flex items-center text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors"},fe={class:"font-medium"},be={class:"flex flex-col items-start lg:items-end w-full flex-1"},pe={class:"flex items-center justify-between mb-2 w-full"},xe={class:"flex items-center"},ve={class:"relative w-full bg-gray-100 dark:bg-gray-700 rounded-full h-7 overflow-hidden shadow-inner"},he=["aria-valuenow","aria-label"],ye={class:"relative z-10 font-bold"},_e={key:0,class:"absolute inset-0 flex items-center justify-center"},we={class:"flex items-center justify-between w-full mt-2 text-xs"},ke={class:"text-gray-500 dark:text-gray-400"},$e={__name:"MemberCard",props:{member:{type:Object,required:!0,default:()=>({})},dataIndex:{type:Number,default:0}},emits:["request-unmember-course"],setup(M,{emit:c}){const s=M,w=c,u=n(()=>X().props),f=n(()=>u.value.course?.data?.total_score||100),m=n(()=>u.value.isCourseAdmin),b=n(()=>u.value.auth?.user?.id);n(()=>s.member?.user?.id===b.value||m.value);const $=U(s,"member"),{percentage:p,progressStatus:h,progressColor:y,statusMessage:l,statusIcon:o}=ee($,f),r=n(()=>s.member?.member_name||s.member?.user?.name||s.member?.student?.name||s.member?.name||"Unknown"),a=n(()=>s.member?.order_number||"#"),k=n(()=>s.member?.group?.name||"-"),N=n(()=>s.member?.user?.avatar||"/images/default-avatar.png"),D=()=>{w("request-unmember-course",{memberId:s.member.id,memberName:r.value})};return(Ve,g)=>s.member?.role!==3?(i(),d("li",{key:0,class:"group relative bg-white dark:bg-gray-800 hover:bg-gradient-to-br hover:from-white hover:to-indigo-50 dark:hover:from-gray-800 dark:hover:to-gray-700 shadow-lg hover:shadow-xl p-4 rounded-xl w-full mb-3 transition-all duration-300 border border-gray-100 dark:border-gray-700 hover:border-indigo-200 dark:hover:border-indigo-900","aria-label":`Member card for ${r.value}`,role:"article"},[m.value?(i(),d("div",re,[v(Z,{onDeleteModel:D},{deleteModel:R(()=>[...g[0]||(g[0]=[e("span",null,"ลบสมาชิก",-1)])]),_:1})])):B("",!0),e("div",{class:C(["flex flex-col lg:flex-row gap-4 items-start",{"pr-10":m.value}])},[e("div",se,[e("div",oe,[e("img",{class:C(["w-16 h-16 rounded-full ring-2 transition-all duration-300",[t(y).ring,`group-hover:${t(y).ring}`]]),src:N.value,alt:`${r.value}'s avatar`,loading:"lazy"},null,10,ae),e("div",{class:C(["absolute -bottom-1 -right-1 px-2 py-0.5 rounded-full text-[10px] font-bold text-white shadow-lg",t(y).bg])},x(t(p))+"% ",3)]),e("div",ne,[m.value?(i(),d("a",{key:0,href:`/courses/${u.value.course?.data?.id}/members/${s.member.id}/member-settings`,target:"_blank",rel:"noopener noreferrer",title:r.value,class:"text-gray-900 dark:text-white font-bold tracking-wide text-lg hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors duration-300 cursor-pointer inline-flex items-center group/link max-w-full"},[e("span",ie,x(r.value),1),v(t(_),{icon:"heroicons:arrow-top-right-on-square",class:"w-4 h-4 ml-1.5 flex-shrink-0 opacity-0 group-hover/link:opacity-100 transition-opacity duration-200"})],8,le)):(i(),d("p",{key:1,title:r.value,class:"text-gray-900 dark:text-white font-bold tracking-wide text-lg truncate"},x(r.value),9,ue)),e("div",{class:C(["flex items-center mt-1 mb-2",t(y).text])},[v(t(_),{icon:t(o),class:"w-4 h-4 mr-1.5"},null,8,["icon"]),e("span",de,x(t(l)),1)],2),e("div",ce,[e("span",{class:C(["flex items-center transition-colors",a.value==="#"?"text-orange-500 dark:text-orange-400 font-bold":"text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400"])},[v(t(_),{icon:"fluent:number-symbol-square-20-filled",class:"w-5 h-5 mr-1"}),e("span",me,x(a.value),1)],2),e("span",ge,[v(t(_),{icon:"heroicons:user-group-solid",class:"w-5 h-5 mr-1"}),e("span",fe,x(k.value),1)])])])]),e("div",be,[e("div",pe,[e("div",xe,[v(t(_),{icon:"heroicons:academic-cap-solid",class:"w-5 h-5 text-indigo-500 dark:text-indigo-400 mr-2"}),g[1]||(g[1]=e("span",{class:"text-sm font-semibold text-gray-700 dark:text-gray-300"},"ความคืบหน้า",-1))])]),e("div",ve,[e("div",{class:C(["h-full text-xs font-bold text-white flex items-center justify-center rounded-full transition-all duration-500 ease-out relative overflow-hidden bg-gradient-to-r",t(y).gradient]),style:V(`width: ${t(p)}%`),role:"progressbar","aria-valuenow":t(p),"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Progress: ${t(p)}% - ${t(h)}`},[g[2]||(g[2]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"},null,-1)),e("span",ye,x(t(p))+"%",1)],14,he),t(p)===0?(i(),d("div",_e,[...g[3]||(g[3]=[e("span",{class:"text-xs font-medium text-gray-500"},"ยังไม่มีคะแนน",-1)])])):B("",!0)]),e("div",we,[e("div",ke,[e("span",{class:C(["font-medium",t(y).text])},x(s.member?.achieved_score||0),3),g[4]||(g[4]=e("span",{class:"mx-1"},"/",-1)),e("span",null,x(f.value),1),g[5]||(g[5]=e("span",{class:"ml-1"},"คะแนน",-1))])])])],2)],8,te)):B("",!0)}},Ce=L($e,[["__scopeId","data-v-0865bb0d"]]),Me={class:"container mx-auto px-4 py-8 max-w-7xl"},Ne={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8"},Be={class:"text-2xl font-bold text-gray-900 dark:text-white flex items-center gap-3"},Ie={key:0,class:"text-sm font-normal text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full"},Se={class:"flex flex-col sm:flex-row gap-3"},Ge={class:"relative w-full md:w-64"},je={key:0,class:"flex items-center gap-2 w-full md:w-auto"},qe=["value"],Ae={key:0,class:"flex justify-center py-20"},ze={class:"flex flex-col items-center gap-3"},De={key:1},Le={class:"flex flex-col gap-3"},Ue={key:2,class:"text-center py-20 bg-white dark:bg-gray-800 rounded-xl border border-dashed border-gray-300 dark:border-gray-700"},Re={class:"inline-flex p-4 rounded-full bg-gray-50 dark:bg-gray-900 mb-4"},Ye=T({__name:"index",setup(M){const c=G("course"),s=G("isCourseAdmin"),w=P();F();const u=K(),f=W(),m=I(""),b=I("all");I("grid");const $=n(()=>{let l=[];const o=b.value==="all"?"all":Number(b.value);if(o==="all"){const r=u.groups.flatMap(k=>k.members||[]),a=new Set;l=r.filter(k=>{const N=a.has(k.id);return a.add(k.id),!N})}else l=u.getGroupById(Number(o))?.members||[];if(!s.value&&f.member?.group_id){const r=Number(f.member.group_id);l=l.filter(a=>a.group_id===r)}if(m.value){const r=m.value.toLowerCase();l=l.filter(a=>(a.member_name||a.user?.name||a.student?.name||a.name||"").toLowerCase().includes(r)||(a.user?.email||"").toLowerCase().includes(r)||(a.student_id||"").toLowerCase().includes(r))}return l.sort((r,a)=>{const k=r.order_number!=null?Number(r.order_number):1/0,N=a.order_number!=null?Number(a.order_number):1/0;return k-N}),l}),p=n(()=>u.isLoading),h=n(()=>$.value.length);O(async()=>{s.value&&f.member?.last_access_group_tab?b.value=f.member.last_access_group_tab:!s.value&&f.member?.group_id&&(b.value=f.member.group_id),c?.value?.id&&await u.fetchGroups(c.value.id)}),E(()=>c?.value?.id,async l=>{l&&await u.fetchGroups(l)});const y=async({memberId:l,memberName:o})=>{if((await S.fire({title:"ยืนยันการลบสมาชิก?",text:`คุณต้องการลบ "${o}" ออกจากรายวิชานี้ใช่หรือไม่?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย!",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await w.delete(`/api/courses/${c.value.id}/members/${l}`),S.fire("ลบสำเร็จ!","สมาชิกธถูกลบออกจากรายวิชาเรียบร้อยแล้ว.","success"),await u.fetchGroups(c.value.id,!0)}catch(a){console.error("Failed to remove member:",a),S.fire("เกิดข้อผิดพลาด!","ไม่สามารถลบสมาชิกได้.","error")}};return(l,o)=>(i(),d("div",Me,[e("div",Ne,[e("div",null,[e("h1",Be,[v(t(_),{icon:"ph:users-three-duotone",class:"w-8 h-8 text-blue-500"}),o[2]||(o[2]=Q(" สมาชิกในรายวิชา ",-1)),t(p)?B("",!0):(i(),d("span",Ie,x(t(h))+" คน ",1))]),o[3]||(o[3]=e("p",{class:"mt-1 text-gray-500 dark:text-gray-400 text-sm"}," รายชื่อนักเรียนและผู้สอนทั้งหมดในรายวิชานี้ ",-1))]),e("div",Se,[e("div",Ge,[v(t(_),{icon:"heroicons:magnifying-glass",class:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),j(e("input",{"onUpdate:modelValue":o[0]||(o[0]=r=>q(m)?m.value=r:null),type:"text",placeholder:"ค้นหาชื่อ, รหัสนักศึกษา...",class:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all placeholder:text-gray-400 dark:placeholder:text-gray-500 dark:text-white"},null,512),[[Y,t(m)]])]),t(s)?(i(),d("div",je,[v(t(_),{icon:"heroicons:funnel",class:"w-5 h-5 text-gray-400"}),j(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>q(b)?b.value=r:null),class:"w-full md:w-64 px-4 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none cursor-pointer"},[o[4]||(o[4]=e("option",{value:"all"},"ทุกกลุ่มเรียน (All Groups)",-1)),(i(!0),d(A,null,z(t(u).groups,r=>(i(),d("option",{key:r.id,value:r.id},x(r.name),9,qe))),128))],512),[[H,t(b)]])])):B("",!0)])]),t(p)?(i(),d("div",Ae,[e("div",ze,[v(t(_),{icon:"svg-spinners:ring-resize",class:"w-10 h-10 text-blue-500"}),o[5]||(o[5]=e("span",{class:"text-gray-500 animate-pulse"},"กำลังโหลดข้อมูลสมาชิก...",-1))])])):t($).length>0?(i(),d("div",De,[e("ul",Le,[(i(!0),d(A,null,z(t($),(r,a)=>(i(),J(Ce,{key:r.id,member:r,"data-index":a,onRequestUnmemberCourse:y},null,8,["member","data-index"]))),128))])])):(i(),d("div",Ue,[e("div",Re,[v(t(_),{icon:"ph:users-three-duotone",class:"w-12 h-12 text-gray-400"})]),o[6]||(o[6]=e("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-1"},"ไม่พบสมาชิก",-1)),o[7]||(o[7]=e("p",{class:"text-gray-500"},"ลองเปลี่ยนคำค้นหา หรือตัวกรองกลุ่มเรียน",-1))]))]))}});export{Ye as default};
