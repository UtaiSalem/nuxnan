import{z as M,an as U,af as F,r as i,f as D,c as r,a as e,d as w,b as d,e as k,u as l,F as A,n as $,l as B,p as K,ay as S,y as L,ak as q,Y as T,o as n,I as c,t as m}from"./DuB962GZ.js";import{S as x}from"./BQxta0Da.js";const E={class:"container mx-auto px-4 py-8 max-w-6xl"},Q={class:"flex justify-between items-center mb-6"},Y={class:"text-2xl font-bold flex items-center gap-2"},G={key:0,class:"text-center py-10"},H={key:1,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},J={key:0,class:"absolute top-0 right-0 bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},O={key:1,class:"absolute top-0 right-0 bg-green-100 text-green-800 text-xs px-2 py-1 rounded-bl-lg font-medium"},P=["src"],W={class:"flex-1 min-w-0"},X={class:"font-semibold text-gray-900 dark:text-gray-100 truncate"},Z={class:"text-sm text-gray-500 truncate"},ee={class:"flex items-center gap-2 mt-2"},te=["onClick"],se={key:0,class:"col-span-full text-center py-10 text-gray-500"},oe={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4"},le={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-lg overflow-hidden flex flex-col max-h-[90vh]"},re={class:"p-4 border-b dark:border-gray-700 flex justify-between items-center"},ne={class:"p-4 space-y-4"},ae={class:"flex gap-2"},ie={class:"flex-1 overflow-y-auto min-h-[200px] border rounded-lg p-2 bg-gray-50 dark:bg-gray-900/50"},de={key:0,class:"text-center py-4"},ce={key:1,class:"space-y-2"},ue={class:"flex items-center gap-3"},ge=["src"],me={class:"font-medium text-sm"},xe={class:"text-xs text-gray-500"},pe=["onClick"],fe={key:2,class:"text-center py-4 text-gray-500"},he=M({__name:"admin",setup(ve){const j=U(),p=F(),f=j.params.id;T("isCourseAdmin");const b=i([]),u=i(!0),g=i(!1),a=i(""),v=i([]),h=i(!1),y=i(3),_=async()=>{u.value=!0;try{const o=await p.get(`/api/courses/${f}/admins`);o.success&&(b.value=o.admins)}catch(o){console.error("Failed to fetch admins",o)}finally{u.value=!1}};D(()=>{_()});const C=async()=>{if(!(a.value.length<2)){h.value=!0;try{const o=await p.post(`/api/courses/${f}/admins/search`,{query:a.value});o.success&&(v.value=o.users)}catch(o){console.error("Search failed",o)}finally{h.value=!1}}},V=async o=>{try{u.value=!0,(await p.post(`/api/courses/${f}/admins/invite`,{user_id:o.id,role:y.value})).success&&(x.fire("สำเร็จ","ส่งคำเชิญเรียบร้อยแล้ว","success"),g.value=!1,a.value="",v.value=[],_())}catch(t){x.fire("ข้อผิดพลาด",t.response?.data?.message||"ไม่สามารถเชิญได้","error")}finally{u.value=!1}},N=async o=>{if((await x.fire({title:"ยืนยันการลบ?",text:`คุณต้องการลบ "${o.user?.name}" ออกจากผู้ดูแล?`,icon:"warning",showCancelButton:!0,confirmButtonText:"ลบเลย",cancelButtonText:"ยกเลิก",confirmButtonColor:"#d33"})).isConfirmed)try{await p.delete(`/api/courses/${f}/admins/${o.id}`),x.fire("ลบสำเร็จ","","success"),_()}catch{x.fire("ผิดพลาด","ไม่สามารถลบได้","error")}},R=T("course"),z=o=>R?.value?.user_id===o.user_id?"แอดมิน (Admin)":o.role===4?"ผู้ดูแล (Admin)":"ผู้ช่วยสอน (TA)";return(o,t)=>(n(),r("div",E,[e("div",Q,[e("div",null,[e("h1",Y,[d(l(c),{icon:"eos-icons:admin-outlined",class:"text-blue-600"}),t[4]||(t[4]=k(" จัดการผู้ดูแลรายวิชา ",-1))]),t[5]||(t[5]=e("p",{class:"text-gray-500 text-sm mt-1"},"เพิ่มหรือลบผู้ดูแลและผู้ช่วยสอน",-1))]),e("button",{onClick:t[0]||(t[0]=s=>g.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow transition-all"},[d(l(c),{icon:"mdi:plus"}),t[6]||(t[6]=k(" เพิ่มผู้ดูแล ",-1))])]),l(u)&&!l(g)?(n(),r("div",G,[d(l(c),{icon:"svg-spinners:ring-resize",class:"w-10 h-10 mx-auto text-blue-500"})])):(n(),r("div",H,[(n(!0),r(A,null,$(l(b),s=>(n(),r("div",{key:s.id,class:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 p-4 flex items-center gap-4 relative overflow-hidden"},[s.status===2?(n(),r("div",J," รอการตอบรับ ")):(n(),r("div",O,m(z(s)),1)),e("img",{src:s.user?.avatar||"https://via.placeholder.com/150",class:"w-16 h-16 rounded-full object-cover border-2 border-gray-200"},null,8,P),e("div",W,[e("h3",X,m(s.user?.name||"Unknown"),1),e("p",Z,m(s.user?.email),1),e("div",ee,[e("button",{onClick:I=>N(s),class:"text-red-500 hover:text-red-700 text-xs flex items-center gap-1 bg-red-50 px-2 py-1 rounded-md transition-colors"},[d(l(c),{icon:"mdi:trash-can-outline"}),t[7]||(t[7]=k(" ลบ/ยกเลิก ",-1))],8,te)])])]))),128)),l(b).length===0?(n(),r("div",se," ยังไม่มีผู้ดูแล ")):w("",!0)])),l(g)?(n(),r("div",oe,[e("div",le,[e("div",re,[t[8]||(t[8]=e("h3",{class:"font-bold text-lg"},"เชิญผู้ดูแล / TA",-1)),e("button",{onClick:t[1]||(t[1]=s=>g.value=!1),class:"text-gray-500 hover:text-gray-700"},[d(l(c),{icon:"mdi:close",class:"w-6 h-6"})])]),e("div",ne,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium mb-1"},"ตำแหน่ง",-1)),B(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>S(y)?y.value=s:null),class:"w-full border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700"},[...t[9]||(t[9]=[e("option",{value:3},"ผู้ช่วยสอน (TA) - จัดการเนื้อหา/การบ้านได้",-1),e("option",{value:4},"ผู้ดูแลระบบ (Admin) - จัดการทุกอย่างได้",-1)])],512),[[K,l(y)]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium mb-1"},"ค้นหาผู้ใช้งาน (ชื่อ, อีเมล, รหัสอ้างอิง)",-1)),e("div",ae,[B(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>S(a)?a.value=s:null),onKeyup:q(C,["enter"]),type:"text",class:"flex-1 border rounded-lg p-2 dark:bg-gray-900 dark:border-gray-700",placeholder:"พิมพ์ชื่อเพื่อค้นหา..."},null,544),[[L,l(a)]]),e("button",{onClick:C,class:"bg-blue-600 text-white px-4 rounded-lg hover:bg-blue-700"},[d(l(c),{icon:"heroicons:magnifying-glass"})])])]),e("div",ie,[l(h)?(n(),r("div",de,[d(l(c),{icon:"svg-spinners:ring-resize",class:"w-6 h-6 mx-auto text-blue-500"})])):l(v).length>0?(n(),r("div",ce,[(n(!0),r(A,null,$(l(v),s=>(n(),r("div",{key:s.id,class:"flex items-center justify-between p-2 bg-white dark:bg-gray-800 rounded shadow-sm hover:shadow-md transition-shadow"},[e("div",ue,[e("img",{src:s.avatar||"https://via.placeholder.com/40",class:"w-10 h-10 rounded-full"},null,8,ge),e("div",null,[e("p",me,m(s.name),1),e("p",xe,m(s.email),1)])]),e("button",{onClick:I=>V(s),class:"text-blue-600 hover:text-blue-800 text-sm font-medium px-3 py-1 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors"}," เชิญ ",8,pe)]))),128))])):l(a).length>1?(n(),r("div",fe," ไม่พบผู้ใช้งาน ")):w("",!0)])])])])):w("",!0)]))}});export{he as default};
