import{z as R,az as V,N as o,an as z,A as H,af as M,r as h,f as T,a4 as b,c as m,j as W,F as q,d as G,a as n,b as g,u as J,t as K,o as d,I as O,$ as Q,aC as U}from"./DuB962GZ.js";import{_ as X}from"./Oh9mCLdH.js";import{u as Y}from"./CaSR6SuD.js";import"./fgoR5NrX.js";import"./BgB4xtqt.js";import"./DG8aYUbs.js";import"./BmpSa16v.js";import"./DlRiQVPw.js";import"./C3g3vxIO.js";import"./BQxta0Da.js";const Z={key:0,class:"flex justify-center items-center min-h-[50vh]"},ee={key:1,class:"flex justify-center items-center min-h-[50vh]"},se={class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center max-w-md"},te={class:"text-red-600 dark:text-red-400 mb-4"},oe={key:2,class:"max-w-4xl mx-auto px-4"},he=R({__name:"[lessonId]",setup(ae){const f=V(),x=o(()=>f.currentCourse),w=o(()=>f.isCourseAdmin),k=z(),$=H(),r=M(),l=Y(),t=o(()=>k.params.id),p=o(()=>k.params.lessonId),C=o(()=>{const e=k.path,s=`/courses/${t.value}/lessons/${p.value}`;return e!==s&&e.startsWith(s+"/")}),c=h(null),a=h([]),y=h(!0),v=h(null),u=o(()=>!c.value||a.value.length===0?-1:a.value.findIndex(e=>e.id===c.value.id)),L=o(()=>u.value<=0?null:a.value[u.value-1]),F=o(()=>u.value<0||u.value>=a.value.length-1?null:a.value[u.value+1]),A=o(()=>a.value.length),I=async()=>{if(!x.value||x.value.id!=t.value)try{await f.fetchCourse(t.value)}catch(e){console.error("Failed to fetch course:",e)}},B=async()=>{try{const e=await r.get(`/api/courses/${t.value}/lessons`);e.lessons&&(a.value=e.lessons.sort((s,i)=>(s.order||0)-(i.order||0)))}catch(e){console.error("Failed to fetch lessons list:",e)}},_=async()=>{if(!(!t.value||!p.value)){y.value=!0,v.value=null;try{const e=await r.get(`/api/courses/${t.value}/lessons/${p.value}`);e.success!==!1?c.value=e.lesson||e.data||e:v.value="ไม่สามารถโหลดข้อมูลบทเรียนได้"}catch(e){console.error("Failed to fetch lesson:",e),v.value=e.data?.message||"เกิดข้อผิดพลาดในการโหลดบทเรียน"}finally{y.value=!1}}},S=e=>{$.push(`/courses/${t.value}/lessons/${e.id}/edit`)},D=async e=>{if(await l.confirm("คุณแน่ใจหรือไม่ที่จะลบบทเรียนนี้? การกระทำนี้ไม่สามารถย้อนกลับได้","ลบบทเรียน"))try{await r.delete(`/api/lessons/${e}`),l.success("บทเรียนถูกลบแล้ว","สำเร็จ"),$.push(`/courses/${t.value}/lessons`)}catch(i){console.error("Failed to delete lesson:",i),l.error(i.data?.message||"ไม่สามารถลบบทเรียนได้")}},N=async e=>{try{await r.post(`/api/courses/${t.value}/lessons/${e}/like`)}catch(s){console.error("Failed to like lesson:",s)}},j=async e=>{try{await r.post(`/api/courses/${t.value}/lessons/${e}/dislike`)}catch(s){console.error("Failed to dislike lesson:",s)}},E=async e=>{try{(await r.post(`/api/courses/${t.value}/lessons/${e}/bookmark`)).bookmarked?l.toast("บันทึกบทเรียนแล้ว","success"):l.toast("ยกเลิกการบันทึกแล้ว","info")}catch(s){console.error("Failed to bookmark lesson:",s)}},P=e=>{const s=`${window.location.origin}/courses/${t.value}/lessons/${e.id}`;navigator.clipboard.writeText(s),l.toast("คัดลอกลิงก์แล้ว","success")};return T(async()=>{await I(),await Promise.all([_(),B()])}),b(p,async()=>{await _()}),b(c,e=>{e?.title&&Q({title:`${e.title} - ${x.value?.name||"บทเรียน"}`})}),(e,s)=>{const i=U;return d(),m("div",null,[C.value?(d(),W(i,{key:0})):(d(),m(q,{key:1},[y.value?(d(),m("div",Z,[...s[0]||(s[0]=[n("div",{class:"text-center"},[n("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),n("p",{class:"text-gray-500 dark:text-gray-400"},"กำลังโหลดบทเรียน...")],-1)])])):v.value?(d(),m("div",ee,[n("div",se,[g(J(O),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),s[1]||(s[1]=n("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"เกิดข้อผิดพลาด",-1)),n("p",te,K(v.value),1),n("button",{onClick:_,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," ลองใหม่ ")])])):c.value?(d(),m("div",oe,[g(X,{lesson:c.value,isAdmin:w.value,"prev-lesson":L.value,"next-lesson":F.value,"current-index":u.value,"total-lessons":A.value,onEdit:S,onDelete:D,onLike:N,onDislike:j,onBookmark:E,onShare:P},null,8,["lesson","isAdmin","prev-lesson","next-lesson","current-index","total-lessons"])])):G("",!0)],64))])}}});export{he as default};
