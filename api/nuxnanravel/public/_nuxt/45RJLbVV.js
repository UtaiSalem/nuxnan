import{_ as ge,af as ve,r as n,N as W,j as K,o as a,b as d,w as ae,c as l,d as h,i as de,a as t,u as o,I as g,t as f,l as le,ak as ue,y as oe,F as z,n as G,p as Ve,q as se,a8 as ce,aa as $e,z as fe,ah as Ne,a4 as Ce,e as Z,ae as qe,f as Ke,g as Ge,aG as He,x as Qe}from"./DuB962GZ.js";import{u as pe}from"./BfQfvC4n.js";import{u as he}from"./CaSR6SuD.js";import{u as Ae}from"./BmpSa16v.js";import{_ as Je}from"./fgoR5NrX.js";import{S as We}from"./BuM89_iy.js";import{I as Xe}from"./DlRiQVPw.js";import"./BQxta0Da.js";const Ye={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},Ze={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},et={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},tt={class:"flex items-center gap-2"},st={class:"p-4 max-h-[70vh] overflow-y-auto"},at={class:"flex items-center gap-3 mb-4"},lt=["src"],rt={class:"flex-1"},it={class:"font-medium text-gray-800 dark:text-white"},ot={class:"flex items-center gap-1 text-xs text-gray-500"},nt={class:"rounded-lg mb-4 min-h-[120px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},dt=["onKeydown","disabled"],ut={key:0,class:"mb-4"},ct={class:"flex flex-wrap gap-2"},gt=["src"],vt=["onClick"],pt={class:"text-xs text-gray-500 mt-1"},kt={key:1,class:"mb-4 space-y-2"},ft={class:"flex items-center gap-3"},ht={class:"w-10 h-10 rounded-lg bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},bt={class:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate max-w-[200px]"},xt={class:"text-xs text-gray-500"},yt=["onClick"],mt={key:2,class:"mb-4 p-4 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200 dark:border-amber-700/30"},_t={class:"flex items-center justify-between mb-3"},wt={class:"flex items-center gap-2"},$t={class:"space-y-2 mb-3"},Ct={class:"text-sm text-gray-500 w-6"},At=["onUpdate:modelValue","placeholder"],It=["onClick"],Dt={class:"mt-3 pt-3 border-t border-amber-200 dark:border-amber-700/30"},Bt={class:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400"},Lt={class:"flex flex-wrap gap-2 border-t border-gray-200 dark:border-vikinger-dark-50/30 pt-4"},Mt=["disabled"],St=["disabled"],jt=["disabled"],Ft={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30"},Tt=["disabled"],Pt={__name:"CourseCreatePostModal",props:{show:{type:Boolean,default:!1},courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["close","post-created"],setup(m,{emit:H}){const i=m,V=H,{user:S}=pe(),D=ve(),p=he(),_=n(""),b=n(!1),j=n([]),B=n([]),y=n(null),I=n(null),w=n(!1),F=n(""),L=n(["",""]),T=n(24),E=n("course"),N=W(()=>typeof window>"u"?[]:j.value.map(k=>({file:k,url:URL.createObjectURL(k)}))),Q=()=>{V("close")},ee=async()=>{if(!(!_.value.trim()&&j.value.length===0&&!w.value)&&!b.value){if(w.value){if(!F.value.trim()){p.warning("กรุณาใส่คำถามสำหรับโพล");return}if(L.value.filter(u=>u.trim()).length<2){p.warning("กรุณาใส่ตัวเลือกอย่างน้อย 2 ตัวเลือก");return}}b.value=!0;try{const k=new FormData;k.append("content",_.value),k.append("privacy",E.value),i.groupId&&k.append("group_id",i.groupId),j.value.forEach((A,M)=>{k.append(`images[${M}]`,A)}),B.value.forEach((A,M)=>{k.append(`attachments[${M}]`,A)}),w.value&&F.value.trim()&&(k.append("poll_question",F.value),L.value.filter(M=>M.trim()).forEach((M,te)=>{k.append(`poll_options[${te}]`,M)}),k.append("poll_duration",T.value));const u=await D.post(`/api/courses/${i.courseId}/posts`,k,{headers:{"Content-Type":"multipart/form-data"}});if(u.success||u.data){const A=u.data||u.post;V("post-created",A),J(),p.toast("สร้างโพสต์สำเร็จ!","success")}else p.error(u.message||"ไม่สามารถสร้างโพสต์ได้")}catch(k){console.error("Error creating post:",k);let u="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";k?.data?.message&&(u=k.data.message),p.error(u)}finally{b.value=!1}}},J=()=>{_.value="",j.value=[],B.value=[],w.value=!1,F.value="",L.value=["",""],T.value=24,Q()},X=k=>{const u=Array.from(k.target.files);j.value=[...j.value,...u].slice(0,10),k.target.value=""},O=k=>{j.value.splice(k,1)},Y=()=>{y.value?.click()},re=k=>{const u=Array.from(k.target.files);B.value=[...B.value,...u].slice(0,5),k.target.value=""},C=k=>{B.value.splice(k,1)},v=()=>{I.value?.click()},$=()=>{w.value=!w.value,w.value||(F.value="",L.value=["",""])},P=()=>{L.value.length<6&&L.value.push("")},U=k=>{L.value.length>2&&L.value.splice(k,1)},R=k=>{if(k===0)return"0 Bytes";const u=1024,A=["Bytes","KB","MB","GB"],M=Math.floor(Math.log(k)/Math.log(u));return parseFloat((k/Math.pow(u,M)).toFixed(2))+" "+A[M]};return(k,u)=>(a(),K($e,{to:"body"},[d(ce,{name:"modal"},{default:ae(()=>[m.show?(a(),l("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(Q,["self"])},[t("div",Ye,[t("div",Ze,[t("div",et,[t("div",tt,[d(o(g),{icon:"fluent:book-24-regular",class:"w-5 h-5 text-blue-500"}),u[3]||(u[3]=t("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"โพสต์ในรายวิชา",-1))]),t("button",{onClick:Q,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),t("div",st,[t("input",{type:"file",ref_key:"imageInput",ref:y,class:"hidden",accept:"image/*",multiple:"",onChange:X},null,544),t("input",{type:"file",ref_key:"fileInput",ref:I,class:"hidden",multiple:"",onChange:re},null,544),t("div",at,[t("img",{src:o(S)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,lt),t("div",rt,[t("div",it,f(o(S)?.name),1),t("div",ot,[d(o(g),{icon:"fluent:people-community-24-regular",class:"w-3 h-3"}),u[4]||(u[4]=t("span",null,"โพสต์ในรายวิชา",-1))])])]),t("div",nt,[le(t("textarea",{"onUpdate:modelValue":u[0]||(u[0]=A=>_.value=A),placeholder:"แชร์ความรู้หรือถามคำถามในรายวิชานี้...",rows:"4",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(ee,["ctrl"]),["enter"]),disabled:b.value},null,40,dt),[[oe,_.value]])]),N.value.length>0?(a(),l("div",ut,[t("div",ct,[(a(!0),l(z,null,G(N.value,(A,M)=>(a(),l("div",{key:M,class:"relative group"},[t("img",{src:A.url,class:"w-24 h-24 object-cover rounded-lg border border-gray-200 dark:border-vikinger-dark-50/30"},null,8,gt),t("button",{onClick:te=>O(M),class:"absolute -top-1 -right-1 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center shadow-sm md:opacity-0 md:group-hover:opacity-100 transition-opacity"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,vt)]))),128)),N.value.length<10?(a(),l("button",{key:0,onClick:Y,class:"w-24 h-24 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg flex items-center justify-center hover:border-vikinger-purple hover:bg-vikinger-purple/5 transition-all"},[d(o(g),{icon:"fluent:add-24-regular",class:"w-8 h-8 text-gray-400"})])):h("",!0)]),t("p",pt,f(N.value.length)+"/10 รูป",1)])):h("",!0),B.value.length>0?(a(),l("div",kt,[(a(!0),l(z,null,G(B.value,(A,M)=>(a(),l("div",{key:M,class:"flex items-center justify-between p-3 bg-gray-50 dark:bg-vikinger-dark-200 rounded-lg"},[t("div",ft,[t("div",ht,[d(o(g),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"})]),t("div",null,[t("p",bt,f(A.name),1),t("p",xt,f(R(A.size)),1)])]),t("button",{onClick:te=>C(M),class:"p-1 hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 rounded-full"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4 text-gray-400 hover:text-red-500"})],8,yt)]))),128))])):h("",!0),w.value?(a(),l("div",mt,[t("div",_t,[t("div",wt,[d(o(g),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-600"}),u[5]||(u[5]=t("span",{class:"font-medium text-amber-700 dark:text-amber-300"},"สร้างโพล",-1))]),t("button",{onClick:$,class:"text-gray-400 hover:text-red-500"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-5 h-5"})])]),le(t("input",{"onUpdate:modelValue":u[1]||(u[1]=A=>F.value=A),type:"text",placeholder:"คำถามโพล...",class:"w-full px-3 py-2 mb-3 rounded-lg border border-amber-200 dark:border-amber-700/50 bg-white dark:bg-vikinger-dark-200 text-gray-800 dark:text-white"},null,512),[[oe,F.value]]),t("div",$t,[(a(!0),l(z,null,G(L.value,(A,M)=>(a(),l("div",{key:M,class:"flex items-center gap-2"},[t("span",Ct,f(M+1)+".",1),le(t("input",{"onUpdate:modelValue":te=>L.value[M]=te,type:"text",placeholder:`ตัวเลือก ${M+1}`,class:"flex-1 px-3 py-2 rounded-lg border border-gray-200 dark:border-vikinger-dark-50/30 bg-white dark:bg-vikinger-dark-100 text-gray-800 dark:text-white text-sm"},null,8,At),[[oe,L.value[M]]]),L.value.length>2?(a(),l("button",{key:0,onClick:te=>U(M),class:"p-1 text-gray-400 hover:text-red-500"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"})],8,It)):h("",!0)]))),128))]),L.value.length<6?(a(),l("button",{key:0,onClick:P,class:"flex items-center gap-1 text-sm text-amber-600 hover:text-amber-700"},[d(o(g),{icon:"fluent:add-24-regular",class:"w-4 h-4"}),u[6]||(u[6]=t("span",null,"เพิ่มตัวเลือก",-1))])):h("",!0),t("div",Dt,[t("label",Bt,[d(o(g),{icon:"fluent:clock-24-regular",class:"w-4 h-4"}),u[8]||(u[8]=t("span",null,"ระยะเวลาโพล:",-1)),le(t("select",{"onUpdate:modelValue":u[2]||(u[2]=A=>T.value=A),class:"px-2 py-1 rounded border border-gray-200 dark:border-vikinger-dark-50/30 bg-white dark:bg-vikinger-dark-100 text-sm"},[...u[7]||(u[7]=[t("option",{value:1},"1 ชั่วโมง",-1),t("option",{value:6},"6 ชั่วโมง",-1),t("option",{value:12},"12 ชั่วโมง",-1),t("option",{value:24},"1 วัน",-1),t("option",{value:72},"3 วัน",-1),t("option",{value:168},"1 สัปดาห์",-1)])],512),[[Ve,T.value]])])])])):h("",!0),t("div",Lt,[t("button",{onClick:Y,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-green-400 hover:bg-green-50 dark:hover:bg-green-900/20 transition-all",disabled:b.value},[d(o(g),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),u[9]||(u[9]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"รูปภาพ",-1))],8,Mt),t("button",{onClick:v,class:"flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-all",disabled:b.value},[d(o(g),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),u[10]||(u[10]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"ไฟล์แนบ",-1))],8,St),t("button",{onClick:$,class:se(["flex items-center gap-2 px-3 py-2 rounded-lg bg-white dark:bg-vikinger-dark-200 border border-gray-200 dark:border-vikinger-dark-50/30 hover:border-amber-400 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-all",{"border-amber-400 bg-amber-50 dark:bg-amber-900/20":w.value}]),disabled:b.value},[d(o(g),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-500"}),u[11]||(u[11]=t("span",{class:"text-sm text-gray-700 dark:text-gray-300"},"โพล",-1))],10,jt)])]),t("div",Ft,[t("button",{onClick:ee,disabled:b.value||!_.value.trim()&&N.value.length===0&&!w.value,class:"w-full py-3 px-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-blue-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[b.value?(a(),K(o(g),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):h("",!0),t("span",null,f(b.value?"กำลังโพสต์...":"โพสต์"),1)],8,Tt)])])])])):h("",!0)]),_:1})]))}},Ut=ge(Pt,[["__scopeId","data-v-afae63d0"]]),Et={class:"bg-white dark:bg-vikinger-dark-100 rounded-xl p-4 shadow-sm border border-gray-100 dark:border-vikinger-dark-50/20"},Ot={class:"flex items-center gap-3 mb-3"},Rt=["src"],zt={class:"flex items-center justify-around pt-2 border-t border-gray-100 dark:border-vikinger-dark-50/20"},Vt={__name:"CourseCreatePostBox",props:{courseId:{type:[String,Number],required:!0},groupId:{type:[String,Number],default:null}},emits:["post-created"],setup(m,{emit:H}){const i=H,{user:V}=pe(),{getAvatarUrl:S}=Ae(),D=n(!1),p=W(()=>S(V.value)),_=()=>{D.value=!0},b=()=>{D.value=!1},j=B=>{i("post-created",B),b()};return(B,y)=>(a(),l("div",Et,[t("div",Ot,[t("img",{src:p.value,alt:"Avatar",class:"w-10 h-10 rounded-full object-cover ring-2 ring-vikinger-purple/20"},null,8,Rt),t("button",{onClick:_,class:"flex-1 text-left px-4 py-2.5 bg-gray-100 dark:bg-vikinger-dark-200/50 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-vikinger-dark-200 transition-colors text-sm"}," โพสต์อะไรในรายวิชานี้... ")]),t("div",zt,[t("button",{onClick:_,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(g),{icon:"fluent:image-24-regular",class:"w-5 h-5 text-green-500"}),y[0]||(y[0]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"รูปภาพ",-1))]),t("button",{onClick:_,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(g),{icon:"fluent:attach-24-regular",class:"w-5 h-5 text-blue-500"}),y[1]||(y[1]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"ไฟล์แนบ",-1))]),t("button",{onClick:_,class:"flex items-center gap-2 px-3 py-1.5 hover:bg-gray-50 dark:hover:bg-vikinger-dark-200/50 rounded-lg transition-colors"},[d(o(g),{icon:"fluent:poll-24-regular",class:"w-5 h-5 text-amber-500"}),y[2]||(y[2]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"โพล",-1))])]),d(Ut,{show:D.value,"course-id":m.courseId,"group-id":m.groupId,onClose:b,onPostCreated:j},null,8,["show","course-id","group-id"])]))}},Nt={class:"bg-white dark:bg-vikinger-dark-200 rounded-xl shadow-sm overflow-hidden"},qt={class:"p-4 flex items-start gap-3"},Kt=["src","alt"],Gt={class:"flex-1 min-w-0"},Ht={class:"flex items-center gap-2"},Qt={key:0,class:"px-2 py-0.5 text-xs rounded-full bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},Jt={class:"text-sm text-gray-500 dark:text-gray-400"},Wt={key:0,class:"text-gray-400"},Xt={key:0,class:"relative"},Yt={key:0,class:"absolute right-0 top-full mt-1 w-36 bg-white dark:bg-vikinger-dark-300 rounded-lg shadow-lg border border-gray-200 dark:border-vikinger-dark-50/30 py-1 z-10"},Zt={class:"px-4 pb-3"},es={key:0,class:"prose dark:prose-invert prose-sm max-w-none whitespace-pre-wrap"},ts={key:0,class:"relative"},ss=["src","alt"],as=["onClick"],ls=["src","alt"],rs={key:0,class:"absolute inset-0 bg-black/50 flex items-center justify-center"},is={class:"text-2xl font-bold text-white"},os={key:1,class:"px-4 py-2"},ns={class:"space-y-2"},ds=["href"],us={class:"flex-1 text-sm text-gray-700 dark:text-gray-300 truncate"},cs={class:"text-xs text-gray-400"},gs={key:2,class:"px-4 py-3 bg-amber-50 dark:bg-amber-900/20 mx-4 mb-3 rounded-lg"},vs={class:"font-medium text-gray-900 dark:text-white mb-2"},ps={class:"space-y-2"},ks={class:"relative flex items-center justify-between"},fs={class:"text-sm text-gray-700 dark:text-gray-300"},hs={class:"text-sm font-medium text-gray-600 dark:text-gray-400"},bs={class:"text-xs text-gray-500 mt-2"},xs={class:"px-4 py-2 flex items-center justify-between text-sm text-gray-500 dark:text-gray-400"},ys={class:"flex items-center gap-3"},ms={key:0,class:"flex items-center gap-1"},_s={class:"w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center"},ws={key:1,class:"flex items-center gap-1"},$s={class:"w-5 h-5 rounded-full bg-gray-400 flex items-center justify-center"},Cs={class:"flex items-center gap-4"},As={key:1},Is={class:"px-4 py-2 border-t border-gray-100 dark:border-vikinger-dark-50/30 flex items-center"},Ds=["disabled"],Bs=["disabled"],Ls={key:0,class:"border-t border-gray-100 dark:border-vikinger-dark-50/30"},Ms={class:"p-4 flex gap-3"},Ss=["src","alt"],js={class:"flex-1 flex gap-2"},Fs=["disabled"],Ts=["disabled"],Ps={key:1},Us={key:0,class:"px-4 pb-4 space-y-4"},Es={class:"flex gap-2"},Os=["src","alt"],Rs={class:"flex-1"},zs={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},Vs={class:"flex items-center gap-2"},Ns={class:"font-medium text-sm text-gray-900 dark:text-white"},qs={key:0,class:"px-1.5 py-0.5 text-xs rounded bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},Ks={class:"text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap"},Gs={class:"flex items-center gap-4 mt-1 ml-2 text-xs text-gray-500"},Hs=["onClick"],Qs=["onClick"],Js=["onClick"],Ws=["onClick"],Xs={key:0,class:"mt-2 flex gap-2"},Ys=["src","alt"],Zs={class:"flex-1 flex gap-2"},ea=["placeholder","disabled"],ta=["disabled"],sa={key:1},aa=["onClick"],la={key:2,class:"mt-2 ml-8"},ra={key:3,class:"mt-2 ml-8 space-y-3"},ia=["src","alt"],oa={class:"flex-1"},na={class:"bg-gray-100 dark:bg-vikinger-dark-100 rounded-xl px-3 py-2"},da={class:"font-medium text-xs text-gray-900 dark:text-white"},ua={class:"text-xs text-gray-700 dark:text-gray-300"},ca={class:"flex items-center gap-3 mt-1 ml-2 text-xs text-gray-500"},ga=["onClick"],va=["onClick"],pa=["disabled"],ka={key:1,class:"px-4 pb-4 text-center text-sm text-gray-500 dark:text-gray-400"},fa=fe({__name:"CourseFeedPost",props:{post:{},courseId:{},currentUserId:{},isCourseAdmin:{type:Boolean,default:!1}},emits:["edit","delete","post-updated"],setup(m,{emit:H}){const i=m,V=H,S=Ne(),D=ve(),p=he(),{getAvatarUrl:_}=Ae(),b=W(()=>S.user),j=n(!1),B=n(!0),y=n(!1),I=n(null),w=n(i.post?.isLikedByAuth||i.post?.is_liked||!1),F=n(i.post?.isDislikedByAuth||i.post?.is_disliked||!1),L=n(i.post?.likes||i.post?.likes_count||0),T=n(i.post?.dislikes||i.post?.dislikes_count||0),E=n(i.post?.comments_count||0),N=n(i.post?.shares||i.post?.shares_count||0),Q=n(!1),ee=n(!1),J=n(!1),X=n(""),O=n(i.post?.post_comments||i.post?.comments||[]),Y=n(!1),re=n(1),C=n(!0),v=n(null),$=n(""),P=n(!1),U=n({}),R=n({}),k=n({}),u=W(()=>{const e=b.value;return i.post.user?.id===i.currentUserId||e&&i.post.user?.id===e.id}),A=W(()=>i.post.author||i.post.user||{}),M=W(()=>_(A.value)),te=W(()=>_(b.value)),q=W(()=>i.post.imagesResources?.length?i.post.imagesResources:i.post.images?.length?i.post.images:i.post.media?.length?i.post.media:[]),be=W(()=>i.post.attachments||[]),ie=W(()=>i.post.poll||null),ke=e=>{if(!e)return"";if(typeof e=="string"&&(e.includes("ที่แล้ว")||e.includes("เมื่อสักครู่")))return e;const r=new Date(e),s=new Date().getTime()-r.getTime(),c=Math.floor(s/6e4),ne=Math.floor(s/36e5),we=Math.floor(s/864e5);return c<1?"เมื่อสักครู่":c<60?`${c} นาทีที่แล้ว`:ne<24?`${ne} ชั่วโมงที่แล้ว`:we<7?`${we} วันที่แล้ว`:r.toLocaleDateString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Ie=W(()=>i.post.diff_humans_created_at||ke(i.post.created_at));Ce(()=>i.post,e=>{e&&(w.value=e.isLikedByAuth||e.is_liked||!1,F.value=e.isDislikedByAuth||e.is_disliked||!1,L.value=e.likes||e.likes_count||0,T.value=e.dislikes||e.dislikes_count||0,E.value=e.comments_count||0,N.value=e.shares||e.shares_count||0,O.value=e.post_comments||e.comments||[])},{immediate:!0});const De=async()=>{if(Q.value||!i.post?.id)return;if(u.value){p.warning("คุณไม่สามารถกดถูกใจโพสต์ของตัวเองได้");return}Q.value=!0;const e=w.value;w.value=!e,L.value+=e?-1:1,!e&&F.value&&(F.value=!1,T.value--);try{const r=await D.call(`/api/courses/${i.courseId}/posts/${i.post.id}/like`,{method:"POST"});r.success||(w.value=e,L.value+=e?1:-1,p.error(r.message||"ไม่สามารถกดถูกใจได้"))}catch(r){w.value=e,L.value+=e?1:-1,console.error("Failed to like:",r)}finally{Q.value=!1}},Be=async()=>{if(ee.value||!i.post?.id)return;if(u.value){p.warning("คุณไม่สามารถกดไม่ถูกใจโพสต์ของตัวเองได้");return}ee.value=!0;const e=F.value;F.value=!e,T.value+=e?-1:1,!e&&w.value&&(w.value=!1,L.value--);try{const r=await D.call(`/api/courses/${i.courseId}/posts/${i.post.id}/dislike`,{method:"POST"});r.success||(F.value=e,T.value+=e?1:-1,p.error(r.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(r){F.value=e,T.value+=e?1:-1,console.error("Failed to dislike:",r)}finally{ee.value=!1}},xe=async()=>{if(!(!X.value.trim()||J.value)){J.value=!0;try{const e=await D.call(`/api/courses/${i.courseId}/posts/${i.post.id}/comments`,{method:"POST",body:{content:X.value}});e.success&&e.comment?(O.value.unshift(e.comment),E.value++,X.value=""):p.error(e.message||"ไม่สามารถเพิ่มความคิดเห็นได้")}catch(e){console.error("Failed to add comment:",e),p.error("เกิดข้อผิดพลาดในการเพิ่มความคิดเห็น")}finally{J.value=!1}}},Le=async()=>{if(!(Y.value||!C.value)){Y.value=!0;try{const e=re.value+1,r=await D.get(`/api/courses/${i.courseId}/posts/${i.post.id}/comments?page=${e}`);if(r.comments?.length){const x=new Set(O.value.map(c=>c.id)),s=r.comments.filter(c=>!x.has(c.id));O.value.push(...s),re.value=e}r.pagination?C.value=r.pagination.has_more:r.comments?.length||(C.value=!1)}catch(e){console.error("Failed to load comments:",e)}finally{Y.value=!1}}},Me=async e=>{const r=e.user||e.author;if(b.value?.id===r?.id){p.warning("คุณไม่สามารถกดถูกใจคอมเมนต์ของตัวเองได้");return}if(e.isLiking)return;e.isLiking=!0;const x=e.isLikedByAuth||e.is_liked||!1;e.isLikedByAuth=!x,e.is_liked=!x,e.likes=(e.likes||0)+(x?-1:1),!x&&(e.isDislikedByAuth||e.is_disliked)&&(e.isDislikedByAuth=!1,e.is_disliked=!1,e.dislikes=(e.dislikes||0)-1);try{const s=await D.call(`/api/courses/posts/comments/${e.id}/like`,{method:"POST"});s.success||(e.isLikedByAuth=x,e.is_liked=x,e.likes=(e.likes||0)+(x?1:-1),p.error(s.message||"ไม่สามารถกดถูกใจได้"))}catch(s){e.isLikedByAuth=x,e.is_liked=x,e.likes=(e.likes||0)+(x?1:-1),console.error("Failed to like comment:",s)}finally{e.isLiking=!1}},Se=async e=>{const r=e.user||e.author;if(b.value?.id===r?.id){p.warning("คุณไม่สามารถกดไม่ถูกใจคอมเมนต์ของตัวเองได้");return}if(e.isDisliking)return;e.isDisliking=!0;const x=e.isDislikedByAuth||e.is_disliked||!1;e.isDislikedByAuth=!x,e.is_disliked=!x,e.dislikes=(e.dislikes||0)+(x?-1:1),!x&&(e.isLikedByAuth||e.is_liked)&&(e.isLikedByAuth=!1,e.is_liked=!1,e.likes=(e.likes||0)-1);try{const s=await D.call(`/api/courses/posts/comments/${e.id}/dislike`,{method:"POST"});s.success||(e.isDislikedByAuth=x,e.is_disliked=x,e.dislikes=(e.dislikes||0)+(x?1:-1),p.error(s.message||"ไม่สามารถกดไม่ถูกใจได้"))}catch(s){e.isDislikedByAuth=x,e.is_disliked=x,e.dislikes=(e.dislikes||0)+(x?1:-1),console.error("Failed to dislike comment:",s)}finally{e.isDisliking=!1}},je=e=>{v.value=e,$.value=""},ye=()=>{v.value=null,$.value=""},me=async()=>{if(!(!$.value.trim()||!v.value||P.value)){P.value=!0;try{const e=await D.call(`/api/courses/posts/comments/${v.value.id}/replies`,{method:"POST",body:{content:$.value}});e.success&&e.reply?(R.value[v.value.id]||(R.value[v.value.id]=[]),R.value[v.value.id].unshift(e.reply),v.value.replies_count!==void 0&&v.value.replies_count++,U.value[v.value.id]=!0,ye()):p.error(e.message||"ไม่สามารถตอบกลับได้")}catch(e){console.error("Failed to submit reply:",e),p.error("เกิดข้อผิดพลาดในการตอบกลับ")}finally{P.value=!1}}},Fe=async e=>{if(!k.value[e]){k.value[e]=!0;try{const r=await D.get(`/api/courses/posts/comments/${e}/replies`);r.replies&&(R.value[e]=r.replies,U.value[e]=!0)}catch(r){console.error("Failed to load replies:",r)}finally{k.value[e]=!1}}},Te=e=>{U.value[e]?U.value[e]=!1:R.value[e]?U.value[e]=!0:Fe(e)},Pe=async(e,r)=>{const x=e.user||e.author;if(b.value?.id===x?.id){p.warning("คุณไม่สามารถกดถูกใจการตอบกลับของตัวเองได้");return}if(e.isLiking)return;e.isLiking=!0;const s=e.isLikedByAuth||e.is_liked||!1;e.isLikedByAuth=!s,e.is_liked=!s,e.likes=(e.likes||0)+(s?-1:1);try{(await D.call(`/api/courses/posts/comments/replies/${e.id}/like`,{method:"POST"})).success||(e.isLikedByAuth=s,e.is_liked=s,e.likes=(e.likes||0)+(s?1:-1))}catch(c){e.isLikedByAuth=s,e.is_liked=s,e.likes=(e.likes||0)+(s?1:-1),console.error("Failed to like reply:",c)}finally{e.isLiking=!1}},Ue=async(e,r)=>{const x=e.user||e.author;if(b.value?.id===x?.id){p.warning("คุณไม่สามารถกดไม่ถูกใจการตอบกลับของตัวเองได้");return}if(e.isDisliking)return;e.isDisliking=!0;const s=e.isDislikedByAuth||e.is_disliked||!1;e.isDislikedByAuth=!s,e.is_disliked=!s,e.dislikes=(e.dislikes||0)+(s?-1:1);try{(await D.call(`/api/courses/posts/comments/replies/${e.id}/dislike`,{method:"POST"})).success||(e.isDislikedByAuth=s,e.is_disliked=s,e.dislikes=(e.dislikes||0)+(s?1:-1))}catch(c){e.isDislikedByAuth=s,e.is_disliked=s,e.dislikes=(e.dislikes||0)+(s?1:-1),console.error("Failed to dislike reply:",c)}finally{e.isDisliking=!1}},Ee=async()=>{if(await p.confirm("คุณต้องการลบโพสต์นี้หรือไม่?","ลบโพสต์"))try{const r=await D.call(`/api/courses/${i.courseId}/posts/${i.post.id}`,{method:"DELETE"});r.success?(V("delete",i.post.id),p.toast("ลบโพสต์สำเร็จ","success")):p.error(r.message||"ไม่สามารถลบโพสต์ได้")}catch(r){console.error("Failed to delete post:",r),p.error("เกิดข้อผิดพลาดในการลบโพสต์")}},Oe=async e=>{if(await p.confirm("คุณต้องการลบความคิดเห็นนี้หรือไม่?","ลบความคิดเห็น"))try{const x=await D.call(`/api/courses/posts/comments/${e.id}`,{method:"DELETE"});x.success?(O.value=O.value.filter(s=>s.id!==e.id),E.value--,p.toast("ลบความคิดเห็นสำเร็จ","success")):p.error(x.message||"ไม่สามารถลบความคิดเห็นได้")}catch(x){console.error("Failed to delete comment:",x),p.error("เกิดข้อผิดพลาดในการลบความคิดเห็น")}},Re=()=>{y.value=!0},ze=()=>{N.value++,y.value=!1},_e=e=>{I.value=e};return(e,r)=>{const x=Je;return a(),l("div",Nt,[t("div",qt,[d(x,{to:`/profile/${A.value.username}`},{default:ae(()=>[t("img",{src:M.value,alt:A.value.name,class:"w-10 h-10 rounded-full object-cover"},null,8,Kt)]),_:1},8,["to"]),t("div",Gt,[t("div",Ht,[d(x,{to:`/profile/${A.value.username}`,class:"font-medium text-gray-900 dark:text-white hover:underline"},{default:ae(()=>[Z(f(A.value.name),1)]),_:1},8,["to"]),A.value.role==="teacher"||A.value.role==="admin"?(a(),l("span",Qt," ผู้สอน ")):h("",!0)]),t("p",Jt,[Z(f(Ie.value)+" ",1),m.post.is_edited?(a(),l("span",Wt," · แก้ไขแล้ว")):h("",!0)])]),u.value||m.isCourseAdmin?(a(),l("div",Xt,[t("button",{onClick:r[0]||(r[0]=s=>j.value=!j.value),class:"p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 text-gray-400"},[d(o(g),{icon:"fluent:more-horizontal-24-regular",class:"w-5 h-5"})]),d(ce,{name:"fade"},{default:ae(()=>[j.value?(a(),l("div",Yt,[u.value?(a(),l("button",{key:0,onClick:r[1]||(r[1]=s=>{V("edit",m.post),j.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 flex items-center gap-2"},[d(o(g),{icon:"fluent:edit-24-regular",class:"w-4 h-4"}),r[10]||(r[10]=Z(" แก้ไข ",-1))])):h("",!0),t("button",{onClick:r[2]||(r[2]=s=>{Ee(),j.value=!1}),class:"w-full px-4 py-2 text-left text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2"},[d(o(g),{icon:"fluent:delete-24-regular",class:"w-4 h-4"}),r[11]||(r[11]=Z(" ลบ ",-1))])])):h("",!0)]),_:1})])):h("",!0)]),t("div",Zt,[m.post.content?(a(),l("div",es,f(m.post.content),1)):h("",!0)]),q.value.length>0?(a(),l("div",ts,[q.value.length===1?(a(),l("img",{key:0,src:q.value[0].url||q.value[0],alt:q.value[0].alt||"Post image",class:"w-full max-h-96 object-cover cursor-pointer",onClick:r[3]||(r[3]=s=>_e(0))},null,8,ss)):(a(),l("div",{key:1,class:se(["grid gap-1",[q.value.length===2?"grid-cols-2":"",q.value.length===3?"grid-cols-3":"",q.value.length>=4?"grid-cols-2":""]])},[(a(!0),l(z,null,G(q.value.slice(0,4),(s,c)=>(a(),l("div",{key:c,class:"relative aspect-square cursor-pointer",onClick:ne=>_e(c)},[t("img",{src:s.url||s,alt:s.alt||`Image ${c+1}`,class:"w-full h-full object-cover"},null,8,ls),c===3&&q.value.length>4?(a(),l("div",rs,[t("span",is,"+"+f(q.value.length-4),1)])):h("",!0)],8,as))),128))],2))])):h("",!0),be.value.length>0?(a(),l("div",os,[t("div",ns,[(a(!0),l(z,null,G(be.value,s=>(a(),l("a",{key:s.id,href:s.url,target:"_blank",class:"flex items-center gap-2 p-2 bg-gray-50 dark:bg-vikinger-dark-100 rounded-lg hover:bg-gray-100 dark:hover:bg-vikinger-dark-50 transition-colors"},[d(o(g),{icon:"fluent:document-24-regular",class:"w-5 h-5 text-blue-500"}),t("span",us,f(s.name||s.filename),1),t("span",cs,f(s.size),1)],8,ds))),128))])])):h("",!0),ie.value?(a(),l("div",gs,[t("h4",vs,f(ie.value.question),1),t("div",ps,[(a(!0),l(z,null,G(ie.value.options,s=>(a(),l("div",{key:s.id,class:"relative bg-white dark:bg-vikinger-dark-200 rounded-lg p-2"},[t("div",{class:"absolute left-0 top-0 h-full bg-amber-200 dark:bg-amber-700/30 rounded-lg transition-all",style:qe({width:`${s.percentage||0}%`})},null,4),t("div",ks,[t("span",fs,f(s.text),1),t("span",hs,f(s.votes_count||0)+" ("+f(s.percentage||0)+"%) ",1)])]))),128))]),t("p",bs,f(ie.value.total_votes||0)+" คนโหวต · "+f(ie.value.is_ended?"สิ้นสุดแล้ว":`เหลือ ${ie.value.time_remaining||""}`),1)])):h("",!0),t("div",xs,[t("div",ys,[L.value>0?(a(),l("div",ms,[t("div",_s,[d(o(g),{icon:"fluent:thumb-like-24-filled",class:"w-3 h-3 text-white"})]),t("span",null,f(L.value),1)])):h("",!0),T.value>0?(a(),l("div",ws,[t("div",$s,[d(o(g),{icon:"fluent:thumb-dislike-24-filled",class:"w-3 h-3 text-white"})]),t("span",null,f(T.value),1)])):h("",!0)]),t("div",Cs,[E.value>0?(a(),l("button",{key:0,onClick:r[4]||(r[4]=s=>B.value=!B.value),class:"hover:underline"},f(E.value)+" ความคิดเห็น ",1)):h("",!0),N.value>0?(a(),l("span",As,f(N.value)+" แชร์",1)):h("",!0)])]),t("div",Is,[t("button",{onClick:De,disabled:Q.value,class:se(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",w.value?"text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(g),{icon:w.value?"fluent:thumb-like-24-filled":"fluent:thumb-like-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[12]||(r[12]=t("span",null,"ถูกใจ",-1))],10,Ds),t("button",{onClick:Be,disabled:ee.value,class:se(["flex-1 flex items-center justify-center gap-2 py-2 rounded-lg transition-colors",F.value?"text-gray-700 dark:text-gray-200":"text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(g),{icon:F.value?"fluent:thumb-dislike-24-filled":"fluent:thumb-dislike-24-regular",class:"w-5 h-5"},null,8,["icon"]),r[13]||(r[13]=t("span",null,"ไม่ถูกใจ",-1))],10,Bs),t("button",{onClick:r[5]||(r[5]=s=>B.value=!B.value),class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(o(g),{icon:"fluent:chat-24-regular",class:"w-5 h-5"}),r[14]||(r[14]=t("span",null,"ความคิดเห็น",-1))]),t("button",{onClick:Re,class:"flex-1 flex items-center justify-center gap-2 py-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100 rounded-lg transition-colors"},[d(o(g),{icon:"fluent:share-24-regular",class:"w-5 h-5"}),r[15]||(r[15]=t("span",null,"แชร์",-1))])]),d(ce,{name:"slide"},{default:ae(()=>[B.value?(a(),l("div",Ls,[t("div",Ms,[t("img",{src:te.value,alt:b.value?.name,class:"w-8 h-8 rounded-full"},null,8,Ss),t("div",js,[le(t("input",{"onUpdate:modelValue":r[6]||(r[6]=s=>X.value=s),type:"text",placeholder:"เขียนความคิดเห็น...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(xe,["enter"]),disabled:J.value},null,40,Fs),[[oe,X.value]]),t("button",{onClick:xe,disabled:!X.value.trim()||J.value,class:"px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[J.value?(a(),K(o(g),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin"})):(a(),l("span",Ps,"ส่ง"))],8,Ts)])]),O.value.length>0?(a(),l("div",Us,[(a(!0),l(z,null,G(O.value,s=>(a(),l("div",{key:s.id,class:"space-y-2"},[t("div",Es,[t("img",{src:o(_)(s.user||s.author),alt:(s.user||s.author)?.name,class:"w-8 h-8 rounded-full"},null,8,Os),t("div",Rs,[t("div",zs,[t("div",Vs,[t("p",Ns,f((s.user||s.author)?.name),1),(s.user||s.author)?.role==="teacher"?(a(),l("span",qs," ผู้สอน ")):h("",!0)]),t("p",Ks,f(s.content),1)]),t("div",Gs,[t("button",{onClick:c=>Me(s),class:se(["hover:text-blue-600",s.isLikedByAuth||s.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+f(s.likes>0?` (${s.likes})`:""),11,Hs),t("button",{onClick:c=>Se(s),class:se(["hover:text-gray-700",s.isDislikedByAuth||s.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+f(s.dislikes>0?` (${s.dislikes})`:""),11,Qs),t("button",{onClick:c=>je(s),class:"hover:text-blue-600"}," ตอบกลับ ",8,Js),t("span",null,f(ke(s.created_at)),1),b.value?.id===(s.user||s.author)?.id||m.isCourseAdmin?(a(),l("button",{key:0,onClick:c=>Oe(s),class:"hover:text-red-600"}," ลบ ",8,Ws)):h("",!0)]),v.value?.id===s.id?(a(),l("div",Xs,[t("img",{src:te.value,alt:b.value?.name,class:"w-6 h-6 rounded-full"},null,8,Ys),t("div",Zs,[le(t("input",{"onUpdate:modelValue":r[7]||(r[7]=c=>$.value=c),type:"text",placeholder:`ตอบกลับ ${(s.user||s.author)?.name}...`,class:"flex-1 px-3 py-1.5 bg-gray-100 dark:bg-vikinger-dark-100 rounded-full text-sm text-gray-800 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:ue(me,["enter"]),disabled:P.value},null,40,ea),[[oe,$.value]]),t("button",{onClick:me,disabled:!$.value.trim()||P.value,class:"px-3 py-1.5 bg-blue-600 text-white rounded-full text-xs font-medium hover:bg-blue-700 disabled:opacity-50"},[P.value?(a(),K(o(g),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-3 h-3 animate-spin"})):(a(),l("span",sa,"ส่ง"))],8,ta),t("button",{onClick:ye,class:"px-3 py-1.5 text-gray-500 hover:text-gray-700 text-xs"}," ยกเลิก ")])])):h("",!0),s.replies_count>0||R.value[s.id]?.length>0?(a(),l("button",{key:1,onClick:c=>Te(s.id),class:"mt-2 ml-2 flex items-center gap-1 text-xs text-blue-600 hover:underline"},[d(o(g),{icon:U.value[s.id]?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-4 h-4"},null,8,["icon"]),Z(" "+f(U.value[s.id]?"ซ่อน":"ดู")+" "+f(s.replies_count||R.value[s.id]?.length||0)+" การตอบกลับ ",1)],8,aa)):h("",!0),k.value[s.id]?(a(),l("div",la,[d(o(g),{icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin text-gray-400"})])):h("",!0),U.value[s.id]&&R.value[s.id]?.length?(a(),l("div",ra,[(a(!0),l(z,null,G(R.value[s.id],c=>(a(),l("div",{key:c.id,class:"flex gap-2"},[t("img",{src:o(_)(c.user||c.author),alt:(c.user||c.author)?.name,class:"w-6 h-6 rounded-full"},null,8,ia),t("div",oa,[t("div",na,[t("p",da,f((c.user||c.author)?.name),1),t("p",ua,f(c.content),1)]),t("div",ca,[t("button",{onClick:ne=>Pe(c,s.id),class:se(["hover:text-blue-600",c.isLikedByAuth||c.is_liked?"text-blue-600 font-medium":""])}," ถูกใจ"+f(c.likes>0?` (${c.likes})`:""),11,ga),t("button",{onClick:ne=>Ue(c,s.id),class:se(["hover:text-gray-700",c.isDislikedByAuth||c.is_disliked?"text-gray-700 font-medium":""])}," ไม่ถูกใจ"+f(c.dislikes>0?` (${c.dislikes})`:""),11,va),t("span",null,f(ke(c.created_at)),1)])])]))),128))])):h("",!0)])])]))),128)),C.value&&E.value>O.value.length?(a(),l("button",{key:0,onClick:Le,disabled:Y.value,class:"w-full py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg"},[Y.value?(a(),K(o(g),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-4 h-4 animate-spin inline mr-2"})):h("",!0),Z(" ดูความคิดเห็นเพิ่มเติม ("+f(E.value-O.value.length)+") ",1)],8,pa)):h("",!0)])):(a(),l("div",ka," ยังไม่มีความคิดเห็น เป็นคนแรกที่แสดงความคิดเห็น! "))])):h("",!0)]),_:1}),y.value?(a(),K(We,{key:3,show:y.value,"shareable-type":"CoursePost","shareable-id":m.post.id,post:m.post,onClose:r[8]||(r[8]=s=>y.value=!1),onShared:ze},null,8,["show","shareable-id","post"])):h("",!0),I.value!==null?(a(),K(Xe,{key:4,images:q.value,"initial-index":I.value,onClose:r[9]||(r[9]=s=>I.value=null)},null,8,["images","initial-index"])):h("",!0)])}}}),ha=ge(fa,[["__scopeId","data-v-30f04d69"]]),ba={class:"w-full max-w-2xl mx-4 mb-10 modal-content"},xa={class:"bg-white dark:bg-vikinger-dark-300 rounded-xl shadow-2xl"},ya={class:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-vikinger-dark-50/30"},ma={class:"flex items-center gap-2"},_a={class:"p-4"},wa={class:"flex items-center gap-3 mb-4"},$a=["src"],Ca={class:"font-medium text-gray-800 dark:text-white"},Aa={class:"flex items-center gap-1 text-xs text-gray-500"},Ia={class:"rounded-lg mb-4 min-h-[150px] p-4 bg-gray-50 dark:bg-vikinger-dark-200"},Da=["onKeydown","disabled"],Ba={key:0,class:"mb-4"},La={class:"flex flex-wrap gap-2"},Ma=["src"],Sa={class:"p-4 border-t border-gray-200 dark:border-vikinger-dark-50/30 flex gap-3"},ja=["disabled"],Fa=fe({__name:"CourseEditPostModal",props:{show:{type:Boolean},post:{},courseId:{}},emits:["close","post-updated"],setup(m,{emit:H}){const i=m,V=H,{user:S}=pe(),D=ve(),p=he(),_=n(i.post?.content||""),b=n(!1);Ce(()=>i.post,y=>{y&&(_.value=y.content||"")},{immediate:!0});const j=()=>{V("close")},B=async()=>{if(!_.value.trim()){p.warning("กรุณาใส่เนื้อหาโพสต์");return}if(!b.value){b.value=!0;try{const y=await D.put(`/api/courses/${i.courseId}/posts/${i.post.id}`,{content:_.value});if(y.success||y.data){const I=y.data||y.post||{...i.post,content:_.value,is_edited:!0};V("post-updated",I),p.toast("แก้ไขโพสต์สำเร็จ!","success")}else p.error(y.message||"ไม่สามารถแก้ไขโพสต์ได้")}catch(y){console.error("Error updating post:",y);let I="เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง";y?.data?.message&&(I=y.data.message),p.error(I)}finally{b.value=!1}}};return(y,I)=>(a(),K($e,{to:"body"},[d(ce,{name:"modal"},{default:ae(()=>[m.show?(a(),l("div",{key:0,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 md:pt-16 overflow-y-auto backdrop-blur-sm",onClick:de(j,["self"])},[t("div",ba,[t("div",xa,[t("div",ya,[t("div",ma,[d(o(g),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-blue-500"}),I[1]||(I[1]=t("h2",{class:"text-xl font-bold text-gray-800 dark:text-white"},"แก้ไขโพสต์",-1))]),t("button",{onClick:j,class:"p-2 hover:bg-gray-100 dark:hover:bg-vikinger-dark-200 rounded-full"},[d(o(g),{icon:"fluent:dismiss-24-regular",class:"w-6 h-6 text-gray-500"})])]),t("div",_a,[t("div",wa,[t("img",{src:m.post.user?.avatar||m.post.author?.avatar||o(S)?.avatar||"/images/default-avatar.png",class:"w-10 h-10 rounded-full object-cover"},null,8,$a),t("div",null,[t("div",Ca,f(m.post.user?.name||m.post.author?.name||o(S)?.name),1),t("div",Aa,[d(o(g),{icon:"fluent:book-24-regular",class:"w-3 h-3"}),I[2]||(I[2]=t("span",null,"โพสต์ในรายวิชา",-1))])])]),t("div",Ia,[le(t("textarea",{"onUpdate:modelValue":I[0]||(I[0]=w=>_.value=w),placeholder:"แก้ไขเนื้อหาโพสต์...",rows:"6",class:"w-full bg-transparent border-none outline-none resize-none text-gray-800 dark:text-white placeholder-gray-400",onKeydown:ue(de(B,["ctrl"]),["enter"]),disabled:b.value},null,40,Da),[[oe,_.value]])]),m.post.images?.length||m.post.media?.length?(a(),l("div",Ba,[I[3]||(I[3]=t("p",{class:"text-sm text-gray-500 mb-2"},"รูปภาพในโพสต์ (ไม่สามารถแก้ไขได้)",-1)),t("div",La,[(a(!0),l(z,null,G(m.post.images||m.post.media||m.post.imagesResources||[],(w,F)=>(a(),l("img",{key:F,src:w.url||w,class:"w-20 h-20 object-cover rounded-lg opacity-70"},null,8,Ma))),128))])])):h("",!0)]),t("div",Sa,[t("button",{onClick:j,class:"flex-1 py-3 px-4 bg-gray-100 dark:bg-vikinger-dark-200 text-gray-700 dark:text-gray-300 font-semibold rounded-lg hover:bg-gray-200 dark:hover:bg-vikinger-dark-100 transition-all"}," ยกเลิก "),t("button",{onClick:B,disabled:b.value||!_.value.trim(),class:"flex-1 py-3 px-4 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},[b.value?(a(),K(o(g),{key:0,icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"})):h("",!0),t("span",null,f(b.value?"กำลังบันทึก...":"บันทึก"),1)],8,ja)])])])])):h("",!0)]),_:1})]))}}),Ta=ge(Fa,[["__scopeId","data-v-1bfd21ea"]]),Pa={class:"space-y-4"},Ua={class:"flex items-center gap-2 overflow-x-auto pb-2 scrollbar-hide"},Ea=["onClick"],Oa={key:0,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-6 text-center"},Ra={class:"text-red-600 dark:text-red-400 mb-4"},za={key:1,class:"space-y-4"},Va={class:"flex justify-center"},Na={key:1,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-8 text-center"},qa={key:0,class:"flex items-center gap-2 px-6 py-3 bg-white dark:bg-vikinger-dark-200 text-blue-600 rounded-full shadow-sm"},Ka={key:1,class:"h-4 w-full"},Ga={key:3,class:"text-center py-6 text-gray-500 dark:text-gray-400"},Ha=fe({__name:"CourseFeedsList",props:{courseId:{},isCourseAdmin:{type:Boolean,default:!1},groupId:{},initialTab:{default:"all"}},setup(m){const H=m,i=ve(),{user:V}=pe(),S=n([]),D=n(!0),p=n(!1),_=n(!0),b=n(1),j=n(10),B=n(null),y=n(!1),I=n(null),w=n(H.initialTab),F=[{id:"all",label:"ทั้งหมด",icon:"fluent:feed-24-regular"},{id:"discussions",label:"พูดคุย",icon:"fluent:chat-multiple-24-regular"},{id:"questions",label:"คำถาม",icon:"fluent:question-circle-24-regular"},{id:"materials",label:"เอกสาร",icon:"fluent:document-24-regular"},{id:"announcements",label:"ประกาศ",icon:"fluent:megaphone-24-regular"}],L=n(null);let T=null;const E=async(C=!1)=>{C&&(b.value=1,_.value=!0,B.value=null),D.value=C,p.value=!C;try{const v={page:b.value,per_page:j.value,group_id:H.groupId};w.value!=="all"&&(v.type=w.value);const $=await i.get(`/api/courses/${H.courseId}/posts`,{params:v}),P=$.data?.data||$.data||$.posts||[],U=$.pagination||$.meta||{};if(C)S.value=Array.isArray(P)?P:[];else{const R=Array.isArray(P)?P:[];S.value=[...S.value,...R]}U.has_more!==void 0?_.value=U.has_more:U.last_page!==void 0?_.value=b.value<U.last_page:_.value=Array.isArray(P)&&P.length===j.value}catch(v){console.error("Error fetching posts:",v),B.value="ไม่สามารถโหลดโพสต์ได้",C||(B.value=null)}finally{D.value=!1,p.value=!1}},N=async()=>{p.value||!_.value||(b.value++,await E(!1))},Q=async()=>{await E(!0)},ee=C=>{C&&S.value.unshift(C)},J=C=>{const v=S.value.findIndex($=>$.id===C.id);v!==-1&&(S.value[v]={...S.value[v],...C}),y.value=!1,I.value=null},X=C=>{S.value=S.value.filter(v=>v.id!==C)},O=C=>{I.value={...C},y.value=!0},Y=C=>{w.value!==C&&(w.value=C,E(!0))},re=()=>{T&&T.disconnect(),T=new IntersectionObserver(C=>{C[0].isIntersecting&&_.value&&!p.value&&!D.value&&N()},{root:null,rootMargin:"200px",threshold:.1}),L.value&&T.observe(L.value)};return Ke(()=>{E(!0),re()}),Ge(()=>{T&&T.disconnect()}),(C,v)=>(a(),l("div",Pa,[d(Vt,{"course-id":m.courseId,"group-id":m.groupId,onPostCreated:ee},null,8,["course-id","group-id"]),t("div",Ua,[(a(),l(z,null,G(F,$=>t("button",{key:$.id,onClick:P=>Y($.id),class:se(["flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all duration-300",w.value===$.id?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg":"bg-white dark:bg-vikinger-dark-200 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-vikinger-dark-100"])},[d(o(g),{icon:$.icon,class:"w-4 h-4"},null,8,["icon"]),Z(" "+f($.label),1)],10,Ea)),64))]),B.value&&!D.value?(a(),l("div",Oa,[d(o(g),{icon:"fluent:error-circle-24-regular",class:"w-12 h-12 mx-auto mb-3 text-red-500"}),t("p",Ra,f(B.value),1),t("button",{onClick:Q,class:"px-6 py-2 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-colors"},[d(o(g),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4 inline mr-2"}),v[1]||(v[1]=Z(" ลองใหม่อีกครั้ง ",-1))])])):D.value?(a(),l("div",za,[(a(),l(z,null,G(3,$=>t("div",{key:$,class:"bg-white dark:bg-vikinger-dark-200 rounded-xl p-6 animate-pulse"},[...v[2]||(v[2]=[Qe('<div class="flex items-center gap-4 mb-4" data-v-0f6913ec><div class="w-10 h-10 bg-gray-200 dark:bg-vikinger-dark-100 rounded-full" data-v-0f6913ec></div><div class="flex-1 space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/4" data-v-0f6913ec></div><div class="h-3 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-1/6" data-v-0f6913ec></div></div></div><div class="space-y-2" data-v-0f6913ec><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-full" data-v-0f6913ec></div><div class="h-4 bg-gray-200 dark:bg-vikinger-dark-100 rounded w-3/4" data-v-0f6913ec></div></div>',2)])])),64))])):(a(),l(z,{key:2},[t("div",Va,[t("button",{onClick:Q,class:"flex items-center gap-2 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full transition-colors"},[d(o(g),{icon:"fluent:arrow-sync-24-regular",class:"w-4 h-4"}),v[3]||(v[3]=Z(" รีเฟรชฟีด ",-1))])]),S.value.length>0?(a(),K(He,{key:0,tag:"div",name:"feed",class:"space-y-4"},{default:ae(()=>[(a(!0),l(z,null,G(S.value,$=>(a(),K(ha,{key:$.id,post:$,"course-id":m.courseId,"current-user-id":o(V)?.id,"is-course-admin":m.isCourseAdmin,onEdit:O,onDelete:X,onPostUpdated:J},null,8,["post","course-id","current-user-id","is-course-admin"]))),128))]),_:1})):(a(),l("div",Na,[d(o(g),{icon:"fluent:chat-24-regular",class:"w-16 h-16 mx-auto mb-4 text-gray-300 dark:text-gray-600"}),v[4]||(v[4]=t("h3",{class:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2"}," ยังไม่มีโพสต์ ",-1)),v[5]||(v[5]=t("p",{class:"text-gray-500 dark:text-gray-400"}," เป็นคนแรกที่โพสต์ในรายวิชานี้! ",-1))])),_.value&&S.value.length>0?(a(),l("div",{key:2,ref_key:"loadMoreTrigger",ref:L,class:"flex justify-center py-6"},[p.value?(a(),l("div",qa,[d(o(g),{icon:"fluent:spinner-ios-20-regular",class:"w-5 h-5 animate-spin"}),v[6]||(v[6]=Z(" กำลังโหลด... ",-1))])):(a(),l("div",Ka))],512)):h("",!0),!_.value&&S.value.length>0?(a(),l("div",Ga,[d(o(g),{icon:"fluent:checkmark-circle-24-regular",class:"w-8 h-8 mx-auto mb-2 text-green-500"}),v[7]||(v[7]=t("p",null,"คุณได้ดูโพสต์ทั้งหมดแล้ว!",-1))])):h("",!0)],64)),y.value&&I.value?(a(),K(Ta,{key:3,show:y.value,post:I.value,"course-id":m.courseId,onClose:v[0]||(v[0]=$=>{y.value=!1,I.value=null}),onPostUpdated:J},null,8,["show","post","course-id"])):h("",!0)]))}}),sl=ge(Ha,[["__scopeId","data-v-0f6913ec"]]);export{sl as C};
