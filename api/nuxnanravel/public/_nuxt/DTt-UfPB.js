import{r as y,f as P,c,a as t,d as p,t as f,e as b,F as D,n as H,i as R,l as $,p as U,y as O,aj as q,a5 as w,o as d,q as M}from"./DuB962GZ.js";import{a as k}from"./B9ygI19o.js";import{S as x}from"./BQxta0Da.js";const G={class:"bg-white rounded-lg sm:rounded-xl shadow-sm border border-gray-200 overflow-hidden"},J={class:"bg-gradient-to-r from-teal-500 to-cyan-600 px-4 py-3 sm:px-6 sm:py-4"},K={class:"flex items-center justify-between"},Q={class:"flex items-center"},W={class:"ml-2 sm:ml-3 min-w-0 flex-1"},Y={class:"text-base sm:text-lg font-semibold text-white truncate"},Z=["disabled"],tt={class:"bg-gradient-to-br from-teal-50 to-cyan-50"},et={class:"hidden md:block overflow-x-auto"},st={class:"w-full"},at={class:"bg-white divide-y divide-gray-200"},ot={class:"px-4 py-4 whitespace-nowrap"},nt={class:"px-4 py-4"},lt={class:"text-sm text-gray-900 font-medium"},it={class:"px-4 py-4 whitespace-nowrap"},rt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-teal-100 text-teal-800"},ct={class:"px-4 py-4 text-right text-sm font-medium"},dt={class:"flex items-center justify-end space-x-2"},ut=["onClick","disabled"],pt=["onClick","disabled"],mt=["onClick","disabled"],vt={key:0},yt={class:"md:hidden space-y-4 p-4"},ft={class:"p-4 space-y-3"},xt={class:"flex items-center justify-between"},gt={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-teal-100 text-teal-800"},ht={class:"space-y-2"},_t={key:0,class:"text-sm"},bt={class:"text-gray-500 font-medium"},wt={class:"text-gray-900"},kt={class:"flex items-center justify-end pt-2 border-t border-gray-200"},Ct={class:"flex space-x-2"},Bt=["onClick","disabled"],Mt=["onClick","disabled"],jt=["onClick","disabled"],Et={key:0,class:"text-center py-8"},$t={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},Nt={class:"mt-3"},Lt={class:"flex items-center justify-between pb-3"},Vt={class:"text-lg font-semibold text-gray-900"},Ft={class:"space-y-4"},Tt=["placeholder"],Dt={class:"flex items-center"},Ht={class:"flex items-center justify-end pt-6 space-x-2"},At=["disabled"],Pt={__name:"ContactCard",props:{student:{type:Object,required:!0},context:{type:String,default:"student"}},emits:["save"],setup(A,{emit:S}){const u=A,g=S,i=y([]),r=y(!1),N=y(null);y(null);const C=y(!1),m=y("add"),h=y(null),_=y(-1),n=y({contact_type:"phone",contact_value:"",is_primary:!1});P(async()=>{try{u.student?.id?await L():console.warn("ContactCard: No student ID provided")}catch(a){console.error("Error loading contacts:",a),a.value="ไม่สามารถโหลดข้อมูลการติดต่อได้: "+a.message}});const L=async()=>{if(!u.student?.id){console.warn("ContactCard: Cannot load contacts - no student ID");return}try{let a;try{a=route("homevisit.student.contacts.index",u.student.id)}catch{a=`/home-visit/student/${u.student.id}/contacts`}const e=(await k.get(a)).data;e.status==="success"&&e.data?e.data.length>0?i.value=e.data.map(o=>({id:o.id,contact_type:o.contact_type||"phone",contact_value:o.contact_value||"",is_primary:!!o.is_primary,isFromAPI:!0})).filter(o=>o.contact_value&&o.contact_value.trim()!==""):i.value=[]:i.value=[]}catch(a){console.error("API Error:",a),i.value=[],a.response&&a.response.status!==404&&(a.value="ไม่สามารถโหลดข้อมูลการติดต่อได้")}},V=async a=>{const s=i.value[a];if(!s)return;if(s.isNew){i.value.splice(a,1);return}if((await x.fire({title:"ยืนยันการลบ",text:"คุณต้องการลบข้อมูลการติดต่อนี้หรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#dc2626",cancelButtonColor:"#6b7280",confirmButtonText:"ลบ",cancelButtonText:"ยกเลิก"})).isConfirmed){r.value=!0,N.value=null;try{let o;try{o=route("homevisit.student.contacts.destroy",[u.student.id,s.id])}catch{o=`/home-visit/student/${u.student.id}/contacts/${s.id}`}const v=(await k.delete(o)).data;if(v.status==="success"||v.success===!0){i.value.splice(a,1),g("save",{success:!0,type:"contact_deleted",data:s}),await w(),r.value=!1,await x.fire({title:"ลบสำเร็จ!",text:"ลบข้อมูลการติดต่อเรียบร้อยแล้ว",icon:"success",timer:2e3,showConfirmButton:!1});return}else throw new Error(v.message||"เกิดข้อผิดพลาดในการลบข้อมูล")}catch(o){console.error("Delete error:",o),await x.fire({title:"เกิดข้อผิดพลาด!",text:o.message,icon:"error",confirmButtonText:"ตกลง"}),g("save",{success:!1,type:"contact_deleted",message:o.message}),r.value=!1}}},F=async(a,s)=>{if(a.id){r.value=!0,N.value=null;try{let e;try{e=route("homevisit.student.contacts.set-primary",[u.student.id,a.id])}catch{e=`/home-visit/student/${u.student.id}/contacts/${a.id}/set-primary`}const l=(await k.put(e)).data;if(l.status==="success"||l.success===!0){i.value.forEach(v=>v.is_primary=!1),a.is_primary=!0,g("save",{success:!0,type:"contact_set_primary",data:l.data}),await w(),r.value=!1,await x.fire({title:"สำเร็จ!",text:"ตั้งค่าเป็นการติดต่อหลักเรียบร้อยแล้ว",icon:"success",timer:2e3,showConfirmButton:!1});return}else throw new Error(l.message||"เกิดข้อผิดพลาดในการตั้งค่า")}catch(e){console.error("Set primary error:",e),await x.fire({title:"เกิดข้อผิดพลาด!",text:e.message,icon:"error",confirmButtonText:"ตกลง"}),g("save",{success:!1,type:"contact_set_primary",message:e.message}),r.value=!1}}},j=a=>({phone:"โทรศัพท์",email:"อีเมล",line:"Line",facebook:"Facebook"})[a]||a,X=()=>{m.value="add",h.value=null,_.value=-1,E(),C.value=!0},T=async(a,s)=>{m.value="edit",h.value=a,_.value=s,E(),await w(),I(a),C.value=!0},B=()=>{C.value=!1,E()},E=()=>{n.value={contact_type:"phone",contact_value:"",is_primary:!1}},I=a=>{Object.assign(n.value,{contact_type:a.contact_type||"phone",contact_value:a.contact_value||"",is_primary:a.is_primary||!1})},z=async()=>{if(!n.value.contact_value){await x.fire({title:"ข้อมูลไม่ครบถ้วน",text:"กรุณากรอกข้อมูลการติดต่อ",icon:"warning",confirmButtonText:"ตกลง"});return}r.value=!0;try{const a={contact_type:n.value.contact_type||"phone",contact_value:n.value.contact_value||null,is_primary:!!n.value.is_primary};let s;if(m.value==="edit"&&h.value?.id){let o;try{o=route("homevisit.student.contacts.update",[u.student.id,h.value.id])}catch{o=`/home-visit/student/${u.student.id}/contacts/${h.value.id}`}s=await k.put(o,a)}else{let o;try{o=route("homevisit.student.contacts.store",u.student.id)}catch{o=`/home-visit/student/${u.student.id}/contacts`}s=await k.post(o,a)}const e=s.data;if(e.status==="success"||e.success===!0||s.status===200){if(m.value==="add"&&e.data){(e.data.is_primary||n.value.is_primary)&&i.value.forEach(l=>l.is_primary=!1);const o={id:e.data.id,contact_type:e.data.contact_type||n.value.contact_type,contact_value:e.data.contact_value||n.value.contact_value,is_primary:!!(e.data.is_primary||n.value.is_primary),isFromAPI:!0};i.value.push(o)}else if(m.value==="edit"&&_.value>=0&&e.data){(e.data.is_primary||n.value.is_primary)&&i.value.forEach(l=>l.is_primary=!1);const o={...i.value[_.value],contact_type:e.data.contact_type||n.value.contact_type,contact_value:e.data.contact_value||n.value.contact_value,is_primary:!!(e.data.is_primary||n.value.is_primary)};i.value[_.value]=o}e.data||await L(),await w(),B(),g("save",{success:!0,type:m.value==="add"?"contact_added":"contact_updated",data:e.data}),await w(),r.value=!1,await x.fire({title:"สำเร็จ!",text:e.message||(m.value==="add"?"เพิ่มข้อมูลการติดต่อเรียบร้อยแล้ว":"แก้ไขข้อมูลการติดต่อเรียบร้อยแล้ว"),icon:"success",timer:2e3,showConfirmButton:!1});return}else throw new Error(e.message||"เกิดข้อผิดพลาดในการบันทึกข้อมูล")}catch(a){console.error("Submit error:",a);let s="เกิดข้อผิดพลาดในการบันทึกข้อมูล";if(a.response&&a.response.status===403){const e=a.response.data;s=e.message||"ไม่มีสิทธิ์ในการดำเนินการนี้",console.error("403 Forbidden:",e)}else if(a.response&&a.response.status===422){const e=a.response.data;if(e.errors){const o=[];Object.entries(e.errors).forEach(([l,v])=>{o.push(`${l}: ${Array.isArray(v)?v.join(", "):v}`)}),s=`Validation Errors:
${o.join(`
`)}`}else e.message&&(s=e.message)}else a.response&&a.response.data?s=a.response.data.message||a.response.data.error||s:a.message&&!a.message.includes("เรียบร้อยแล้ว")&&(s=a.message);await x.fire({title:"เกิดข้อผิดพลาด!",text:s,icon:"error",confirmButtonText:"ตกลง"}),g("save",{success:!1,type:m.value==="add"?"contact_added":"contact_updated",message:a.message}),r.value=!1}};return(a,s)=>(d(),c("div",G,[t("div",J,[t("div",K,[t("div",Q,[s[4]||(s[4]=t("div",{class:"w-7 h-7 sm:w-8 sm:h-8 bg-white bg-opacity-20 rounded-lg flex items-center justify-center flex-shrink-0"},[t("svg",{class:"w-4 h-4 sm:w-5 sm:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),t("div",W,[t("h3",Y," ข้อมูลติดต่อ ("+f(i.value.length)+" รายการ) ",1),s[3]||(s[3]=t("p",{class:"text-teal-100 text-xs sm:text-sm"},"ข้อมูลการติดต่อของนักเรียน",-1))])]),t("button",{onClick:X,disabled:r.value,class:"inline-flex items-center px-3 py-2 bg-white bg-opacity-20 text-white text-sm font-medium rounded-lg hover:bg-opacity-30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-teal-600 disabled:opacity-50 transition-all"},[...s[5]||(s[5]=[t("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),b(" เพิ่มข้อมูล ",-1)])],8,Z)])]),t("div",tt,[t("div",et,[t("table",st,[s[11]||(s[11]=t("thead",{class:"bg-white border-b border-gray-200"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ประเภท"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ข้อมูลติดต่อ"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"สถานะ"),t("th",{class:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"จัดการ")])],-1)),t("tbody",at,[(d(!0),c(D,null,H(i.value,(e,o)=>(d(),c("tr",{key:e.id||o,class:M(e.isNew?"bg-teal-50":"hover:bg-gray-50")},[t("td",ot,[t("span",{class:M(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",{"bg-blue-100 text-blue-800":e.contact_type==="phone","bg-green-100 text-green-800":e.contact_type==="email","bg-yellow-100 text-yellow-800":e.contact_type==="line","bg-purple-100 text-purple-800":e.contact_type==="facebook","bg-gray-100 text-gray-800":!e.contact_type}])},f(j(e.contact_type)||"-"),3)]),t("td",nt,[t("div",lt,f(e.contact_value||"-"),1)]),t("td",it,[e.is_primary?(d(),c("span",rt,[...s[6]||(s[6]=[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),b(" หลัก ",-1)])])):p("",!0)]),t("td",ct,[t("div",dt,[e.isNew?p("",!0):(d(),c("button",{key:0,onClick:l=>T(e,o),disabled:r.value,class:"text-orange-600 hover:text-orange-800 disabled:opacity-50",title:"แก้ไข"},[...s[7]||(s[7]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,ut)),!e.is_primary&&!e.isNew?(d(),c("button",{key:1,onClick:l=>F(e),disabled:r.value,class:"text-teal-600 hover:text-teal-800 disabled:opacity-50",title:"ตั้งเป็นหลัก"},[...s[8]||(s[8]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1)])],8,pt)):p("",!0),e.isNew?p("",!0):(d(),c("button",{key:2,onClick:l=>V(o),disabled:r.value,class:"text-red-600 hover:text-red-800 disabled:opacity-50",title:"ลบ"},[...s[9]||(s[9]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,mt))])])],2))),128)),i.value.length===0?(d(),c("tr",vt,[...s[10]||(s[10]=[t("td",{colspan:"4",class:"px-4 py-12 text-center"},[t("svg",{class:"w-12 h-12 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})]),t("p",{class:"text-sm text-gray-500"},"ยังไม่มีข้อมูลการติดต่อ"),t("p",{class:"text-xs text-gray-400 mt-1"},'คลิกปุ่ม "เพิ่มข้อมูล" เพื่อเริ่มต้น')],-1)])])):p("",!0)])])]),t("div",yt,[(d(!0),c(D,null,H(i.value,(e,o)=>(d(),c("div",{key:e.id||o,class:M(["bg-white rounded-lg border",e.isNew?"border-teal-300 bg-teal-50":"border-gray-200"])},[t("div",ft,[t("div",xt,[t("span",{class:M(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",{"bg-blue-100 text-blue-800":e.contact_type==="phone","bg-green-100 text-green-800":e.contact_type==="email","bg-yellow-100 text-yellow-800":e.contact_type==="line","bg-purple-100 text-purple-800":e.contact_type==="facebook","bg-gray-100 text-gray-800":!e.contact_type}])},f(j(e.contact_type)||"-"),3),e.is_primary?(d(),c("span",gt," หลัก ")):p("",!0)]),t("div",ht,[e.contact_value?(d(),c("div",_t,[t("span",bt,f(j(e.contact_type))+": ",1),t("span",wt,f(e.contact_value),1)])):p("",!0)]),t("div",kt,[t("div",Ct,[e.isNew?p("",!0):(d(),c("button",{key:0,onClick:l=>T(e,o),disabled:r.value,class:"inline-flex items-center px-3 py-1.5 bg-orange-600 text-white text-xs font-medium rounded-md hover:bg-orange-700 disabled:opacity-50"},[...s[12]||(s[12]=[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),b(" แก้ไข ",-1)])],8,Bt)),!e.is_primary&&!e.isNew?(d(),c("button",{key:1,onClick:l=>F(e),disabled:r.value,class:"inline-flex items-center px-3 py-1.5 bg-teal-600 text-white text-xs font-medium rounded-md hover:bg-teal-700 disabled:opacity-50"},[...s[13]||(s[13]=[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),b(" ตั้งหลัก ",-1)])],8,Mt)):p("",!0),e.isNew?p("",!0):(d(),c("button",{key:2,onClick:l=>V(o),disabled:r.value,class:"inline-flex items-center px-3 py-1.5 bg-red-600 text-white text-xs font-medium rounded-md hover:bg-red-700 disabled:opacity-50"},[...s[14]||(s[14]=[t("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),b(" ลบ ",-1)])],8,jt))])])])],2))),128)),i.value.length===0?(d(),c("div",Et,[...s[15]||(s[15]=[t("svg",{class:"w-12 h-12 text-gray-300 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),t("p",{class:"text-sm text-gray-500"},"ยังไม่มีข้อมูลการติดต่อ",-1),t("p",{class:"text-xs text-gray-400 mt-1"},'คลิกปุ่ม "เพิ่มข้อมูล" เพื่อเริ่มต้น',-1)])])):p("",!0)])]),C.value?(d(),c("div",{key:0,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:R(B,["self"])},[t("div",$t,[t("div",Nt,[t("div",Lt,[t("h3",Vt,f(m.value==="add"?"เพิ่มข้อมูลการติดต่อ":"แก้ไขข้อมูลการติดต่อ"),1),t("button",{onClick:B,class:"text-gray-400 hover:text-gray-600"},[...s[16]||(s[16]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ft,[t("div",null,[s[18]||(s[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ประเภทการติดต่อ",-1)),$(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.value.contact_type=e),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500"},[...s[17]||(s[17]=[t("option",{value:"phone"},"โทรศัพท์",-1),t("option",{value:"email"},"อีเมล",-1),t("option",{value:"line"},"Line",-1),t("option",{value:"facebook"},"Facebook",-1)])],512),[[U,n.value.contact_type]])]),t("div",null,[s[19]||(s[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"ข้อมูลการติดต่อ",-1)),$(t("input",{type:"text","onUpdate:modelValue":s[1]||(s[1]=e=>n.value.contact_value=e),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500",placeholder:n.value.contact_type==="phone"?"0XX-XXX-XXXX":n.value.contact_type==="email"?"email@example.com":n.value.contact_type==="line"?"Line ID":"ข้อมูลการติดต่อ"},null,8,Tt),[[O,n.value.contact_value]])]),t("div",Dt,[$(t("input",{type:"checkbox",id:"is_primary","onUpdate:modelValue":s[2]||(s[2]=e=>n.value.is_primary=e),class:"rounded border-gray-300 text-teal-600 shadow-sm focus:border-teal-300 focus:ring focus:ring-teal-200 focus:ring-opacity-50"},null,512),[[q,n.value.is_primary]]),s[20]||(s[20]=t("label",{for:"is_primary",class:"ml-2 text-sm text-gray-700"},"ช่องทางการติดต่อหลัก",-1))])]),t("div",Ht,[t("button",{onClick:B,type:"button",class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-300"}," ยกเลิก "),t("button",{onClick:z,type:"button",disabled:r.value,class:"px-4 py-2 bg-teal-600 text-white rounded-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-teal-500 disabled:opacity-50"},f(r.value?"กำลังบันทึก...":m.value==="add"?"เพิ่มข้อมูล":"บันทึกการแก้ไข"),9,At)])])])])):p("",!0)]))}};export{Pt as default};
