import{c as m,o as u,F as N,n as A,a,t as y,z as F,an as O,af as Q,A as M,r as l,N as U,f as H,ab as B,g as Y,aF as G,j as J,d as K,b as f,u as t,e as C,ay as P,w as W,a8 as X,I as w,l as Z,v as ee}from"./DuB962GZ.js";import{S as b}from"./BQxta0Da.js";import{C as te}from"./DvOU9n0k.js";const se={class:"space-y-4"},oe={class:"font-bold"},ae={__name:"QuestionsListViewer",props:{questions:Array,quizId:Number,quiz:Object,quizResult:Object},setup(q){return(x,i)=>(u(),m("div",se,[(u(!0),m(N,null,A(q.questions,r=>(u(),m("div",{key:r.id,class:"p-4 bg-white shadow rounded"},[a("p",oe,y(r.question_text),1),i[0]||(i[0]=a("div",{class:"mt-2 text-gray-500"},"Options go here...",-1))]))),128))]))}},re={class:"container mx-auto px-4 py-6 max-w-4xl"},ne={key:1,class:"relative"},le={class:"sticky top-4 z-20 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-blue-100 dark:border-gray-700 p-4 mb-6 flex items-center justify-between transition-all duration-300"},ie={class:"flex items-center gap-4"},ue={class:"text-lg font-bold text-gray-800 dark:text-white truncate max-w-[200px] sm:max-w-md hidden sm:block"},ce={class:"flex items-center gap-4"},de={class:"flex items-center gap-2 px-4 py-2 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 rounded-lg font-mono font-bold text-lg"},fe=["disabled"],me={key:0},ve={class:"mt-8 flex justify-center pb-10"},pe={key:1,class:"flex flex-col items-center justify-center p-20 bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700"},xe=F({__name:"attempt",setup(q){const x=O(),i=x.params.id,r=x.params.quizId,g=Q(),T=M(),n=l(null),o=l(null),z=l(!0),v=l(!1),R=l([]),c=l(0),p=l(null),h=l(null),S=U(()=>{const s=Math.floor(c.value/60),e=c.value%60;return`${s.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}),L=async()=>{try{const s=await g.get(`/api/courses/${i}/quizzes/${r}`);if(n.value=s.quiz,R.value=n.value.questions||[],n.value.current_result)o.value=n.value.current_result;else{const e=await g.post(`/api/courses/${i}/quizzes/${r}/results`,{});o.value=e.quizResult}o.value&&o.value.duration?c.value=parseInt(o.value.duration):c.value=0,E()}catch(s){console.error(s),b.fire("Error","Failed to load quiz: "+(s.message||s),"error")}finally{z.value=!1}},E=()=>{p.value&&clearInterval(p.value),p.value=B(()=>{c.value++},1e3)},k=l(!1),_=()=>{k.value=window.scrollY>300},V=()=>{window.scrollTo({top:0,behavior:"smooth"})},j=async()=>{if(!(!o.value||!o.value.id||v.value))try{await g.put(`/api/courses/${i}/quizzes/${r}/results/${o.value.id}`,{duration:c.value})}catch(s){console.error("Heartbeat failed",s)}},$=s=>{v.value||(s.preventDefault(),s.returnValue="")};H(()=>{L(),window.addEventListener("scroll",_),window.addEventListener("beforeunload",$),h.value=B(j,1e4)}),Y(()=>{p.value&&clearInterval(p.value),h.value&&clearInterval(h.value),window.removeEventListener("scroll",_),window.removeEventListener("beforeunload",$)}),G((s,e,d)=>{if(v.value){d();return}b.fire({title:"ออกจากหน้าสอบ?",text:"การทำข้อสอบจะยังไม่ถูกส่ง คุณต้องการออกจริงหรือไม่?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ออกเลย",cancelButtonText:"ทำต่อ"}).then(D=>{D.isConfirmed?d():d(!1)})});const I=async(s=!1)=>{if(!(!s&&!(await b.fire({title:"ส่งคำตอบ?",text:"คุณต้องการส่งคำตอบและสิ้นสุดการทำแบบทดสอบใช่หรือไม่?",icon:"question",showCancelButton:!0,confirmButtonText:"ส่งคำตอบ",cancelButtonText:"ยกเลิก"})).isConfirmed)){v.value=!0;try{if(!o.value||!o.value.id)throw new Error("Result ID not found");await g.put(`/api/courses/${i}/quizzes/${r}/results/${o.value.id}`,{completed_at:new Date().toISOString(),duration:c.value}),await b.fire({icon:"success",title:"ส่งคำตอบเรียบร้อย",timer:1500,showConfirmButton:!1}),T.replace(`/courses/${i}/quizzes/${r}`)}catch(e){console.error(e),b.fire("Error","เกิดข้อผิดพลาดในการส่งคำตอบ","error")}finally{v.value=!1}}};return(s,e)=>(u(),m("div",re,[t(z)?(u(),J(te,{key:0})):t(n)?(u(),m("div",ne,[a("div",le,[a("div",ie,[a("h1",ue,y(t(n).title),1),e[3]||(e[3]=a("span",{class:"sm:hidden font-bold text-gray-800 dark:text-white"},"เวลาที่ใช้",-1))]),a("div",ce,[a("div",de,[f(t(w),{icon:"fluent:timer-24-filled",class:"w-6 h-6"}),C(" "+y(t(S)),1)]),a("button",{onClick:e[0]||(e[0]=d=>I(!1)),disabled:t(v),class:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-medium shadow-md transition-colors flex items-center gap-2"},[e[4]||(e[4]=a("span",{class:"hidden sm:inline"},"ยืนยันการทำแบบทดสอบเสร็จสิ้น",-1)),f(t(w),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5 sm:hidden"})],8,fe)])]),t(n).questions&&t(n).questions.length>0?(u(),m("div",me,[f(ae,{modelValue:t(o),"onUpdate:modelValue":e[1]||(e[1]=d=>P(o)?o.value=d:null),questions:t(n).questions,quizId:parseInt(t(r)),quiz:t(n),quizResult:t(o),questionApiRoute:`/api/quizs/${t(r)}`},null,8,["modelValue","questions","quizId","quiz","quizResult","questionApiRoute"]),a("div",ve,[a("button",{onClick:e[2]||(e[2]=d=>I(!1)),class:"px-8 py-3 bg-blue-600 text-white rounded-full font-bold shadow-lg hover:bg-blue-700 transition flex items-center gap-2"},[f(t(w),{icon:"fluent:checkmark-circle-24-filled",class:"w-5 h-5"}),e[5]||(e[5]=C(" ยืนยันการทำแบบทดสอบเสร็จสิ้น ",-1))])])])):(u(),m("div",pe,[f(t(w),{icon:"fluent:document-error-24-regular",class:"w-16 h-16 text-gray-300 mb-4"}),e[6]||(e[6]=a("h3",{class:"text-xl font-medium text-gray-600 dark:text-gray-400"},"ยังไม่มีคำถามในแบบทดสอบนี้",-1)),e[7]||(e[7]=a("p",{class:"text-gray-400 mt-2"},"โปรดติดต่อผู้สอน",-1))]))])):K("",!0),f(X,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 translate-y-10","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-300","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-10"},{default:W(()=>[Z(a("button",{onClick:V,class:"fixed bottom-6 right-6 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all z-50",title:"Back to Top"},[f(t(w),{icon:"fluent:arrow-up-24-filled",class:"w-6 h-6"})],512),[[ee,t(k)]])]),_:1})]))}});export{xe as default};
