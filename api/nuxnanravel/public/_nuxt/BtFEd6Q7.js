import{z as q,af as H,r as i,a4 as Y,f as O,g as Q,c as r,a as t,d as f,b as h,l as A,e as C,u as x,t as u,p as R,F as I,n as T,w as W,a8 as X,o as a,I as _,q as L,v as M,y as G,j as Z}from"./DuB962GZ.js";import{u as J}from"./CaSR6SuD.js";import{u as ee}from"./BmpSa16v.js";const te={class:"space-y-4"},se={class:"flex items-center justify-between"},ae={class:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2"},re=["value"],oe={key:0,class:"bg-gray-50 dark:bg-gray-800 rounded-xl p-6 text-center text-gray-500 border border-dashed border-gray-300 dark:border-gray-700 text-sm"},ne={key:1,class:"flex justify-center py-8"},le={key:2,class:"grid gap-3"},ie={class:"flex items-start gap-3"},de=["src"],ce={class:"flex-1 min-w-0"},ue={class:"flex justify-between"},ge={class:"font-bold text-gray-900 dark:text-white text-sm"},pe={key:0},me={class:"text-right flex items-center gap-2"},ve=["onClick"],be={class:"text-xs font-normal text-gray-400"},ye={class:"mt-3 p-3 bg-gray-50 dark:bg-gray-900/50 rounded-lg text-gray-700 dark:text-gray-300 text-sm whitespace-pre-wrap border border-gray-100 dark:border-gray-800"},fe={key:0,class:"mt-3 flex flex-wrap gap-2"},he=["src"],xe={class:"mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 flex items-center gap-3"},_e=["onUpdate:modelValue","max"],ke=["onUpdate:modelValue","max"],we=["onClick","disabled"],$e={key:0,class:"flex justify-center mt-4"},Ae=["disabled"],qe=q({__name:"AssignmentGradingView",props:{assignment:{},courseId:{}},setup(b){const v=b,$=H(),E=J(),{getAvatarUrl:D}=ee(),y=i([]),g=i([]),d=i(null),c=i(!1);i(!1);const k=i(1),w=i(1),U=i(!1),F=i(0),B=async()=>{try{const s=await $.get(`/api/courses/${v.courseId}/groups`);g.value=s.groups||[]}catch(s){console.error(s),g.value=[]}},S=async(s=1,p=!1)=>{c.value=!0;try{const e=await $.get(`/api/assignments/${v.assignment.id}/answers`,{params:{page:s,group_id:d.value||"all"}}),m=(e.data||[]).map(V=>({...V,points:V.points,originalPoints:V.points,isUpdating:!1,isExpanded:V.points===null}));p?y.value=m:y.value=[...y.value,...m],k.value=e.meta.current_page,w.value=e.meta.last_page,F.value=e.meta.total,U.value=!0}catch(e){console.error("Failed to fetch answers:",e)}finally{c.value=!1}};Y(d,()=>{U.value&&S(1,!0)});const o=async s=>{try{s.isUpdating=!0,await $.post(`/api/assignments/${v.assignment.id}/answers/${s.id}/set-points`,{points:s.points,course_id:v.courseId}),s.originalPoints=s.points,s.isUpdating=!1,s.isExpanded=!1,E.toast("บันทึกคะแนนเรียบร้อย","success")}catch(p){console.error("Grading error:",p),E.toast("บันทึกคะแนนไม่สำเร็จ","error"),s.isUpdating=!1}},n=s=>s?new Date(s).toLocaleString("th-TH",{dateStyle:"medium",timeStyle:"short"}):"-",l=s=>v.assignment.due_date?new Date(s.created_at)>new Date(v.assignment.due_date):!1,j=s=>D(s),P=s=>{if(s.points===null)return"bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700";const p=v.assignment.passing_score??0;return s.points>=p?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"};O(()=>{B(),S(1,!0),window.addEventListener("scroll",z)}),Q(()=>{window.removeEventListener("scroll",z)});const N=i(!1),z=()=>{N.value=window.scrollY>300},K=()=>{window.scrollTo({top:0,behavior:"smooth"})};return(s,p)=>(a(),r("div",te,[t("div",se,[t("h2",ae,[h(x(_),{icon:"fluent:people-community-24-regular",class:"w-5 h-5"}),C(" การส่งงาน ("+u(U.value?F.value:v.assignment.answer_count||0)+") ",1)]),g.value&&g.value.length>0?A((a(),r("select",{key:0,"onUpdate:modelValue":p[0]||(p[0]=e=>d.value=e),class:"px-3 py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-sm focus:ring-2 focus:ring-orange-500 outline-none"},[p[2]||(p[2]=t("option",{value:null},"ทั้งหมด (All)",-1)),(a(!0),r(I,null,T(g.value,e=>(a(),r("option",{key:e.id,value:e.id},u(e.name),9,re))),128))],512)),[[R,d.value]]):f("",!0)]),y.value.length===0&&!c.value?(a(),r("div",oe,u(d.value?"ไม่มีงานที่ส่งในกลุ่มนี้":"ยังไม่มีนักเรียนส่งงาน"),1)):f("",!0),c.value&&y.value.length===0?(a(),r("div",ne,[h(x(_),{icon:"eos-icons:loading",class:"w-8 h-8 text-orange-500"})])):(a(),r("div",le,[(a(!0),r(I,null,T(y.value,e=>(a(),r("div",{key:e.id,class:L(["rounded-xl p-4 border shadow-sm transition-shadow hover:shadow-md",P(e)])},[t("div",ie,[t("img",{src:j(e.student),class:"w-10 h-10 rounded-full object-cover ring-2 ring-gray-100 dark:ring-gray-700"},null,8,de),t("div",ce,[t("div",ue,[t("div",null,[t("h3",ge,u(e.member_name||e.student?.username||"Unknown Student"),1),t("p",{class:L(["text-xs flex items-center gap-1",l(e)?"text-red-500 font-bold":"text-green-600"])},[C(u(n(e.created_at))+" ",1),l(e)?(a(),r("span",pe,"(Late)")):f("",!0)],2)]),t("div",me,[t("button",{onClick:m=>e.isExpanded=!e.isExpanded,class:"p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-400"},[h(x(_),{icon:e.isExpanded?"fluent:chevron-up-24-regular":"fluent:chevron-down-24-regular",class:"w-5 h-5"},null,8,["icon"])],8,ve),t("div",{class:L(["text-xl font-bold",e.points?"text-green-600":"text-gray-300"])},[C(u(e.points??"-")+" ",1),t("span",be,"/ "+u(b.assignment.points),1)],2)])]),A(t("div",null,[t("div",ye,[C(u(e.content)+" ",1),e.images?.length?(a(),r("div",fe,[(a(!0),r(I,null,T(e.images,m=>(a(),r("img",{key:m.id,src:m.full_url||m.image_url,class:"w-12 h-12 object-cover rounded-lg border border-gray-200 dark:border-gray-700 cursor-pointer"},null,8,he))),128))])):f("",!0)])],512),[[M,e.isExpanded]]),t("div",xe,[A(t("input",{type:"number","onUpdate:modelValue":m=>e.points=m,min:0,max:b.assignment.points,class:"w-16 px-2 py-1 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-center font-bold text-sm focus:ring-2 focus:ring-orange-500 outline-none"},null,8,_e),[[G,e.points,void 0,{number:!0}]]),A(t("input",{type:"range","onUpdate:modelValue":m=>e.points=m,min:0,max:b.assignment.points,class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-orange-500"},null,8,ke),[[G,e.points,void 0,{number:!0}]]),t("button",{onClick:m=>o(e),disabled:e.isUpdating||e.points===e.originalPoints,class:"px-3 py-1 text-xs font-bold text-white bg-orange-500 rounded-lg hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},u(e.isUpdating?"...":"บันทึก"),9,we)])])])],2))),128)),k.value<w.value?(a(),r("div",$e,[t("button",{onClick:p[1]||(p[1]=e=>S(k.value+1)),disabled:c.value,class:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 text-sm text-gray-700 dark:text-gray-300 font-medium disabled:opacity-50 flex items-center gap-2"},u(c.value?"กำลังโหลด...":"โหลดเพิ่ม"),9,Ae)])):f("",!0)])),h(X,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"opacity-0 translate-y-10","enter-to-class":"opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-300","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-10"},{default:W(()=>[A(t("button",{onClick:K,class:"fixed bottom-6 right-6 p-3 bg-orange-500 text-white rounded-full shadow-lg hover:bg-orange-600 transition-all z-50 animate-bounce-slow",title:"Back to Top"},[h(x(_),{icon:"fluent:arrow-up-24-filled",class:"w-6 h-6"})],512),[[M,N.value]])]),_:1})]))}}),Ce={class:"bg-white dark:bg-gray-800 rounded-2xl p-6 border border-gray-200 dark:border-gray-700 shadow-lg"},Ee={class:"text-lg font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2"},Ue={class:"space-y-4"},Se={class:"flex items-center justify-center w-full"},je={class:"flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-xl cursor-pointer bg-gray-50 dark:bg-gray-900 hover:bg-gray-100 dark:border-gray-700 dark:hover:border-gray-500 dark:hover:bg-gray-800 transition-colors"},Ie={class:"flex flex-col items-center justify-center pt-5 pb-6"},Te={key:0,class:"flex flex-wrap gap-2"},Fe={class:"truncate max-w-xs"},Ve=["onClick"],De={key:1,class:"flex flex-wrap gap-2"},Be=["src"],Le=["onClick"],Ge={class:"mt-6 flex gap-3 justify-end"},Pe=["disabled"],He=q({__name:"AssignmentSubmissionForm",props:{assignment:{},courseId:{},existingAnswer:{},isEditing:{type:Boolean}},emits:["submitted","cancel"],setup(b,{emit:v}){const $=b,E=v,D=H(),y=J(),g=i(""),d=i([]),c=i([]),k=i([]),w=i(!1);Y(()=>$.existingAnswer,o=>{o&&(g.value=o.content||"",c.value=[...o.images||[]])},{immediate:!0});const U=o=>{const n=o.target;n.files&&(d.value=[...d.value,...Array.from(n.files)])},F=o=>{d.value.splice(o,1)},B=o=>{const n=c.value.findIndex(l=>l.id===o);n!==-1&&(c.value.splice(n,1),k.value.push(o))},S=async()=>{if(!(!g.value.trim()&&d.value.length===0&&c.value.length===0)){w.value=!0;try{const o=new FormData;o.append("content",g.value),o.append("course_id",$.courseId),d.value.forEach((n,l)=>{o.append(`images[${l}]`,n)}),k.value.length>0&&k.value.forEach((n,l)=>{o.append(`deleted_images[${l}]`,n.toString())}),await D.post(`/api/assignments/${$.assignment.id}/answers`,o),y.toast("ส่งคำตอบเรียบร้อยแล้ว","success"),E("submitted"),g.value="",d.value=[],k.value=[]}catch(o){console.error("Submission error:",o),y.toast("ส่งคำตอบไม่สำเร็จ","error")}finally{w.value=!1}}};return(o,n)=>(a(),r("div",Ce,[t("h3",Ee,[h(x(_),{icon:"fluent:form-new-24-regular",class:"w-6 h-6 text-orange-500"}),C(" "+u(b.isEditing?"แก้ไขการส่งงาน":"ส่งงาน"),1)]),t("div",Ue,[A(t("textarea",{"onUpdate:modelValue":n[0]||(n[0]=l=>g.value=l),rows:"4",class:"w-full p-4 rounded-xl bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all outline-none",placeholder:"พิมพ์คำตอบของคุณ..."},null,512),[[G,g.value]]),t("div",null,[n[3]||(n[3]=t("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},"แนบรูปภาพผลงาน",-1)),t("div",Se,[t("label",je,[t("div",Ie,[h(x(_),{icon:"fluent:image-add-24-regular",class:"w-8 h-8 text-gray-400 mb-1"}),n[2]||(n[2]=t("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"คลิกเพื่ออัพโหลดรูปภาพ",-1))]),t("input",{type:"file",multiple:"",accept:"image/*",class:"hidden",onChange:U},null,32)])])]),d.value.length?(a(),r("div",Te,[(a(!0),r(I,null,T(d.value,(l,j)=>(a(),r("div",{key:j,class:"px-3 py-1 bg-gray-100 dark:bg-gray-700 rounded-full text-sm flex items-center gap-2"},[t("span",Fe,u(l.name),1),t("button",{onClick:P=>F(j),class:"text-red-500 hover:bg-red-50 rounded-full p-0.5"},[h(x(_),{icon:"fluent:dismiss-16-regular"})],8,Ve)]))),128))])):f("",!0),c.value.length?(a(),r("div",De,[(a(!0),r(I,null,T(c.value,l=>(a(),r("div",{key:l.id,class:"relative group w-20 h-20 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},[t("img",{src:l.full_url||l.image_url,class:"w-full h-full object-cover"},null,8,Be),t("button",{onClick:j=>B(l.id),class:"absolute top-1 right-1 bg-red-500/80 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity"},[h(x(_),{icon:"fluent:delete-16-regular"})],8,Le)]))),128))])):f("",!0)]),t("div",Ge,[b.isEditing?(a(),r("button",{key:0,onClick:n[1]||(n[1]=l=>E("cancel")),class:"px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors"}," ยกเลิก ")):f("",!0),t("button",{onClick:S,disabled:w.value,class:"px-8 py-2.5 rounded-xl font-bold text-white bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 shadow-lg hover:shadow-orange-500/25 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"},[w.value?(a(),Z(x(_),{key:0,icon:"eos-icons:loading",class:"w-5 h-5"})):f("",!0),C(" "+u(w.value?"กำลังส่ง...":b.isEditing?"บันทึกการแก้ไข":"ส่งงาน"),1)],8,Pe)])]))}});export{qe as _,He as a};
