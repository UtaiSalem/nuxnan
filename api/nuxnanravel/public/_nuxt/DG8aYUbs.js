import{z as Z,af as q,r as _,N as M,a4 as ee,c as r,a as e,d as g,b as c,e as p,u as i,t as b,F as I,n as A,q as E,l as K,y as W,a5 as ne,o as t,I as d,j as O,ae as ie,w as X,i as Y,aG as de,a8 as ce,_ as ue}from"./DuB962GZ.js";import{_ as ge}from"./BgB4xtqt.js";import{u as te}from"./CaSR6SuD.js";import{u as be}from"./BmpSa16v.js";import{I as ve}from"./DlRiQVPw.js";const me={class:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6"},xe={class:"flex items-center justify-between mb-6"},fe={class:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white"},he={class:"px-2 py-0.5 text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 rounded-full"},ye={key:0,class:"flex gap-2 mb-6 overflow-x-auto pb-2"},pe=["onClick"],ke={key:1,class:"space-y-6"},_e={class:"p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl border border-green-200 dark:border-green-800"},we={class:"flex items-start justify-between mb-4"},$e={class:"text-lg font-bold text-gray-900 dark:text-white"},Ce={class:"flex items-center gap-3"},je={key:0,class:"flex items-center gap-1 bg-white dark:bg-gray-800 rounded-lg p-1 shadow-sm border border-gray-200 dark:border-gray-700"},Ie={key:0,class:"mb-4 prose prose-sm dark:prose-invert max-w-none"},Ae={class:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400"},Se={class:"flex items-center gap-1.5"},Ue={key:0,class:"flex items-center gap-1.5"},Fe={key:1,class:"mt-4 grid grid-cols-2 md:grid-cols-3 gap-3"},Le=["src","alt"],Ne={key:0,class:"space-y-4"},Ve={class:"font-bold text-gray-900 dark:text-white flex items-center gap-2"},ze={key:0,class:"py-8 flex justify-center"},Be={key:1,class:"text-center py-8 bg-gray-50 dark:bg-gray-800 rounded-xl border border-dashed border-gray-300 dark:border-gray-700"},Ee={key:2,class:"space-y-4"},Qe={class:"flex items-start gap-3 mb-3"},Te=["src"],Pe={class:"flex-1 min-w-0"},Me={class:"flex justify-between items-start"},De={class:"font-bold text-gray-900 dark:text-white flex items-center gap-2"},Ge={key:0,class:"px-2 py-0.5 text-[10px] bg-red-100 text-red-600 rounded-full border border-red-200"},Oe={key:1,class:"px-2 py-0.5 text-[10px] bg-green-100 text-green-600 rounded-full border border-green-200"},Je={class:"text-xs text-gray-500"},He={key:0,class:"text-red-500 ml-1"},Re={class:"text-right flex flex-col items-end gap-1"},Ke=["onClick"],We={class:"text-xs text-gray-500"},Xe={class:"mt-2 text-sm text-gray-700 dark:text-gray-300 bg-gray-50 dark:bg-gray-900/50 p-3 rounded-lg border border-gray-100 dark:border-gray-800"},Ye={key:0,class:"mt-2 text-xs text-blue-500 flex gap-1"},Ze={class:"mt-2 pt-3 border-t border-gray-100 dark:border-gray-700"},qe={class:"flex items-center gap-4"},et=["onUpdate:modelValue","max"],tt=["onClick","disabled"],rt=["onClick","disabled"],st={key:1,class:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-200 dark:border-blue-800"},at={class:"flex justify-between items-start mb-2"},ot={class:"font-semibold text-blue-800 dark:text-blue-300 flex items-center gap-2"},lt={class:"flex items-center gap-2"},nt={key:0,class:"px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400 rounded-lg flex items-center gap-1"},it={key:1,class:"px-2 py-0.5 text-xs font-medium bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400 rounded-lg flex items-center gap-1"},dt={class:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap mt-2"},ct={key:0,class:"mt-3 grid grid-cols-2 sm:grid-cols-3 gap-2"},ut=["src"],gt={key:1,class:"mt-4 p-3 bg-amber-100 dark:bg-amber-900/30 rounded-lg"},bt={class:"flex items-center gap-2 text-amber-700 dark:text-amber-400 font-bold"},vt={key:0,class:"mt-2 text-sm text-gray-600 dark:text-gray-400"},mt={key:2,id:"answer-form",class:"p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-lg"},xt={class:"flex justify-between items-center mb-4"},ft={class:"font-semibold text-gray-900 dark:text-white flex items-center gap-2"},ht={class:"mt-4"},yt={class:"flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-xl text-gray-500 dark:text-gray-400 hover:border-green-500 hover:text-green-500 cursor-pointer transition-colors"},pt={key:0,class:"mt-3 flex flex-wrap gap-2"},kt={class:"truncate max-w-32"},_t=["onClick"],wt={key:1,class:"mt-3"},$t={class:"flex flex-wrap gap-2"},Ct=["src"],jt=["onClick"],It=["disabled"],At={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},_r=Z({__name:"LessonAssignmentSection",props:{assignments:{},lessonId:{},courseId:{},isCreator:{type:Boolean}},emits:["submit","close","edit","delete","view-submissions"],setup(k,{emit:J}){const y=k,L=J,Q=q(),C=te(),{getAvatarUrl:T}=be(),S=_(y.assignments[0]?.id||null),w=_(!1),f=_(""),h=_([]),V=_([]),D=_(!1),U=_([]),z=_([]),F=_(!1),G=l=>T(l),u=M(()=>y.assignments.find(l=>l.id===S.value)||null),x=M(()=>u.value&&u.value.answers?.[0]||null),B=M(()=>u.value?x.value?.graded_score!==void 0&&x.value?.graded_score!==null?"graded":x.value?"submitted":"not_started":"not_started"),P=M(()=>{const l={not_started:{icon:"fluent:circle-24-regular",text:"ยังไม่ได้ทำ",color:"text-gray-700 dark:text-gray-300",bgColor:"bg-gray-50 dark:bg-gray-800 ring-1 ring-inset ring-gray-600/20 dark:ring-gray-500/30"},submitted:{icon:"fluent:checkmark-circle-24-filled",text:"ส่งแล้ว - รอตรวจ",color:"text-blue-700 dark:text-blue-400",bgColor:"bg-blue-50 dark:bg-blue-900/30 ring-1 ring-inset ring-blue-700/10 dark:ring-blue-500/30"},graded:{icon:"fluent:trophy-24-filled",text:"ตรวจแล้ว",color:"text-amber-700 dark:text-amber-400",bgColor:"bg-amber-50 dark:bg-amber-900/30 ring-1 ring-inset ring-amber-600/20 dark:ring-amber-500/30"}};return l[B.value]||l.not_started}),v=async()=>{if(!(!u.value||!y.isCreator)){D.value=!0;try{const l=await Q.get(`/api/assignments/${u.value.id}/answers`);V.value=(l.answers||[]).map(a=>({...a,points:a.points,originalPoints:a.points,isUpdating:!1}))}catch(l){console.error("Failed to fetch answers:",l)}finally{D.value=!1}}};ee(S,()=>{y.isCreator&&v()},{immediate:!0});const m=async l=>{if(u.value)try{l.isUpdating=!0,await Q.post(`/api/assignments/${u.value.id}/answers/${l.id}/set-points`,{points:l.points,feedback:l.feedback,course_id:y.courseId||u.value.course_id||u.value.lesson?.course_id}),l.status="graded",l.originalPoints=l.points,l.isUpdating=!1,C.toast("บันทึกคะแนนเรียบร้อย","success")}catch(a){console.error("Failed to grade:",a),C.toast("ไม่สามารถบันทึกคะแนนได้","error"),l.isUpdating=!1}},s=l=>{l.points=l.originalPoints},j=async l=>{const a=l.student?.name||l.member_name||"นักเรียน";if(!(!await C.confirm("ลบคำตอบ",`คุณแน่ใจหรือไม่ที่จะลบคำตอบของ ${a}? 
ข้อมูลคะแนนที่ได้จากงานนี้จะถูกลบไปด้วย`)||!u.value))try{await Q.delete(`/api/assignments/${u.value.id}/answers/${l.id}`,{params:{course_id:y.courseId||u.value.course_id||u.value.lesson?.course_id}}),V.value=V.value.filter($=>$.id!==l.id),C.toast("ลบคำตอบเรียบร้อยแล้ว","success")}catch($){console.error("Failed to delete answer:",$),C.toast("ไม่สามารถลบคำตอบได้","error")}},n=l=>{S.value=l,f.value="",h.value=[],U.value=[],z.value=[],F.value=!1},N=l=>{const a=l.target;a.files&&(h.value=[...h.value,...Array.from(a.files)])},H=l=>{h.value.splice(l,1)},re=()=>{x.value&&(f.value=x.value.content||"",U.value=[...x.value.images||[]],z.value=[],h.value=[],F.value=!0,ne(()=>{const l=document.getElementById("answer-form");l&&l.scrollIntoView({behavior:"smooth"})}))},se=()=>{F.value=!1,f.value="",h.value=[],U.value=[],z.value=[]},ae=l=>{const a=U.value.findIndex(o=>o.id===l);a!==-1&&(U.value.splice(a,1),z.value.push(l))},oe=async()=>{if(!(!u.value||!f.value.trim()&&h.value.length===0&&U.value.length===0)){w.value=!0;try{const l={content:f.value,files:h.value,deleted_images:z.value};L("submit",u.value.id,l),f.value="",h.value=[],U.value=[],z.value=[],F.value=!1}finally{w.value=!1}}},R=l=>l?new Date(l).toLocaleString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-";return(l,a)=>(t(),r("div",me,[e("div",xe,[e("h3",fe,[c(i(d),{icon:"fluent:clipboard-task-24-filled",class:"w-6 h-6 text-green-600"}),a[5]||(a[5]=p(" แบบฝึกหัดประจำบทเรียน ",-1)),e("span",he,b(k.assignments.length)+" ข้อ ",1)]),e("button",{onClick:a[0]||(a[0]=o=>L("close")),class:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"},[c(i(d),{icon:"fluent:chevron-up-24-regular",class:"w-5 h-5"})])]),k.assignments.length>1?(t(),r("div",ye,[(t(!0),r(I,null,A(k.assignments,(o,$)=>(t(),r("button",{key:o.id,onClick:le=>n(o.id),class:E(["flex-shrink-0 px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200",[S.value===o.id?"bg-green-500 text-white shadow-lg":"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"]])}," ข้อที่ "+b($+1),11,pe))),128))])):g("",!0),u.value?(t(),r("div",ke,[e("div",_e,[e("div",we,[e("h4",$e,b(u.value.title),1),e("div",Ce,[k.isCreator?(t(),r("div",je,[e("button",{onClick:a[1]||(a[1]=o=>L("edit",u.value)),class:"p-1.5 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-md transition-colors",title:"แก้ไข"},[c(i(d),{icon:"fluent:edit-16-regular",class:"w-4 h-4"})]),a[7]||(a[7]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700"},null,-1)),e("button",{onClick:a[2]||(a[2]=o=>L("delete",u.value)),class:"p-1.5 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-md transition-colors",title:"ลบ"},[c(i(d),{icon:"fluent:delete-16-regular",class:"w-4 h-4"})]),a[8]||(a[8]=e("div",{class:"w-px h-4 bg-gray-200 dark:bg-gray-700"},null,-1)),e("button",{onClick:a[3]||(a[3]=o=>L("view-submissions",u.value)),class:"flex items-center gap-1 px-2 py-1 text-xs font-bold text-amber-600 bg-amber-50 hover:bg-amber-100 dark:bg-amber-900/20 dark:text-amber-400 dark:hover:bg-amber-900/30 rounded-md transition-colors"},[c(i(d),{icon:"fluent:clipboard-task-list-20-regular",class:"w-4 h-4"}),a[6]||(a[6]=e("span",null,"ตรวจละเอียด",-1))])])):(t(),r("span",{key:1,class:E(["inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium",[P.value.bgColor,P.value.color]])},[c(i(d),{icon:P.value.icon,class:"w-4 h-4"},null,8,["icon"]),p(" "+b(P.value.text),1)],2))])]),u.value.description?(t(),r("div",Ie,[c(ge,{content:u.value.description},null,8,["content"])])):g("",!0),e("div",Ae,[e("div",Se,[c(i(d),{icon:"fluent:star-24-regular",class:"w-4 h-4 text-amber-500"}),e("span",null,b(u.value.points||0)+" คะแนน",1)]),u.value.due_date?(t(),r("div",Ue,[c(i(d),{icon:"fluent:calendar-24-regular",class:"w-4 h-4 text-blue-500"}),e("span",null,"กำหนดส่ง: "+b(R(u.value.due_date)),1)])):g("",!0)]),u.value.images?.length?(t(),r("div",Fe,[(t(!0),r(I,null,A(u.value.images,o=>(t(),r("img",{key:o.id,src:o.full_url||o.image_url,alt:u.value.title,class:"w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-90 transition-opacity"},null,8,Le))),128))])):g("",!0)]),k.isCreator?(t(),r("div",Ne,[e("h4",Ve,[c(i(d),{icon:"fluent:person-available-24-filled",class:"w-5 h-5 text-green-600"}),p(" ส่งงานแล้ว ("+b(V.value.length)+") ",1)]),D.value?(t(),r("div",ze,[c(i(d),{icon:"eos-icons:loading",class:"w-8 h-8 text-green-500"})])):V.value.length===0?(t(),r("div",Be,[...a[9]||(a[9]=[e("p",{class:"text-gray-500"},"ยังไม่มีใครส่งงาน",-1)])])):(t(),r("div",Ee,[(t(!0),r(I,null,A(V.value,o=>(t(),r("div",{key:o.id,class:"bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 shadow-sm"},[e("div",Qe,[e("img",{src:G(o.user),class:"w-10 h-10 rounded-full object-cover border border-gray-200 dark:border-gray-600"},null,8,Te),e("div",Pe,[e("div",Me,[e("div",null,[e("div",De,[p(b(o.user?.firstname)+" "+b(o.user?.lastname)+" ",1),o.points===null||o.points===void 0?(t(),r("span",Ge," รอตรวจ ")):(t(),r("span",Oe," ตรวจแล้ว "))]),e("div",Je,[p(" ส่งเมื่อ "+b(R(o.created_at))+" ",1),o.late_submission?(t(),r("span",He,"(ส่งช้า)")):g("",!0)])]),e("div",Re,[e("button",{onClick:$=>j(o),class:"text-gray-400 hover:text-red-500 transition-colors p-1",title:"ลบคำตอบ"},[c(i(d),{icon:"fluent:delete-20-regular",class:"w-5 h-5"})],8,Ke),e("div",null,[e("span",{class:E(["text-2xl font-bold",o.points!==null?"text-green-600 dark:text-green-400":"text-gray-400"])},b(o.points??"-"),3),e("span",We,"/ "+b(u.value.points),1)])])]),e("div",Xe,[p(b(o.content)+" ",1),o.images?.length?(t(),r("div",Ye,[c(i(d),{icon:"fluent:image-24-regular",class:"w-4 h-4"}),p(" มีรูปภาพแนบ "+b(o.images.length)+" รูป ",1)])):g("",!0)])])]),e("div",Ze,[e("div",qe,[a[12]||(a[12]=e("span",{class:"text-xs font-medium text-gray-500"},"ให้คะแนน:",-1)),K(e("input",{type:"range","onUpdate:modelValue":$=>o.points=$,min:0,max:u.value.points,step:"1",class:"flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700 accent-green-500"},null,8,et),[[W,o.points,void 0,{number:!0}]]),e("button",{onClick:$=>m(o),disabled:o.isUpdating||o.points===o.originalPoints,class:"p-1 px-3 text-xs font-bold text-white bg-green-500 rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-1",title:"บันทึกคะแนน"},[o.isUpdating?(t(),O(i(d),{key:0,icon:"eos-icons:loading",class:"w-4 h-4 animate-spin"})):(t(),O(i(d),{key:1,icon:"fluent:save-24-regular",class:"w-4 h-4"})),a[10]||(a[10]=p(" บันทึก ",-1))],8,tt),o.points!==o.originalPoints?(t(),r("button",{key:0,onClick:$=>s(o),disabled:o.isUpdating,class:"p-1 px-3 text-xs font-bold text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors disabled:opacity-50 flex items-center gap-1",title:"ยกเลิก"},[c(i(d),{icon:"fluent:dismiss-24-regular",class:"w-4 h-4"}),a[11]||(a[11]=p(" ยกเลิก ",-1))],8,rt)):g("",!0)])])]))),128))]))])):g("",!0),x.value&&!F.value&&!k.isCreator?(t(),r("div",st,[e("div",at,[e("h5",ot,[c(i(d),{icon:"fluent:document-text-24-regular",class:"w-5 h-5"}),a[13]||(a[13]=p(" คำตอบของคุณ ",-1))]),e("div",lt,[x.value.graded_score===null||x.value.graded_score===void 0?(t(),r("span",nt,[c(i(d),{icon:"fluent:clock-24-regular",class:"w-3.5 h-3.5"}),a[14]||(a[14]=p(" ส่งแล้ว - รอตรวจ ",-1))])):(t(),r("span",it,[c(i(d),{icon:"fluent:checkmark-circle-24-filled",class:"w-3.5 h-3.5"}),a[15]||(a[15]=p(" ตรวจแล้ว ",-1))])),B.value!=="graded"?(t(),r("button",{key:2,onClick:re,class:"text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center gap-1 ml-2"},[c(i(d),{icon:"fluent:edit-16-filled",class:"w-4 h-4"}),a[16]||(a[16]=p(" แก้ไข ",-1))])):g("",!0)])]),e("p",dt,b(x.value.content),1),x.value.images?.length?(t(),r("div",ct,[(t(!0),r(I,null,A(x.value.images,o=>(t(),r("img",{key:o.id,src:o.full_url||o.image_url,class:"w-full h-24 object-cover rounded-lg border border-blue-100 dark:border-blue-800"},null,8,ut))),128))])):g("",!0),x.value.graded_score!==void 0&&x.value.graded_score!==null?(t(),r("div",gt,[e("div",bt,[c(i(d),{icon:"fluent:trophy-24-filled",class:"w-5 h-5"}),p(" คะแนนที่ได้: "+b(x.value.graded_score)+" / "+b(u.value.points||100),1)]),x.value.feedback?(t(),r("p",vt,b(x.value.feedback),1)):g("",!0)])):g("",!0)])):g("",!0),B.value!=="graded"&&!k.isCreator&&!x.value||F.value?(t(),r("div",mt,[e("div",xt,[e("h5",ft,[c(i(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5 text-green-600"}),p(" "+b(F.value?"แก้ไขคำตอบ":"เขียนคำตอบ"),1)]),F.value?(t(),r("button",{key:0,onClick:se,class:"text-gray-500 hover:text-gray-700 text-sm font-medium"}," ยกเลิก ")):g("",!0)]),K(e("textarea",{"onUpdate:modelValue":a[4]||(a[4]=o=>f.value=o),rows:"4",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-green-500 focus:border-transparent resize-none transition-all",placeholder:"พิมพ์คำตอบของคุณที่นี่..."},null,512),[[W,f.value]]),e("div",ht,[e("label",yt,[c(i(d),{icon:"fluent:attach-24-regular",class:"w-5 h-5"}),a[17]||(a[17]=e("span",null,"แนบไฟล์ / รูปภาพ",-1)),e("input",{type:"file",multiple:"",accept:"image/*,.pdf,.doc,.docx",class:"hidden",onChange:N},null,32)]),h.value.length?(t(),r("div",pt,[(t(!0),r(I,null,A(h.value,(o,$)=>(t(),r("div",{key:$,class:"flex items-center gap-2 px-3 py-1.5 bg-gray-100 dark:bg-gray-700 rounded-lg text-sm"},[c(i(d),{icon:"fluent:document-24-regular",class:"w-4 h-4"}),e("span",kt,b(o.name),1),e("button",{onClick:le=>H($),class:"text-red-500 hover:text-red-700"},[c(i(d),{icon:"fluent:dismiss-12-regular",class:"w-4 h-4"})],8,_t)]))),128))])):g("",!0),U.value.length>0?(t(),r("div",wt,[a[18]||(a[18]=e("p",{class:"text-xs text-gray-500 mb-2"},"รูปภาพเดิม:",-1)),e("div",$t,[(t(!0),r(I,null,A(U.value,o=>(t(),r("div",{key:o.id,class:"relative group w-24 h-24 rounded-lg overflow-hidden border border-gray-200 dark:border-gray-700"},[e("img",{src:o.full_url||o.image_url,class:"w-full h-full object-cover"},null,8,Ct),e("button",{onClick:$=>ae(o.id),class:"absolute top-1 right-1 p-1 bg-red-500/90 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"ลบรูปภาพ"},[c(i(d),{icon:"fluent:delete-16-regular",class:"w-3 h-3"})],8,jt)]))),128))])])):g("",!0)]),e("button",{onClick:oe,disabled:w.value||!f.value.trim()&&h.value.length===0,class:"mt-4 w-full px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white font-semibold rounded-xl hover:from-green-600 hover:to-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 shadow-lg hover:shadow-xl flex items-center justify-center gap-2"},[c(i(d),{icon:w.value?"fluent:spinner-ios-20-regular":"fluent:send-24-filled",class:E(["w-5 h-5",w.value&&"animate-spin"])},null,8,["icon","class"]),p(" "+b(w.value?"กำลังบันทึก...":F.value?"บันทึกการแก้ไข":"ส่งคำตอบ"),1)],8,It)])):g("",!0)])):(t(),r("div",At,[c(i(d),{icon:"fluent:clipboard-task-24-regular",class:"w-12 h-12 mx-auto mb-2 opacity-50"}),a[19]||(a[19]=e("p",null,"ไม่มีแบบฝึกหัดในบทเรียนนี้",-1))]))]))}}),St={class:"mt-6 border-t border-gray-200 dark:border-gray-700 pt-6"},Ut={class:"flex flex-col gap-4 mb-6"},Ft={class:"flex items-center justify-between"},Lt={class:"flex items-center gap-2 text-xl font-bold text-gray-900 dark:text-white"},Nt={class:"px-2 py-0.5 text-sm font-medium bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400 rounded-full"},Vt={key:0,class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 overflow-hidden"},zt={key:1,class:"text-right text-sm text-gray-500 dark:text-gray-400"},Bt={key:0,class:"space-y-8"},Et={class:"flex items-start gap-5"},Qt={class:"flex-shrink-0 w-10 h-10 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg font-bold text-lg"},Tt={class:"flex-1 w-full min-w-0"},Pt={class:"font-medium text-lg text-gray-900 dark:text-white mb-4 leading-relaxed whitespace-pre-wrap"},Mt={key:0,class:"flex gap-3 overflow-x-auto pb-4 scrollbar-hide"},Dt=["src","onClick"],Gt={class:"space-y-3 mt-2"},Ot=["onClick","disabled"],Jt={class:"flex-1"},Ht={class:"text-gray-900 dark:text-gray-200 text-base"},Rt={key:0,class:"mt-3"},Kt=["src","onClick"],Wt={class:"mt-6 flex items-center justify-between pt-4 border-t border-gray-100 dark:border-gray-700/50"},Xt={class:"flex-1 min-h-[40px] flex items-center"},Yt={key:0,class:"text-sm opacity-80 ml-1"},Zt=["onClick","disabled"],qt={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},er={key:1,class:"space-y-4"},tr={key:0,class:"text-center py-12 bg-gray-50 dark:bg-gray-800 rounded-xl border-dashed border-2 border-gray-200 dark:border-gray-700"},rr={class:"w-16 h-16 bg-orange-100 dark:bg-orange-900/30 rounded-full flex items-center justify-center mx-auto mb-4"},sr={class:"flex items-start gap-4"},ar={class:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 text-orange-600 dark:text-orange-400 rounded-lg font-bold"},or={class:"flex-1 min-w-0"},lr={class:"font-medium text-gray-900 dark:text-white mb-2"},nr={key:0,class:"flex gap-2 overflow-x-auto pb-2"},ir=["src","onClick"],dr={class:"mt-3 space-y-1"},cr=["src","onClick"],ur={key:1},gr={class:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity"},br=["onClick"],vr=["onClick"],mr={class:"absolute top-4 right-4 text-xs font-medium text-gray-400"},xr=Z({__name:"LessonQuizSection",props:{questions:{},lessonId:{},isCreator:{type:Boolean}},emits:["update:questions","create","edit","delete"],setup(k,{emit:J}){const y=k,L=J,Q=q(),C=te(),T=M(()=>y.questions&&y.questions.length>0),S=_([]),w=_({}),f=_({}),h=_({});ee(()=>y.questions,v=>{v&&(S.value=JSON.parse(JSON.stringify(v)))},{immediate:!0,deep:!0});const V=M(()=>{if(!y.questions||y.questions.length===0)return 0;const v=new Set(Object.keys(f.value).map(Number));y.questions&&y.questions.forEach(s=>{s.user_answer&&v.add(s.id)});const m=v.size;return Math.round(m/y.questions.length*100)}),D=(v,m)=>{f.value[v]?.is_correct||(w.value[v]=m)},U=v=>{for(let m=v.length-1;m>0;m--){const s=Math.floor(Math.random()*(m+1));[v[m],v[s]]=[v[s],v[m]]}return v},z=async v=>{const m=w.value[v.id];if(m){h.value[v.id]=!0;try{const j=await Q.post(`/api/lessons/${y.lessonId}/questions/${v.id}/answer`,{answer_id:m});if(f.value[v.id]={is_correct:j.is_correct,points:j.points,message:j.message},j.is_correct)C.toast("ถูกต้อง! เก่งมาก","success");else{C.toast("ยังไม่ถูกต้อง ลองใหม่นะ","error");const n=S.value.findIndex(N=>N.id===v.id);n!==-1&&S.value[n].options&&setTimeout(()=>{S.value[n].options=U([...S.value[n].options]),w.value[v.id]=0},1e3)}}catch(s){console.error("Submit answer failed",s),C.error("ส่งคำตอบไม่สำเร็จ")}finally{h.value[v.id]=!1}}},F=async v=>{if(await C.confirm("ลบคำถาม","คุณแน่ใจหรือไม่ที่จะลบคำถามนี้?"))try{await Q.delete(`/api/lessons/${y.lessonId}/questions/${v.id}`),C.toast("ลบคำถามเรียบร้อย","success");const s=y.questions.filter(j=>j.id!==v.id);L("update:questions",s)}catch(s){console.error("Failed to delete question:",s),C.error("ไม่สามารถลบคำถามได้")}},G=_(!1),u=_([]),x=_(0),B=(v,m)=>{u.value=v.map(s=>({...s,url:s.full_url||s.image_url})),x.value=m,G.value=!0},P=()=>{G.value=!1,u.value=[],x.value=0};return(v,m)=>(t(),r("div",St,[e("div",Ut,[e("div",Ft,[e("h3",Lt,[c(i(d),{icon:"fluent:quiz-new-24-filled",class:"w-6 h-6 text-orange-600"}),m[2]||(m[2]=p(" แบบทดสอบ ",-1)),e("span",Nt,b(k.questions.length)+" ข้อ ",1)]),k.isCreator?(t(),r("button",{key:0,onClick:m[0]||(m[0]=s=>L("create")),class:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm font-medium"},[c(i(d),{icon:"fluent:add-24-filled",class:"w-4 h-4"}),m[3]||(m[3]=p(" เพิ่มคำถาม ",-1))])):g("",!0)]),!k.isCreator&&T.value?(t(),r("div",Vt,[e("div",{class:"bg-orange-600 h-2.5 rounded-full transition-all duration-500 ease-out",style:ie({width:`${V.value}%`})},null,4)])):g("",!0),!k.isCreator&&T.value?(t(),r("div",zt," ความคืบหน้า: "+b(V.value)+"% ",1)):g("",!0)]),!k.isCreator&&T.value?(t(),r("div",Bt,[(t(!0),r(I,null,A(S.value,(s,j)=>(t(),r("div",{key:s.id,class:"bg-white dark:bg-gray-800 p-6 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-all hover:shadow-md"},[e("div",Et,[e("div",Qt,b(j+1),1),e("div",Tt,[e("p",Pt,b(s.text),1),s.images?.length?(t(),r("div",Mt,[(t(!0),r(I,null,A(s.images,(n,N)=>(t(),r("img",{key:n.id,src:n.full_url||n.image_url,class:"h-40 w-auto rounded-xl object-cover border border-gray-200 dark:border-gray-700 cursor-pointer hover:opacity-95 transition-opacity shadow-sm",onClick:H=>B(s.images,N)},null,8,Dt))),128))])):g("",!0),e("div",Gt,[c(de,{name:"list",tag:"div",class:"space-y-3"},{default:X(()=>[(t(!0),r(I,null,A(s.options,n=>(t(),r("button",{key:n.id,onClick:N=>D(s.id,n.id),disabled:h.value[s.id]||f.value[s.id]?.is_correct,class:E(["w-full flex items-center gap-4 p-4 rounded-xl border-2 transition-all text-left group relative overflow-hidden",[w.value[s.id]===n.id?"border-orange-500 bg-orange-50 dark:bg-orange-900/10":"border-gray-200 dark:border-gray-700 hover:border-orange-200 dark:hover:border-orange-800 hover:bg-gray-50 dark:hover:bg-gray-800/50"]])},[e("div",{class:E(["w-6 h-6 rounded-full border-2 flex-shrink-0 flex items-center justify-center transition-colors",[w.value[s.id]===n.id?"border-orange-500 bg-orange-500 text-white":"border-gray-300 dark:border-gray-600 group-hover:border-orange-400"]])},[w.value[s.id]===n.id?(t(),O(i(d),{key:0,icon:"fluent:checkmark-16-filled",class:"w-4 h-4"})):g("",!0)],2),e("div",Jt,[e("span",Ht,b(n.text),1),n.images?.length?(t(),r("div",Rt,[e("img",{src:n.images[0].full_url||n.images[0].image_url,class:"h-32 w-auto rounded-lg object-cover cursor-pointer hover:opacity-95 shadow-sm border border-gray-200 dark:border-gray-700",onClick:Y(N=>B(n.images,0),["stop"])},null,8,Kt)])):g("",!0)])],10,Ot))),128))]),_:2},1024)]),e("div",Wt,[e("div",Xt,[c(ce,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"opacity-0 translate-y-2","enter-to-class":"opacity-100 translate-y-0"},{default:X(()=>[f.value[s.id]?(t(),r("div",{key:0,class:E(["flex items-center gap-3 font-medium px-4 py-2 rounded-lg",f.value[s.id].is_correct?"bg-green-50 text-green-700 dark:bg-green-900/20 dark:text-green-400":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400"])},[c(i(d),{icon:f.value[s.id].is_correct?"fluent:checkmark-circle-24-filled":"fluent:dismiss-circle-24-filled",class:"w-6 h-6"},null,8,["icon"]),e("span",null,b(f.value[s.id].message),1),f.value[s.id].is_correct?(t(),r("span",Yt," (+"+b(f.value[s.id].points)+" คะแนน) ",1)):g("",!0)],2)):g("",!0)]),_:2},1024)]),f.value[s.id]?.is_correct?g("",!0):(t(),r("button",{key:0,onClick:n=>z(s),disabled:!w.value[s.id]||h.value[s.id],class:"px-8 py-2.5 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium rounded-full shadow-lg shadow-orange-500/20 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2 transform active:scale-95"},[h.value[s.id]?(t(),r("span",qt)):g("",!0),e("span",null,b(h.value[s.id]?"กำลังส่ง...":"ตรวจคำตอบ"),1),h.value[s.id]?g("",!0):(t(),O(i(d),{key:1,icon:"fluent:send-24-filled",class:"w-5 h-5"}))],8,Zt))])])])]))),128))])):g("",!0),k.isCreator?(t(),r("div",er,[T.value?g("",!0):(t(),r("div",tr,[e("div",rr,[c(i(d),{icon:"fluent:question-circle-24-regular",class:"w-8 h-8 text-orange-500"})]),m[4]||(m[4]=e("p",{class:"text-gray-500 dark:text-gray-400"},"ยังไม่มีคำถาม",-1)),e("button",{onClick:m[1]||(m[1]=s=>L("create")),class:"mt-4 text-orange-600 hover:text-orange-700 font-medium"}," เพิ่มคำถามแรก ")])),(t(!0),r(I,null,A(k.questions,(s,j)=>(t(),r("div",{key:s.id,class:"bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm relative group"},[e("div",sr,[e("div",ar,b(j+1),1),e("div",or,[e("p",lr,b(s.text),1),s.images?.length?(t(),r("div",nr,[(t(!0),r(I,null,A(s.images,(n,N)=>(t(),r("img",{key:n.id,src:n.full_url||n.image_url,class:"h-16 w-auto rounded-lg object-cover border border-gray-200 dark:border-gray-700 cursor-pointer hover:opacity-90 transition-opacity",onClick:H=>B(s.images,N)},null,8,ir))),128))])):g("",!0),e("div",dr,[(t(!0),r(I,null,A(s.options,n=>(t(),r("div",{key:n.id,class:E(["flex items-center gap-2 text-sm",n.is_correct?"text-green-600 dark:text-green-400 font-medium":"text-gray-500 dark:text-gray-400"])},[c(i(d),{icon:n.is_correct?"fluent:checkmark-circle-24-filled":"fluent:circle-24-regular",class:"w-4 h-4 flex-shrink-0"},null,8,["icon"]),n.images?.length?(t(),r("img",{key:0,src:n.images[0].full_url||n.images[0].image_url,class:"h-10 w-auto rounded border border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:opacity-90 transition-opacity",onClick:Y(N=>B(n.images,0),["stop"])},null,8,cr)):g("",!0),n.text?(t(),r("span",ur,b(n.text),1)):g("",!0)],2))),128))])]),e("div",gr,[e("button",{onClick:n=>L("edit",s),class:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg",title:"แก้ไข"},[c(i(d),{icon:"fluent:edit-20-regular",class:"w-5 h-5"})],8,br),e("button",{onClick:n=>F(s),class:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg",title:"ลบ"},[c(i(d),{icon:"fluent:delete-20-regular",class:"w-5 h-5"})],8,vr)])]),e("div",mr,b(s.points)+" คะแนน ",1)]))),128))])):g("",!0),c(ve,{show:G.value,images:u.value,"initial-index":x.value,onClose:P},null,8,["show","images","initial-index"])]))}}),wr=ue(xr,[["__scopeId","data-v-dd10a6ba"]]);export{wr as Q,_r as _};
