import{z as T,an as D,af as S,aD as A,N as I,c as n,u as e,b as i,a as t,d as p,e as x,t as o,w as C,q as m,F as N,n as Q,O as _,Y as V,o as a,I as d,j as L}from"./DuB962GZ.js";import{S as f}from"./BQxta0Da.js";import{_ as q}from"./BaNOa8gA.js";import{u as W}from"./CcTqlhN9.js";import"./Dy2WcBMD.js";const E={class:"container mx-auto px-4 py-6 max-w-4xl"},H={key:0,class:"flex justify-center p-12"},O={key:1},R={class:"flex items-center justify-between mb-6"},U={key:0,class:"flex items-center gap-2"},Y={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden"},G={class:"bg-gradient-to-r from-purple-600 to-indigo-600 p-8 text-white"},J={class:"flex items-start gap-4"},K={class:"w-16 h-16 rounded-xl bg-white/20 backdrop-blur-sm flex items-center justify-center border border-white/30"},M={class:"flex items-center gap-2 mb-2"},P={class:"px-2 py-0.5 rounded-full text-xs font-medium bg-white/20 text-white border border-white/20"},X={key:0,class:"flex items-center gap-1 text-xs bg-black/20 px-2 py-0.5 rounded-full"},Z={class:"text-3xl font-bold mb-2"},tt={class:"text-purple-100 text-lg opacity-90"},et={class:"grid md:grid-cols-3 divide-y md:divide-y-0 md:divide-x divide-gray-200 dark:divide-gray-700 border-b border-gray-200 dark:border-gray-700"},st={class:"p-6 text-center"},rt={class:"text-2xl font-bold text-gray-900 dark:text-white"},ot={class:"p-6 text-center"},at={class:"text-2xl font-bold text-gray-900 dark:text-white"},nt={class:"p-6 text-center"},lt={class:"text-2xl font-bold text-gray-900 dark:text-white"},it={class:"p-6 bg-gray-50 dark:bg-gray-700/30 border-b border-gray-200 dark:border-gray-700"},dt={class:"grid md:grid-cols-2 gap-4 text-sm"},ct={class:"flex items-center gap-3"},ut={class:"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400"},gt={class:"font-medium text-gray-900 dark:text-white"},xt={class:"flex items-center gap-3"},pt={class:"w-10 h-10 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-400"},_t={class:"font-medium text-gray-900 dark:text-white"},bt={class:"p-8 text-center"},mt={key:0},yt={key:0,class:"bg-gray-100 dark:bg-gray-700/50 rounded-xl p-6 mb-6"},ft={class:"flex justify-center gap-12 text-center py-4"},ht={class:"flex flex-col items-center"},vt={class:"flex flex-col items-center mt-1"},kt={class:"text-xs text-gray-400 font-medium"},wt={class:"flex flex-col items-center"},zt={class:"mt-4 text-center"},Ct={key:1,class:"mt-4 text-sm text-gray-500"},qt={key:1},$t={class:"bg-gray-50 dark:bg-gray-700/30 rounded-xl p-6"},Ft={class:"overflow-x-auto"},jt={class:"w-full text-sm text-left"},Bt={class:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white flex items-center gap-2"},Tt={class:"w-8 h-8 rounded-full bg-gray-200 overflow-hidden"},Dt=["src"],St={class:"px-6 py-4"},At={class:"px-6 py-4"},It={class:"px-6 py-4"},Nt={class:"px-6 py-4"},Qt={key:1,class:"text-gray-500 italic"},Vt={key:0},Lt={class:"mt-4 flex justify-end gap-2"},Wt={key:2,class:"text-center py-12"},Jt=T({__name:"index",async setup(Et){let b,h;const v=D(),u=v.params.id,g=v.params.quizId,k=S(),w=V("isCourseAdmin"),{data:s,refresh:Ht,pending:$}=([b,h]=A(async()=>W(`course-quiz-${g}`,async()=>(await k.get(`/api/courses/${u}/quizzes/${g}`)).quiz)),b=await b,h(),b),F=()=>{console.log("Start Quiz clicked",{courseId:u,quizId:g}),_(`/courses/${u}/quizzes/${g}/attempt`)},z=()=>{_(`/courses/${u}/quizzes/${g}/edit`)},j=async()=>{if((await f.fire({title:"ยืนยันการลบ?",text:"คุณต้องการลบแบบทดสอบนี้ใช่หรือไม่ การกระทำนี้ไม่สามารถยกเลิกได้",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"ใช่, ลบเลย",cancelButtonText:"ยกเลิก"})).isConfirmed)try{await k.delete(`/api/courses/${u}/quizzes/${g}`),await f.fire("ลบสำเร็จ!","แบบทดสอบถูกลบแล้ว","success"),_(`/courses/${u}/quizzes`)}catch{f.fire("เกิดข้อผิดพลาด","ไม่สามารถลบแบบทดสอบได้","error")}},y=c=>c?new Date(c).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"-",B=I(()=>s.value?s.value.is_active?{text:"เผยแพร่แล้ว",class:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"}:{text:"ฉบับร่าง",class:"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400"}:{});return(c,r)=>(a(),n("div",E,[e($)?(a(),n("div",H,[i(e(d),{icon:"svg-spinners:3-dots-fade",class:"w-10 h-10 text-gray-400"})])):e(s)?(a(),n("div",O,[t("div",R,[t("button",{onClick:r[0]||(r[0]=l=>("navigateTo"in c?c.navigateTo:e(_))(`/courses/${e(u)}/quizzes`)),class:"flex items-center gap-2 text-gray-500 hover:text-gray-900 dark:hover:text-white transition-colors"},[i(e(d),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"}),r[2]||(r[2]=t("span",null,"กลับไปหน้ารวมแบบทดสอบ",-1))]),e(w)?(a(),n("div",U,[t("button",{onClick:z,class:"px-4 py-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5"}),r[3]||(r[3]=x(" แก้ไข ",-1))]),t("button",{onClick:j,class:"px-4 py-2 rounded-lg bg-red-50 text-red-600 hover:bg-red-100 dark:bg-red-900/20 dark:text-red-400 dark:hover:bg-red-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:delete-24-regular",class:"w-5 h-5"}),r[4]||(r[4]=x(" ลบ ",-1))])])):p("",!0)]),t("div",Y,[t("div",G,[t("div",J,[t("div",K,[i(e(d),{icon:"fluent:quiz-new-24-filled",class:"w-8 h-8 text-white"})]),t("div",null,[t("div",M,[t("span",P,o(e(B).text),1),e(s).time_limit?(a(),n("span",X,[i(e(d),{icon:"fluent:timer-24-filled",class:"w-3 h-3"}),x(" "+o(e(s).time_limit)+" นาที ",1)])):p("",!0)]),t("h1",Z,o(e(s).title),1),t("p",tt,o(e(s).description||"ไม่มีคำอธิบาย"),1)])])]),t("div",et,[t("div",st,[r[5]||(r[5]=t("div",{class:"text-sm text-gray-500 mb-1"},"จำนวนข้อ",-1)),t("div",rt,o(e(s).questions?.length||0),1)]),t("div",ot,[r[6]||(r[6]=t("div",{class:"text-sm text-gray-500 mb-1"},"คะแนนเต็ม",-1)),t("div",at,o(e(s).total_score||0),1)]),t("div",nt,[r[7]||(r[7]=t("div",{class:"text-sm text-gray-500 mb-1"},"เกณฑ์ผ่าน",-1)),t("div",lt,o(e(s).passing_score)+"% ",1)])]),t("div",it,[t("div",dt,[t("div",ct,[t("div",ut,[i(e(d),{icon:"fluent:calendar-ltr-24-regular",class:"w-5 h-5"})]),t("div",null,[r[8]||(r[8]=t("p",{class:"text-gray-500"},"เริ่มทำได้ตั้งแต่",-1)),t("p",gt,o(y(e(s).start_date)),1)])]),t("div",xt,[t("div",pt,[i(e(d),{icon:"fluent:calendar-end-24-regular",class:"w-5 h-5"})]),t("div",null,[r[9]||(r[9]=t("p",{class:"text-gray-500"},"สิ้นสุดเมื่อ",-1)),t("p",_t,o(y(e(s).end_date)),1)])])])]),t("div",bt,[e(w)?(a(),n("div",qt,[t("div",$t,[r[15]||(r[15]=t("h3",{class:"text-lg font-semibold mb-4"},"ผลการสอบของนักเรียน",-1)),t("div",Ft,[t("table",jt,[r[14]||(r[14]=t("thead",{class:"text-xs text-gray-700 uppercase bg-gray-100 dark:bg-gray-700 dark:text-gray-400"},[t("tr",null,[t("th",{class:"px-6 py-3 rounded-l-lg"},"นักเรียน"),t("th",{class:"px-6 py-3"},"วันที่สอบ"),t("th",{class:"px-6 py-3"},"คะแนน"),t("th",{class:"px-6 py-3"},"เปอร์เซ็นต์"),t("th",{class:"px-6 py-3 rounded-r-lg"},"สถานะ")])],-1)),t("tbody",null,[(a(!0),n(N,null,Q(e(s).student_results,l=>(a(),n("tr",{key:l.id,class:"bg-white border-b dark:bg-gray-800 dark:border-gray-700"},[t("td",Bt,[t("div",Tt,[l.user?.avatar?(a(),n("img",{key:0,src:l.user.avatar,class:"w-full h-full object-cover"},null,8,Dt)):(a(),L(e(d),{key:1,icon:"fluent:person-24-filled",class:"w-full h-full p-1 text-gray-400"}))]),x(" "+o(l.user?.name||"Unknown"),1)]),t("td",St,o(l.completed_at?y(l.completed_at):l.started_at?"กำลังทำข้อสอบ":"-"),1),t("td",At,o(l.score)+" / "+o(e(s).total_score),1),t("td",It,o(parseFloat(l.percentage).toFixed(1))+"% ",1),t("td",Nt,[l.completed_at?(a(),n("span",{key:0,class:m(["px-2 py-1 rounded text-xs font-bold",l.status===3?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},o(l.status===3?"ผ่าน":"ไม่ผ่าน"),3)):(a(),n("span",Qt,"..."))])]))),128)),!e(s).student_results||e(s).student_results.length===0?(a(),n("tr",Vt,[...r[13]||(r[13]=[t("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"}," ยังไม่มีใครทำแบบทดสอบนี้นะ ",-1)])])):p("",!0)])])])]),t("div",Lt,[t("button",{onClick:z,class:"px-4 py-2 rounded-lg bg-blue-50 text-blue-600 hover:bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400 dark:hover:bg-blue-900/30 transition-colors flex items-center gap-2"},[i(e(d),{icon:"fluent:edit-24-regular",class:"w-5 h-5"}),r[16]||(r[16]=x(" แก้ไขแบบทดสอบ ",-1))])])])):(a(),n("div",mt,[e(s).current_result&&e(s).current_result.completed_at?(a(),n("div",yt,[r[12]||(r[12]=t("h3",{class:"text-lg font-semibold mb-4 text-center"},"ผลการทดสอบของคุณ",-1)),t("div",ft,[t("div",ht,[i(q,{percentage:e(s).current_result.score/e(s).total_score*100,color:e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-500":"text-green-600":"text-red-500",trackColor:"text-gray-100 dark:text-gray-700",size:100,strokeWidth:8},{default:C(()=>[t("div",vt,[t("span",{class:m(["text-2xl font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-600":"text-green-600":"text-red-600"])},o(e(s).current_result.score),3),t("span",kt,"/ "+o(e(s).total_score),1)])]),_:1},8,["percentage","color"]),r[10]||(r[10]=t("div",{class:"text-sm font-bold mt-3 text-gray-500"},"คะแนน",-1))]),t("div",wt,[i(q,{percentage:parseFloat(e(s).current_result.percentage),color:e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-500":"text-green-600":"text-red-500",trackColor:"text-gray-100 dark:text-gray-700",size:100,strokeWidth:8},{default:C(()=>[t("span",{class:m(["text-xl font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"text-orange-600":"text-green-600":"text-red-600"])},o(parseFloat(e(s).current_result.percentage).toFixed(0))+"% ",3)]),_:1},8,["percentage","color"]),r[11]||(r[11]=t("div",{class:"text-sm font-bold mt-3 text-gray-500"},"เปอร์เซ็นต์",-1))])]),t("div",zt,[t("span",{class:m(["px-3 py-1 rounded-full text-sm font-bold",e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"bg-orange-100 text-orange-700":"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},o(e(s).current_result.status===3?parseFloat(e(s).current_result.percentage)<e(s).passing_score+10?"ผ่านเฉียดฉิว":"ผ่านฉลุย":"ไม่ผ่าน"),3)])])):p("",!0),t("button",{onClick:F,class:"inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-xl font-bold text-lg hover:shadow-lg hover:scale-105 transition-all duration-300 shadow-purple-200 dark:shadow-none"},[i(e(d),{icon:"fluent:play-circle-24-filled",class:"w-8 h-8"}),x(" "+o(e(s).current_result&&e(s).current_result.completed_at?"ทำแบบทดสอบอีกครั้ง":"เริ่มทำแบบทดสอบ"),1)]),!e(s).current_result||!e(s).current_result.completed_at?(a(),n("p",Ct," เมื่อกดปุ่มเริ่มทำ เวลาจะนับถอยหลังทันที ")):p("",!0)]))])])])):(a(),n("div",Wt,[i(e(d),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),r[17]||(r[17]=t("h3",{class:"text-xl font-semibold text-gray-900 dark:text-white"},"ไม่พบข้อมูลแบบทดสอบ",-1)),t("button",{onClick:r[1]||(r[1]=l=>("navigateTo"in c?c.navigateTo:e(_))(`/courses/${e(u)}/quizzes`)),class:"mt-4 text-purple-600 hover:underline"}," กลับไปหน้ารวม ")]))]))}});export{Jt as default};
