import{_ as V}from"./fgoR5NrX.js";import{z as L,az as j,N as v,an as z,A as F,af as R,r as h,f as D,a4 as E,c as m,a,j as $,d as C,b as r,w as f,u as l,t as y,o as n,e as p,I as u,$ as H}from"./DuB962GZ.js";import{_ as M}from"./hThijwr8.js";import"./Dy2WcBMD.js";import"./D1c4_Teu.js";const T={class:"max-w-4xl mx-auto py-8 px-4"},q={class:"flex items-center gap-2 text-sm mb-6"},G={key:0,class:"flex justify-center items-center py-16"},J={key:1,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center"},K={class:"text-red-600 dark:text-red-400 mb-4"},O={key:2,class:"bg-red-50 dark:bg-red-900/20 rounded-xl p-8 text-center"},Z=L({__name:"edit",setup(P){const b=j(),d=v(()=>b.currentCourse),N=v(()=>b.isCourseAdmin),k=z(),_=F(),I=R(),s=v(()=>k.params.id),c=v(()=>k.params.lessonId),o=h(null),g=h(!0),i=h(null),S=async()=>{if(!d.value||d.value.id!=s.value)try{await b.fetchCourse(s.value)}catch(t){console.error("Failed to fetch course:",t)}},w=async()=>{if(!(!s.value||!c.value)){g.value=!0,i.value=null;try{const t=await I.get(`/api/courses/${s.value}/lessons/${c.value}`);o.value=t.lesson||t.data||t}catch(t){console.error("Failed to fetch lesson:",t),i.value=t.data?.message||"ไม่สามารถโหลดข้อมูลบทเรียนได้"}finally{g.value=!1}}};D(async()=>{await S(),await w()});const A=t=>{_.push(`/courses/${s.value}/lessons/${c.value}`)},B=()=>{_.back()};return E(o,t=>{t?.title&&H({title:`แก้ไข: ${t.title} - ${d.value?.name||"รายวิชา"}`})}),(t,e)=>{const x=V;return n(),m("div",T,[a("nav",q,[r(x,{to:`/courses/${s.value}`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:f(()=>[p(y(d.value?.name||"รายวิชา"),1)]),_:1},8,["to"]),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),r(x,{to:`/courses/${s.value}/lessons`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:f(()=>[...e[0]||(e[0]=[p(" บทเรียน ",-1)])]),_:1},8,["to"]),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),o.value?(n(),$(x,{key:0,to:`/courses/${s.value}/lessons/${c.value}`,class:"text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400"},{default:f(()=>[p(y(o.value.title),1)]),_:1},8,["to"])):C("",!0),r(l(u),{icon:"fluent:chevron-right-16-regular",class:"w-4 h-4 text-gray-400"}),e[1]||(e[1]=a("span",{class:"text-gray-900 dark:text-white font-medium"},"แก้ไข",-1))]),g.value?(n(),m("div",G,[...e[2]||(e[2]=[a("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):i.value?(n(),m("div",J,[r(l(u),{icon:"fluent:error-circle-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[3]||(e[3]=a("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"เกิดข้อผิดพลาด",-1)),a("p",K,y(i.value),1),a("button",{onClick:w,class:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"}," ลองใหม่ ")])):N.value?o.value?(n(),$(M,{key:3,"course-id":s.value,lesson:o.value,"is-edit":!0,onSubmit:A,onCancel:B},null,8,["course-id","lesson"])):C("",!0):(n(),m("div",O,[r(l(u),{icon:"fluent:shield-error-24-regular",class:"w-16 h-16 text-red-500 mx-auto mb-4"}),e[5]||(e[5]=a("h3",{class:"text-xl font-bold text-red-700 dark:text-red-400 mb-2"},"ไม่มีสิทธิ์เข้าถึง",-1)),e[6]||(e[6]=a("p",{class:"text-red-600 dark:text-red-400 mb-4"},"คุณไม่มีสิทธิ์ในการแก้ไขบทเรียน",-1)),r(x,{to:`/courses/${s.value}/lessons`,class:"inline-flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"},{default:f(()=>[r(l(u),{icon:"fluent:arrow-left-24-regular",class:"w-5 h-5"}),e[4]||(e[4]=p(" กลับไปหน้าบทเรียน ",-1))]),_:1},8,["to"])]))])}}});export{Z as default};
